{"schema": {"fields":[{"type":"integer","name":"index"},{"type":"string","name":"author_association"},{"type":"string","name":"body"},{"type":"datetime","name":"created_at"},{"type":"string","name":"html_url"},{"type":"integer","name":"id"},{"type":"string","name":"issue_url"},{"type":"string","name":"node_id"},{"type":"datetime","name":"updated_at"},{"type":"string","name":"url"},{"type":"string","name":"user"}],"pandas_version":"0.20.0","primaryKey":["index"]}, "data": [{"index":0,"author_association":"CONTRIBUTOR","body":"To remind: #10547, #10627, #11226, #11246\r\n\r\n@mrdoob \r\n@Mugen87\r\n@drcmda\r\n@pailhead\r\n@zorro-fr24\r\n\r\nFirst of all, i'm really sorry to being late on this topic... 2 works at same time, 3 children, 1 house in construction... the life ! So all my apologies. And nice too see you again !\r\n\r\nOk ok i readed the topix #11333, and just some little things...\r\n\r\nFirst of all, all these optimizations are here to avoid some circular references inside three.js with a gain of performance. If we revert all the things to the primary state, circular references will come back too, isn't it ? And performance will decrease too. \r\n\r\nYou said that the performance gain is ~~minor~~ **MAJOR**... \r\nIn my world: [https:\/\/jsperf.com\/test-identity-check-cost\/5](https:\/\/jsperf.com\/test-identity-check-cost\/5)\r\nFor me under chrome  61.0.3163.100 _ 64bits, i got:\r\n\r\n- without check 1514 +\/- 2.57% (fastest)\r\n- with OR check 385 +\/-0.26% (74% slower)\r\n- with identity check 389 +\/- 0.50% (74% slower) and voila !\r\n\r\n\r\nI understand too that the problem is fixed for webpack 2.5.1 users, right ?\r\n\r\nSo, if i fully understand your problem... You got circular reference for Vec3 and Mat4 due to the import inside Jest, right ? \r\nSo first of all, could you show the incriminated piece of code (I would try to reproduce, please) ? Next, why would you use this test library instead of the currently implemented QUnit ? It is for your own code base, or to replace QUnit ? Did you ask Jest team about this problem, maybe they had the same problem than webpack ?\r\n\r\nI hope we will find a better answer than revert all these things, like a include check on top of circular files maybe ?!\r\n\r\nBest regards,\r\nTristan","created_at":"2017-10-06T21:24:44.000Z","html_url":"https:\/\/github.com\/mrdoob\/three.js\/pull\/12348#issuecomment-334873811","id":334873811,"issue_url":"https:\/\/api.github.com\/repos\/mrdoob\/three.js\/issues\/12348","node_id":"MDEyOklzc3VlQ29tbWVudDMzNDg3MzgxMQ==","updated_at":"2017-10-06T21:24:44.000Z","url":"https:\/\/api.github.com\/repos\/mrdoob\/three.js\/issues\/comments\/334873811","user":{"following_url":"https:\/\/api.github.com\/users\/Itee\/following{\/other_user}","events_url":"https:\/\/api.github.com\/users\/Itee\/events{\/privacy}","avatar_url":"https:\/\/avatars0.githubusercontent.com\/u\/5276909?v=4","url":"https:\/\/api.github.com\/users\/Itee","gists_url":"https:\/\/api.github.com\/users\/Itee\/gists{\/gist_id}","html_url":"https:\/\/github.com\/Itee","subscriptions_url":"https:\/\/api.github.com\/users\/Itee\/subscriptions","node_id":"MDQ6VXNlcjUyNzY5MDk=","repos_url":"https:\/\/api.github.com\/users\/Itee\/repos","received_events_url":"https:\/\/api.github.com\/users\/Itee\/received_events","gravatar_id":"","starred_url":"https:\/\/api.github.com\/users\/Itee\/starred{\/owner}{\/repo}","site_admin":false,"login":"Itee","type":"User","id":5276909,"followers_url":"https:\/\/api.github.com\/users\/Itee\/followers","organizations_url":"https:\/\/api.github.com\/users\/Itee\/orgs"}},{"index":1,"author_association":"CONTRIBUTOR","body":"The reason you're getting the high performance benefit is because your for loop does not have any other changing code, so Chrome optimizes the entire for loop in the VM. If you do any sort of changing operation on `foo` the perf gain is _much_ lower.","created_at":"2017-10-06T21:29:19.000Z","html_url":"https:\/\/github.com\/mrdoob\/three.js\/pull\/12348#issuecomment-334874724","id":334874724,"issue_url":"https:\/\/api.github.com\/repos\/mrdoob\/three.js\/issues\/12348","node_id":"MDEyOklzc3VlQ29tbWVudDMzNDg3NDcyNA==","updated_at":"2017-10-06T21:29:19.000Z","url":"https:\/\/api.github.com\/repos\/mrdoob\/three.js\/issues\/comments\/334874724","user":{"following_url":"https:\/\/api.github.com\/users\/chazcb\/following{\/other_user}","events_url":"https:\/\/api.github.com\/users\/chazcb\/events{\/privacy}","avatar_url":"https:\/\/avatars3.githubusercontent.com\/u\/599298?v=4","url":"https:\/\/api.github.com\/users\/chazcb","gists_url":"https:\/\/api.github.com\/users\/chazcb\/gists{\/gist_id}","html_url":"https:\/\/github.com\/chazcb","subscriptions_url":"https:\/\/api.github.com\/users\/chazcb\/subscriptions","node_id":"MDQ6VXNlcjU5OTI5OA==","repos_url":"https:\/\/api.github.com\/users\/chazcb\/repos","received_events_url":"https:\/\/api.github.com\/users\/chazcb\/received_events","gravatar_id":"","starred_url":"https:\/\/api.github.com\/users\/chazcb\/starred{\/owner}{\/repo}","site_admin":false,"login":"chazcb","type":"User","id":599298,"followers_url":"https:\/\/api.github.com\/users\/chazcb\/followers","organizations_url":"https:\/\/api.github.com\/users\/chazcb\/orgs"}},{"index":2,"author_association":"CONTRIBUTOR","body":"@TristanVALCKE yeah, definitely the reason is because we use three.js in a larger code base. Our code base is tested using jest, which evaluates modules individually (e.g. it will evaluate Vector3 in isolation, then attempt to find all of Vector3's dependencies - in this case Matrix4). The issue is _only_ fixed if you are using webpack, which is great, because we use webpack when bundling for production! But it still makes testing any three.js related code not possible for us.\r\n\r\nI'll try to get a Jest suite up and running that shows the issue, but in the meanwhile, some example code:\r\n\r\n\r\nThis code works because Vector3 and Matrix4 functions are _hoisted to the top of the evaluation_.\r\n\r\n```js\r\nfunction Vector3() {}\r\nVector3.propotype = { \/\/ or using Object.assign\r\n   unproject: function () {\r\n        var matrix = new Matrix4()\r\n        return function unproject() { ... }\r\n   }()\r\n}\r\n\r\nfunction Matrix4() {}\r\nMatrix4.propotype = { \/\/ or using Object.assign\r\n   extractRotation: (function () {\r\n        var vector3 = new Vector3()\r\n        return function extractRotation() { ... }\r\n   })()\r\n}\r\n```\r\n\r\n\r\nThis code fails because the constructor functions are only hoisted within their local module closure.\r\n\r\n```js\r\n\/\/ .\/Vector3.js\r\nconst Matrix4 = require('Matrix4')\r\nfunction Vector3() {}\r\nVector3.propotype = { \/\/ or using Object.assign\r\n   unproject: function () {\r\n        var matrix = new Matrix4()\r\n        return function unproject() { ... }\r\n   }()\r\n}\r\nexport default Vector3\r\n```\r\n\r\n```js\r\n\/\/ .\/Matrix4.js\r\nconst Vector3 = require('Vector3')\r\nfunction Matrix4() {}\r\nMatrix4.propotype = { \/\/ or using Object.assign\r\n   extractRotation: (function () {\r\n        var vector3 = new Vector3()\r\n        return function extractRotation() { ... }\r\n   })()\r\n}\r\nexport default Matrix4\r\n```\r\n","created_at":"2017-10-06T21:43:00.000Z","html_url":"https:\/\/github.com\/mrdoob\/three.js\/pull\/12348#issuecomment-334877363","id":334877363,"issue_url":"https:\/\/api.github.com\/repos\/mrdoob\/three.js\/issues\/12348","node_id":"MDEyOklzc3VlQ29tbWVudDMzNDg3NzM2Mw==","updated_at":"2017-10-06T21:44:53.000Z","url":"https:\/\/api.github.com\/repos\/mrdoob\/three.js\/issues\/comments\/334877363","user":{"following_url":"https:\/\/api.github.com\/users\/chazcb\/following{\/other_user}","events_url":"https:\/\/api.github.com\/users\/chazcb\/events{\/privacy}","avatar_url":"https:\/\/avatars3.githubusercontent.com\/u\/599298?v=4","url":"https:\/\/api.github.com\/users\/chazcb","gists_url":"https:\/\/api.github.com\/users\/chazcb\/gists{\/gist_id}","html_url":"https:\/\/github.com\/chazcb","subscriptions_url":"https:\/\/api.github.com\/users\/chazcb\/subscriptions","node_id":"MDQ6VXNlcjU5OTI5OA==","repos_url":"https:\/\/api.github.com\/users\/chazcb\/repos","received_events_url":"https:\/\/api.github.com\/users\/chazcb\/received_events","gravatar_id":"","starred_url":"https:\/\/api.github.com\/users\/chazcb\/starred{\/owner}{\/repo}","site_admin":false,"login":"chazcb","type":"User","id":599298,"followers_url":"https:\/\/api.github.com\/users\/chazcb\/followers","organizations_url":"https:\/\/api.github.com\/users\/chazcb\/orgs"}},{"index":3,"author_association":"CONTRIBUTOR","body":"Ok thank for fast reply !\r\n\r\nThat what i understood... what class are affected by this problem ? Only Vector3 and Matrix4 or there is lot of other incriminated class ? And what about Jest team about circular references ?","created_at":"2017-10-06T21:48:38.000Z","html_url":"https:\/\/github.com\/mrdoob\/three.js\/pull\/12348#issuecomment-334878481","id":334878481,"issue_url":"https:\/\/api.github.com\/repos\/mrdoob\/three.js\/issues\/12348","node_id":"MDEyOklzc3VlQ29tbWVudDMzNDg3ODQ4MQ==","updated_at":"2017-10-06T21:48:38.000Z","url":"https:\/\/api.github.com\/repos\/mrdoob\/three.js\/issues\/comments\/334878481","user":{"following_url":"https:\/\/api.github.com\/users\/Itee\/following{\/other_user}","events_url":"https:\/\/api.github.com\/users\/Itee\/events{\/privacy}","avatar_url":"https:\/\/avatars0.githubusercontent.com\/u\/5276909?v=4","url":"https:\/\/api.github.com\/users\/Itee","gists_url":"https:\/\/api.github.com\/users\/Itee\/gists{\/gist_id}","html_url":"https:\/\/github.com\/Itee","subscriptions_url":"https:\/\/api.github.com\/users\/Itee\/subscriptions","node_id":"MDQ6VXNlcjUyNzY5MDk=","repos_url":"https:\/\/api.github.com\/users\/Itee\/repos","received_events_url":"https:\/\/api.github.com\/users\/Itee\/received_events","gravatar_id":"","starred_url":"https:\/\/api.github.com\/users\/Itee\/starred{\/owner}{\/repo}","site_admin":false,"login":"Itee","type":"User","id":5276909,"followers_url":"https:\/\/api.github.com\/users\/Itee\/followers","organizations_url":"https:\/\/api.github.com\/users\/Itee\/orgs"}},{"index":4,"author_association":"CONTRIBUTOR","body":"In my opinion, circular reference is not an edge case in javascript library and Jest will need ( a day ) to deal with it... So maybe they currently have a solution to solve this problem.\r\n\r\nAbout the test: [https:\/\/jsperf.com\/test-identity-check-cost\/7](https:\/\/jsperf.com\/test-identity-check-cost\/7)\r\n\r\nI got 10% slower which is more acceptable !","created_at":"2017-10-06T22:05:27.000Z","html_url":"https:\/\/github.com\/mrdoob\/three.js\/pull\/12348#issuecomment-334881292","id":334881292,"issue_url":"https:\/\/api.github.com\/repos\/mrdoob\/three.js\/issues\/12348","node_id":"MDEyOklzc3VlQ29tbWVudDMzNDg4MTI5Mg==","updated_at":"2017-10-06T22:05:27.000Z","url":"https:\/\/api.github.com\/repos\/mrdoob\/three.js\/issues\/comments\/334881292","user":{"following_url":"https:\/\/api.github.com\/users\/Itee\/following{\/other_user}","events_url":"https:\/\/api.github.com\/users\/Itee\/events{\/privacy}","avatar_url":"https:\/\/avatars0.githubusercontent.com\/u\/5276909?v=4","url":"https:\/\/api.github.com\/users\/Itee","gists_url":"https:\/\/api.github.com\/users\/Itee\/gists{\/gist_id}","html_url":"https:\/\/github.com\/Itee","subscriptions_url":"https:\/\/api.github.com\/users\/Itee\/subscriptions","node_id":"MDQ6VXNlcjUyNzY5MDk=","repos_url":"https:\/\/api.github.com\/users\/Itee\/repos","received_events_url":"https:\/\/api.github.com\/users\/Itee\/received_events","gravatar_id":"","starred_url":"https:\/\/api.github.com\/users\/Itee\/starred{\/owner}{\/repo}","site_admin":false,"login":"Itee","type":"User","id":5276909,"followers_url":"https:\/\/api.github.com\/users\/Itee\/followers","organizations_url":"https:\/\/api.github.com\/users\/Itee\/orgs"}},{"index":5,"author_association":"CONTRIBUTOR","body":"I'm putting together a repo right now to demo the problem with both babel's default module loader and w\/ webpack. In the meanwhile, yeah, I don't think the issue is circular dependency (this revert doesn't actually resolve a circular dep issue, it just avoids using constructors which are not hoisted).","created_at":"2017-10-06T22:18:36.000Z","html_url":"https:\/\/github.com\/mrdoob\/three.js\/pull\/12348#issuecomment-334883526","id":334883526,"issue_url":"https:\/\/api.github.com\/repos\/mrdoob\/three.js\/issues\/12348","node_id":"MDEyOklzc3VlQ29tbWVudDMzNDg4MzUyNg==","updated_at":"2017-10-06T22:18:36.000Z","url":"https:\/\/api.github.com\/repos\/mrdoob\/three.js\/issues\/comments\/334883526","user":{"following_url":"https:\/\/api.github.com\/users\/chazcb\/following{\/other_user}","events_url":"https:\/\/api.github.com\/users\/chazcb\/events{\/privacy}","avatar_url":"https:\/\/avatars3.githubusercontent.com\/u\/599298?v=4","url":"https:\/\/api.github.com\/users\/chazcb","gists_url":"https:\/\/api.github.com\/users\/chazcb\/gists{\/gist_id}","html_url":"https:\/\/github.com\/chazcb","subscriptions_url":"https:\/\/api.github.com\/users\/chazcb\/subscriptions","node_id":"MDQ6VXNlcjU5OTI5OA==","repos_url":"https:\/\/api.github.com\/users\/chazcb\/repos","received_events_url":"https:\/\/api.github.com\/users\/chazcb\/received_events","gravatar_id":"","starred_url":"https:\/\/api.github.com\/users\/chazcb\/starred{\/owner}{\/repo}","site_admin":false,"login":"chazcb","type":"User","id":599298,"followers_url":"https:\/\/api.github.com\/users\/chazcb\/followers","organizations_url":"https:\/\/api.github.com\/users\/chazcb\/orgs"}},{"index":6,"author_association":"CONTRIBUTOR","body":"Alright @TristanVALCKE added a repo here https:\/\/github.com\/chazcb\/circular-deps-es6 that has a few different versions of module loaders. Two are intended to obviously fail (`web` and `closured`) but I added them for clarity. `babel` is not so obvious that it should fail, but it does because babel's current behavior is to turn modules into commonjs type modules (I believe). `node` demos current default Node behavior, and finally `hoisted` demos the behavior we're getting w\/ three's rollup. I can flip all these demos over to use real three.js code, but I'm hoping this is clear enough to further the discussion.","created_at":"2017-10-06T23:11:05.000Z","html_url":"https:\/\/github.com\/mrdoob\/three.js\/pull\/12348#issuecomment-334890536","id":334890536,"issue_url":"https:\/\/api.github.com\/repos\/mrdoob\/three.js\/issues\/12348","node_id":"MDEyOklzc3VlQ29tbWVudDMzNDg5MDUzNg==","updated_at":"2017-10-06T23:11:05.000Z","url":"https:\/\/api.github.com\/repos\/mrdoob\/three.js\/issues\/comments\/334890536","user":{"following_url":"https:\/\/api.github.com\/users\/chazcb\/following{\/other_user}","events_url":"https:\/\/api.github.com\/users\/chazcb\/events{\/privacy}","avatar_url":"https:\/\/avatars3.githubusercontent.com\/u\/599298?v=4","url":"https:\/\/api.github.com\/users\/chazcb","gists_url":"https:\/\/api.github.com\/users\/chazcb\/gists{\/gist_id}","html_url":"https:\/\/github.com\/chazcb","subscriptions_url":"https:\/\/api.github.com\/users\/chazcb\/subscriptions","node_id":"MDQ6VXNlcjU5OTI5OA==","repos_url":"https:\/\/api.github.com\/users\/chazcb\/repos","received_events_url":"https:\/\/api.github.com\/users\/chazcb\/received_events","gravatar_id":"","starred_url":"https:\/\/api.github.com\/users\/chazcb\/starred{\/owner}{\/repo}","site_admin":false,"login":"chazcb","type":"User","id":599298,"followers_url":"https:\/\/api.github.com\/users\/chazcb\/followers","organizations_url":"https:\/\/api.github.com\/users\/chazcb\/orgs"}},{"index":7,"author_association":"CONTRIBUTOR","body":"Welp, turns out I can also subvert Jest to use the fully built three.module.js file (with hoisting) instead of the individual source files. I'll try that for now since it fixes our immediate issue.","created_at":"2017-10-06T23:27:27.000Z","html_url":"https:\/\/github.com\/mrdoob\/three.js\/pull\/12348#issuecomment-334892400","id":334892400,"issue_url":"https:\/\/api.github.com\/repos\/mrdoob\/three.js\/issues\/12348","node_id":"MDEyOklzc3VlQ29tbWVudDMzNDg5MjQwMA==","updated_at":"2017-10-06T23:27:52.000Z","url":"https:\/\/api.github.com\/repos\/mrdoob\/three.js\/issues\/comments\/334892400","user":{"following_url":"https:\/\/api.github.com\/users\/chazcb\/following{\/other_user}","events_url":"https:\/\/api.github.com\/users\/chazcb\/events{\/privacy}","avatar_url":"https:\/\/avatars3.githubusercontent.com\/u\/599298?v=4","url":"https:\/\/api.github.com\/users\/chazcb","gists_url":"https:\/\/api.github.com\/users\/chazcb\/gists{\/gist_id}","html_url":"https:\/\/github.com\/chazcb","subscriptions_url":"https:\/\/api.github.com\/users\/chazcb\/subscriptions","node_id":"MDQ6VXNlcjU5OTI5OA==","repos_url":"https:\/\/api.github.com\/users\/chazcb\/repos","received_events_url":"https:\/\/api.github.com\/users\/chazcb\/received_events","gravatar_id":"","starred_url":"https:\/\/api.github.com\/users\/chazcb\/starred{\/owner}{\/repo}","site_admin":false,"login":"chazcb","type":"User","id":599298,"followers_url":"https:\/\/api.github.com\/users\/chazcb\/followers","organizations_url":"https:\/\/api.github.com\/users\/chazcb\/orgs"}},{"index":8,"author_association":"CONTRIBUTOR","body":"@mrdoob  @TristanVALCKE just FYI, I think that Ashi is referencing this same issue here in her talk https:\/\/youtu.be\/DJ-oSy0tN_U?t=884 cc @queerviolet would love if you chimed in here","created_at":"2017-10-12T16:09:55.000Z","html_url":"https:\/\/github.com\/mrdoob\/three.js\/pull\/12348#issuecomment-336186191","id":336186191,"issue_url":"https:\/\/api.github.com\/repos\/mrdoob\/three.js\/issues\/12348","node_id":"MDEyOklzc3VlQ29tbWVudDMzNjE4NjE5MQ==","updated_at":"2017-10-12T16:10:10.000Z","url":"https:\/\/api.github.com\/repos\/mrdoob\/three.js\/issues\/comments\/336186191","user":{"following_url":"https:\/\/api.github.com\/users\/chazcb\/following{\/other_user}","events_url":"https:\/\/api.github.com\/users\/chazcb\/events{\/privacy}","avatar_url":"https:\/\/avatars3.githubusercontent.com\/u\/599298?v=4","url":"https:\/\/api.github.com\/users\/chazcb","gists_url":"https:\/\/api.github.com\/users\/chazcb\/gists{\/gist_id}","html_url":"https:\/\/github.com\/chazcb","subscriptions_url":"https:\/\/api.github.com\/users\/chazcb\/subscriptions","node_id":"MDQ6VXNlcjU5OTI5OA==","repos_url":"https:\/\/api.github.com\/users\/chazcb\/repos","received_events_url":"https:\/\/api.github.com\/users\/chazcb\/received_events","gravatar_id":"","starred_url":"https:\/\/api.github.com\/users\/chazcb\/starred{\/owner}{\/repo}","site_admin":false,"login":"chazcb","type":"User","id":599298,"followers_url":"https:\/\/api.github.com\/users\/chazcb\/followers","organizations_url":"https:\/\/api.github.com\/users\/chazcb\/orgs"}},{"index":9,"author_association":"CONTRIBUTOR","body":"I will take a look\r\n","created_at":"2017-10-13T16:19:18.000Z","html_url":"https:\/\/github.com\/mrdoob\/three.js\/pull\/12348#issuecomment-336499539","id":336499539,"issue_url":"https:\/\/api.github.com\/repos\/mrdoob\/three.js\/issues\/12348","node_id":"MDEyOklzc3VlQ29tbWVudDMzNjQ5OTUzOQ==","updated_at":"2017-10-13T16:19:18.000Z","url":"https:\/\/api.github.com\/repos\/mrdoob\/three.js\/issues\/comments\/336499539","user":{"following_url":"https:\/\/api.github.com\/users\/Itee\/following{\/other_user}","events_url":"https:\/\/api.github.com\/users\/Itee\/events{\/privacy}","avatar_url":"https:\/\/avatars0.githubusercontent.com\/u\/5276909?v=4","url":"https:\/\/api.github.com\/users\/Itee","gists_url":"https:\/\/api.github.com\/users\/Itee\/gists{\/gist_id}","html_url":"https:\/\/github.com\/Itee","subscriptions_url":"https:\/\/api.github.com\/users\/Itee\/subscriptions","node_id":"MDQ6VXNlcjUyNzY5MDk=","repos_url":"https:\/\/api.github.com\/users\/Itee\/repos","received_events_url":"https:\/\/api.github.com\/users\/Itee\/received_events","gravatar_id":"","starred_url":"https:\/\/api.github.com\/users\/Itee\/starred{\/owner}{\/repo}","site_admin":false,"login":"Itee","type":"User","id":5276909,"followers_url":"https:\/\/api.github.com\/users\/Itee\/followers","organizations_url":"https:\/\/api.github.com\/users\/Itee\/orgs"}}]}