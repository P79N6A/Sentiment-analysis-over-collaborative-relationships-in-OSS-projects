[
  {
    "url": "https://api.github.com/repos/grpc/grpc/issues/comments/377959839",
    "html_url": "https://github.com/grpc/grpc/issues/14900#issuecomment-377959839",
    "issue_url": "https://api.github.com/repos/grpc/grpc/issues/14900",
    "id": 377959839,
    "node_id": "MDEyOklzc3VlQ29tbWVudDM3Nzk1OTgzOQ==",
    "user": {
      "login": "ericgribkoff",
      "id": 5067076,
      "node_id": "MDQ6VXNlcjUwNjcwNzY=",
      "avatar_url": "https://avatars2.githubusercontent.com/u/5067076?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/ericgribkoff",
      "html_url": "https://github.com/ericgribkoff",
      "followers_url": "https://api.github.com/users/ericgribkoff/followers",
      "following_url": "https://api.github.com/users/ericgribkoff/following{/other_user}",
      "gists_url": "https://api.github.com/users/ericgribkoff/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/ericgribkoff/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/ericgribkoff/subscriptions",
      "organizations_url": "https://api.github.com/users/ericgribkoff/orgs",
      "repos_url": "https://api.github.com/users/ericgribkoff/repos",
      "events_url": "https://api.github.com/users/ericgribkoff/events{/privacy}",
      "received_events_url": "https://api.github.com/users/ericgribkoff/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2018-04-02T15:46:08Z",
    "updated_at": "2018-04-02T15:46:08Z",
    "author_association": "CONTRIBUTOR",
    "body": "Can you post the nginx config (or just the gRPC-relevant parts) that you are using? Also, how are you setting `path1` and `path2` for the client calls in your example - are the two paths coming from different proto service definitions?"
  },
  {
    "url": "https://api.github.com/repos/grpc/grpc/issues/comments/377964234",
    "html_url": "https://github.com/grpc/grpc/issues/14900#issuecomment-377964234",
    "issue_url": "https://api.github.com/repos/grpc/grpc/issues/14900",
    "id": 377964234,
    "node_id": "MDEyOklzc3VlQ29tbWVudDM3Nzk2NDIzNA==",
    "user": {
      "login": "sandersaares",
      "id": 9914262,
      "node_id": "MDQ6VXNlcjk5MTQyNjI=",
      "avatar_url": "https://avatars1.githubusercontent.com/u/9914262?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/sandersaares",
      "html_url": "https://github.com/sandersaares",
      "followers_url": "https://api.github.com/users/sandersaares/followers",
      "following_url": "https://api.github.com/users/sandersaares/following{/other_user}",
      "gists_url": "https://api.github.com/users/sandersaares/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/sandersaares/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/sandersaares/subscriptions",
      "organizations_url": "https://api.github.com/users/sandersaares/orgs",
      "repos_url": "https://api.github.com/users/sandersaares/repos",
      "events_url": "https://api.github.com/users/sandersaares/events{/privacy}",
      "received_events_url": "https://api.github.com/users/sandersaares/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2018-04-02T16:04:01Z",
    "updated_at": "2018-04-03T04:11:35Z",
    "author_association": "NONE",
    "body": "Here is an example nginx config I would like to use for this:\r\n\r\n```\r\n\tserver {\r\n\t\tlisten 82 http2 default_server;\r\n\r\n\t\t# Instance 1 in Docker container 1\r\n\t\tlocation /foo/ {\r\n\t\t\tgrpc_pass grpc://10.0.4.235:5124;\r\n\t\t}\r\n\t\t# Instance 2 in Docker container 2\r\n\t\tlocation /bar/ {\r\n\t\t\tgrpc_pass grpc://10.0.4.236:5124;\r\n\t\t}\r\n\t}\r\n```\r\n\r\nThe way I would like to use it (C# example here) is by specifying the path in the Channel constructor, where one would normally use just the host:port pair, as `new Channel(\"localhost:82/foo\", ChannelCredentials.Insecure)`. This currently creates a channel without throwing any exceptions but no traffic seems to reach nginx if a path is present, as far as I can tell."
  },
  {
    "url": "https://api.github.com/repos/grpc/grpc/issues/comments/378071244",
    "html_url": "https://github.com/grpc/grpc/issues/14900#issuecomment-378071244",
    "issue_url": "https://api.github.com/repos/grpc/grpc/issues/14900",
    "id": 378071244,
    "node_id": "MDEyOklzc3VlQ29tbWVudDM3ODA3MTI0NA==",
    "user": {
      "login": "ericgribkoff",
      "id": 5067076,
      "node_id": "MDQ6VXNlcjUwNjcwNzY=",
      "avatar_url": "https://avatars2.githubusercontent.com/u/5067076?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/ericgribkoff",
      "html_url": "https://github.com/ericgribkoff",
      "followers_url": "https://api.github.com/users/ericgribkoff/followers",
      "following_url": "https://api.github.com/users/ericgribkoff/following{/other_user}",
      "gists_url": "https://api.github.com/users/ericgribkoff/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/ericgribkoff/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/ericgribkoff/subscriptions",
      "organizations_url": "https://api.github.com/users/ericgribkoff/orgs",
      "repos_url": "https://api.github.com/users/ericgribkoff/repos",
      "events_url": "https://api.github.com/users/ericgribkoff/events{/privacy}",
      "received_events_url": "https://api.github.com/users/ericgribkoff/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2018-04-02T22:51:36Z",
    "updated_at": "2018-04-02T22:51:36Z",
    "author_association": "CONTRIBUTOR",
    "body": "Your use case makes sense. But I think you want to set this up using `:authority` rather than URI paths. The host used to create the channel does not go into the path used by gRPC (the channel builder arg should not include the \"/foo\" portion from your example). Instead, HTTP/2 paths are specified in a [`:path`](https://tools.ietf.org/html/rfc7540#section-8.1.2.3) header field, and gRPC clients generate these from the proto service definition in the form `protoPackage.serviceName.methodName` (see [here](https://github.com/grpc/grpc/blob/master/doc/PROTOCOL-HTTP2.md#requests)).\r\n\r\nI believe that you can accomplish your goal via setting the `default_authority` channel option, which is similar to setting a virtual hostname: it looks like you can set this in C# [here](https://github.com/grpc/grpc/blob/5253c8f9a899450397a5e46e4923d01ac9a66a27/src/csharp/Grpc.Core/ChannelOptions.cs#L152) and it will be used as the `:authority` HTTP/2 header. I am most familiar with our java implementation, and there are some comments on the use of the override authority feature in the [javadoc](https://github.com/grpc/grpc-java/blob/9be41ba0e84d85b9c9a96992d8158c2e95cb3050/core/src/main/java/io/grpc/ManagedChannelBuilder.java#L135). At least with Java, using this with TLS will require the overridden authority to still appear on your server's cert - I believe the same is true for wrapped languages (including C#), but if you plan to use this in production this should be verified.\r\n\r\nI'm still getting up to speed with nginx's gRPC support, but it should support routing requests based on the `:authority` HTTP/2 header. Let me know if this approach works for you, or if you encounter any issues."
  },
  {
    "url": "https://api.github.com/repos/grpc/grpc/issues/comments/378128267",
    "html_url": "https://github.com/grpc/grpc/issues/14900#issuecomment-378128267",
    "issue_url": "https://api.github.com/repos/grpc/grpc/issues/14900",
    "id": 378128267,
    "node_id": "MDEyOklzc3VlQ29tbWVudDM3ODEyODI2Nw==",
    "user": {
      "login": "sandersaares",
      "id": 9914262,
      "node_id": "MDQ6VXNlcjk5MTQyNjI=",
      "avatar_url": "https://avatars1.githubusercontent.com/u/9914262?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/sandersaares",
      "html_url": "https://github.com/sandersaares",
      "followers_url": "https://api.github.com/users/sandersaares/followers",
      "following_url": "https://api.github.com/users/sandersaares/following{/other_user}",
      "gists_url": "https://api.github.com/users/sandersaares/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/sandersaares/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/sandersaares/subscriptions",
      "organizations_url": "https://api.github.com/users/sandersaares/orgs",
      "repos_url": "https://api.github.com/users/sandersaares/repos",
      "events_url": "https://api.github.com/users/sandersaares/events{/privacy}",
      "received_events_url": "https://api.github.com/users/sandersaares/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2018-04-03T04:56:31Z",
    "updated_at": "2018-04-03T04:56:31Z",
    "author_association": "NONE",
    "body": "I confirm that setting `default_authority` and configuring nginx with individual `server` blocks for each route appears to work great. Thank you for the assistance!"
  },
  {
    "url": "https://api.github.com/repos/grpc/grpc/issues/comments/378138160",
    "html_url": "https://github.com/grpc/grpc/issues/14900#issuecomment-378138160",
    "issue_url": "https://api.github.com/repos/grpc/grpc/issues/14900",
    "id": 378138160,
    "node_id": "MDEyOklzc3VlQ29tbWVudDM3ODEzODE2MA==",
    "user": {
      "login": "ericgribkoff",
      "id": 5067076,
      "node_id": "MDQ6VXNlcjUwNjcwNzY=",
      "avatar_url": "https://avatars2.githubusercontent.com/u/5067076?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/ericgribkoff",
      "html_url": "https://github.com/ericgribkoff",
      "followers_url": "https://api.github.com/users/ericgribkoff/followers",
      "following_url": "https://api.github.com/users/ericgribkoff/following{/other_user}",
      "gists_url": "https://api.github.com/users/ericgribkoff/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/ericgribkoff/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/ericgribkoff/subscriptions",
      "organizations_url": "https://api.github.com/users/ericgribkoff/orgs",
      "repos_url": "https://api.github.com/users/ericgribkoff/repos",
      "events_url": "https://api.github.com/users/ericgribkoff/events{/privacy}",
      "received_events_url": "https://api.github.com/users/ericgribkoff/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2018-04-03T06:05:45Z",
    "updated_at": "2018-04-03T06:05:45Z",
    "author_association": "CONTRIBUTOR",
    "body": "Great, glad that worked for you! I'll mark this issue as closed."
  },
  {
    "url": "https://api.github.com/repos/grpc/grpc/issues/comments/404539447",
    "html_url": "https://github.com/grpc/grpc/issues/14900#issuecomment-404539447",
    "issue_url": "https://api.github.com/repos/grpc/grpc/issues/14900",
    "id": 404539447,
    "node_id": "MDEyOklzc3VlQ29tbWVudDQwNDUzOTQ0Nw==",
    "user": {
      "login": "NicolasDorier",
      "id": 3020646,
      "node_id": "MDQ6VXNlcjMwMjA2NDY=",
      "avatar_url": "https://avatars0.githubusercontent.com/u/3020646?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/NicolasDorier",
      "html_url": "https://github.com/NicolasDorier",
      "followers_url": "https://api.github.com/users/NicolasDorier/followers",
      "following_url": "https://api.github.com/users/NicolasDorier/following{/other_user}",
      "gists_url": "https://api.github.com/users/NicolasDorier/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/NicolasDorier/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/NicolasDorier/subscriptions",
      "organizations_url": "https://api.github.com/users/NicolasDorier/orgs",
      "repos_url": "https://api.github.com/users/NicolasDorier/repos",
      "events_url": "https://api.github.com/users/NicolasDorier/events{/privacy}",
      "received_events_url": "https://api.github.com/users/NicolasDorier/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2018-07-12T14:50:48Z",
    "updated_at": "2018-07-12T14:50:48Z",
    "author_association": "NONE",
    "body": "@sandersaares  Can you share how you used authority routing in the nginx config?"
  },
  {
    "url": "https://api.github.com/repos/grpc/grpc/issues/comments/418256898",
    "html_url": "https://github.com/grpc/grpc/issues/14900#issuecomment-418256898",
    "issue_url": "https://api.github.com/repos/grpc/grpc/issues/14900",
    "id": 418256898,
    "node_id": "MDEyOklzc3VlQ29tbWVudDQxODI1Njg5OA==",
    "user": {
      "login": "sandersaares",
      "id": 9914262,
      "node_id": "MDQ6VXNlcjk5MTQyNjI=",
      "avatar_url": "https://avatars1.githubusercontent.com/u/9914262?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/sandersaares",
      "html_url": "https://github.com/sandersaares",
      "followers_url": "https://api.github.com/users/sandersaares/followers",
      "following_url": "https://api.github.com/users/sandersaares/following{/other_user}",
      "gists_url": "https://api.github.com/users/sandersaares/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/sandersaares/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/sandersaares/subscriptions",
      "organizations_url": "https://api.github.com/users/sandersaares/orgs",
      "repos_url": "https://api.github.com/users/sandersaares/repos",
      "events_url": "https://api.github.com/users/sandersaares/events{/privacy}",
      "received_events_url": "https://api.github.com/users/sandersaares/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2018-09-04T06:37:15Z",
    "updated_at": "2018-09-05T08:10:53Z",
    "author_association": "NONE",
    "body": "@NicolasDorier here is an example for the \"abc\" and \"xyz\" authorities.\r\n\r\n```\r\n server {\r\n                listen 82 http2;\r\n                server_name abc;\r\n\r\n                location / {\r\n                        grpc_pass grpc://172.31.250.1:82;\r\n                }\r\n        }\r\n\r\n server {\r\n                listen 82 http2;\r\n                server_name xyz;\r\n\r\n                location / {\r\n                        grpc_pass grpc://172.31.250.2:82;\r\n                }\r\n        }\r\n```"
  },
  {
    "url": "https://api.github.com/repos/grpc/grpc/issues/comments/418291943",
    "html_url": "https://github.com/grpc/grpc/issues/14900#issuecomment-418291943",
    "issue_url": "https://api.github.com/repos/grpc/grpc/issues/14900",
    "id": 418291943,
    "node_id": "MDEyOklzc3VlQ29tbWVudDQxODI5MTk0Mw==",
    "user": {
      "login": "NicolasDorier",
      "id": 3020646,
      "node_id": "MDQ6VXNlcjMwMjA2NDY=",
      "avatar_url": "https://avatars0.githubusercontent.com/u/3020646?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/NicolasDorier",
      "html_url": "https://github.com/NicolasDorier",
      "followers_url": "https://api.github.com/users/NicolasDorier/followers",
      "following_url": "https://api.github.com/users/NicolasDorier/following{/other_user}",
      "gists_url": "https://api.github.com/users/NicolasDorier/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/NicolasDorier/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/NicolasDorier/subscriptions",
      "organizations_url": "https://api.github.com/users/NicolasDorier/orgs",
      "repos_url": "https://api.github.com/users/NicolasDorier/repos",
      "events_url": "https://api.github.com/users/NicolasDorier/events{/privacy}",
      "received_events_url": "https://api.github.com/users/NicolasDorier/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2018-09-04T08:54:04Z",
    "updated_at": "2018-09-04T08:54:04Z",
    "author_association": "NONE",
    "body": "Ah so you need different port for each :/"
  },
  {
    "url": "https://api.github.com/repos/grpc/grpc/issues/comments/418639452",
    "html_url": "https://github.com/grpc/grpc/issues/14900#issuecomment-418639452",
    "issue_url": "https://api.github.com/repos/grpc/grpc/issues/14900",
    "id": 418639452,
    "node_id": "MDEyOklzc3VlQ29tbWVudDQxODYzOTQ1Mg==",
    "user": {
      "login": "sandersaares",
      "id": 9914262,
      "node_id": "MDQ6VXNlcjk5MTQyNjI=",
      "avatar_url": "https://avatars1.githubusercontent.com/u/9914262?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/sandersaares",
      "html_url": "https://github.com/sandersaares",
      "followers_url": "https://api.github.com/users/sandersaares/followers",
      "following_url": "https://api.github.com/users/sandersaares/following{/other_user}",
      "gists_url": "https://api.github.com/users/sandersaares/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/sandersaares/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/sandersaares/subscriptions",
      "organizations_url": "https://api.github.com/users/sandersaares/orgs",
      "repos_url": "https://api.github.com/users/sandersaares/repos",
      "events_url": "https://api.github.com/users/sandersaares/events{/privacy}",
      "received_events_url": "https://api.github.com/users/sandersaares/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2018-09-05T08:10:06Z",
    "updated_at": "2018-09-05T08:10:31Z",
    "author_association": "NONE",
    "body": "No, you can have multiple server blocks use the same port. I edit my example for two services."
  },
  {
    "url": "https://api.github.com/repos/grpc/grpc/issues/comments/418665989",
    "html_url": "https://github.com/grpc/grpc/issues/14900#issuecomment-418665989",
    "issue_url": "https://api.github.com/repos/grpc/grpc/issues/14900",
    "id": 418665989,
    "node_id": "MDEyOklzc3VlQ29tbWVudDQxODY2NTk4OQ==",
    "user": {
      "login": "NicolasDorier",
      "id": 3020646,
      "node_id": "MDQ6VXNlcjMwMjA2NDY=",
      "avatar_url": "https://avatars0.githubusercontent.com/u/3020646?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/NicolasDorier",
      "html_url": "https://github.com/NicolasDorier",
      "followers_url": "https://api.github.com/users/NicolasDorier/followers",
      "following_url": "https://api.github.com/users/NicolasDorier/following{/other_user}",
      "gists_url": "https://api.github.com/users/NicolasDorier/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/NicolasDorier/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/NicolasDorier/subscriptions",
      "organizations_url": "https://api.github.com/users/NicolasDorier/orgs",
      "repos_url": "https://api.github.com/users/NicolasDorier/repos",
      "events_url": "https://api.github.com/users/NicolasDorier/events{/privacy}",
      "received_events_url": "https://api.github.com/users/NicolasDorier/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2018-09-05T09:33:43Z",
    "updated_at": "2018-09-05T09:33:43Z",
    "author_association": "NONE",
    "body": "This is awesome, thanks a lot."
  }
]
