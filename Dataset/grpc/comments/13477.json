[
  {
    "url": "https://api.github.com/repos/grpc/grpc/issues/comments/351839046",
    "html_url": "https://github.com/grpc/grpc/issues/13477#issuecomment-351839046",
    "issue_url": "https://api.github.com/repos/grpc/grpc/issues/13477",
    "id": 351839046,
    "node_id": "MDEyOklzc3VlQ29tbWVudDM1MTgzOTA0Ng==",
    "user": {
      "login": "jtattermusch",
      "id": 9939684,
      "node_id": "MDQ6VXNlcjk5Mzk2ODQ=",
      "avatar_url": "https://avatars1.githubusercontent.com/u/9939684?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/jtattermusch",
      "html_url": "https://github.com/jtattermusch",
      "followers_url": "https://api.github.com/users/jtattermusch/followers",
      "following_url": "https://api.github.com/users/jtattermusch/following{/other_user}",
      "gists_url": "https://api.github.com/users/jtattermusch/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/jtattermusch/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/jtattermusch/subscriptions",
      "organizations_url": "https://api.github.com/users/jtattermusch/orgs",
      "repos_url": "https://api.github.com/users/jtattermusch/repos",
      "events_url": "https://api.github.com/users/jtattermusch/events{/privacy}",
      "received_events_url": "https://api.github.com/users/jtattermusch/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2017-12-14T21:19:47Z",
    "updated_at": "2017-12-14T21:20:13Z",
    "author_association": "CONTRIBUTOR",
    "body": "Seen on all of linux opt, linux dbg, tsan. Also seen for other pollers."
  },
  {
    "url": "https://api.github.com/repos/grpc/grpc/issues/comments/357670322",
    "html_url": "https://github.com/grpc/grpc/issues/13477#issuecomment-357670322",
    "issue_url": "https://api.github.com/repos/grpc/grpc/issues/13477",
    "id": 357670322,
    "node_id": "MDEyOklzc3VlQ29tbWVudDM1NzY3MDMyMg==",
    "user": {
      "login": "jtattermusch",
      "id": 9939684,
      "node_id": "MDQ6VXNlcjk5Mzk2ODQ=",
      "avatar_url": "https://avatars1.githubusercontent.com/u/9939684?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/jtattermusch",
      "html_url": "https://github.com/jtattermusch",
      "followers_url": "https://api.github.com/users/jtattermusch/followers",
      "following_url": "https://api.github.com/users/jtattermusch/following{/other_user}",
      "gists_url": "https://api.github.com/users/jtattermusch/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/jtattermusch/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/jtattermusch/subscriptions",
      "organizations_url": "https://api.github.com/users/jtattermusch/orgs",
      "repos_url": "https://api.github.com/users/jtattermusch/repos",
      "events_url": "https://api.github.com/users/jtattermusch/events{/privacy}",
      "received_events_url": "https://api.github.com/users/jtattermusch/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2018-01-15T12:31:59Z",
    "updated_at": "2018-01-15T12:31:59Z",
    "author_association": "CONTRIBUTOR",
    "body": "Is there any progress here?  Currently this, is breaking 10% of our dbg, opt and asan builds.\r\n\r\nThe error messages look like this:\r\n\r\n```\r\ned: {\"created\":\"@1515975860.938660549\",\"description\":\"Handshake failed\",\"file\":\"src/core/lib/security/transport/security_handshaker.cc\",\"file_line\":242,\"tsi_code\":10,\"tsi_error\":\"TSI_PROTOCOL_FAILURE\"}\r\nD0115 00:24:20.938695356   18964 chttp2_server.cc:110]       Handshaking failed: {\"created\":\"@1515975860.938660549\",\"description\":\"Handshake failed\",\"file\":\"src/core/lib/security/transport/security_handshaker.cc\",\"file_line\":242,\"tsi_code\":10,\"tsi_error\":\"TSI_PROTOCOL_FAILURE\"}\r\nD0115 00:24:20.938755350   18964 security_handshaker.cc:127] Security handshake failed: {\"created\":\"@1515975860.938737672\",\"description\":\"Handshake read failed\",\"file\":\"src/core/lib/security/transport/security_handshaker.cc\",\"file_line\":315,\"referenced_errors\":[{\"created\":\"@1515975860.938735955\",\"description\":\"Socket closed\",\"fd\":14,\"file\":\"src/core/lib/iomgr/tcp_posix.cc\",\"file_line\":421,\"grpc_status\":14,\"target_address\":\"ipv6:[::1]:25697\"}]}\r\nI0115 00:24:20.938815504   18964 subchannel.cc:679]          Connect failed: {\"created\":\"@1515975860.938737672\",\"description\":\"Handshake read failed\",\"file\":\"src/core/lib/security/transport/security_handshaker.cc\",\"file_line\":315,\"referenced_errors\":[{\"created\":\"@1515975860.938735955\",\"description\":\"Socket closed\",\"fd\":14,\"file\":\"src/core/lib/iomgr/tcp_posix.cc\",\"file_line\":421,\"grpc_status\":14,\"target_address\":\"ipv6:[::1]:25697\"}]}\r\nI0115 00:24:20.938826530   18964 subchannel.cc:486]          Retry in 3 milliseconds\r\nI0115 00:24:20.941742465   18967 subchannel.cc:439]          Failed to connect to channel, retrying\r\nE0115 00:24:20.949551398   18964 ssl_transport_security.cc:979] Handshake failed with fatal error SSL_ERROR_SSL: error:1000007d:SSL routines:OPENSSL_internal:CERTIFICATE_VERIFY_FAILED.\r\nD0115 00:24:20.949575845   18964 security_handshaker.cc:127] Security handshake failed: {\"created\":\"@1515975860.949565338\",\"description\":\"Handshake failed\",\"file\":\"src/core/lib/security/transport/security_handshaker.cc\",\"file_line\":242,\"tsi_code\":10,\"tsi_error\":\"TSI_PROTOCOL_FAILURE\"}\r\nD0115 00:24:20.949597884   18964 chttp2_server.cc:110]       Handshaking failed: {\"created\":\"@1515975860.949565338\",\"description\":\"Handshake failed\",\"file\":\"src/core/lib/security/transport/security_handshaker.cc\",\"file_line\":242,\"tsi_code\":10,\"tsi_error\":\"TSI_PROTOCOL_FAILURE\"}\r\nD0115 00:24:20.949663331   18964 security_handshaker.cc:127] Security handshake failed: {\"created\":\"@1515975860.949645184\",\"description\":\"Handshake read failed\",\"file\":\"src/core/lib/security/transport/security_handshaker.cc\",\"file_line\":315,\"referenced_errors\":[{\"created\":\"@1515975860.949643561\",\"description\":\"Socket closed\",\"fd\":14,\"file\":\"src/core/lib/iomgr/tcp_posix.cc\",\"file_line\":421,\"grpc_status\":14,\"target_address\":\"ipv4:127.0.0.1:25697\"}]}\r\nI0115 00:24:20.949714747   18964 subchannel.cc:679]          Connect failed: {\"created\":\"@1515975860.949645184\",\"description\":\"Handshake read failed\",\"file\":\"src/core/lib/security/transport/security_handshaker.cc\",\"file_line\":315,\"referenced_errors\":[{\"created\":\"@1515975860.949643561\",\"description\":\"Socket closed\",\"fd\":14,\"file\":\"src/core/lib/iomgr/tcp_posix.cc\",\"file_line\":421,\"grpc_status\":14,\"target_address\":\"ipv4:127.0.0.1:25697\"}]}\r\nI0115 00:24:20.949726413   18964 subchannel.cc:486]          Retry in 1846 milliseconds\r\nI0115 00:24:22.795766338   21297 subchannel.cc:439]          Failed to connect to channel, retrying\r\nE0115 00:24:22.803980927   18964 ssl_transport_security.cc:979] Handshake failed with fatal error SSL_ERROR_SSL: error:1000007d:SSL routines:OPENSSL_internal:CERTIFICATE_VERIFY_FAILED.\r\nD0115 00:24:22.804010438   18964 security_handshaker.cc:127] Security handshake failed: {\"created\":\"@1515975862.803998494\",\"description\":\"Handshake failed\",\"file\":\"src/core/lib/security/transport/security_handshaker.cc\",\"file_line\":242,\"tsi_code\":10,\"tsi_error\":\"TSI_PROTOCOL_FAILURE\"}\r\nD0115 00:24:22.804044236   18964 chttp2_server.cc:110]       Handshaking failed: {\"created\":\"@1515975862.803998494\",\"description\":\"Handshake failed\",\"file\":\"src/core/lib/security/transport/security_handshaker.cc\",\"file_line\":242,\"tsi_code\":10,\"tsi_error\":\"TSI_PROTOCOL_FAILURE\"}\r\nD0115 00:24:22.804120918   18964 security_handshaker.cc:127] Security handshake failed: {\"created\":\"@1515975862.804097515\",\"description\":\"Handshake read failed\",\"file\":\"src/core/lib/security/transport/security_handshaker.cc\",\"file_line\":315,\"referenced_errors\":[{\"created\":\"@1515975862.804095618\",\"description\":\"Socket closed\",\"fd\":14,\"file\":\"src/core/lib/iomgr/tcp_posix.cc\",\"file_line\":421,\"grpc_status\":14,\"target_address\":\"ipv6:[::1]:25697\"}]}\r\nI0115 00:24:22.804193918   18964 subchannel.cc:679]          Connect failed: {\"created\":\"@1515975862.804097515\",\"description\":\"Handshake read failed\",\"file\":\"src/core/lib/security/transport/security_handshaker.cc\",\"file_line\":315,\"referenced_errors\":[{\"created\":\"@1515975862.804095618\",\"description\":\"Socket closed\",\"fd\":14,\"file\":\"src/core/lib/iomgr/tcp_posix.cc\",\"file_line\":421,\"grpc_status\":14,\"target_address\":\"ipv6:[::1]:25697\"}]}\r\nI0115 00:24:22.804212513   18964 subchannel.cc:486]          Retry in 38 milliseconds\r\nI0115 00:24:22.841746586   18967 subchannel.cc:439]          Failed to connect to channel, retrying\r\nE0115 00:24:22.849470367   18964 ssl_transport_security.cc:979] Handshake failed with fatal error SSL_ERROR_SSL: error:1000007d:SSL routines:OPENSSL_internal:CERTIFICATE_VERIFY_FAILED.\r\nD0115 00:24:22.849497926   18964 security_handshaker.cc:127] Security handshake failed: {\"created\":\"@1515975862.849486661\",\"description\":\"Handshake failed\",\"file\":\"src/core/lib/security/transport/security_handshaker.cc\",\"file_line\":242,\"tsi_code\":10,\"tsi_error\":\"TSI_PROTOCOL_FAILURE\"}\r\nD0115 00:24:22.849537638   18964 chttp2_server.cc:110]       Handshaking failed: {\"created\":\"@1515975862.849486661\",\"description\":\"Handshake failed\",\"file\":\"src/core/lib/security/transport/security_handshaker.cc\",\"file_line\":242,\"tsi_code\":10,\"tsi_error\":\"TSI_PROTOCOL_FAILURE\"}\r\nD0115 00:24:22.849598666   18964 security_handshaker.cc:127] Security handshake failed: {\"created\":\"@1515975862.849580650\",\"description\":\"Handshake read failed\",\"file\":\"src/core/lib/security/transport/security_handshaker.cc\",\"file_line\":315,\"referenced_errors\":[{\"created\":\"@1515975862.849578887\",\"description\":\"Socket closed\",\"fd\":14,\"file\":\"src/core/lib/iomgr/tcp_posix.cc\",\"file_line\":421,\"grpc_status\":14,\"target_address\":\"ipv4:127.0.0.1:25697\"}]}\r\nI0115 00:24:22.849652006   18964 subchannel.cc:679]          Connect failed: {\"created\":\"@1515975862.849580650\",\"description\":\"Handshake read failed\",\"file\":\"src/core/lib/security/transport/security_handshaker.cc\",\"file_line\":315,\"referenced_errors\":[{\"created\":\"@1515975862.849578887\",\"description\":\"Socket closed\",\"fd\":14,\"file\":\"src/core/lib/iomgr/tcp_posix.cc\",\"file_line\":421,\"grpc_status\":14,\"target_address\":\"ipv4:127.0.0.1:25697\"}]}\r\nI0115 00:24:22.849665175   18964 subchannel.cc:486]          Retry in 2076 milliseconds\r\nI0115 00:24:24.925778976   21297 subchannel.cc:439]          Failed to connect to channel, retrying\r\nE0115 00:24:29.939232084   18964 h2_ssl_cert_test.cc:279]    assertion failed: grpc_completion_queue_pluck(f->shutdown_cq, tag(1000), grpc_timeout_seconds_to_deadline(5), nullptr) .type == GRPC_OP_COMPLETE\r\n```\r\n\r\n\r\nhttps://sponge.corp.google.com/target?id=7928d303-68ff-4f2b-a506-c1057396d8fc&target=github/grpc/c%2B%2B_linux_dbg_native&searchFor=&show=FAILED&sortBy=STATUS\r\nhttps://sponge.corp.google.com/invocation?id=6d61b006-c76c-4ce0-b258-e5d9ad40e21c\r\n\r\n\r\n"
  },
  {
    "url": "https://api.github.com/repos/grpc/grpc/issues/comments/357670483",
    "html_url": "https://github.com/grpc/grpc/issues/13477#issuecomment-357670483",
    "issue_url": "https://api.github.com/repos/grpc/grpc/issues/13477",
    "id": 357670483,
    "node_id": "MDEyOklzc3VlQ29tbWVudDM1NzY3MDQ4Mw==",
    "user": {
      "login": "jtattermusch",
      "id": 9939684,
      "node_id": "MDQ6VXNlcjk5Mzk2ODQ=",
      "avatar_url": "https://avatars1.githubusercontent.com/u/9939684?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/jtattermusch",
      "html_url": "https://github.com/jtattermusch",
      "followers_url": "https://api.github.com/users/jtattermusch/followers",
      "following_url": "https://api.github.com/users/jtattermusch/following{/other_user}",
      "gists_url": "https://api.github.com/users/jtattermusch/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/jtattermusch/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/jtattermusch/subscriptions",
      "organizations_url": "https://api.github.com/users/jtattermusch/orgs",
      "repos_url": "https://api.github.com/users/jtattermusch/repos",
      "events_url": "https://api.github.com/users/jtattermusch/events{/privacy}",
      "received_events_url": "https://api.github.com/users/jtattermusch/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2018-01-15T12:32:45Z",
    "updated_at": "2018-01-15T12:32:45Z",
    "author_association": "CONTRIBUTOR",
    "body": "https://sponge.corp.google.com/target?id=5d04820c-e98f-42c6-a515-37e99a088764&target=github/grpc/c%2B%2B_linux_dbg_native&searchFor=&show=FAILED&sortBy=STATUS\r\n"
  },
  {
    "url": "https://api.github.com/repos/grpc/grpc/issues/comments/358268174",
    "html_url": "https://github.com/grpc/grpc/issues/13477#issuecomment-358268174",
    "issue_url": "https://api.github.com/repos/grpc/grpc/issues/13477",
    "id": 358268174,
    "node_id": "MDEyOklzc3VlQ29tbWVudDM1ODI2ODE3NA==",
    "user": {
      "login": "jtattermusch",
      "id": 9939684,
      "node_id": "MDQ6VXNlcjk5Mzk2ODQ=",
      "avatar_url": "https://avatars1.githubusercontent.com/u/9939684?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/jtattermusch",
      "html_url": "https://github.com/jtattermusch",
      "followers_url": "https://api.github.com/users/jtattermusch/followers",
      "following_url": "https://api.github.com/users/jtattermusch/following{/other_user}",
      "gists_url": "https://api.github.com/users/jtattermusch/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/jtattermusch/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/jtattermusch/subscriptions",
      "organizations_url": "https://api.github.com/users/jtattermusch/orgs",
      "repos_url": "https://api.github.com/users/jtattermusch/repos",
      "events_url": "https://api.github.com/users/jtattermusch/events{/privacy}",
      "received_events_url": "https://api.github.com/users/jtattermusch/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2018-01-17T10:51:23Z",
    "updated_at": "2018-01-17T10:51:23Z",
    "author_association": "CONTRIBUTOR",
    "body": "This is also happening on mac\r\nhttps://sponge.corp.google.com/target?id=e5b72fdd-6e33-4f8a-98a1-3116a6d3d318&target=github/grpc/c%2B%2B_macos_dbg_native&searchFor=&show=FAILED&sortBy=STATUS"
  },
  {
    "url": "https://api.github.com/repos/grpc/grpc/issues/comments/358279302",
    "html_url": "https://github.com/grpc/grpc/issues/13477#issuecomment-358279302",
    "issue_url": "https://api.github.com/repos/grpc/grpc/issues/13477",
    "id": 358279302,
    "node_id": "MDEyOklzc3VlQ29tbWVudDM1ODI3OTMwMg==",
    "user": {
      "login": "jtattermusch",
      "id": 9939684,
      "node_id": "MDQ6VXNlcjk5Mzk2ODQ=",
      "avatar_url": "https://avatars1.githubusercontent.com/u/9939684?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/jtattermusch",
      "html_url": "https://github.com/jtattermusch",
      "followers_url": "https://api.github.com/users/jtattermusch/followers",
      "following_url": "https://api.github.com/users/jtattermusch/following{/other_user}",
      "gists_url": "https://api.github.com/users/jtattermusch/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/jtattermusch/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/jtattermusch/subscriptions",
      "organizations_url": "https://api.github.com/users/jtattermusch/orgs",
      "repos_url": "https://api.github.com/users/jtattermusch/repos",
      "events_url": "https://api.github.com/users/jtattermusch/events{/privacy}",
      "received_events_url": "https://api.github.com/users/jtattermusch/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2018-01-17T11:39:30Z",
    "updated_at": "2018-01-17T11:39:30Z",
    "author_association": "CONTRIBUTOR",
    "body": "I took a closer look at the failure logs and this is what's happening:\r\n\r\nThe specific test cases that are flaky are:\r\n`SSL_CERT_tests/chttp2/ssl_GRPC_SSL_REQUEST_AND_REQUIRE_CLIENT_CERTIFICATE_BUT_DONT_VERIFY_NONE_FAIL_`\r\nor \r\n`SSL_CERT_tests/chttp2/ssl_GRPC_SSL_REQUEST_AND_REQUIRE_CLIENT_CERTIFICATE_AND_VERIFY_SELF_SIGNED_FAIL_`\r\n\r\n(and they are supposed to fail, so the `Handshake failed with fatal error SSL_ERROR_SSL: error:1000007d:SSL routines:OPENSSL_internal:CERTIFICATE_VERIFY_FAILED.`  error messages are expected.\r\n\r\nAfter the client fails to connect multiple times, the server goes for shutdown and fails to shutdown within the 5 second deadline, which aborts the test\r\n```\r\n[ RUN      ] H2SslCert/H2SslCertTest.SimpleRequestBody/12\r\nI0116 15:48:33.367451214   28248 h2_ssl_cert_test.cc:336]    SSL_CERT_tests/chttp2/ssl_GRPC_SSL_REQUEST_AND_REQUIRE_CLIENT_CERTIFICATE_BUT_DONT_VERIFY_NONE_FAIL_\r\n....\r\n[handshake failed errors here are expected]\r\n...\r\nE0116 15:48:43.375905473   28248 h2_ssl_cert_test.cc:279]    assertion failed: grpc_completion_queue_pluck(f->shutdown_cq, tag(1000), grpc_timeout_seconds_to_deadline(5), nullptr) .type == GRPC_OP_COMPLETE\r\n```\r\n\r\n\r\n"
  },
  {
    "url": "https://api.github.com/repos/grpc/grpc/issues/comments/358285880",
    "html_url": "https://github.com/grpc/grpc/issues/13477#issuecomment-358285880",
    "issue_url": "https://api.github.com/repos/grpc/grpc/issues/13477",
    "id": 358285880,
    "node_id": "MDEyOklzc3VlQ29tbWVudDM1ODI4NTg4MA==",
    "user": {
      "login": "jtattermusch",
      "id": 9939684,
      "node_id": "MDQ6VXNlcjk5Mzk2ODQ=",
      "avatar_url": "https://avatars1.githubusercontent.com/u/9939684?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/jtattermusch",
      "html_url": "https://github.com/jtattermusch",
      "followers_url": "https://api.github.com/users/jtattermusch/followers",
      "following_url": "https://api.github.com/users/jtattermusch/following{/other_user}",
      "gists_url": "https://api.github.com/users/jtattermusch/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/jtattermusch/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/jtattermusch/subscriptions",
      "organizations_url": "https://api.github.com/users/jtattermusch/orgs",
      "repos_url": "https://api.github.com/users/jtattermusch/repos",
      "events_url": "https://api.github.com/users/jtattermusch/events{/privacy}",
      "received_events_url": "https://api.github.com/users/jtattermusch/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2018-01-17T12:10:24Z",
    "updated_at": "2018-01-17T12:10:46Z",
    "author_association": "CONTRIBUTOR",
    "body": "I can reproduce locally with\r\n`GRPC_TRACE=api GRPC_VERBOSITY=debug tools/run_tests/run_tests.py -c dbg -l c++ -r 'H2SslCert/H2SslCertTest.SimpleRequestBody/12' -n 100 -j 50 --force_use_pollers poll`"
  },
  {
    "url": "https://api.github.com/repos/grpc/grpc/issues/comments/360759158",
    "html_url": "https://github.com/grpc/grpc/issues/13477#issuecomment-360759158",
    "issue_url": "https://api.github.com/repos/grpc/grpc/issues/13477",
    "id": 360759158,
    "node_id": "MDEyOklzc3VlQ29tbWVudDM2MDc1OTE1OA==",
    "user": {
      "login": "jtattermusch",
      "id": 9939684,
      "node_id": "MDQ6VXNlcjk5Mzk2ODQ=",
      "avatar_url": "https://avatars1.githubusercontent.com/u/9939684?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/jtattermusch",
      "html_url": "https://github.com/jtattermusch",
      "followers_url": "https://api.github.com/users/jtattermusch/followers",
      "following_url": "https://api.github.com/users/jtattermusch/following{/other_user}",
      "gists_url": "https://api.github.com/users/jtattermusch/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/jtattermusch/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/jtattermusch/subscriptions",
      "organizations_url": "https://api.github.com/users/jtattermusch/orgs",
      "repos_url": "https://api.github.com/users/jtattermusch/repos",
      "events_url": "https://api.github.com/users/jtattermusch/events{/privacy}",
      "received_events_url": "https://api.github.com/users/jtattermusch/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2018-01-26T11:20:32Z",
    "updated_at": "2018-01-26T11:20:32Z",
    "author_association": "CONTRIBUTOR",
    "body": "More insight:\r\n- after the test finishes successfully, the server shutdown is request, but the completion fails to be delivered within 5 secs:\r\nhttps://github.com/grpc/grpc/blob/75c190ddd39db674744c387580c1f85b14c4509b/test/core/end2end/h2_ssl_cert_test.cc#L276\r\n- there is 1 listener attached to the server. I think destroying of the listener is requested, but `listener_destroy_done` is never invoked, so cq_end_op  is never emitted (should be invoked by  `maybe_finish_shutdown` which should be invoked by `listener_destroy_done`)."
  },
  {
    "url": "https://api.github.com/repos/grpc/grpc/issues/comments/360768708",
    "html_url": "https://github.com/grpc/grpc/issues/13477#issuecomment-360768708",
    "issue_url": "https://api.github.com/repos/grpc/grpc/issues/13477",
    "id": 360768708,
    "node_id": "MDEyOklzc3VlQ29tbWVudDM2MDc2ODcwOA==",
    "user": {
      "login": "jtattermusch",
      "id": 9939684,
      "node_id": "MDQ6VXNlcjk5Mzk2ODQ=",
      "avatar_url": "https://avatars1.githubusercontent.com/u/9939684?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/jtattermusch",
      "html_url": "https://github.com/jtattermusch",
      "followers_url": "https://api.github.com/users/jtattermusch/followers",
      "following_url": "https://api.github.com/users/jtattermusch/following{/other_user}",
      "gists_url": "https://api.github.com/users/jtattermusch/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/jtattermusch/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/jtattermusch/subscriptions",
      "organizations_url": "https://api.github.com/users/jtattermusch/orgs",
      "repos_url": "https://api.github.com/users/jtattermusch/repos",
      "events_url": "https://api.github.com/users/jtattermusch/events{/privacy}",
      "received_events_url": "https://api.github.com/users/jtattermusch/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2018-01-26T12:07:24Z",
    "updated_at": "2018-01-26T12:07:24Z",
    "author_association": "CONTRIBUTOR",
    "body": "-  `grpc_tcp_server_shutdown_listeners` is invoked, but `tcp_server_shutdown_complete` never gets invoked (which would normally invoke listener_destroy_done)."
  },
  {
    "url": "https://api.github.com/repos/grpc/grpc/issues/comments/360863700",
    "html_url": "https://github.com/grpc/grpc/issues/13477#issuecomment-360863700",
    "issue_url": "https://api.github.com/repos/grpc/grpc/issues/13477",
    "id": 360863700,
    "node_id": "MDEyOklzc3VlQ29tbWVudDM2MDg2MzcwMA==",
    "user": {
      "login": "yashykt",
      "id": 4181124,
      "node_id": "MDQ6VXNlcjQxODExMjQ=",
      "avatar_url": "https://avatars2.githubusercontent.com/u/4181124?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/yashykt",
      "html_url": "https://github.com/yashykt",
      "followers_url": "https://api.github.com/users/yashykt/followers",
      "following_url": "https://api.github.com/users/yashykt/following{/other_user}",
      "gists_url": "https://api.github.com/users/yashykt/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/yashykt/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/yashykt/subscriptions",
      "organizations_url": "https://api.github.com/users/yashykt/orgs",
      "repos_url": "https://api.github.com/users/yashykt/repos",
      "events_url": "https://api.github.com/users/yashykt/events{/privacy}",
      "received_events_url": "https://api.github.com/users/yashykt/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2018-01-26T18:22:03Z",
    "updated_at": "2018-01-26T18:22:03Z",
    "author_association": "MEMBER",
    "body": "@jtattermusch I did some digging yesterday. It turns out that the handshaker code keeps a reference to the listener. If the deadline for the subchannel connection expires while a handshake is in progress, the tcp listener doesn't get unref'd immediately.\r\n\r\nI tried setting the deadline for the shutdown_cq next operation to 120 seconds, and it doesn't seem to fail anymore, which makes me think that a timer forces the listener to be unref'd afterwards.\r\n\r\nI'm going to do a bit more digging that this assumption is true and that it is a proper fix."
  },
  {
    "url": "https://api.github.com/repos/grpc/grpc/issues/comments/360872792",
    "html_url": "https://github.com/grpc/grpc/issues/13477#issuecomment-360872792",
    "issue_url": "https://api.github.com/repos/grpc/grpc/issues/13477",
    "id": 360872792,
    "node_id": "MDEyOklzc3VlQ29tbWVudDM2MDg3Mjc5Mg==",
    "user": {
      "login": "yashykt",
      "id": 4181124,
      "node_id": "MDQ6VXNlcjQxODExMjQ=",
      "avatar_url": "https://avatars2.githubusercontent.com/u/4181124?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/yashykt",
      "html_url": "https://github.com/yashykt",
      "followers_url": "https://api.github.com/users/yashykt/followers",
      "following_url": "https://api.github.com/users/yashykt/following{/other_user}",
      "gists_url": "https://api.github.com/users/yashykt/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/yashykt/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/yashykt/subscriptions",
      "organizations_url": "https://api.github.com/users/yashykt/orgs",
      "repos_url": "https://api.github.com/users/yashykt/repos",
      "events_url": "https://api.github.com/users/yashykt/events{/privacy}",
      "received_events_url": "https://api.github.com/users/yashykt/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2018-01-26T18:56:52Z",
    "updated_at": "2018-01-26T18:56:52Z",
    "author_association": "MEMBER",
    "body": "I think I've got a better fix. Just before shutdown, the server can perform another cq_next for a short duration (say 100ms). With this cq_next, the server should be able to clean up the ref taken up by the handshaker, and the shutdown should progress cleanly."
  },
  {
    "url": "https://api.github.com/repos/grpc/grpc/issues/comments/361177700",
    "html_url": "https://github.com/grpc/grpc/issues/13477#issuecomment-361177700",
    "issue_url": "https://api.github.com/repos/grpc/grpc/issues/13477",
    "id": 361177700,
    "node_id": "MDEyOklzc3VlQ29tbWVudDM2MTE3NzcwMA==",
    "user": {
      "login": "jtattermusch",
      "id": 9939684,
      "node_id": "MDQ6VXNlcjk5Mzk2ODQ=",
      "avatar_url": "https://avatars1.githubusercontent.com/u/9939684?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/jtattermusch",
      "html_url": "https://github.com/jtattermusch",
      "followers_url": "https://api.github.com/users/jtattermusch/followers",
      "following_url": "https://api.github.com/users/jtattermusch/following{/other_user}",
      "gists_url": "https://api.github.com/users/jtattermusch/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/jtattermusch/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/jtattermusch/subscriptions",
      "organizations_url": "https://api.github.com/users/jtattermusch/orgs",
      "repos_url": "https://api.github.com/users/jtattermusch/repos",
      "events_url": "https://api.github.com/users/jtattermusch/events{/privacy}",
      "received_events_url": "https://api.github.com/users/jtattermusch/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2018-01-29T08:51:22Z",
    "updated_at": "2018-01-29T08:51:22Z",
    "author_association": "CONTRIBUTOR",
    "body": "I'm not seeing this after #14204."
  },
  {
    "url": "https://api.github.com/repos/grpc/grpc/issues/comments/374344574",
    "html_url": "https://github.com/grpc/grpc/issues/13477#issuecomment-374344574",
    "issue_url": "https://api.github.com/repos/grpc/grpc/issues/13477",
    "id": 374344574,
    "node_id": "MDEyOklzc3VlQ29tbWVudDM3NDM0NDU3NA==",
    "user": {
      "login": "markdroth",
      "id": 18664614,
      "node_id": "MDQ6VXNlcjE4NjY0NjE0",
      "avatar_url": "https://avatars2.githubusercontent.com/u/18664614?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/markdroth",
      "html_url": "https://github.com/markdroth",
      "followers_url": "https://api.github.com/users/markdroth/followers",
      "following_url": "https://api.github.com/users/markdroth/following{/other_user}",
      "gists_url": "https://api.github.com/users/markdroth/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/markdroth/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/markdroth/subscriptions",
      "organizations_url": "https://api.github.com/users/markdroth/orgs",
      "repos_url": "https://api.github.com/users/markdroth/repos",
      "events_url": "https://api.github.com/users/markdroth/events{/privacy}",
      "received_events_url": "https://api.github.com/users/markdroth/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2018-03-19T19:43:21Z",
    "updated_at": "2018-03-19T19:43:21Z",
    "author_association": "MEMBER",
    "body": "Just saw this again:\r\n\r\nhttps://source.cloud.google.com/results/invocations/2fa26d40-c063-4200-947e-d2e845e28bc4/targets/github%2Fgrpc%2Fcpp_macos_dbg_native/tests"
  },
  {
    "url": "https://api.github.com/repos/grpc/grpc/issues/comments/374440113",
    "html_url": "https://github.com/grpc/grpc/issues/13477#issuecomment-374440113",
    "issue_url": "https://api.github.com/repos/grpc/grpc/issues/13477",
    "id": 374440113,
    "node_id": "MDEyOklzc3VlQ29tbWVudDM3NDQ0MDExMw==",
    "user": {
      "login": "sreecha",
      "id": 2754995,
      "node_id": "MDQ6VXNlcjI3NTQ5OTU=",
      "avatar_url": "https://avatars1.githubusercontent.com/u/2754995?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/sreecha",
      "html_url": "https://github.com/sreecha",
      "followers_url": "https://api.github.com/users/sreecha/followers",
      "following_url": "https://api.github.com/users/sreecha/following{/other_user}",
      "gists_url": "https://api.github.com/users/sreecha/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/sreecha/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/sreecha/subscriptions",
      "organizations_url": "https://api.github.com/users/sreecha/orgs",
      "repos_url": "https://api.github.com/users/sreecha/repos",
      "events_url": "https://api.github.com/users/sreecha/events{/privacy}",
      "received_events_url": "https://api.github.com/users/sreecha/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2018-03-20T01:22:19Z",
    "updated_at": "2018-03-20T01:22:19Z",
    "author_association": "CONTRIBUTOR",
    "body": "This is most likely the issue I documented here: https://github.com/grpc/grpc/issues/13429#issuecomment-363657093\r\n\r\nWe need to do a CQ next on the `f->cq`  **after** calling `grpc_server_shutdown_and_notify` .\r\n(In, #14204 which previously fixed this issue, we were calling it *before* `grpc_server_shutdown_and_notify`)\r\n\r\nI suggest we pass `f->cq` to `grpc_server_shutdown_and_notify` (instead of passing `f->shutdown_cq`) and then just keep doing CQ next until we get the shutdown completion tag \r\n"
  },
  {
    "url": "https://api.github.com/repos/grpc/grpc/issues/comments/374721280",
    "html_url": "https://github.com/grpc/grpc/issues/13477#issuecomment-374721280",
    "issue_url": "https://api.github.com/repos/grpc/grpc/issues/13477",
    "id": 374721280,
    "node_id": "MDEyOklzc3VlQ29tbWVudDM3NDcyMTI4MA==",
    "user": {
      "login": "yashykt",
      "id": 4181124,
      "node_id": "MDQ6VXNlcjQxODExMjQ=",
      "avatar_url": "https://avatars2.githubusercontent.com/u/4181124?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/yashykt",
      "html_url": "https://github.com/yashykt",
      "followers_url": "https://api.github.com/users/yashykt/followers",
      "following_url": "https://api.github.com/users/yashykt/following{/other_user}",
      "gists_url": "https://api.github.com/users/yashykt/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/yashykt/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/yashykt/subscriptions",
      "organizations_url": "https://api.github.com/users/yashykt/orgs",
      "repos_url": "https://api.github.com/users/yashykt/repos",
      "events_url": "https://api.github.com/users/yashykt/events{/privacy}",
      "received_events_url": "https://api.github.com/users/yashykt/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2018-03-20T19:11:14Z",
    "updated_at": "2018-03-20T19:11:14Z",
    "author_association": "MEMBER",
    "body": "Nice Idea Sree! I was thinking of creating another thread to handle this scenario, but using f->cq instead of f->shutdown_cq will be a much simpler fix. Thanks!"
  },
  {
    "url": "https://api.github.com/repos/grpc/grpc/issues/comments/376703914",
    "html_url": "https://github.com/grpc/grpc/issues/13477#issuecomment-376703914",
    "issue_url": "https://api.github.com/repos/grpc/grpc/issues/13477",
    "id": 376703914,
    "node_id": "MDEyOklzc3VlQ29tbWVudDM3NjcwMzkxNA==",
    "user": {
      "login": "yashykt",
      "id": 4181124,
      "node_id": "MDQ6VXNlcjQxODExMjQ=",
      "avatar_url": "https://avatars2.githubusercontent.com/u/4181124?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/yashykt",
      "html_url": "https://github.com/yashykt",
      "followers_url": "https://api.github.com/users/yashykt/followers",
      "following_url": "https://api.github.com/users/yashykt/following{/other_user}",
      "gists_url": "https://api.github.com/users/yashykt/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/yashykt/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/yashykt/subscriptions",
      "organizations_url": "https://api.github.com/users/yashykt/orgs",
      "repos_url": "https://api.github.com/users/yashykt/repos",
      "events_url": "https://api.github.com/users/yashykt/events{/privacy}",
      "received_events_url": "https://api.github.com/users/yashykt/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2018-03-27T23:04:11Z",
    "updated_at": "2018-03-27T23:04:11Z",
    "author_association": "MEMBER",
    "body": "Applied Sree's recommended fix in #14769 \r\nNow instead of using a separate queue to manage shutdown, we use the same queue to keep things simple. So the new process is -\r\n1) Perform the test using the completion_queue f->cq.\r\n2) Shutdown the server using the same queue f->cq.\r\n3) Shutdown the completion_queue f->cq.\r\n4) Drain the completion queue f->cq till it gets the queue shutdown event.\r\n"
  }
]
