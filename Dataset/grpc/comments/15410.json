[
  {
    "url": "https://api.github.com/repos/grpc/grpc/issues/comments/389600374",
    "html_url": "https://github.com/grpc/grpc/issues/15410#issuecomment-389600374",
    "issue_url": "https://api.github.com/repos/grpc/grpc/issues/15410",
    "id": 389600374,
    "node_id": "MDEyOklzc3VlQ29tbWVudDM4OTYwMDM3NA==",
    "user": {
      "login": "adelez",
      "id": 14932100,
      "node_id": "MDQ6VXNlcjE0OTMyMTAw",
      "avatar_url": "https://avatars3.githubusercontent.com/u/14932100?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/adelez",
      "html_url": "https://github.com/adelez",
      "followers_url": "https://api.github.com/users/adelez/followers",
      "following_url": "https://api.github.com/users/adelez/following{/other_user}",
      "gists_url": "https://api.github.com/users/adelez/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/adelez/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/adelez/subscriptions",
      "organizations_url": "https://api.github.com/users/adelez/orgs",
      "repos_url": "https://api.github.com/users/adelez/repos",
      "events_url": "https://api.github.com/users/adelez/events{/privacy}",
      "received_events_url": "https://api.github.com/users/adelez/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2018-05-16T17:26:24Z",
    "updated_at": "2018-05-16T17:26:24Z",
    "author_association": "CONTRIBUTOR",
    "body": "Same with invalid_call_argument_test: https://source.cloud.google.com/results/invocations/365d5ce3-5b55-4e68-b793-f6fbd87c83fc/targets/%2F%2Ftest%2Fcore%2Fend2end:invalid_call_argument_test@poller%3Depoll1/log"
  },
  {
    "url": "https://api.github.com/repos/grpc/grpc/issues/comments/391075227",
    "html_url": "https://github.com/grpc/grpc/issues/15410#issuecomment-391075227",
    "issue_url": "https://api.github.com/repos/grpc/grpc/issues/15410",
    "id": 391075227,
    "node_id": "MDEyOklzc3VlQ29tbWVudDM5MTA3NTIyNw==",
    "user": {
      "login": "dgquintas",
      "id": 120217,
      "node_id": "MDQ6VXNlcjEyMDIxNw==",
      "avatar_url": "https://avatars3.githubusercontent.com/u/120217?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/dgquintas",
      "html_url": "https://github.com/dgquintas",
      "followers_url": "https://api.github.com/users/dgquintas/followers",
      "following_url": "https://api.github.com/users/dgquintas/following{/other_user}",
      "gists_url": "https://api.github.com/users/dgquintas/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/dgquintas/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/dgquintas/subscriptions",
      "organizations_url": "https://api.github.com/users/dgquintas/orgs",
      "repos_url": "https://api.github.com/users/dgquintas/repos",
      "events_url": "https://api.github.com/users/dgquintas/events{/privacy}",
      "received_events_url": "https://api.github.com/users/dgquintas/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2018-05-22T17:30:21Z",
    "updated_at": "2018-05-22T17:30:21Z",
    "author_association": "NONE",
    "body": "The issue is happening [here](https://github.com/grpc/grpc/blob/463e4d56193bbaec3977ce38fb8f0103d006794e/src/core/ext/filters/client_channel/lb_policy/subchannel_list.h#L505), part of https://github.com/grpc/grpc/pull/14886 . Assigning this issue individually to @markdroth as the original author. "
  },
  {
    "url": "https://api.github.com/repos/grpc/grpc/issues/comments/395122470",
    "html_url": "https://github.com/grpc/grpc/issues/15410#issuecomment-395122470",
    "issue_url": "https://api.github.com/repos/grpc/grpc/issues/15410",
    "id": 395122470,
    "node_id": "MDEyOklzc3VlQ29tbWVudDM5NTEyMjQ3MA==",
    "user": {
      "login": "markdroth",
      "id": 18664614,
      "node_id": "MDQ6VXNlcjE4NjY0NjE0",
      "avatar_url": "https://avatars2.githubusercontent.com/u/18664614?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/markdroth",
      "html_url": "https://github.com/markdroth",
      "followers_url": "https://api.github.com/users/markdroth/followers",
      "following_url": "https://api.github.com/users/markdroth/following{/other_user}",
      "gists_url": "https://api.github.com/users/markdroth/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/markdroth/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/markdroth/subscriptions",
      "organizations_url": "https://api.github.com/users/markdroth/orgs",
      "repos_url": "https://api.github.com/users/markdroth/repos",
      "events_url": "https://api.github.com/users/markdroth/events{/privacy}",
      "received_events_url": "https://api.github.com/users/markdroth/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2018-06-06T16:01:35Z",
    "updated_at": "2018-06-06T16:01:35Z",
    "author_association": "MEMBER",
    "body": "As far as I can tell, the code is correct.  Note that `PickFirstSubchannelList` is actually a subclass of `SubchannelList<PickFirstSubchannelList, PickFirstSubchannelData>`, so this down-cast should be fine.\r\n\r\nThis happens consistently when running the test under bazel, but it does not happen when running via make.  Is there something different about the build environment under bazel that is triggering this?  Maybe a different version of clang?\r\n\r\n@nicolasnoble @adelez @matt-kwong "
  },
  {
    "url": "https://api.github.com/repos/grpc/grpc/issues/comments/413120079",
    "html_url": "https://github.com/grpc/grpc/issues/15410#issuecomment-413120079",
    "issue_url": "https://api.github.com/repos/grpc/grpc/issues/15410",
    "id": 413120079,
    "node_id": "MDEyOklzc3VlQ29tbWVudDQxMzEyMDA3OQ==",
    "user": {
      "login": "snaury",
      "id": 53117,
      "node_id": "MDQ6VXNlcjUzMTE3",
      "avatar_url": "https://avatars3.githubusercontent.com/u/53117?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/snaury",
      "html_url": "https://github.com/snaury",
      "followers_url": "https://api.github.com/users/snaury/followers",
      "following_url": "https://api.github.com/users/snaury/following{/other_user}",
      "gists_url": "https://api.github.com/users/snaury/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/snaury/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/snaury/subscriptions",
      "organizations_url": "https://api.github.com/users/snaury/orgs",
      "repos_url": "https://api.github.com/users/snaury/repos",
      "events_url": "https://api.github.com/users/snaury/events{/privacy}",
      "received_events_url": "https://api.github.com/users/snaury/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2018-08-15T07:43:53Z",
    "updated_at": "2018-08-15T07:44:44Z",
    "author_association": "NONE",
    "body": "I think ubsan may be correct, because the downcast is happening inside of a constructor of a base class with a vtable, and at that point the object is not yet of a derived class, since constructor for derived class has not yet been called. It's easy to reproduce with something like this:\r\n\r\n```cpp\r\n#include <iostream>\r\n\r\ntemplate<class Derived>\r\nclass Base {\r\npublic:\r\n    Base() {\r\n        std::cout << \"Base::Base()\" << std::endl;\r\n        derived = static_cast<Derived*>(this);\r\n    }\r\n\r\n    virtual ~Base() {\r\n        std::cout << \"Base::~Base()\" << std::endl;\r\n    }\r\n\r\nprivate:\r\n    Derived* derived;\r\n};\r\n\r\nclass Derived : public Base<Derived> {\r\npublic:\r\n    Derived()\r\n        : Base()\r\n    {\r\n        std::cout << \"Derived::Derived()\" << std::endl;\r\n    }\r\n\r\n    ~Derived() {\r\n        std::cout << \"Derived::~Derived()\" << std::endl;\r\n    }\r\n};\r\n\r\nint main() {\r\n    Derived derived;\r\n    return 0;\r\n}\r\n```\r\n\r\nMaking destructors non-virtual stops ubsan from complaining, but that may be due to a less fine-grained tracking method when vtable is not available?"
  },
  {
    "url": "https://api.github.com/repos/grpc/grpc/issues/comments/417745304",
    "html_url": "https://github.com/grpc/grpc/issues/15410#issuecomment-417745304",
    "issue_url": "https://api.github.com/repos/grpc/grpc/issues/15410",
    "id": 417745304,
    "node_id": "MDEyOklzc3VlQ29tbWVudDQxNzc0NTMwNA==",
    "user": {
      "login": "vjpai",
      "id": 8864912,
      "node_id": "MDQ6VXNlcjg4NjQ5MTI=",
      "avatar_url": "https://avatars0.githubusercontent.com/u/8864912?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/vjpai",
      "html_url": "https://github.com/vjpai",
      "followers_url": "https://api.github.com/users/vjpai/followers",
      "following_url": "https://api.github.com/users/vjpai/following{/other_user}",
      "gists_url": "https://api.github.com/users/vjpai/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/vjpai/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/vjpai/subscriptions",
      "organizations_url": "https://api.github.com/users/vjpai/orgs",
      "repos_url": "https://api.github.com/users/vjpai/repos",
      "events_url": "https://api.github.com/users/vjpai/events{/privacy}",
      "received_events_url": "https://api.github.com/users/vjpai/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2018-08-31T18:02:40Z",
    "updated_at": "2018-08-31T18:02:40Z",
    "author_association": "MEMBER",
    "body": "The comment from @snaury is an accurate description of the issue. This work shouldn't be done in the base constructor since the element is not yet an element of the derived type. Bumping to P1 since this is undefined behavior (and to answer your question above @markdroth : that's the issue with UB, it sometimes behaves as you want it to)\r\n"
  },
  {
    "url": "https://api.github.com/repos/grpc/grpc/issues/comments/419231469",
    "html_url": "https://github.com/grpc/grpc/issues/15410#issuecomment-419231469",
    "issue_url": "https://api.github.com/repos/grpc/grpc/issues/15410",
    "id": 419231469,
    "node_id": "MDEyOklzc3VlQ29tbWVudDQxOTIzMTQ2OQ==",
    "user": {
      "login": "markdroth",
      "id": 18664614,
      "node_id": "MDQ6VXNlcjE4NjY0NjE0",
      "avatar_url": "https://avatars2.githubusercontent.com/u/18664614?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/markdroth",
      "html_url": "https://github.com/markdroth",
      "followers_url": "https://api.github.com/users/markdroth/followers",
      "following_url": "https://api.github.com/users/markdroth/following{/other_user}",
      "gists_url": "https://api.github.com/users/markdroth/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/markdroth/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/markdroth/subscriptions",
      "organizations_url": "https://api.github.com/users/markdroth/orgs",
      "repos_url": "https://api.github.com/users/markdroth/repos",
      "events_url": "https://api.github.com/users/markdroth/events{/privacy}",
      "received_events_url": "https://api.github.com/users/markdroth/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2018-09-06T20:32:21Z",
    "updated_at": "2018-09-06T20:32:21Z",
    "author_association": "MEMBER",
    "body": "> (and to answer your question above @markdroth : that's the issue with UB, it sometimes behaves as you want it to)\r\n\r\nSure, but shouldn't ubsan be deterministic in detecting the problem?  What we're seeing here is that ubsan running from bazel detects the problem but ubsan running from make does not.\r\n\r\nIn any case, I didn't realize that this was undefined when doing it from the ctor of the base class.  I'll have to think about the right way to fix it."
  },
  {
    "url": "https://api.github.com/repos/grpc/grpc/issues/comments/420517270",
    "html_url": "https://github.com/grpc/grpc/issues/15410#issuecomment-420517270",
    "issue_url": "https://api.github.com/repos/grpc/grpc/issues/15410",
    "id": 420517270,
    "node_id": "MDEyOklzc3VlQ29tbWVudDQyMDUxNzI3MA==",
    "user": {
      "login": "adelez",
      "id": 14932100,
      "node_id": "MDQ6VXNlcjE0OTMyMTAw",
      "avatar_url": "https://avatars3.githubusercontent.com/u/14932100?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/adelez",
      "html_url": "https://github.com/adelez",
      "followers_url": "https://api.github.com/users/adelez/followers",
      "following_url": "https://api.github.com/users/adelez/following{/other_user}",
      "gists_url": "https://api.github.com/users/adelez/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/adelez/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/adelez/subscriptions",
      "organizations_url": "https://api.github.com/users/adelez/orgs",
      "repos_url": "https://api.github.com/users/adelez/repos",
      "events_url": "https://api.github.com/users/adelez/events{/privacy}",
      "received_events_url": "https://api.github.com/users/adelez/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2018-09-12T05:31:12Z",
    "updated_at": "2018-09-12T05:31:12Z",
    "author_association": "CONTRIBUTOR",
    "body": "Mark, the ubsan from make may be a much older version. "
  },
  {
    "url": "https://api.github.com/repos/grpc/grpc/issues/comments/420679503",
    "html_url": "https://github.com/grpc/grpc/issues/15410#issuecomment-420679503",
    "issue_url": "https://api.github.com/repos/grpc/grpc/issues/15410",
    "id": 420679503,
    "node_id": "MDEyOklzc3VlQ29tbWVudDQyMDY3OTUwMw==",
    "user": {
      "login": "markdroth",
      "id": 18664614,
      "node_id": "MDQ6VXNlcjE4NjY0NjE0",
      "avatar_url": "https://avatars2.githubusercontent.com/u/18664614?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/markdroth",
      "html_url": "https://github.com/markdroth",
      "followers_url": "https://api.github.com/users/markdroth/followers",
      "following_url": "https://api.github.com/users/markdroth/following{/other_user}",
      "gists_url": "https://api.github.com/users/markdroth/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/markdroth/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/markdroth/subscriptions",
      "organizations_url": "https://api.github.com/users/markdroth/orgs",
      "repos_url": "https://api.github.com/users/markdroth/repos",
      "events_url": "https://api.github.com/users/markdroth/events{/privacy}",
      "received_events_url": "https://api.github.com/users/markdroth/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2018-09-12T14:55:57Z",
    "updated_at": "2018-09-12T14:55:57Z",
    "author_association": "MEMBER",
    "body": "I don't think so.  I've installed clang-6 on my desktop machine."
  }
]
