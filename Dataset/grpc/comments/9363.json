[
  {
    "url": "https://api.github.com/repos/grpc/grpc/issues/comments/273217371",
    "html_url": "https://github.com/grpc/grpc/issues/9363#issuecomment-273217371",
    "issue_url": "https://api.github.com/repos/grpc/grpc/issues/9363",
    "id": 273217371,
    "node_id": "MDEyOklzc3VlQ29tbWVudDI3MzIxNzM3MQ==",
    "user": {
      "login": "rjshade",
      "id": 97579,
      "node_id": "MDQ6VXNlcjk3NTc5",
      "avatar_url": "https://avatars2.githubusercontent.com/u/97579?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/rjshade",
      "html_url": "https://github.com/rjshade",
      "followers_url": "https://api.github.com/users/rjshade/followers",
      "following_url": "https://api.github.com/users/rjshade/following{/other_user}",
      "gists_url": "https://api.github.com/users/rjshade/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/rjshade/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/rjshade/subscriptions",
      "organizations_url": "https://api.github.com/users/rjshade/orgs",
      "repos_url": "https://api.github.com/users/rjshade/repos",
      "events_url": "https://api.github.com/users/rjshade/events{/privacy}",
      "received_events_url": "https://api.github.com/users/rjshade/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2017-01-17T16:20:33Z",
    "updated_at": "2017-01-17T16:21:26Z",
    "author_association": "CONTRIBUTOR",
    "body": "Adding a sleep(1) between starting the server subprocess, and starting the client subprocess seems to fix it, but there may be a better fix than simply waiting for a second.\r\n\r\nWith the following patch, 100% of test runs pass:\r\n$ ./tools/run_tests/run_tests.py --language c --config dbg --regex \"memory_profile_test\"  --runs_per_test 100\r\nPASSED: make [time=1.4sec; retries=0:0]detected port server running version 9\r\nmy port server is version 9\r\nSUCCESS: All tests passed\r\n\r\n```\r\ndiff --git a/test/core/memory_usage/memory_usage_test.c b/test/core/memory_usage/memory_usage_test.c\r\nindex 7e7a9d050..2486d2010 100644\r\n--- a/test/core/memory_usage/memory_usage_test.c\r\n+++ b/test/core/memory_usage/memory_usage_test.c\r\n@@ -33,6 +33,7 @@\r\n \r\n #include <stdio.h>\r\n #include <string.h>\r\n+#include <unistd.h>\r\n \r\n #include <grpc/support/alloc.h>\r\n #include <grpc/support/host_port.h>\r\n@@ -66,6 +67,9 @@ int main(int argc, char **argv) {\r\n   gpr_free(args[0]);\r\n   gpr_free(args[2]);\r\n \r\n+  /* Give the server time to start. */\r\n+  sleep(1);\r\n+\r\n   /* start the client */\r\n   gpr_asprintf(&args[0], \"%s/memory_profile_client%s\", root,\r\n                gpr_subprocess_binary_extension());\r\n```"
  },
  {
    "url": "https://api.github.com/repos/grpc/grpc/issues/comments/273218451",
    "html_url": "https://github.com/grpc/grpc/issues/9363#issuecomment-273218451",
    "issue_url": "https://api.github.com/repos/grpc/grpc/issues/9363",
    "id": 273218451,
    "node_id": "MDEyOklzc3VlQ29tbWVudDI3MzIxODQ1MQ==",
    "user": {
      "login": "ctiller",
      "id": 10120821,
      "node_id": "MDQ6VXNlcjEwMTIwODIx",
      "avatar_url": "https://avatars3.githubusercontent.com/u/10120821?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/ctiller",
      "html_url": "https://github.com/ctiller",
      "followers_url": "https://api.github.com/users/ctiller/followers",
      "following_url": "https://api.github.com/users/ctiller/following{/other_user}",
      "gists_url": "https://api.github.com/users/ctiller/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/ctiller/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/ctiller/subscriptions",
      "organizations_url": "https://api.github.com/users/ctiller/orgs",
      "repos_url": "https://api.github.com/users/ctiller/repos",
      "events_url": "https://api.github.com/users/ctiller/events{/privacy}",
      "received_events_url": "https://api.github.com/users/ctiller/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2017-01-17T16:24:05Z",
    "updated_at": "2017-01-17T16:24:05Z",
    "author_association": "MEMBER",
    "body": "Suspect the write fix is to add GRPC_INITIAL_METADATA_WAIT_FOR_READY_EXPLICITLY_SET to the initial metadata op flags for requests sent from the client (to force waiting for the server to start)."
  }
]
