[
  {
    "url": "https://api.github.com/repos/grpc/grpc/issues/comments/363808988",
    "html_url": "https://github.com/grpc/grpc/issues/14354#issuecomment-363808988",
    "issue_url": "https://api.github.com/repos/grpc/grpc/issues/14354",
    "id": 363808988,
    "node_id": "MDEyOklzc3VlQ29tbWVudDM2MzgwODk4OA==",
    "user": {
      "login": "jtattermusch",
      "id": 9939684,
      "node_id": "MDQ6VXNlcjk5Mzk2ODQ=",
      "avatar_url": "https://avatars1.githubusercontent.com/u/9939684?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/jtattermusch",
      "html_url": "https://github.com/jtattermusch",
      "followers_url": "https://api.github.com/users/jtattermusch/followers",
      "following_url": "https://api.github.com/users/jtattermusch/following{/other_user}",
      "gists_url": "https://api.github.com/users/jtattermusch/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/jtattermusch/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/jtattermusch/subscriptions",
      "organizations_url": "https://api.github.com/users/jtattermusch/orgs",
      "repos_url": "https://api.github.com/users/jtattermusch/repos",
      "events_url": "https://api.github.com/users/jtattermusch/events{/privacy}",
      "received_events_url": "https://api.github.com/users/jtattermusch/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2018-02-07T15:41:19Z",
    "updated_at": "2018-02-07T15:41:19Z",
    "author_association": "CONTRIBUTOR",
    "body": "Easily reproduced with `tools/run_tests/run_tests.py -l c++ -c opt -r 'UpdatesTest.ReresolveDeadBackend' -n 100`"
  },
  {
    "url": "https://api.github.com/repos/grpc/grpc/issues/comments/363818023",
    "html_url": "https://github.com/grpc/grpc/issues/14354#issuecomment-363818023",
    "issue_url": "https://api.github.com/repos/grpc/grpc/issues/14354",
    "id": 363818023,
    "node_id": "MDEyOklzc3VlQ29tbWVudDM2MzgxODAyMw==",
    "user": {
      "login": "jtattermusch",
      "id": 9939684,
      "node_id": "MDQ6VXNlcjk5Mzk2ODQ=",
      "avatar_url": "https://avatars1.githubusercontent.com/u/9939684?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/jtattermusch",
      "html_url": "https://github.com/jtattermusch",
      "followers_url": "https://api.github.com/users/jtattermusch/followers",
      "following_url": "https://api.github.com/users/jtattermusch/following{/other_user}",
      "gists_url": "https://api.github.com/users/jtattermusch/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/jtattermusch/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/jtattermusch/subscriptions",
      "organizations_url": "https://api.github.com/users/jtattermusch/orgs",
      "repos_url": "https://api.github.com/users/jtattermusch/repos",
      "events_url": "https://api.github.com/users/jtattermusch/events{/privacy}",
      "received_events_url": "https://api.github.com/users/jtattermusch/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2018-02-07T16:05:34Z",
    "updated_at": "2018-02-07T16:05:34Z",
    "author_association": "CONTRIBUTOR",
    "body": "@AspirinSJL , it looks like the culprit is \r\nhttps://github.com/grpc/grpc/pull/13671."
  },
  {
    "url": "https://api.github.com/repos/grpc/grpc/issues/comments/363818590",
    "html_url": "https://github.com/grpc/grpc/issues/14354#issuecomment-363818590",
    "issue_url": "https://api.github.com/repos/grpc/grpc/issues/14354",
    "id": 363818590,
    "node_id": "MDEyOklzc3VlQ29tbWVudDM2MzgxODU5MA==",
    "user": {
      "login": "jtattermusch",
      "id": 9939684,
      "node_id": "MDQ6VXNlcjk5Mzk2ODQ=",
      "avatar_url": "https://avatars1.githubusercontent.com/u/9939684?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/jtattermusch",
      "html_url": "https://github.com/jtattermusch",
      "followers_url": "https://api.github.com/users/jtattermusch/followers",
      "following_url": "https://api.github.com/users/jtattermusch/following{/other_user}",
      "gists_url": "https://api.github.com/users/jtattermusch/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/jtattermusch/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/jtattermusch/subscriptions",
      "organizations_url": "https://api.github.com/users/jtattermusch/orgs",
      "repos_url": "https://api.github.com/users/jtattermusch/repos",
      "events_url": "https://api.github.com/users/jtattermusch/events{/privacy}",
      "received_events_url": "https://api.github.com/users/jtattermusch/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2018-02-07T16:07:01Z",
    "updated_at": "2018-02-07T16:07:01Z",
    "author_association": "CONTRIBUTOR",
    "body": "Ah, apparently - the test was actually added in that PR:\r\nhttps://github.com/grpc/grpc/pull/13671/files#diff-9c7f9543d2e67573f1e8a091c8f52b46R1093\r\n\r\nPlease fix ASAP or revert."
  },
  {
    "url": "https://api.github.com/repos/grpc/grpc/issues/comments/363819722",
    "html_url": "https://github.com/grpc/grpc/issues/14354#issuecomment-363819722",
    "issue_url": "https://api.github.com/repos/grpc/grpc/issues/14354",
    "id": 363819722,
    "node_id": "MDEyOklzc3VlQ29tbWVudDM2MzgxOTcyMg==",
    "user": {
      "login": "jtattermusch",
      "id": 9939684,
      "node_id": "MDQ6VXNlcjk5Mzk2ODQ=",
      "avatar_url": "https://avatars1.githubusercontent.com/u/9939684?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/jtattermusch",
      "html_url": "https://github.com/jtattermusch",
      "followers_url": "https://api.github.com/users/jtattermusch/followers",
      "following_url": "https://api.github.com/users/jtattermusch/following{/other_user}",
      "gists_url": "https://api.github.com/users/jtattermusch/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/jtattermusch/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/jtattermusch/subscriptions",
      "organizations_url": "https://api.github.com/users/jtattermusch/orgs",
      "repos_url": "https://api.github.com/users/jtattermusch/repos",
      "events_url": "https://api.github.com/users/jtattermusch/events{/privacy}",
      "received_events_url": "https://api.github.com/users/jtattermusch/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2018-02-07T16:10:07Z",
    "updated_at": "2018-02-07T16:10:07Z",
    "author_association": "CONTRIBUTOR",
    "body": "```\r\nI0207 13:48:09.713155740    2854 grpclb_end2end_test.cc:1191] ========= BEFORE FIRST BATCH ==========\r\nI0207 13:48:09.713512308    2854 subchannel.cc:603]          New connected subchannel at 0x117bdd0 for subchannel 0x117ab70\r\nI0207 13:48:09.713893736    2881 grpclb_end2end_test.cc:187] LB[0x11722f0]: BalanceLoad\r\nI0207 13:48:09.714175325    2881 grpclb_end2end_test.cc:191] LB[0x11722f0]: recv msg 'initial_request {\r\n  name: \"servername_not_used\"\r\n}\r\n'\r\nI0207 13:48:10.213667350    2854 subchannel.cc:603]          New connected subchannel at 0x117cf90 for subchannel 0x7fa9ac001750\r\nI0207 13:48:10.215168237    2854 grpclb_end2end_test.cc:1193] ========= DONE WITH FIRST BATCH ==========\r\nI0207 13:48:10.215192072    2854 grpclb_end2end_test.cc:1198] ********** ABOUT TO KILL BACKEND 0 *************\r\nI0207 13:48:10.215196209    2854 grpclb_end2end_test.cc:140] Backend: shut down\r\nI0207 13:48:10.215199967    2854 grpclb_end2end_test.cc:574] backend about to shutdown\r\nI0207 13:48:10.215365312    2854 grpclb_end2end_test.cc:577] backend shutdown completed\r\nI0207 13:48:10.215377106    2854 grpclb_end2end_test.cc:1200] ********** KILLED BACKEND 0 *************\r\nI0207 13:48:10.215429136    2881 grpclb_end2end_test.cc:251] LB[0x11722f0]: done\r\nI0207 13:48:10.215667036    2854 subchannel.cc:641]          Connect failed: {\"created\":\"@1518011290.215648461\",\"description\":\"Failed to connect to remote host: OS Error\",\"errno\":111,\"file\":\"src/core/lib/iomgr/tcp_client_posix.cc\",\"file_line\":198,\"os_error\":\"Connection refused\",\"syscall\":\"connect\",\"target_address\":\"ipv4:127.0.0.1:5028\"}\r\nI0207 13:48:10.215711373    2854 subchannel.cc:466]          Subchannel 0x7fa9ac001750: Retry in 1000 milliseconds\r\nI0207 13:48:10.215939133    2854 subchannel.cc:603]          New connected subchannel at 0x117c720 for subchannel 0x117a1d0\r\nI0207 13:48:11.215682604    2891 grpclb_end2end_test.cc:187] LB[0x11728c0]: BalanceLoad\r\nI0207 13:48:11.215762638    2891 grpclb_end2end_test.cc:191] LB[0x11728c0]: recv msg 'initial_request {\r\n  name: \"servername_not_used\"\r\n}\r\n'\r\nI0207 13:48:11.215773737    2891 grpclb_end2end_test.cc:305] LB[0x11728c0]: sleeping for 0 ms...\r\nI0207 13:48:11.215793400    2891 grpclb_end2end_test.cc:311] LB[0x11728c0]: Woke up! Sending response 'server_list {\r\n  servers {\r\n    ip_address: \"\\177\\000\\000\\001\"\r\n    port: 19633\r\n  }\r\n}\r\n'\r\nI0207 13:48:11.215868054    2891 grpclb_end2end_test.cc:251] LB[0x11728c0]: done\r\nI0207 13:48:11.215961545    2854 grpclb.cc:551]              Missing LB token for backend address 'ipv4:127.0.0.1:19633'. The empty token will be used instead\r\nI0207 13:48:11.216209520    2854 subchannel.cc:603]          New connected subchannel at 0x1178f10 for subchannel 0x1176370\r\ntest/cpp/end2end/test_service_impl.cc:130: Failure\r\nValue of: context->IsCancelled()\r\n  Actual: true\r\nExpected: false\r\nI0207 13:48:11.216499593    2854 grpclb_end2end_test.cc:1222] ========= BEFORE SECOND BATCH ==========\r\nI0207 13:48:11.217719646    2854 grpclb_end2end_test.cc:1224] ========= DONE WITH SECOND BATCH ==========\r\nI0207 13:48:11.217735636    2854 grpclb_end2end_test.cc:140] Backend: shut down\r\nI0207 13:48:11.217739660    2854 grpclb_end2end_test.cc:140] Backend: shut down\r\nI0207 13:48:11.217743032    2854 grpclb_end2end_test.cc:574] backend about to shutdown\r\nI0207 13:48:11.217922251    2854 grpclb_end2end_test.cc:577] backend shutdown completed\r\nI0207 13:48:11.217928615    2854 grpclb_end2end_test.cc:140] Backend: shut down\r\nI0207 13:48:11.217931821    2854 grpclb_end2end_test.cc:574] backend about to shutdown\r\nI0207 13:48:11.218020036    2854 grpclb_end2end_test.cc:577] backend shutdown completed\r\nI0207 13:48:11.218026264    2854 grpclb_end2end_test.cc:140] Backend: shut down\r\nI0207 13:48:11.218030204    2854 grpclb_end2end_test.cc:574] backend about to shutdown\r\nI0207 13:48:11.218199189    2854 grpclb_end2end_test.cc:577] backend shutdown completed\r\nI0207 13:48:11.218214851    2854 grpclb_end2end_test.cc:266] LB[0x11722f0]: shut down\r\nI0207 13:48:11.218218804    2854 grpclb_end2end_test.cc:574] balancer about to shutdown\r\nI0207 13:48:11.218562976    2854 grpclb_end2end_test.cc:577] balancer shutdown completed\r\nI0207 13:48:11.218570983    2854 grpclb_end2end_test.cc:266] LB[0x11728c0]: shut down\r\nI0207 13:48:11.218574171    2854 grpclb_end2end_test.cc:574] balancer about to shutdown\r\nI0207 13:48:11.218842342    2854 grpclb_end2end_test.cc:577] balancer shutdown completed\r\nI0207 13:48:11.218852673    2854 grpclb_end2end_test.cc:266] LB[0x1172a40]: shut down\r\nI0207 13:48:11.218857521    2854 grpclb_end2end_test.cc:574] balancer about to shutdown\r\nI0207 13:48:11.218951678    2854 grpclb_end2end_test.cc:577] balancer shutdown completed\r\n[  FAILED  ] UpdatesTest.ReresolveDeadBackend (1518 ms)\r\n[----------] 1 test from UpdatesTest (1518 ms total)\r\n\r\n[----------] Global test environment tear-down\r\n[==========] 1 test from 1 test case ran. (1518 ms total)\r\n[  PASSED  ] 0 tests.\r\n[  FAILED  ] 1 test, listed below:\r\n[  FAILED  ] UpdatesTest.ReresolveDeadBackend\r\n\r\n 1 FAILED TEST\r\nD0207 13:48:11.219780875    2854 ev_posix.cc:140]            Using polling engine: poll\r\nD0207 13:48:11.219802880    2854 dns_resolver.cc:334]        Using native dns resolver\r\nCommand exited with non-zero status 1\r\nreal 1.52\r\nuser 0.02\r\nsys 0.05\r\n\r\n2018-02-07 13:48:11,226 FAILED: bins/opt/grpclb_end2end_test --gtest_filter=UpdatesTest.ReresolveDeadBackend  GRPC_POLL_STRATEGY=poll [ret=1, pid=2843, time=1.5sec]\r\n```"
  },
  {
    "url": "https://api.github.com/repos/grpc/grpc/issues/comments/363833322",
    "html_url": "https://github.com/grpc/grpc/issues/14354#issuecomment-363833322",
    "issue_url": "https://api.github.com/repos/grpc/grpc/issues/14354",
    "id": 363833322,
    "node_id": "MDEyOklzc3VlQ29tbWVudDM2MzgzMzMyMg==",
    "user": {
      "login": "AspirinSJL",
      "id": 3314176,
      "node_id": "MDQ6VXNlcjMzMTQxNzY=",
      "avatar_url": "https://avatars0.githubusercontent.com/u/3314176?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/AspirinSJL",
      "html_url": "https://github.com/AspirinSJL",
      "followers_url": "https://api.github.com/users/AspirinSJL/followers",
      "following_url": "https://api.github.com/users/AspirinSJL/following{/other_user}",
      "gists_url": "https://api.github.com/users/AspirinSJL/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/AspirinSJL/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/AspirinSJL/subscriptions",
      "organizations_url": "https://api.github.com/users/AspirinSJL/orgs",
      "repos_url": "https://api.github.com/users/AspirinSJL/repos",
      "events_url": "https://api.github.com/users/AspirinSJL/events{/privacy}",
      "received_events_url": "https://api.github.com/users/AspirinSJL/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2018-02-07T16:50:23Z",
    "updated_at": "2018-02-07T16:50:23Z",
    "author_association": "MEMBER",
    "body": "I'll try to fix it in 1 hour. If I can't fix it, I will revert it."
  },
  {
    "url": "https://api.github.com/repos/grpc/grpc/issues/comments/363835134",
    "html_url": "https://github.com/grpc/grpc/issues/14354#issuecomment-363835134",
    "issue_url": "https://api.github.com/repos/grpc/grpc/issues/14354",
    "id": 363835134,
    "node_id": "MDEyOklzc3VlQ29tbWVudDM2MzgzNTEzNA==",
    "user": {
      "login": "jtattermusch",
      "id": 9939684,
      "node_id": "MDQ6VXNlcjk5Mzk2ODQ=",
      "avatar_url": "https://avatars1.githubusercontent.com/u/9939684?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/jtattermusch",
      "html_url": "https://github.com/jtattermusch",
      "followers_url": "https://api.github.com/users/jtattermusch/followers",
      "following_url": "https://api.github.com/users/jtattermusch/following{/other_user}",
      "gists_url": "https://api.github.com/users/jtattermusch/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/jtattermusch/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/jtattermusch/subscriptions",
      "organizations_url": "https://api.github.com/users/jtattermusch/orgs",
      "repos_url": "https://api.github.com/users/jtattermusch/repos",
      "events_url": "https://api.github.com/users/jtattermusch/events{/privacy}",
      "received_events_url": "https://api.github.com/users/jtattermusch/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2018-02-07T16:55:43Z",
    "updated_at": "2018-02-07T16:55:43Z",
    "author_association": "CONTRIBUTOR",
    "body": "@AspirinSJL  thanks!"
  },
  {
    "url": "https://api.github.com/repos/grpc/grpc/issues/comments/363854423",
    "html_url": "https://github.com/grpc/grpc/issues/14354#issuecomment-363854423",
    "issue_url": "https://api.github.com/repos/grpc/grpc/issues/14354",
    "id": 363854423,
    "node_id": "MDEyOklzc3VlQ29tbWVudDM2Mzg1NDQyMw==",
    "user": {
      "login": "AspirinSJL",
      "id": 3314176,
      "node_id": "MDQ6VXNlcjMzMTQxNzY=",
      "avatar_url": "https://avatars0.githubusercontent.com/u/3314176?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/AspirinSJL",
      "html_url": "https://github.com/AspirinSJL",
      "followers_url": "https://api.github.com/users/AspirinSJL/followers",
      "following_url": "https://api.github.com/users/AspirinSJL/following{/other_user}",
      "gists_url": "https://api.github.com/users/AspirinSJL/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/AspirinSJL/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/AspirinSJL/subscriptions",
      "organizations_url": "https://api.github.com/users/AspirinSJL/orgs",
      "repos_url": "https://api.github.com/users/AspirinSJL/repos",
      "events_url": "https://api.github.com/users/AspirinSJL/events{/privacy}",
      "received_events_url": "https://api.github.com/users/AspirinSJL/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2018-02-07T17:56:49Z",
    "updated_at": "2018-02-07T17:56:49Z",
    "author_association": "MEMBER",
    "body": "Reverting.."
  },
  {
    "url": "https://api.github.com/repos/grpc/grpc/issues/comments/363958297",
    "html_url": "https://github.com/grpc/grpc/issues/14354#issuecomment-363958297",
    "issue_url": "https://api.github.com/repos/grpc/grpc/issues/14354",
    "id": 363958297,
    "node_id": "MDEyOklzc3VlQ29tbWVudDM2Mzk1ODI5Nw==",
    "user": {
      "login": "AspirinSJL",
      "id": 3314176,
      "node_id": "MDQ6VXNlcjMzMTQxNzY=",
      "avatar_url": "https://avatars0.githubusercontent.com/u/3314176?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/AspirinSJL",
      "html_url": "https://github.com/AspirinSJL",
      "followers_url": "https://api.github.com/users/AspirinSJL/followers",
      "following_url": "https://api.github.com/users/AspirinSJL/following{/other_user}",
      "gists_url": "https://api.github.com/users/AspirinSJL/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/AspirinSJL/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/AspirinSJL/subscriptions",
      "organizations_url": "https://api.github.com/users/AspirinSJL/orgs",
      "repos_url": "https://api.github.com/users/AspirinSJL/repos",
      "events_url": "https://api.github.com/users/AspirinSJL/events{/privacy}",
      "received_events_url": "https://api.github.com/users/AspirinSJL/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2018-02-08T00:19:15Z",
    "updated_at": "2018-02-08T00:19:15Z",
    "author_association": "MEMBER",
    "body": "After the backend is shut down, we keep sending RPCs until the re-resolution is finished. The first RPCs will fail because there are no working backend. Right after the client receives a serverlist from the new balancer, the next RPC can reach the server, but may trigger this check because the RPC is somehow cancelled. I don't know why this RPC can be cancelled but it already arrives at the server...\r\n\r\nWait for 500ms before `WaitForBackend(1);` can make the test pass."
  }
]
