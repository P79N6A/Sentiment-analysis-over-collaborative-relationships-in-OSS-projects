[
  {
    "url": "https://api.github.com/repos/grpc/grpc/issues/comments/276178539",
    "html_url": "https://github.com/grpc/grpc/issues/9510#issuecomment-276178539",
    "issue_url": "https://api.github.com/repos/grpc/grpc/issues/9510",
    "id": 276178539,
    "node_id": "MDEyOklzc3VlQ29tbWVudDI3NjE3ODUzOQ==",
    "user": {
      "login": "ctiller",
      "id": 10120821,
      "node_id": "MDQ6VXNlcjEwMTIwODIx",
      "avatar_url": "https://avatars3.githubusercontent.com/u/10120821?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/ctiller",
      "html_url": "https://github.com/ctiller",
      "followers_url": "https://api.github.com/users/ctiller/followers",
      "following_url": "https://api.github.com/users/ctiller/following{/other_user}",
      "gists_url": "https://api.github.com/users/ctiller/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/ctiller/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/ctiller/subscriptions",
      "organizations_url": "https://api.github.com/users/ctiller/orgs",
      "repos_url": "https://api.github.com/users/ctiller/repos",
      "events_url": "https://api.github.com/users/ctiller/events{/privacy}",
      "received_events_url": "https://api.github.com/users/ctiller/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2017-01-30T20:20:41Z",
    "updated_at": "2017-01-30T20:20:41Z",
    "author_association": "MEMBER",
    "body": "Am I right in my understanding that the benchmark consists of a single\nthreaded client that's repeatedly making blocking requests to a server to\nretrieve some buffer?\n\nOn Mon, Jan 30, 2017 at 12:13 PM Tamás Szelei <notifications@github.com>\nwrote:\n\n> I'm creating a benchmark of RPC libraries where a client and server are\n> created in the same process and the performance of message passing is\n> measured in each iteration. Creating the server and client happens once per\n> benchmark (i.e. not per iteration).\n>\n> One of the benchmarks uses cached large blobs of increasing sizes (from 4k\n> up to 32M). Using *grpc 1.1.0-pre* with the protobuf it references as a\n> submodule, I consistently get several gigabytes of usage once the benchmark\n> reaches the 2048k size (not sure if that's not from the previous 1024k\n> step). Unfortunately I can't tell how much, because it eats all the memory\n> I have in this machine (8 GB).\n>\n> I was able to reproduce this consistently on both my host machine (Arch\n> x64, g++6.3) and a VM (Ubuntu 16.04 x64, g++5.4).\n>\n> I reduced my benchmark to only contain grpc code, this is the gist of it:\n>\n> class grpc_service : public GrpcServiceBenchmark::Service {public:\n>   ::grpc::Status get_blob(::grpc::ServerContext *context,\n>                             const ::EmptyRequest *request,\n>                             ::BlobResponse *response) override {\n>       response->set_data(::get_blob(blob_size_));\n>       return ::grpc::Status::OK;\n>   }\n>   int blob_size_;\n> };\n> class grpc_bench : public benchmark::Fixture {public:\n>   grpc_bench()\n>       : channel_(grpc::CreateChannel(server_addr_,\n>                                      grpc::InsecureChannelCredentials())),\n>         client_(channel_) {\n>     grpc::ServerBuilder b;\n>     b.AddListeningPort(server_addr_, grpc::InsecureServerCredentials());\n>     b.RegisterService(&service_impl_);\n>     server_ = b.BuildAndStart();\n>   }\n>   void get_blob(int param) {\n>     service_impl_.blob_size_ = param;\n>     grpc::ClientContext client_context;\n>     EmptyRequest request;\n>     BlobResponse response;\n>     auto status = client_.get_blob(&client_context, request, &response);\n>     std::string s;\n>     benchmark::DoNotOptimize(s = response.data());\n>     std::size_t size;\n>     benchmark::DoNotOptimize(size = s.size());\n>   }\n>\n>   ~grpc_bench() noexcept { server_->Shutdown(); }\n>\n>   std::shared_ptr<grpc::ChannelInterface> channel_;\n>   GrpcServiceBenchmark::Stub client_;\n>   std::unique_ptr<grpc::Server> server_;\n>   grpc_service service_impl_;\n>   static constexpr const char *server_addr_ = \"localhost:8082\";\n> };\n>\n> You can clone this branch for the full source:\n> https://github.com/rpclib/benchmarks/tree/grpc_high_memory_repro\n>\n> To build the above repo, conan <https://www.conan.io/> is required:\n>\n> mkdir build && cd build\n> conan install .. --build missing\n> cmake ..\n> make\n>\n> There is of course a chance that I made a mistake in my benchmarking code.\n> Please let me know if I can provide an more details.\n>\n> Also, I would be interested in you opinion about whether or not this code\n> is a fair entry in this benchmark, as I'm not very knowledgeable about\n> grpc. You can see the implementations using other libraries on the master\n> branch of the same repo for comparison.\n>\n> —\n> You are receiving this because you are subscribed to this thread.\n> Reply to this email directly, view it on GitHub\n> <https://github.com/grpc/grpc/issues/9510>, or mute the thread\n> <https://github.com/notifications/unsubscribe-auth/AJpudVxwZudWwmQy2twUPbcfOgl_cQGeks5rXkRlgaJpZM4Lx3GJ>\n> .\n>\n"
  },
  {
    "url": "https://api.github.com/repos/grpc/grpc/issues/comments/276179266",
    "html_url": "https://github.com/grpc/grpc/issues/9510#issuecomment-276179266",
    "issue_url": "https://api.github.com/repos/grpc/grpc/issues/9510",
    "id": 276179266,
    "node_id": "MDEyOklzc3VlQ29tbWVudDI3NjE3OTI2Ng==",
    "user": {
      "login": "sztomi",
      "id": 240594,
      "node_id": "MDQ6VXNlcjI0MDU5NA==",
      "avatar_url": "https://avatars1.githubusercontent.com/u/240594?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/sztomi",
      "html_url": "https://github.com/sztomi",
      "followers_url": "https://api.github.com/users/sztomi/followers",
      "following_url": "https://api.github.com/users/sztomi/following{/other_user}",
      "gists_url": "https://api.github.com/users/sztomi/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/sztomi/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/sztomi/subscriptions",
      "organizations_url": "https://api.github.com/users/sztomi/orgs",
      "repos_url": "https://api.github.com/users/sztomi/repos",
      "events_url": "https://api.github.com/users/sztomi/events{/privacy}",
      "received_events_url": "https://api.github.com/users/sztomi/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2017-01-30T20:23:19Z",
    "updated_at": "2017-01-30T20:23:19Z",
    "author_association": "NONE",
    "body": "Yes (at least that was my intention, but I'm really new to grpc)."
  },
  {
    "url": "https://api.github.com/repos/grpc/grpc/issues/comments/277486752",
    "html_url": "https://github.com/grpc/grpc/issues/9510#issuecomment-277486752",
    "issue_url": "https://api.github.com/repos/grpc/grpc/issues/9510",
    "id": 277486752,
    "node_id": "MDEyOklzc3VlQ29tbWVudDI3NzQ4Njc1Mg==",
    "user": {
      "login": "sztomi",
      "id": 240594,
      "node_id": "MDQ6VXNlcjI0MDU5NA==",
      "avatar_url": "https://avatars1.githubusercontent.com/u/240594?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/sztomi",
      "html_url": "https://github.com/sztomi",
      "followers_url": "https://api.github.com/users/sztomi/followers",
      "following_url": "https://api.github.com/users/sztomi/following{/other_user}",
      "gists_url": "https://api.github.com/users/sztomi/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/sztomi/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/sztomi/subscriptions",
      "organizations_url": "https://api.github.com/users/sztomi/orgs",
      "repos_url": "https://api.github.com/users/sztomi/repos",
      "events_url": "https://api.github.com/users/sztomi/events{/privacy}",
      "received_events_url": "https://api.github.com/users/sztomi/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2017-02-04T23:50:30Z",
    "updated_at": "2017-02-04T23:50:30Z",
    "author_association": "NONE",
    "body": "This issue is still reproducible with the finalized release (https://github.com/grpc/grpc/releases/tag/v1.1.0). I have updated my conan package and repro branch to refer to this version (see above). "
  },
  {
    "url": "https://api.github.com/repos/grpc/grpc/issues/comments/281133532",
    "html_url": "https://github.com/grpc/grpc/issues/9510#issuecomment-281133532",
    "issue_url": "https://api.github.com/repos/grpc/grpc/issues/9510",
    "id": 281133532,
    "node_id": "MDEyOklzc3VlQ29tbWVudDI4MTEzMzUzMg==",
    "user": {
      "login": "sztomi",
      "id": 240594,
      "node_id": "MDQ6VXNlcjI0MDU5NA==",
      "avatar_url": "https://avatars1.githubusercontent.com/u/240594?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/sztomi",
      "html_url": "https://github.com/sztomi",
      "followers_url": "https://api.github.com/users/sztomi/followers",
      "following_url": "https://api.github.com/users/sztomi/following{/other_user}",
      "gists_url": "https://api.github.com/users/sztomi/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/sztomi/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/sztomi/subscriptions",
      "organizations_url": "https://api.github.com/users/sztomi/orgs",
      "repos_url": "https://api.github.com/users/sztomi/repos",
      "events_url": "https://api.github.com/users/sztomi/events{/privacy}",
      "received_events_url": "https://api.github.com/users/sztomi/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2017-02-20T17:07:38Z",
    "updated_at": "2017-02-20T17:07:38Z",
    "author_association": "NONE",
    "body": "I was wondering if this is going to be fixed in the near future? I'd like to release a blog post about the benchmark suite I created, but I'd have to exclude grpc from this particular benchmark due to this bug (two other benchmarks can be performed with the current release though fortunately). Am I wrong in assuming that this potentially makes grpc vulnerable to resource exhaustion attacks?"
  },
  {
    "url": "https://api.github.com/repos/grpc/grpc/issues/comments/281409908",
    "html_url": "https://github.com/grpc/grpc/issues/9510#issuecomment-281409908",
    "issue_url": "https://api.github.com/repos/grpc/grpc/issues/9510",
    "id": 281409908,
    "node_id": "MDEyOklzc3VlQ29tbWVudDI4MTQwOTkwOA==",
    "user": {
      "login": "ctiller",
      "id": 10120821,
      "node_id": "MDQ6VXNlcjEwMTIwODIx",
      "avatar_url": "https://avatars3.githubusercontent.com/u/10120821?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/ctiller",
      "html_url": "https://github.com/ctiller",
      "followers_url": "https://api.github.com/users/ctiller/followers",
      "following_url": "https://api.github.com/users/ctiller/following{/other_user}",
      "gists_url": "https://api.github.com/users/ctiller/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/ctiller/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/ctiller/subscriptions",
      "organizations_url": "https://api.github.com/users/ctiller/orgs",
      "repos_url": "https://api.github.com/users/ctiller/repos",
      "events_url": "https://api.github.com/users/ctiller/events{/privacy}",
      "received_events_url": "https://api.github.com/users/ctiller/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2017-02-21T17:10:41Z",
    "updated_at": "2017-02-21T17:10:41Z",
    "author_association": "MEMBER",
    "body": "@lyuxuan - can you try and reproduce this and capture where the allocations are coming from?"
  },
  {
    "url": "https://api.github.com/repos/grpc/grpc/issues/comments/286599846",
    "html_url": "https://github.com/grpc/grpc/issues/9510#issuecomment-286599846",
    "issue_url": "https://api.github.com/repos/grpc/grpc/issues/9510",
    "id": 286599846,
    "node_id": "MDEyOklzc3VlQ29tbWVudDI4NjU5OTg0Ng==",
    "user": {
      "login": "lyuxuan",
      "id": 426013,
      "node_id": "MDQ6VXNlcjQyNjAxMw==",
      "avatar_url": "https://avatars1.githubusercontent.com/u/426013?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/lyuxuan",
      "html_url": "https://github.com/lyuxuan",
      "followers_url": "https://api.github.com/users/lyuxuan/followers",
      "following_url": "https://api.github.com/users/lyuxuan/following{/other_user}",
      "gists_url": "https://api.github.com/users/lyuxuan/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/lyuxuan/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/lyuxuan/subscriptions",
      "organizations_url": "https://api.github.com/users/lyuxuan/orgs",
      "repos_url": "https://api.github.com/users/lyuxuan/repos",
      "events_url": "https://api.github.com/users/lyuxuan/events{/privacy}",
      "received_events_url": "https://api.github.com/users/lyuxuan/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2017-03-15T00:00:59Z",
    "updated_at": "2017-03-15T00:00:59Z",
    "author_association": "CONTRIBUTOR",
    "body": "@sztomi sorry about the late reply. I cloned your code on a VM and tried to reproduce it, but I have some issues with conan. \r\nRunning the \"conan install .. --build missing\", I got the error shown below:\r\nERROR: pkg-config/0.29.1@sztomi/testing: Error in source() method, line 21\r\n\ttools.download(tarball_url, tgz)\r\n\tError downloading file https://pkgconfig.freedesktop.org/releases/pkg-config-0.29.1.tar.gz: 'hostname 'pkgconfig.freedesktop.org' doesn't match either of 'distributions.freedesktop.org', 'farsight.freedesktop.org', 'fontconfig.freedesktop.org', 'fontconfig.org', 'freedesktop.org', 'geoclue.freedesktop.org', 'secure.freedesktop.org', 'www.fontconfig.org', 'www.freedesktop.org''\r\n\r\nand then I added verify=false to download(). New error appeared:\r\nthrift/0.9.3@sztomi/testing: ERROR: Package '5803b7ddb711007bf721b44c0023e9272981760a' build failed\r\nthrift/0.9.3@sztomi/testing: WARN: Build folder /home/yuxuanli/.conan/data/thrift/0.9.3/sztomi/testing/build/5803b7ddb711007bf721b44c0023e9272981760a\r\nthrift/0.9.3@sztomi/testing: WARN:   File \"/home/yuxuanli/.conan/data/thrift/0.9.3/sztomi/testing/export/conanfile.py\", line 110, in build\r\nthrift/0.9.3@sztomi/testing: WARN:     ACLOCAL_PATH = '$ACLOCAL_PATH:{}'.format(self.deps_env_info['pkg-config'].path[1])\r\nthrift/0.9.3@sztomi/testing: WARN: IndexError: list index out of range\r\nERROR: thrift: list index out of range\r\n\r\nCould you please give me more instructions on how to run your code? Thanks.\r\nAlso, I noticed that there are some updates to the get_blob() on master, are they related to the issue here?\r\n\r\n"
  },
  {
    "url": "https://api.github.com/repos/grpc/grpc/issues/comments/286694758",
    "html_url": "https://github.com/grpc/grpc/issues/9510#issuecomment-286694758",
    "issue_url": "https://api.github.com/repos/grpc/grpc/issues/9510",
    "id": 286694758,
    "node_id": "MDEyOklzc3VlQ29tbWVudDI4NjY5NDc1OA==",
    "user": {
      "login": "sztomi",
      "id": 240594,
      "node_id": "MDQ6VXNlcjI0MDU5NA==",
      "avatar_url": "https://avatars1.githubusercontent.com/u/240594?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/sztomi",
      "html_url": "https://github.com/sztomi",
      "followers_url": "https://api.github.com/users/sztomi/followers",
      "following_url": "https://api.github.com/users/sztomi/following{/other_user}",
      "gists_url": "https://api.github.com/users/sztomi/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/sztomi/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/sztomi/subscriptions",
      "organizations_url": "https://api.github.com/users/sztomi/orgs",
      "repos_url": "https://api.github.com/users/sztomi/repos",
      "events_url": "https://api.github.com/users/sztomi/events{/privacy}",
      "received_events_url": "https://api.github.com/users/sztomi/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2017-03-15T09:59:16Z",
    "updated_at": "2017-03-15T09:59:16Z",
    "author_association": "NONE",
    "body": "@lyuxuan so apparently the last conan update broke some of the packages. That said, it looks like you are building the master branch. Could you try building only the repro branch (grpc_high_memory_repro)? The problematic benchmarks are disabled on the master branch anyway. If it still fails, you could try conan 0.18, because that's the version I used. I'll eventually get around to fix my packages but it'll take time."
  },
  {
    "url": "https://api.github.com/repos/grpc/grpc/issues/comments/293696034",
    "html_url": "https://github.com/grpc/grpc/issues/9510#issuecomment-293696034",
    "issue_url": "https://api.github.com/repos/grpc/grpc/issues/9510",
    "id": 293696034,
    "node_id": "MDEyOklzc3VlQ29tbWVudDI5MzY5NjAzNA==",
    "user": {
      "login": "lyuxuan",
      "id": 426013,
      "node_id": "MDQ6VXNlcjQyNjAxMw==",
      "avatar_url": "https://avatars1.githubusercontent.com/u/426013?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/lyuxuan",
      "html_url": "https://github.com/lyuxuan",
      "followers_url": "https://api.github.com/users/lyuxuan/followers",
      "following_url": "https://api.github.com/users/lyuxuan/following{/other_user}",
      "gists_url": "https://api.github.com/users/lyuxuan/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/lyuxuan/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/lyuxuan/subscriptions",
      "organizations_url": "https://api.github.com/users/lyuxuan/orgs",
      "repos_url": "https://api.github.com/users/lyuxuan/repos",
      "events_url": "https://api.github.com/users/lyuxuan/events{/privacy}",
      "received_events_url": "https://api.github.com/users/lyuxuan/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2017-04-12T20:21:47Z",
    "updated_at": "2017-04-12T20:21:47Z",
    "author_association": "CONTRIBUTOR",
    "body": "Hi @sztomi could you please update your grpc version? I tried your benchmark with grpc v1.2.3, no out of memory issue showed up."
  },
  {
    "url": "https://api.github.com/repos/grpc/grpc/issues/comments/293835326",
    "html_url": "https://github.com/grpc/grpc/issues/9510#issuecomment-293835326",
    "issue_url": "https://api.github.com/repos/grpc/grpc/issues/9510",
    "id": 293835326,
    "node_id": "MDEyOklzc3VlQ29tbWVudDI5MzgzNTMyNg==",
    "user": {
      "login": "sztomi",
      "id": 240594,
      "node_id": "MDQ6VXNlcjI0MDU5NA==",
      "avatar_url": "https://avatars1.githubusercontent.com/u/240594?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/sztomi",
      "html_url": "https://github.com/sztomi",
      "followers_url": "https://api.github.com/users/sztomi/followers",
      "following_url": "https://api.github.com/users/sztomi/following{/other_user}",
      "gists_url": "https://api.github.com/users/sztomi/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/sztomi/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/sztomi/subscriptions",
      "organizations_url": "https://api.github.com/users/sztomi/orgs",
      "repos_url": "https://api.github.com/users/sztomi/repos",
      "events_url": "https://api.github.com/users/sztomi/events{/privacy}",
      "received_events_url": "https://api.github.com/users/sztomi/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2017-04-13T09:10:04Z",
    "updated_at": "2017-05-08T20:09:24Z",
    "author_association": "NONE",
    "body": "Thanks for the update, I'm going to try it soon and will let you know here.\r\n\r\n\r\nOn Wed, Apr 12, 2017 at 10:22 PM, lyuxuan <notifications@github.com> wrote:\r\n\r\n> Hi @sztomi <https://github.com/sztomi> could you please update your grpc\r\n> version? I tried your benchmark with grpc v1.2.3, no out of memory issue\r\n> showed up.\r\n>\r\n> —\r\n> You are receiving this because you were mentioned.\r\n> Reply to this email directly, view it on GitHub\r\n> <https://github.com/grpc/grpc/issues/9510#issuecomment-293696034>, or mute\r\n> the thread\r\n> <https://github.com/notifications/unsubscribe-auth/AAOr0teukTlonbug-wb2PWCe-YbX8Qrjks5rvTJogaJpZM4Lx3GJ>\r\n> .\r\n>\r\n"
  }
]
