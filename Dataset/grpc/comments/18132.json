[
  {
    "url": "https://api.github.com/repos/grpc/grpc/issues/comments/466230814",
    "html_url": "https://github.com/grpc/grpc/issues/18132#issuecomment-466230814",
    "issue_url": "https://api.github.com/repos/grpc/grpc/issues/18132",
    "id": 466230814,
    "node_id": "MDEyOklzc3VlQ29tbWVudDQ2NjIzMDgxNA==",
    "user": {
      "login": "equinox1993",
      "id": 5727628,
      "node_id": "MDQ6VXNlcjU3Mjc2Mjg=",
      "avatar_url": "https://avatars3.githubusercontent.com/u/5727628?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/equinox1993",
      "html_url": "https://github.com/equinox1993",
      "followers_url": "https://api.github.com/users/equinox1993/followers",
      "following_url": "https://api.github.com/users/equinox1993/following{/other_user}",
      "gists_url": "https://api.github.com/users/equinox1993/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/equinox1993/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/equinox1993/subscriptions",
      "organizations_url": "https://api.github.com/users/equinox1993/orgs",
      "repos_url": "https://api.github.com/users/equinox1993/repos",
      "events_url": "https://api.github.com/users/equinox1993/events{/privacy}",
      "received_events_url": "https://api.github.com/users/equinox1993/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2019-02-22T00:59:21Z",
    "updated_at": "2019-02-22T00:59:21Z",
    "author_association": "CONTRIBUTOR",
    "body": "There is another crash in hpack_parser.cc. I'm investigating it.\r\n\r\nChromium bug if you're interested: http://crbug.com/934087"
  },
  {
    "url": "https://api.github.com/repos/grpc/grpc/issues/comments/466236028",
    "html_url": "https://github.com/grpc/grpc/issues/18132#issuecomment-466236028",
    "issue_url": "https://api.github.com/repos/grpc/grpc/issues/18132",
    "id": 466236028,
    "node_id": "MDEyOklzc3VlQ29tbWVudDQ2NjIzNjAyOA==",
    "user": {
      "login": "equinox1993",
      "id": 5727628,
      "node_id": "MDQ6VXNlcjU3Mjc2Mjg=",
      "avatar_url": "https://avatars3.githubusercontent.com/u/5727628?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/equinox1993",
      "html_url": "https://github.com/equinox1993",
      "followers_url": "https://api.github.com/users/equinox1993/followers",
      "following_url": "https://api.github.com/users/equinox1993/following{/other_user}",
      "gists_url": "https://api.github.com/users/equinox1993/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/equinox1993/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/equinox1993/subscriptions",
      "organizations_url": "https://api.github.com/users/equinox1993/orgs",
      "repos_url": "https://api.github.com/users/equinox1993/repos",
      "events_url": "https://api.github.com/users/equinox1993/events{/privacy}",
      "received_events_url": "https://api.github.com/users/equinox1993/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2019-02-22T01:24:13Z",
    "updated_at": "2019-02-22T02:40:13Z",
    "author_association": "CONTRIBUTOR",
    "body": "Seems to be similar issue. This one happens in `parse_value4`:\r\nhttps://github.com/grpc/grpc/blob/15c947a080e20b4d5627d26eb8b5b10fe62a82b8/src/core/ext/transport/chttp2/transport/hpack_parser.cc#L1167\r\n\r\nBacktrace:\r\n```\r\n#0  0x567eba60 in parse_string_prefix (p=0xf5f26c10, \r\n    cur=0x83b00a35 <error: Cannot access memory at address 0x83b00a35>, end=0xf3b009b7 \"\")\r\n    at ../../third_party/grpc/src/src/core/ext/transport/chttp2/transport/hpack_parser.cc:1216\r\n#1  0x567e955e in parse_next (p=0xf5f26c10, \r\n    cur=0x83b00a35 <error: Cannot access memory at address 0x83b00a35>, end=0xf3b009b7 \"\")\r\n    at ../../third_party/grpc/src/src/core/ext/transport/chttp2/transport/hpack_parser.cc:686\r\n#2  0x567ecc8f in begin_parse_string (p=0xf5f26c10, cur=0xf3b009b7 \"\", end=0xf3b009b7 \"\", \r\n    binary=0 '\\000', str=0xf5f26c30)\r\n    at ../../third_party/grpc/src/src/core/ext/transport/chttp2/transport/hpack_parser.cc:1463\r\n#3  0x567f18d2 in parse_key_string (p=0xf5f26c10, cur=0xf3b009b7 \"\", end=0xf3b009b7 \"\")\r\n    at ../../third_party/grpc/src/src/core/ext/transport/chttp2/transport/hpack_parser.cc:1491\r\n#4  0x567e955e in parse_next (p=0xf5f26c10, cur=0xf3b009b7 \"\", end=0xf3b009b7 \"\")\r\n    at ../../third_party/grpc/src/src/core/ext/transport/chttp2/transport/hpack_parser.cc:686\r\n#5  0x567ea0cf in parse_value4 (p=0xf5f26c10, cur=0xf3b009b6 \"\\b\", end=0xf3b009b7 \"\")\r\n    at ../../third_party/grpc/src/src/core/ext/transport/chttp2/transport/hpack_parser.cc:1167\r\n#6  0x567e9aa4 in parse_value3 (p=0xf5f26c10, cur=0xf3b009b5 \"\\377\\b\", end=0xf3b009b7 \"\")\r\n    at ../../third_party/grpc/src/src/core/ext/transport/chttp2/transport/hpack_parser.cc:1131\r\n#7  0x567e97e4 in parse_value2 (p=0xf5f26c10, cur=0xf3b009b4 \"\\377\\377\\b\", end=0xf3b009b7 \"\")\r\n    at ../../third_party/grpc/src/src/core/ext/transport/chttp2/transport/hpack_parser.cc:1113\r\n#8  0x567e9334 in parse_value1 (p=0xf5f26c10, cur=0xf3b009b3 \"\\377\\377\\377\\b\", \r\n    end=0xf3b009b7 \"\")\r\n    at ../../third_party/grpc/src/src/core/ext/transport/chttp2/transport/hpack_parser.cc:1095\r\n#9  0x567e9071 in parse_value0 (p=0xf5f26c10, cur=0xf3b009b2 \"\\377\\377\\377\\377\\b\", \r\n    end=0xf3b009b7 \"\")\r\n    at ../../third_party/grpc/src/src/core/ext/transport/chttp2/transport/hpack_parser.cc:1077\r\n#10 0x567ebc45 in parse_string_prefix (p=0xf5f26c10, cur=0xf3b009b1 \"\\177\\377\\377\\377\\377\\b\", \r\n    end=0xf3b009b7 \"\")\r\n    at ../../third_party/grpc/src/src/core/ext/transport/chttp2/transport/hpack_parser.cc:1220\r\n#11 0x567e61da in parse_lithdr_notidx_v (p=0xf5f26c10, cur=0xf3b009b0 \"\", end=0xf3b009b7 \"\")\r\n    at ../../third_party/grpc/src/src/core/ext/transport/chttp2/transport/hpack_parser.cc:924\r\n#12 0x567e23b2 in parse_begin (p=0xf5f26c10, cur=0xf3b009b0 \"\", end=0xf3b009b7 \"\")\r\n    at ../../third_party/grpc/src/src/core/ext/transport/chttp2/transport/hpack_parser.cc:698\r\n#13 0x567e30e9 in grpc_chttp2_hpack_parser_parse (p=0xf5f26c10, slice=...)\r\n    at ../../third_party/grpc/src/src/core/ext/transport/chttp2/transport/hpack_parser.cc:1583\r\n#14 0x566b7773 in LLVMFuzzerTestOneInput (data=0xf3b009b0 \"\", size=7)\r\n    at ../../third_party/grpc/src/test/core/transport/chttp2/hpack_parser_fuzzer_test.cc:45\r\n#15 0x5673a2e4 in fuzzer::Fuzzer::ExecuteCallback (this=0xf2203d80, Data=0xf3b009e0 \"\", Size=7)\r\n    at ../../third_party/libFuzzer/src/FuzzerLoop.cpp:529\r\n#16 0x566d1fb0 in fuzzer::RunOneTest (F=0xf2203d80, \r\n    InputFilePath=0xf3901e20 \"/usr/local/google/home/yuweih/.clusterfuzz/cache/testcases/5187224482217984_testcase/fuzz-1\", MaxLen=0) at ../../third_party/libFuzzer/src/FuzzerDriver.cpp:286\r\n#17 0x566d9a4e in fuzzer::FuzzerDriver (argc=0xf5eeab50, argv=0xf5eeab60, \r\n    Callback=0x566b73f0 <LLVMFuzzerTestOneInput(uint8_t const*, size_t)>)\r\n    at ../../third_party/libFuzzer/src/FuzzerDriver.cpp:715\r\n#18 0x567700bb in main (argc=5, argv=0xffffc9f4)\r\n    at ../../third_party/libFuzzer/src/FuzzerMain.cpp:19\r\n```"
  },
  {
    "url": "https://api.github.com/repos/grpc/grpc/issues/comments/467231894",
    "html_url": "https://github.com/grpc/grpc/issues/18132#issuecomment-467231894",
    "issue_url": "https://api.github.com/repos/grpc/grpc/issues/18132",
    "id": 467231894,
    "node_id": "MDEyOklzc3VlQ29tbWVudDQ2NzIzMTg5NA==",
    "user": {
      "login": "yang-g",
      "id": 10122250,
      "node_id": "MDQ6VXNlcjEwMTIyMjUw",
      "avatar_url": "https://avatars0.githubusercontent.com/u/10122250?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/yang-g",
      "html_url": "https://github.com/yang-g",
      "followers_url": "https://api.github.com/users/yang-g/followers",
      "following_url": "https://api.github.com/users/yang-g/following{/other_user}",
      "gists_url": "https://api.github.com/users/yang-g/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/yang-g/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/yang-g/subscriptions",
      "organizations_url": "https://api.github.com/users/yang-g/orgs",
      "repos_url": "https://api.github.com/users/yang-g/repos",
      "events_url": "https://api.github.com/users/yang-g/events{/privacy}",
      "received_events_url": "https://api.github.com/users/yang-g/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2019-02-25T23:49:09Z",
    "updated_at": "2019-02-25T23:49:09Z",
    "author_association": "MEMBER",
    "body": "I think what happened is an overflow under 32bit system.\r\n\r\nNote when we are trying to parse a string from HPACK, we first decode the string's length. In the above case of `0x41 0x7f 0xff 0xf6 0xff 0xff 0x8e 0x00`, the length is `4026530687`, which is then converted to `intptr_t` in https://github.com/grpc/grpc/blob/15c947a080e20b4d5627d26eb8b5b10fe62a82b8/src/core/ext/transport/chttp2/transport/hpack_parser.cc#L1455\r\n\r\nThe conversion, if `intptr_t` is 32bit, will result in `-268436609`. At this time, `end == cur` and the comparison `0 >= -268436609` tests to true and then the error.\r\n\r\nI could not see the second bug details but I would guess it is something similar.\r\n\r\nSo I think the fix linked above is likely not right, because this can happen when `end > cur` too.\r\n\r\nIt seems like a valid thing to be fixed as we should not parse out of bound on *any* data read from wire and I suppose we do not have a guard in front of the parser to check this (the test is creating a parser directly).\r\nThe right fix seems to be to return an error when `p->strlen` is going to overflow when converting to a `int32_t` or even further lower the bound with `SETTINGS_MAX_HEADER_LIST_SIZE`.\r\n\r\n\r\n\r\n\r\n\r\n"
  },
  {
    "url": "https://api.github.com/repos/grpc/grpc/issues/comments/467232253",
    "html_url": "https://github.com/grpc/grpc/issues/18132#issuecomment-467232253",
    "issue_url": "https://api.github.com/repos/grpc/grpc/issues/18132",
    "id": 467232253,
    "node_id": "MDEyOklzc3VlQ29tbWVudDQ2NzIzMjI1Mw==",
    "user": {
      "login": "yang-g",
      "id": 10122250,
      "node_id": "MDQ6VXNlcjEwMTIyMjUw",
      "avatar_url": "https://avatars0.githubusercontent.com/u/10122250?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/yang-g",
      "html_url": "https://github.com/yang-g",
      "followers_url": "https://api.github.com/users/yang-g/followers",
      "following_url": "https://api.github.com/users/yang-g/following{/other_user}",
      "gists_url": "https://api.github.com/users/yang-g/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/yang-g/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/yang-g/subscriptions",
      "organizations_url": "https://api.github.com/users/yang-g/orgs",
      "repos_url": "https://api.github.com/users/yang-g/repos",
      "events_url": "https://api.github.com/users/yang-g/events{/privacy}",
      "received_events_url": "https://api.github.com/users/yang-g/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2019-02-25T23:50:29Z",
    "updated_at": "2019-02-25T23:50:29Z",
    "author_association": "MEMBER",
    "body": "The `p->strlen` is defined as `uint32_t`, if it is not clear from the context."
  },
  {
    "url": "https://api.github.com/repos/grpc/grpc/issues/comments/467242230",
    "html_url": "https://github.com/grpc/grpc/issues/18132#issuecomment-467242230",
    "issue_url": "https://api.github.com/repos/grpc/grpc/issues/18132",
    "id": 467242230,
    "node_id": "MDEyOklzc3VlQ29tbWVudDQ2NzI0MjIzMA==",
    "user": {
      "login": "equinox1993",
      "id": 5727628,
      "node_id": "MDQ6VXNlcjU3Mjc2Mjg=",
      "avatar_url": "https://avatars3.githubusercontent.com/u/5727628?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/equinox1993",
      "html_url": "https://github.com/equinox1993",
      "followers_url": "https://api.github.com/users/equinox1993/followers",
      "following_url": "https://api.github.com/users/equinox1993/following{/other_user}",
      "gists_url": "https://api.github.com/users/equinox1993/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/equinox1993/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/equinox1993/subscriptions",
      "organizations_url": "https://api.github.com/users/equinox1993/orgs",
      "repos_url": "https://api.github.com/users/equinox1993/repos",
      "events_url": "https://api.github.com/users/equinox1993/events{/privacy}",
      "received_events_url": "https://api.github.com/users/equinox1993/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2019-02-26T00:32:48Z",
    "updated_at": "2019-02-26T00:32:48Z",
    "author_association": "CONTRIBUTOR",
    "body": "FYI the second test input is `00 7F FF FF FF FF 08`. Anyhow your PR fixes both of the test cases :)"
  },
  {
    "url": "https://api.github.com/repos/grpc/grpc/issues/comments/467243391",
    "html_url": "https://github.com/grpc/grpc/issues/18132#issuecomment-467243391",
    "issue_url": "https://api.github.com/repos/grpc/grpc/issues/18132",
    "id": 467243391,
    "node_id": "MDEyOklzc3VlQ29tbWVudDQ2NzI0MzM5MQ==",
    "user": {
      "login": "yang-g",
      "id": 10122250,
      "node_id": "MDQ6VXNlcjEwMTIyMjUw",
      "avatar_url": "https://avatars0.githubusercontent.com/u/10122250?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/yang-g",
      "html_url": "https://github.com/yang-g",
      "followers_url": "https://api.github.com/users/yang-g/followers",
      "following_url": "https://api.github.com/users/yang-g/following{/other_user}",
      "gists_url": "https://api.github.com/users/yang-g/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/yang-g/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/yang-g/subscriptions",
      "organizations_url": "https://api.github.com/users/yang-g/orgs",
      "repos_url": "https://api.github.com/users/yang-g/repos",
      "events_url": "https://api.github.com/users/yang-g/events{/privacy}",
      "received_events_url": "https://api.github.com/users/yang-g/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2019-02-26T00:37:58Z",
    "updated_at": "2019-02-26T00:37:58Z",
    "author_association": "MEMBER",
    "body": "@equinox1993 Thanks for checking it out."
  }
]
