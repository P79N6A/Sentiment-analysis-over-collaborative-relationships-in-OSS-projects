[
  {
    "url": "https://api.github.com/repos/grpc/grpc/issues/comments/250806900",
    "html_url": "https://github.com/grpc/grpc/issues/8232#issuecomment-250806900",
    "issue_url": "https://api.github.com/repos/grpc/grpc/issues/8232",
    "id": 250806900,
    "node_id": "MDEyOklzc3VlQ29tbWVudDI1MDgwNjkwMA==",
    "user": {
      "login": "kpayson64",
      "id": 18316330,
      "node_id": "MDQ6VXNlcjE4MzE2MzMw",
      "avatar_url": "https://avatars2.githubusercontent.com/u/18316330?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/kpayson64",
      "html_url": "https://github.com/kpayson64",
      "followers_url": "https://api.github.com/users/kpayson64/followers",
      "following_url": "https://api.github.com/users/kpayson64/following{/other_user}",
      "gists_url": "https://api.github.com/users/kpayson64/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/kpayson64/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/kpayson64/subscriptions",
      "organizations_url": "https://api.github.com/users/kpayson64/orgs",
      "repos_url": "https://api.github.com/users/kpayson64/repos",
      "events_url": "https://api.github.com/users/kpayson64/events{/privacy}",
      "received_events_url": "https://api.github.com/users/kpayson64/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2016-09-30T17:41:44Z",
    "updated_at": "2016-09-30T17:42:01Z",
    "author_association": "CONTRIBUTOR",
    "body": "From reading your output, it looks like the program attempts to exit after 2 seconds, but finds a memory leak and waits ~8s longer for the program to clean it up.\n\nThis is likely due to some cyclic reference and objects not being destroyed.  Because shutting down the polling threads completion queue fixes the issue, the cyclic reference is probably somewhere in that area.  I'll take a look.\n"
  },
  {
    "url": "https://api.github.com/repos/grpc/grpc/issues/comments/273568378",
    "html_url": "https://github.com/grpc/grpc/issues/8232#issuecomment-273568378",
    "issue_url": "https://api.github.com/repos/grpc/grpc/issues/8232",
    "id": 273568378,
    "node_id": "MDEyOklzc3VlQ29tbWVudDI3MzU2ODM3OA==",
    "user": {
      "login": "nathanielmanistaatgoogle",
      "id": 10131044,
      "node_id": "MDQ6VXNlcjEwMTMxMDQ0",
      "avatar_url": "https://avatars0.githubusercontent.com/u/10131044?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/nathanielmanistaatgoogle",
      "html_url": "https://github.com/nathanielmanistaatgoogle",
      "followers_url": "https://api.github.com/users/nathanielmanistaatgoogle/followers",
      "following_url": "https://api.github.com/users/nathanielmanistaatgoogle/following{/other_user}",
      "gists_url": "https://api.github.com/users/nathanielmanistaatgoogle/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/nathanielmanistaatgoogle/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/nathanielmanistaatgoogle/subscriptions",
      "organizations_url": "https://api.github.com/users/nathanielmanistaatgoogle/orgs",
      "repos_url": "https://api.github.com/users/nathanielmanistaatgoogle/repos",
      "events_url": "https://api.github.com/users/nathanielmanistaatgoogle/events{/privacy}",
      "received_events_url": "https://api.github.com/users/nathanielmanistaatgoogle/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2017-01-18T19:02:53Z",
    "updated_at": "2017-01-18T19:02:53Z",
    "author_association": "MEMBER",
    "body": "Deferring; there may be something here that we can improve but this doesn't seem high-enough priority to target to `1.1.0`."
  },
  {
    "url": "https://api.github.com/repos/grpc/grpc/issues/comments/321444046",
    "html_url": "https://github.com/grpc/grpc/issues/8232#issuecomment-321444046",
    "issue_url": "https://api.github.com/repos/grpc/grpc/issues/8232",
    "id": 321444046,
    "node_id": "MDEyOklzc3VlQ29tbWVudDMyMTQ0NDA0Ng==",
    "user": {
      "login": "ofpiyush",
      "id": 292174,
      "node_id": "MDQ6VXNlcjI5MjE3NA==",
      "avatar_url": "https://avatars0.githubusercontent.com/u/292174?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/ofpiyush",
      "html_url": "https://github.com/ofpiyush",
      "followers_url": "https://api.github.com/users/ofpiyush/followers",
      "following_url": "https://api.github.com/users/ofpiyush/following{/other_user}",
      "gists_url": "https://api.github.com/users/ofpiyush/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/ofpiyush/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/ofpiyush/subscriptions",
      "organizations_url": "https://api.github.com/users/ofpiyush/orgs",
      "repos_url": "https://api.github.com/users/ofpiyush/repos",
      "events_url": "https://api.github.com/users/ofpiyush/events{/privacy}",
      "received_events_url": "https://api.github.com/users/ofpiyush/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2017-08-10T03:58:51Z",
    "updated_at": "2017-08-10T03:58:51Z",
    "author_association": "NONE",
    "body": "Is this related to #9688? If yes, as a user, I'd say this is VERY high priority."
  },
  {
    "url": "https://api.github.com/repos/grpc/grpc/issues/comments/321525569",
    "html_url": "https://github.com/grpc/grpc/issues/8232#issuecomment-321525569",
    "issue_url": "https://api.github.com/repos/grpc/grpc/issues/8232",
    "id": 321525569,
    "node_id": "MDEyOklzc3VlQ29tbWVudDMyMTUyNTU2OQ==",
    "user": {
      "login": "timmyzaid",
      "id": 1449497,
      "node_id": "MDQ6VXNlcjE0NDk0OTc=",
      "avatar_url": "https://avatars1.githubusercontent.com/u/1449497?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/timmyzaid",
      "html_url": "https://github.com/timmyzaid",
      "followers_url": "https://api.github.com/users/timmyzaid/followers",
      "following_url": "https://api.github.com/users/timmyzaid/following{/other_user}",
      "gists_url": "https://api.github.com/users/timmyzaid/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/timmyzaid/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/timmyzaid/subscriptions",
      "organizations_url": "https://api.github.com/users/timmyzaid/orgs",
      "repos_url": "https://api.github.com/users/timmyzaid/repos",
      "events_url": "https://api.github.com/users/timmyzaid/events{/privacy}",
      "received_events_url": "https://api.github.com/users/timmyzaid/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2017-08-10T11:28:45Z",
    "updated_at": "2017-08-10T11:29:04Z",
    "author_association": "NONE",
    "body": "I would almost guarantee it's related and what's more this basically spells out the solution to both. They're relying on python objects to be deleted because in the __del__ methods they do cleanup of c objects via reference counts. In some cases there is a cycle which means the objects won't be cleaned up until the garbage collector runs which is non-deterministic.\r\n\r\nMy comments have been ignored for months now, very frustrating. "
  },
  {
    "url": "https://api.github.com/repos/grpc/grpc/issues/comments/324031121",
    "html_url": "https://github.com/grpc/grpc/issues/8232#issuecomment-324031121",
    "issue_url": "https://api.github.com/repos/grpc/grpc/issues/8232",
    "id": 324031121,
    "node_id": "MDEyOklzc3VlQ29tbWVudDMyNDAzMTEyMQ==",
    "user": {
      "login": "chenditc",
      "id": 3244845,
      "node_id": "MDQ6VXNlcjMyNDQ4NDU=",
      "avatar_url": "https://avatars0.githubusercontent.com/u/3244845?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/chenditc",
      "html_url": "https://github.com/chenditc",
      "followers_url": "https://api.github.com/users/chenditc/followers",
      "following_url": "https://api.github.com/users/chenditc/following{/other_user}",
      "gists_url": "https://api.github.com/users/chenditc/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/chenditc/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/chenditc/subscriptions",
      "organizations_url": "https://api.github.com/users/chenditc/orgs",
      "repos_url": "https://api.github.com/users/chenditc/repos",
      "events_url": "https://api.github.com/users/chenditc/events{/privacy}",
      "received_events_url": "https://api.github.com/users/chenditc/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2017-08-22T13:46:28Z",
    "updated_at": "2017-08-22T13:46:28Z",
    "author_association": "NONE",
    "body": "I'm also experiencing this issue. I believe every python grpc-server user will experience this."
  },
  {
    "url": "https://api.github.com/repos/grpc/grpc/issues/comments/324039913",
    "html_url": "https://github.com/grpc/grpc/issues/8232#issuecomment-324039913",
    "issue_url": "https://api.github.com/repos/grpc/grpc/issues/8232",
    "id": 324039913,
    "node_id": "MDEyOklzc3VlQ29tbWVudDMyNDAzOTkxMw==",
    "user": {
      "login": "timmyzaid",
      "id": 1449497,
      "node_id": "MDQ6VXNlcjE0NDk0OTc=",
      "avatar_url": "https://avatars1.githubusercontent.com/u/1449497?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/timmyzaid",
      "html_url": "https://github.com/timmyzaid",
      "followers_url": "https://api.github.com/users/timmyzaid/followers",
      "following_url": "https://api.github.com/users/timmyzaid/following{/other_user}",
      "gists_url": "https://api.github.com/users/timmyzaid/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/timmyzaid/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/timmyzaid/subscriptions",
      "organizations_url": "https://api.github.com/users/timmyzaid/orgs",
      "repos_url": "https://api.github.com/users/timmyzaid/repos",
      "events_url": "https://api.github.com/users/timmyzaid/events{/privacy}",
      "received_events_url": "https://api.github.com/users/timmyzaid/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2017-08-22T14:15:41Z",
    "updated_at": "2017-08-22T14:15:41Z",
    "author_association": "NONE",
    "body": "Something like this would fix the issue, the call needs to be explicitly cleaned up, you cannot rely on ```__dealloc__``` methods from cython to be called since they can be GC dependent.\r\n```patch\r\ndiff --git a/src/python/grpcio/grpc/_cython/_cygrpc/call.pyx.pxi b/src/python/grpcio/grpc/_cython/_cygrpc/call.pyx.pxi\r\nindex 752fb330d0..06439643f1 100644\r\n--- a/src/python/grpcio/grpc/_cython/_cygrpc/call.pyx.pxi\r\n+++ b/src/python/grpcio/grpc/_cython/_cygrpc/call.pyx.pxi\r\n@@ -89,6 +89,11 @@ cdef class Call:\r\n       gpr_free(peer)\r\n     return result\r\n\r\n+  def shutdown(self):\r\n+    if self.c_call != NULL:\r\n+      grpc_call_unref(self.c_call)\r\n+      self.c_call = NULL\r\n+\r\n   def __dealloc__(self):\r\n     if self.c_call != NULL:\r\n       grpc_call_unref(self.c_call)\r\ndiff --git a/src/python/grpcio/grpc/_server.py b/src/python/grpcio/grpc/_server.py\r\nindex cd59b07c04..18f36bf6cb 100644\r\n--- a/src/python/grpcio/grpc/_server.py\r\n+++ b/src/python/grpcio/grpc/_server.py\r\n@@ -154,6 +154,7 @@ def _receive_close_on_server(state):\r\n                     0].received_cancelled:\r\n                 state.client = _CANCELLED\r\n             elif state.client is _OPEN:\r\n+                receive_close_on_server_event.operation_call.shutdown()\r\n                 state.client = _CLOSED\r\n             state.condition.notify_all()\r\n             return _possibly_finish_call(state, _RECEIVE_CLOSE_ON_SERVER_TOKEN)\r\n@@ -709,7 +710,7 @@ def _serve(state):\r\n         # We want to force the deletion of the previous event\r\n         # ~before~ we poll again; if the event has a reference\r\n         # to a shutdown Call object, this can induce spinlock.\r\n-        event = None\r\n+        # event = None\r\n\r\n\r\n def _stop(state, grace):\r\n```"
  },
  {
    "url": "https://api.github.com/repos/grpc/grpc/issues/comments/372763260",
    "html_url": "https://github.com/grpc/grpc/issues/8232#issuecomment-372763260",
    "issue_url": "https://api.github.com/repos/grpc/grpc/issues/8232",
    "id": 372763260,
    "node_id": "MDEyOklzc3VlQ29tbWVudDM3Mjc2MzI2MA==",
    "user": {
      "login": "nathanielmanistaatgoogle",
      "id": 10131044,
      "node_id": "MDQ6VXNlcjEwMTMxMDQ0",
      "avatar_url": "https://avatars0.githubusercontent.com/u/10131044?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/nathanielmanistaatgoogle",
      "html_url": "https://github.com/nathanielmanistaatgoogle",
      "followers_url": "https://api.github.com/users/nathanielmanistaatgoogle/followers",
      "following_url": "https://api.github.com/users/nathanielmanistaatgoogle/following{/other_user}",
      "gists_url": "https://api.github.com/users/nathanielmanistaatgoogle/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/nathanielmanistaatgoogle/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/nathanielmanistaatgoogle/subscriptions",
      "organizations_url": "https://api.github.com/users/nathanielmanistaatgoogle/orgs",
      "repos_url": "https://api.github.com/users/nathanielmanistaatgoogle/repos",
      "events_url": "https://api.github.com/users/nathanielmanistaatgoogle/events{/privacy}",
      "received_events_url": "https://api.github.com/users/nathanielmanistaatgoogle/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2018-03-13T18:06:33Z",
    "updated_at": "2018-03-13T18:06:33Z",
    "author_association": "MEMBER",
    "body": "@kpayson64: please reassess - should this be closed because there is no longer a connectivity polling thread or retitled because it's actually about something else?"
  },
  {
    "url": "https://api.github.com/repos/grpc/grpc/issues/comments/372764021",
    "html_url": "https://github.com/grpc/grpc/issues/8232#issuecomment-372764021",
    "issue_url": "https://api.github.com/repos/grpc/grpc/issues/8232",
    "id": 372764021,
    "node_id": "MDEyOklzc3VlQ29tbWVudDM3Mjc2NDAyMQ==",
    "user": {
      "login": "kpayson64",
      "id": 18316330,
      "node_id": "MDQ6VXNlcjE4MzE2MzMw",
      "avatar_url": "https://avatars2.githubusercontent.com/u/18316330?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/kpayson64",
      "html_url": "https://github.com/kpayson64",
      "followers_url": "https://api.github.com/users/kpayson64/followers",
      "following_url": "https://api.github.com/users/kpayson64/following{/other_user}",
      "gists_url": "https://api.github.com/users/kpayson64/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/kpayson64/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/kpayson64/subscriptions",
      "organizations_url": "https://api.github.com/users/kpayson64/orgs",
      "repos_url": "https://api.github.com/users/kpayson64/repos",
      "events_url": "https://api.github.com/users/kpayson64/events{/privacy}",
      "received_events_url": "https://api.github.com/users/kpayson64/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2018-03-13T18:08:43Z",
    "updated_at": "2018-03-13T18:08:43Z",
    "author_association": "CONTRIBUTOR",
    "body": "I think this issue can be closed now that we have removed the background polling thread."
  }
]
