[
  {
    "url": "https://api.github.com/repos/grpc/grpc/issues/comments/444140212",
    "html_url": "https://github.com/grpc/grpc/issues/16721#issuecomment-444140212",
    "issue_url": "https://api.github.com/repos/grpc/grpc/issues/16721",
    "id": 444140212,
    "node_id": "MDEyOklzc3VlQ29tbWVudDQ0NDE0MDIxMg==",
    "user": {
      "login": "markdroth",
      "id": 18664614,
      "node_id": "MDQ6VXNlcjE4NjY0NjE0",
      "avatar_url": "https://avatars2.githubusercontent.com/u/18664614?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/markdroth",
      "html_url": "https://github.com/markdroth",
      "followers_url": "https://api.github.com/users/markdroth/followers",
      "following_url": "https://api.github.com/users/markdroth/following{/other_user}",
      "gists_url": "https://api.github.com/users/markdroth/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/markdroth/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/markdroth/subscriptions",
      "organizations_url": "https://api.github.com/users/markdroth/orgs",
      "repos_url": "https://api.github.com/users/markdroth/repos",
      "events_url": "https://api.github.com/users/markdroth/events{/privacy}",
      "received_events_url": "https://api.github.com/users/markdroth/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2018-12-04T15:27:10Z",
    "updated_at": "2018-12-04T15:27:10Z",
    "author_association": "MEMBER",
    "body": "Also seeing this in SingleBalancerWithClientLoadReportingTest.Vanilla.\r\n\r\nhttps://source.cloud.google.com/results/invocations/69d4b85f-dbe3-4daa-b341-8956071b1e5b/targets/github%2Fgrpc%2Fcpp_linux_tsan_native_x64_clang7.0/tests\r\n\r\n```\r\nWARNING: ThreadSanitizer: data race (pid=17111)\r\n  Write of size 8 at 0x7b5400010540 by thread T1:\r\n    #0 free /tmp/clang-build/src/compiler-rt/lib/tsan/rtl/tsan_interceptors.cc:709:3 (grpclb_end2end_test+0x682654)\r\n    #1 gpr_free /var/local/git/grpc/src/core/lib/gpr/alloc.cc:77:3 (grpclb_end2end_test+0x8d1a04)\r\n    #2 destroy_channel(void*, grpc_error*) /var/local/git/grpc/src/core/lib/surface/channel.cc:462:3 (grpclb_end2end_test+0x916ce9)\r\n    #3 exec_ctx_run(grpc_closure*, grpc_error*) /var/local/git/grpc/src/core/lib/iomgr/exec_ctx.cc:40:3 (grpclb_end2end_test+0x80dc99)\r\n    #4 grpc_core::ExecCtx::Flush() /var/local/git/grpc/src/core/lib/iomgr/exec_ctx.cc:134:9 (grpclb_end2end_test+0x80da23)\r\n    #5 grpc_core::ExecCtx::~ExecCtx() /var/local/git/grpc/./src/core/lib/iomgr/exec_ctx.h:108:5 (grpclb_end2end_test+0x781be9)\r\n    #6 grpc_call_unref /var/local/git/grpc/src/core/lib/surface/call.cc:595:1 (grpclb_end2end_test+0x90afe1)\r\n    #7 grpc_core::(anonymous namespace)::GrpcLb::BalancerCallState::~BalancerCallState() /var/local/git/grpc/src/core/ext/filters/client_channel/lb_policy/grpclb/grpclb.cc:543:3 (grpclb_end2end_test+0xbac251)\r\n    #8 void grpc_core::Delete<grpc_core::(anonymous namespace)::GrpcLb::BalancerCallState>(grpc_core::(anonymous namespace)::GrpcLb::BalancerCallState*) /var/local/git/grpc/./src/core/lib/gprpp/memory.h:59:7 (grpclb_end2end_test+0xbaceff)\r\n    #9 grpc_core::InternallyRefCountedWithTracing<grpc_core::(anonymous namespace)::GrpcLb::BalancerCallState>::Unref() /var/local/git/grpc/./src/core/lib/gprpp/orphanable.h:173:7 (grpclb_end2end_test+0xbace9f)\r\n    #10 grpc_core::InternallyRefCountedWithTracing<grpc_core::(anonymous namespace)::GrpcLb::BalancerCallState>::Unref(grpc_core::DebugLocation const&, char const*) /var/local/git/grpc/./src/core/lib/gprpp/orphanable.h:184:5 (grpclb_end2end_test+0xbac963)\r\n    #11 grpc_core::(anonymous namespace)::GrpcLb::BalancerCallState::OnBalancerMessageReceivedLocked(void*, grpc_error*) /var/local/git/grpc/src/core/ext/filters/client_channel/lb_policy/grpclb/grpclb.cc:755:15 (grpclb_end2end_test+0xbab17d)\r\n    #12 grpc_combiner_continue_exec_ctx() /var/local/git/grpc/src/core/lib/iomgr/combiner.cc:260:5 (grpclb_end2end_test+0x806e95)\r\n    #13 grpc_core::ExecCtx::Flush() /var/local/git/grpc/src/core/lib/iomgr/exec_ctx.cc:137:17 (grpclb_end2end_test+0x80da3a)\r\n    #14 GrpcExecutor::RunClosures(char const*, grpc_closure_list) /var/local/git/grpc/src/core/lib/iomgr/executor.cc:79:32 (grpclb_end2end_test+0x80ebfe)\r\n    #15 GrpcExecutor::ThreadMain(void*) /var/local/git/grpc/src/core/lib/iomgr/executor.cc:191:22 (grpclb_end2end_test+0x80f2f8)\r\n    #16 grpc_core::(anonymous namespace)::ThreadInternalsPosix::ThreadInternalsPosix(char const*, void (*)(void*), void*, bool*)::{lambda(void*)#1}::operator()(void*) const /var/local/git/grpc/src/core/lib/gprpp/thd_posix.cc:100:27 (grpclb_end2end_test+0x8d9e5c)\r\n    #17 grpc_core::(anonymous namespace)::ThreadInternalsPosix::ThreadInternalsPosix(char const*, void (*)(void*), void*, bool*)::{lambda(void*)#1}::__invoke(void*) /var/local/git/grpc/src/core/lib/gprpp/thd_posix.cc:74:25 (grpclb_end2end_test+0x8d9cf8)\r\n  Previous write of size 8 at 0x7b5400010540 by thread T14:\r\n    #0 on_resolver_shutdown_locked(client_channel_channel_data*, grpc_error*) /var/local/git/grpc/src/core/ext/filters/client_channel/client_channel.cc:289:26 (grpclb_end2end_test+0x96d204)\r\n    #1 on_resolver_result_changed_locked(void*, grpc_error*) /var/local/git/grpc/src/core/ext/filters/client_channel/client_channel.cc:445:5 (grpclb_end2end_test+0x96c55b)\r\n    #2 grpc_combiner_continue_exec_ctx() /var/local/git/grpc/src/core/lib/iomgr/combiner.cc:260:5 (grpclb_end2end_test+0x806e95)\r\n    #3 grpc_core::ExecCtx::Flush() /var/local/git/grpc/src/core/lib/iomgr/exec_ctx.cc:137:17 (grpclb_end2end_test+0x80da3a)\r\n    #4 pollset_work(grpc_pollset*, grpc_pollset_worker**, long) /var/local/git/grpc/src/core/lib/iomgr/ev_epollex_linux.cc:1199:34 (grpclb_end2end_test+0x8553b0)\r\n    #5 pollset_work(grpc_pollset*, grpc_pollset_worker**, long) /var/local/git/grpc/src/core/lib/iomgr/ev_posix.cc:321:21 (grpclb_end2end_test+0x848294)\r\n    #6 grpc_pollset_work(grpc_pollset*, grpc_pollset_worker**, long) /var/local/git/grpc/src/core/lib/iomgr/pollset.cc:48:10 (grpclb_end2end_test+0x812584)\r\n    #7 run_poller(void*, grpc_error*) /var/local/git/grpc/src/core/ext/filters/client_channel/backup_poller.cc:122:7 (grpclb_end2end_test+0xb995f6)\r\n    #8 exec_ctx_run(grpc_closure*, grpc_error*) /var/local/git/grpc/src/core/lib/iomgr/exec_ctx.cc:40:3 (grpclb_end2end_test+0x80dc99)\r\n    #9 grpc_core::ExecCtx::Flush() /var/local/git/grpc/src/core/lib/iomgr/exec_ctx.cc:134:9 (grpclb_end2end_test+0x80da23)\r\n    #10 run_some_timers() /var/local/git/grpc/src/core/lib/iomgr/timer_manager.cc:131:30 (grpclb_end2end_test+0x830267)\r\n    #11 timer_main_loop() /var/local/git/grpc/src/core/lib/iomgr/timer_manager.cc:232:9 (grpclb_end2end_test+0x82ff73)\r\n    #12 timer_thread(void*) /var/local/git/grpc/src/core/lib/iomgr/timer_manager.cc:279:3 (grpclb_end2end_test+0x82fec4)\r\n    #13 grpc_core::(anonymous namespace)::ThreadInternalsPosix::ThreadInternalsPosix(char const*, void (*)(void*), void*, bool*)::{lambda(void*)#1}::operator()(void*) const /var/local/git/grpc/src/core/lib/gprpp/thd_posix.cc:100:27 (grpclb_end2end_test+0x8d9e5c)\r\n    #14 grpc_core::(anonymous namespace)::ThreadInternalsPosix::ThreadInternalsPosix(char const*, void (*)(void*), void*, bool*)::{lambda(void*)#1}::__invoke(void*) /var/local/git/grpc/src/core/lib/gprpp/thd_posix.cc:74:25 (grpclb_end2end_test+0x8d9cf8)\r\n  Thread T1 'default-executo' (tid=17125, running) created by main thread at:\r\n    #0 pthread_create /tmp/clang-build/src/compiler-rt/lib/tsan/rtl/tsan_interceptors.cc:992:3 (grpclb_end2end_test+0x683ce5)\r\n    #1 grpc_core::(anonymous namespace)::ThreadInternalsPosix::ThreadInternalsPosix(char const*, void (*)(void*), void*, bool*) /var/local/git/grpc/src/core/lib/gprpp/thd_posix.cc:73:10 (grpclb_end2end_test+0x8d9a06)\r\n    #2 grpc_core::(anonymous namespace)::ThreadInternalsPosix* grpc_core::New<grpc_core::(anonymous namespace)::ThreadInternalsPosix, char const*&, void (*&)(void*), void*&, bool*>(char const*&, void (*&)(void*), void*&, bool*&&) /var/local/git/grpc/./src/core/lib/gprpp/memory.h:52:18 (grpclb_end2end_test+0x8d96c3)\r\n    #3 grpc_core::Thread::Thread(char const*, void (*)(void*), void*, bool*) /var/local/git/grpc/src/core/lib/gprpp/thd_posix.cc:142:7 (grpclb_end2end_test+0x8d94e4)\r\n    #4 GrpcExecutor::SetThreading(bool) /var/local/git/grpc/src/core/lib/iomgr/executor.cc:115:9 (grpclb_end2end_test+0x80e460)\r\n    #5 GrpcExecutor::Init() /var/local/git/grpc/src/core/lib/iomgr/executor.cc:58:29 (grpclb_end2end_test+0x80df9d)\r\n    #6 grpc_executor_init() /var/local/git/grpc/src/core/lib/iomgr/executor.cc:372:37 (grpclb_end2end_test+0x81015b)\r\n    #7 grpc_iomgr_init() /var/local/git/grpc/src/core/lib/iomgr/iomgr.cc:56:3 (grpclb_end2end_test+0x810ec1)\r\n    #8 grpc_init /var/local/git/grpc/src/core/lib/surface/init.cc:134:5 (grpclb_end2end_test+0x8fd568)\r\n    #9 main /var/local/git/grpc/test/cpp/end2end/grpclb_end2end_test.cc:1520:3 (grpclb_end2end_test+0x73a36d)\r\n  Thread T14 'grpc_global_tim' (tid=17188, finished) created by thread T3 at:\r\n    #0 pthread_create /tmp/clang-build/src/compiler-rt/lib/tsan/rtl/tsan_interceptors.cc:992:3 (grpclb_end2end_test+0x683ce5)\r\n    #1 grpc_core::(anonymous namespace)::ThreadInternalsPosix::ThreadInternalsPosix(char const*, void (*)(void*), void*, bool*) /var/local/git/grpc/src/core/lib/gprpp/thd_posix.cc:73:10 (grpclb_end2end_test+0x8d9a06)\r\n    #2 grpc_core::(anonymous namespace)::ThreadInternalsPosix* grpc_core::New<grpc_core::(anonymous namespace)::ThreadInternalsPosix, char const*&, void (*&)(void*), void*&, bool*>(char const*&, void (*&)(void*), void*&, bool*&&) /var/local/git/grpc/./src/core/lib/gprpp/memory.h:52:18 (grpclb_end2end_test+0x8d96c3)\r\n    #3 grpc_core::Thread::Thread(char const*, void (*)(void*), void*, bool*) /var/local/git/grpc/src/core/lib/gprpp/thd_posix.cc:142:7 (grpclb_end2end_test+0x8d94e4)\r\n    #4 start_timer_thread_and_unlock() /var/local/git/grpc/src/core/lib/iomgr/timer_manager.cc:97:13 (grpclb_end2end_test+0x82fe60)\r\n    #5 run_some_timers() /var/local/git/grpc/src/core/lib/iomgr/timer_manager.cc:115:5 (grpclb_end2end_test+0x8301b4)\r\n    #6 timer_main_loop() /var/local/git/grpc/src/core/lib/iomgr/timer_manager.cc:232:9 (grpclb_end2end_test+0x82ff73)\r\n    #7 timer_thread(void*) /var/local/git/grpc/src/core/lib/iomgr/timer_manager.cc:279:3 (grpclb_end2end_test+0x82fec4)\r\n    #8 grpc_core::(anonymous namespace)::ThreadInternalsPosix::ThreadInternalsPosix(char const*, void (*)(void*), void*, bool*)::{lambda(void*)#1}::operator()(void*) const /var/local/git/grpc/src/core/lib/gprpp/thd_posix.cc:100:27 (grpclb_end2end_test+0x8d9e5c)\r\n    #9 grpc_core::(anonymous namespace)::ThreadInternalsPosix::ThreadInternalsPosix(char const*, void (*)(void*), void*, bool*)::{lambda(void*)#1}::__invoke(void*) /var/local/git/grpc/src/core/lib/gprpp/thd_posix.cc:74:25 (grpclb_end2end_test+0x8d9cf8)\r\nSUMMARY: ThreadSanitizer: data race /var/local/git/grpc/src/core/lib/gpr/alloc.cc:77:3 in gpr_free\r\n==================\r\n```\r\n"
  }
]
