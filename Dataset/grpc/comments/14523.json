[
  {
    "url": "https://api.github.com/repos/grpc/grpc/issues/comments/369101259",
    "html_url": "https://github.com/grpc/grpc/issues/14523#issuecomment-369101259",
    "issue_url": "https://api.github.com/repos/grpc/grpc/issues/14523",
    "id": 369101259,
    "node_id": "MDEyOklzc3VlQ29tbWVudDM2OTEwMTI1OQ==",
    "user": {
      "login": "srini100",
      "id": 35056280,
      "node_id": "MDQ6VXNlcjM1MDU2Mjgw",
      "avatar_url": "https://avatars2.githubusercontent.com/u/35056280?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/srini100",
      "html_url": "https://github.com/srini100",
      "followers_url": "https://api.github.com/users/srini100/followers",
      "following_url": "https://api.github.com/users/srini100/following{/other_user}",
      "gists_url": "https://api.github.com/users/srini100/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/srini100/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/srini100/subscriptions",
      "organizations_url": "https://api.github.com/users/srini100/orgs",
      "repos_url": "https://api.github.com/users/srini100/repos",
      "events_url": "https://api.github.com/users/srini100/events{/privacy}",
      "received_events_url": "https://api.github.com/users/srini100/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2018-02-28T02:37:05Z",
    "updated_at": "2018-02-28T02:37:05Z",
    "author_association": "CONTRIBUTOR",
    "body": "@krelst is gRPC version the only change? Was it working fine with 1.8.4?"
  },
  {
    "url": "https://api.github.com/repos/grpc/grpc/issues/comments/369161714",
    "html_url": "https://github.com/grpc/grpc/issues/14523#issuecomment-369161714",
    "issue_url": "https://api.github.com/repos/grpc/grpc/issues/14523",
    "id": 369161714,
    "node_id": "MDEyOklzc3VlQ29tbWVudDM2OTE2MTcxNA==",
    "user": {
      "login": "krelst",
      "id": 4048504,
      "node_id": "MDQ6VXNlcjQwNDg1MDQ=",
      "avatar_url": "https://avatars3.githubusercontent.com/u/4048504?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/krelst",
      "html_url": "https://github.com/krelst",
      "followers_url": "https://api.github.com/users/krelst/followers",
      "following_url": "https://api.github.com/users/krelst/following{/other_user}",
      "gists_url": "https://api.github.com/users/krelst/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/krelst/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/krelst/subscriptions",
      "organizations_url": "https://api.github.com/users/krelst/orgs",
      "repos_url": "https://api.github.com/users/krelst/repos",
      "events_url": "https://api.github.com/users/krelst/events{/privacy}",
      "received_events_url": "https://api.github.com/users/krelst/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2018-02-28T08:41:29Z",
    "updated_at": "2018-02-28T08:42:26Z",
    "author_association": "NONE",
    "body": "It is a curious case. The upgrade of the grpc library took place 16/2, but the first time we saw the error was only 24/2. From then on, multiple different pipelines of ours, which all have grpc/google cloud python clients in common, started failing with the same error. Together with the grpcio upgrade, these other libraries got an upgrade:\r\n```\r\ngoogle-api-python-client==1.6.4 -> 1.6.5\r\ngoogle-auth==1.3.0 -> 1.4.1\r\n```\r\nHowever it still looks like it is an issue in grpc as we see the following error:\r\n```\r\n\"Exception thread.error: error(\"can't start new thread\",) in 'grpc._cython.cygrpc._get_metadata' ignored\r\n```\r\nOf course it could be that some other library is spawning way too much threads, which results in grpc not being able to spawn a new one. But I honestly can't think of any other library that could cause this. We have downgraded grpcio back to 1.8.4, and from then on we didn't see the issue anymore. Will keep you posted if it re-appears with 1.8.4."
  },
  {
    "url": "https://api.github.com/repos/grpc/grpc/issues/comments/370664078",
    "html_url": "https://github.com/grpc/grpc/issues/14523#issuecomment-370664078",
    "issue_url": "https://api.github.com/repos/grpc/grpc/issues/14523",
    "id": 370664078,
    "node_id": "MDEyOklzc3VlQ29tbWVudDM3MDY2NDA3OA==",
    "user": {
      "login": "srini100",
      "id": 35056280,
      "node_id": "MDQ6VXNlcjM1MDU2Mjgw",
      "avatar_url": "https://avatars2.githubusercontent.com/u/35056280?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/srini100",
      "html_url": "https://github.com/srini100",
      "followers_url": "https://api.github.com/users/srini100/followers",
      "following_url": "https://api.github.com/users/srini100/following{/other_user}",
      "gists_url": "https://api.github.com/users/srini100/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/srini100/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/srini100/subscriptions",
      "organizations_url": "https://api.github.com/users/srini100/orgs",
      "repos_url": "https://api.github.com/users/srini100/repos",
      "events_url": "https://api.github.com/users/srini100/events{/privacy}",
      "received_events_url": "https://api.github.com/users/srini100/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2018-03-06T05:06:36Z",
    "updated_at": "2018-03-06T18:12:38Z",
    "author_association": "CONTRIBUTOR",
    "body": "This issue could be related to [this](https://github.com/grpc/grpc/issues/14578) where large number of timer threads are getting created in C core which doesn't look normal. This issue is file against v1.7.2  but here it seems to be a regression from 1.8.4 to 9.1."
  },
  {
    "url": "https://api.github.com/repos/grpc/grpc/issues/comments/371400274",
    "html_url": "https://github.com/grpc/grpc/issues/14523#issuecomment-371400274",
    "issue_url": "https://api.github.com/repos/grpc/grpc/issues/14523",
    "id": 371400274,
    "node_id": "MDEyOklzc3VlQ29tbWVudDM3MTQwMDI3NA==",
    "user": {
      "login": "speedplane",
      "id": 671052,
      "node_id": "MDQ6VXNlcjY3MTA1Mg==",
      "avatar_url": "https://avatars0.githubusercontent.com/u/671052?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/speedplane",
      "html_url": "https://github.com/speedplane",
      "followers_url": "https://api.github.com/users/speedplane/followers",
      "following_url": "https://api.github.com/users/speedplane/following{/other_user}",
      "gists_url": "https://api.github.com/users/speedplane/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/speedplane/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/speedplane/subscriptions",
      "organizations_url": "https://api.github.com/users/speedplane/orgs",
      "repos_url": "https://api.github.com/users/speedplane/repos",
      "events_url": "https://api.github.com/users/speedplane/events{/privacy}",
      "received_events_url": "https://api.github.com/users/speedplane/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2018-03-08T07:10:38Z",
    "updated_at": "2018-03-08T07:16:24Z",
    "author_association": "NONE",
    "body": "I am seeing this too. Looking through my logs, I see it popped up around February 13, 2018, then went away, and now I am seeing it again. My callstack looks similar to the one posted above, except I am using the datastore APIs not the bigtable APIs. I've now added instrumentation to my code to determine if there are memory leaks or if `threading.active_threads` is growing out of control. \r\n\r\nVersion information is below.\r\n\r\nIt seems that with every upgrade to grpc there are major reliability issues.\r\n\r\n```\r\ngapic-google-cloud-datastore-v1==0.15.3\r\ngoogle-api-python-client==1.6.2\r\ngoogle-auth==1.4.1\r\ngoogle-cloud-core==0.27.1\r\ngoogle-cloud-datastore==1.3.0\r\ngoogle-gax==0.15.16\r\ngoogle-python-cloud-debugger==1.18\r\ngoogleapis-common-protos==1.5.3\r\ngrpcio==1.10.0\r\nproto-google-cloud-datastore-v1==0.90.4\r\nprotobuf==3.5.2\r\n```"
  },
  {
    "url": "https://api.github.com/repos/grpc/grpc/issues/comments/371409587",
    "html_url": "https://github.com/grpc/grpc/issues/14523#issuecomment-371409587",
    "issue_url": "https://api.github.com/repos/grpc/grpc/issues/14523",
    "id": 371409587,
    "node_id": "MDEyOklzc3VlQ29tbWVudDM3MTQwOTU4Nw==",
    "user": {
      "login": "krelst",
      "id": 4048504,
      "node_id": "MDQ6VXNlcjQwNDg1MDQ=",
      "avatar_url": "https://avatars3.githubusercontent.com/u/4048504?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/krelst",
      "html_url": "https://github.com/krelst",
      "followers_url": "https://api.github.com/users/krelst/followers",
      "following_url": "https://api.github.com/users/krelst/following{/other_user}",
      "gists_url": "https://api.github.com/users/krelst/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/krelst/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/krelst/subscriptions",
      "organizations_url": "https://api.github.com/users/krelst/orgs",
      "repos_url": "https://api.github.com/users/krelst/repos",
      "events_url": "https://api.github.com/users/krelst/events{/privacy}",
      "received_events_url": "https://api.github.com/users/krelst/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2018-03-08T07:59:13Z",
    "updated_at": "2018-03-08T07:59:27Z",
    "author_association": "NONE",
    "body": "10 days after downgrading from 1.9.1 to 1.8.4 and haven't seen any issues anymore, so we can be quite certain that the upgrade was the cause of the issue."
  },
  {
    "url": "https://api.github.com/repos/grpc/grpc/issues/comments/371470541",
    "html_url": "https://github.com/grpc/grpc/issues/14523#issuecomment-371470541",
    "issue_url": "https://api.github.com/repos/grpc/grpc/issues/14523",
    "id": 371470541,
    "node_id": "MDEyOklzc3VlQ29tbWVudDM3MTQ3MDU0MQ==",
    "user": {
      "login": "mehrdada",
      "id": 900411,
      "node_id": "MDQ6VXNlcjkwMDQxMQ==",
      "avatar_url": "https://avatars3.githubusercontent.com/u/900411?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/mehrdada",
      "html_url": "https://github.com/mehrdada",
      "followers_url": "https://api.github.com/users/mehrdada/followers",
      "following_url": "https://api.github.com/users/mehrdada/following{/other_user}",
      "gists_url": "https://api.github.com/users/mehrdada/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/mehrdada/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/mehrdada/subscriptions",
      "organizations_url": "https://api.github.com/users/mehrdada/orgs",
      "repos_url": "https://api.github.com/users/mehrdada/repos",
      "events_url": "https://api.github.com/users/mehrdada/events{/privacy}",
      "received_events_url": "https://api.github.com/users/mehrdada/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2018-03-08T12:15:02Z",
    "updated_at": "2018-03-08T12:15:09Z",
    "author_association": "CONTRIBUTOR",
    "body": "This is just a shot in the dark, but can you please try passing `GRPC_POLL_STRATEGY=poll` environment variable to the current version of gRPC (v1.10.0) and compare results? One thing that changed since 1.8 and 1.9 is the default polling strategy on gRPC Python Linux binary wheels (used to be `poll`, now it is `epoll1`) which improved things on a bunch of dimensions, but that might be the cause of the regressions you're facing."
  },
  {
    "url": "https://api.github.com/repos/grpc/grpc/issues/comments/372489595",
    "html_url": "https://github.com/grpc/grpc/issues/14523#issuecomment-372489595",
    "issue_url": "https://api.github.com/repos/grpc/grpc/issues/14523",
    "id": 372489595,
    "node_id": "MDEyOklzc3VlQ29tbWVudDM3MjQ4OTU5NQ==",
    "user": {
      "login": "srini100",
      "id": 35056280,
      "node_id": "MDQ6VXNlcjM1MDU2Mjgw",
      "avatar_url": "https://avatars2.githubusercontent.com/u/35056280?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/srini100",
      "html_url": "https://github.com/srini100",
      "followers_url": "https://api.github.com/users/srini100/followers",
      "following_url": "https://api.github.com/users/srini100/following{/other_user}",
      "gists_url": "https://api.github.com/users/srini100/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/srini100/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/srini100/subscriptions",
      "organizations_url": "https://api.github.com/users/srini100/orgs",
      "repos_url": "https://api.github.com/users/srini100/repos",
      "events_url": "https://api.github.com/users/srini100/events{/privacy}",
      "received_events_url": "https://api.github.com/users/srini100/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2018-03-12T22:54:48Z",
    "updated_at": "2018-03-12T22:54:48Z",
    "author_association": "CONTRIBUTOR",
    "body": "@speedplane, have you determined if this is due to memory leak or too many threads?"
  },
  {
    "url": "https://api.github.com/repos/grpc/grpc/issues/comments/378969175",
    "html_url": "https://github.com/grpc/grpc/issues/14523#issuecomment-378969175",
    "issue_url": "https://api.github.com/repos/grpc/grpc/issues/14523",
    "id": 378969175,
    "node_id": "MDEyOklzc3VlQ29tbWVudDM3ODk2OTE3NQ==",
    "user": {
      "login": "srini100",
      "id": 35056280,
      "node_id": "MDQ6VXNlcjM1MDU2Mjgw",
      "avatar_url": "https://avatars2.githubusercontent.com/u/35056280?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/srini100",
      "html_url": "https://github.com/srini100",
      "followers_url": "https://api.github.com/users/srini100/followers",
      "following_url": "https://api.github.com/users/srini100/following{/other_user}",
      "gists_url": "https://api.github.com/users/srini100/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/srini100/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/srini100/subscriptions",
      "organizations_url": "https://api.github.com/users/srini100/orgs",
      "repos_url": "https://api.github.com/users/srini100/repos",
      "events_url": "https://api.github.com/users/srini100/events{/privacy}",
      "received_events_url": "https://api.github.com/users/srini100/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2018-04-05T15:07:11Z",
    "updated_at": "2018-04-05T15:07:11Z",
    "author_association": "CONTRIBUTOR",
    "body": "@krelst @speedplane Any update on this?"
  },
  {
    "url": "https://api.github.com/repos/grpc/grpc/issues/comments/379931092",
    "html_url": "https://github.com/grpc/grpc/issues/14523#issuecomment-379931092",
    "issue_url": "https://api.github.com/repos/grpc/grpc/issues/14523",
    "id": 379931092,
    "node_id": "MDEyOklzc3VlQ29tbWVudDM3OTkzMTA5Mg==",
    "user": {
      "login": "speedplane",
      "id": 671052,
      "node_id": "MDQ6VXNlcjY3MTA1Mg==",
      "avatar_url": "https://avatars0.githubusercontent.com/u/671052?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/speedplane",
      "html_url": "https://github.com/speedplane",
      "followers_url": "https://api.github.com/users/speedplane/followers",
      "following_url": "https://api.github.com/users/speedplane/following{/other_user}",
      "gists_url": "https://api.github.com/users/speedplane/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/speedplane/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/speedplane/subscriptions",
      "organizations_url": "https://api.github.com/users/speedplane/orgs",
      "repos_url": "https://api.github.com/users/speedplane/repos",
      "events_url": "https://api.github.com/users/speedplane/events{/privacy}",
      "received_events_url": "https://api.github.com/users/speedplane/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2018-04-10T00:06:19Z",
    "updated_at": "2018-04-10T00:06:19Z",
    "author_association": "NONE",
    "body": "@srini100 It's not a memory leak or too many threads. I've instrumented my code to spit out both the amount of free memory and the total number of threads, here are some sample logs:\r\n\r\n- `can't start new thread (37.66% mem, 118 threads)`\r\n- `can't start new thread (38.35% mem, 122 threads)`\r\n- `can't start new thread (43.32% mem, 107 threads)`\r\n- `can't start new thread (43.16% mem, 130 threads)`"
  },
  {
    "url": "https://api.github.com/repos/grpc/grpc/issues/comments/381373997",
    "html_url": "https://github.com/grpc/grpc/issues/14523#issuecomment-381373997",
    "issue_url": "https://api.github.com/repos/grpc/grpc/issues/14523",
    "id": 381373997,
    "node_id": "MDEyOklzc3VlQ29tbWVudDM4MTM3Mzk5Nw==",
    "user": {
      "login": "srini100",
      "id": 35056280,
      "node_id": "MDQ6VXNlcjM1MDU2Mjgw",
      "avatar_url": "https://avatars2.githubusercontent.com/u/35056280?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/srini100",
      "html_url": "https://github.com/srini100",
      "followers_url": "https://api.github.com/users/srini100/followers",
      "following_url": "https://api.github.com/users/srini100/following{/other_user}",
      "gists_url": "https://api.github.com/users/srini100/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/srini100/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/srini100/subscriptions",
      "organizations_url": "https://api.github.com/users/srini100/orgs",
      "repos_url": "https://api.github.com/users/srini100/repos",
      "events_url": "https://api.github.com/users/srini100/events{/privacy}",
      "received_events_url": "https://api.github.com/users/srini100/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2018-04-15T01:48:30Z",
    "updated_at": "2018-04-15T01:48:30Z",
    "author_association": "CONTRIBUTOR",
    "body": "@speedplane, I am assuming you have already checked the thread count limit of a process on your system and that it is much higher than 130. Normally, on a stock 64-bit Linux it is several thousand, although it varies a lot based on a number of settings so it is good to confirm you are not hitting the limit.\r\n\r\nHave  you tried GRPC_POLL_STRATEGY=poll suggestion above?\r\n\r\nThe memory usage seems high. If you have long lived streams you may be hitting [this](https://github.com/grpc/grpc/issues/12383) memory leak bug. I am not sure if max number of threads can change dynamically based on amt of memory consumed by the process. This bug was fixed in 1.10.1 and 1.11. "
  },
  {
    "url": "https://api.github.com/repos/grpc/grpc/issues/comments/394894663",
    "html_url": "https://github.com/grpc/grpc/issues/14523#issuecomment-394894663",
    "issue_url": "https://api.github.com/repos/grpc/grpc/issues/14523",
    "id": 394894663,
    "node_id": "MDEyOklzc3VlQ29tbWVudDM5NDg5NDY2Mw==",
    "user": {
      "login": "srini100",
      "id": 35056280,
      "node_id": "MDQ6VXNlcjM1MDU2Mjgw",
      "avatar_url": "https://avatars2.githubusercontent.com/u/35056280?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/srini100",
      "html_url": "https://github.com/srini100",
      "followers_url": "https://api.github.com/users/srini100/followers",
      "following_url": "https://api.github.com/users/srini100/following{/other_user}",
      "gists_url": "https://api.github.com/users/srini100/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/srini100/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/srini100/subscriptions",
      "organizations_url": "https://api.github.com/users/srini100/orgs",
      "repos_url": "https://api.github.com/users/srini100/repos",
      "events_url": "https://api.github.com/users/srini100/events{/privacy}",
      "received_events_url": "https://api.github.com/users/srini100/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2018-06-05T23:41:47Z",
    "updated_at": "2018-06-05T23:41:47Z",
    "author_association": "CONTRIBUTOR",
    "body": "Closing this issue as I have not found any other reason to get this error other than hitting the system limit. The number of threads seem to exceed twice the number of cores. Track the progress of this issue https://github.com/grpc/grpc/issues/14578. I have bumped its priority to get some attention."
  }
]
