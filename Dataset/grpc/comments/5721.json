[
  {
    "url": "https://api.github.com/repos/grpc/grpc/issues/comments/195543636",
    "html_url": "https://github.com/grpc/grpc/issues/5721#issuecomment-195543636",
    "issue_url": "https://api.github.com/repos/grpc/grpc/issues/5721",
    "id": 195543636,
    "node_id": "MDEyOklzc3VlQ29tbWVudDE5NTU0MzYzNg==",
    "user": {
      "login": "jcanizales",
      "id": 5120183,
      "node_id": "MDQ6VXNlcjUxMjAxODM=",
      "avatar_url": "https://avatars0.githubusercontent.com/u/5120183?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/jcanizales",
      "html_url": "https://github.com/jcanizales",
      "followers_url": "https://api.github.com/users/jcanizales/followers",
      "following_url": "https://api.github.com/users/jcanizales/following{/other_user}",
      "gists_url": "https://api.github.com/users/jcanizales/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/jcanizales/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/jcanizales/subscriptions",
      "organizations_url": "https://api.github.com/users/jcanizales/orgs",
      "repos_url": "https://api.github.com/users/jcanizales/repos",
      "events_url": "https://api.github.com/users/jcanizales/events{/privacy}",
      "received_events_url": "https://api.github.com/users/jcanizales/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2016-03-11T20:42:57Z",
    "updated_at": "2016-03-11T20:42:57Z",
    "author_association": "CONTRIBUTOR",
    "body": "I have the suspicion https://github.com/grpc/grpc/pull/5718 will solve this.\n"
  },
  {
    "url": "https://api.github.com/repos/grpc/grpc/issues/comments/195647093",
    "html_url": "https://github.com/grpc/grpc/issues/5721#issuecomment-195647093",
    "issue_url": "https://api.github.com/repos/grpc/grpc/issues/5721",
    "id": 195647093,
    "node_id": "MDEyOklzc3VlQ29tbWVudDE5NTY0NzA5Mw==",
    "user": {
      "login": "blowmage",
      "id": 730,
      "node_id": "MDQ6VXNlcjczMA==",
      "avatar_url": "https://avatars0.githubusercontent.com/u/730?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/blowmage",
      "html_url": "https://github.com/blowmage",
      "followers_url": "https://api.github.com/users/blowmage/followers",
      "following_url": "https://api.github.com/users/blowmage/following{/other_user}",
      "gists_url": "https://api.github.com/users/blowmage/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/blowmage/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/blowmage/subscriptions",
      "organizations_url": "https://api.github.com/users/blowmage/orgs",
      "repos_url": "https://api.github.com/users/blowmage/repos",
      "events_url": "https://api.github.com/users/blowmage/events{/privacy}",
      "received_events_url": "https://api.github.com/users/blowmage/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2016-03-12T03:08:18Z",
    "updated_at": "2016-03-12T03:08:18Z",
    "author_association": "CONTRIBUTOR",
    "body": "I pulled the branch and run our acceptance tests multiple times, but now they are hung on the following error, repeated every 15 seconds:\n\n```\nE0311 15:52:24.737155000 123145306050560 resolve_address_posix.c:126] getaddrinfo: nodename nor servname provided, or not known\nD0311 15:52:24.737179000 123145306050560 dns_resolver.c:189] dns resolution failed: retrying in 15 seconds\n```\n"
  },
  {
    "url": "https://api.github.com/repos/grpc/grpc/issues/comments/195649946",
    "html_url": "https://github.com/grpc/grpc/issues/5721#issuecomment-195649946",
    "issue_url": "https://api.github.com/repos/grpc/grpc/issues/5721",
    "id": 195649946,
    "node_id": "MDEyOklzc3VlQ29tbWVudDE5NTY0OTk0Ng==",
    "user": {
      "login": "ctiller",
      "id": 10120821,
      "node_id": "MDQ6VXNlcjEwMTIwODIx",
      "avatar_url": "https://avatars3.githubusercontent.com/u/10120821?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/ctiller",
      "html_url": "https://github.com/ctiller",
      "followers_url": "https://api.github.com/users/ctiller/followers",
      "following_url": "https://api.github.com/users/ctiller/following{/other_user}",
      "gists_url": "https://api.github.com/users/ctiller/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/ctiller/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/ctiller/subscriptions",
      "organizations_url": "https://api.github.com/users/ctiller/orgs",
      "repos_url": "https://api.github.com/users/ctiller/repos",
      "events_url": "https://api.github.com/users/ctiller/events{/privacy}",
      "received_events_url": "https://api.github.com/users/ctiller/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2016-03-12T03:18:11Z",
    "updated_at": "2016-03-12T03:18:11Z",
    "author_association": "MEMBER",
    "body": "That's ... not promising. What host name are you passing in?\n\nOn Fri, Mar 11, 2016 at 7:08 PM Mike Moore notifications@github.com wrote:\n\n> I pulled the branch and run our acceptance tests multiple times, but now\n> they are hung on the following error, repeated every 15 seconds:\n> \n> E0311 15:52:24.737155000 123145306050560 resolve_address_posix.c:126] getaddrinfo: nodename nor servname provided, or not known\n> D0311 15:52:24.737179000 123145306050560 dns_resolver.c:189] dns resolution failed: retrying in 15 seconds\n> \n> —\n> Reply to this email directly or view it on GitHub\n> https://github.com/grpc/grpc/issues/5721#issuecomment-195647093.\n"
  },
  {
    "url": "https://api.github.com/repos/grpc/grpc/issues/comments/195650384",
    "html_url": "https://github.com/grpc/grpc/issues/5721#issuecomment-195650384",
    "issue_url": "https://api.github.com/repos/grpc/grpc/issues/5721",
    "id": 195650384,
    "node_id": "MDEyOklzc3VlQ29tbWVudDE5NTY1MDM4NA==",
    "user": {
      "login": "blowmage",
      "id": 730,
      "node_id": "MDQ6VXNlcjczMA==",
      "avatar_url": "https://avatars0.githubusercontent.com/u/730?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/blowmage",
      "html_url": "https://github.com/blowmage",
      "followers_url": "https://api.github.com/users/blowmage/followers",
      "following_url": "https://api.github.com/users/blowmage/following{/other_user}",
      "gists_url": "https://api.github.com/users/blowmage/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/blowmage/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/blowmage/subscriptions",
      "organizations_url": "https://api.github.com/users/blowmage/orgs",
      "repos_url": "https://api.github.com/users/blowmage/repos",
      "events_url": "https://api.github.com/users/blowmage/events{/privacy}",
      "received_events_url": "https://api.github.com/users/blowmage/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2016-03-12T03:26:06Z",
    "updated_at": "2016-03-12T03:26:06Z",
    "author_association": "CONTRIBUTOR",
    "body": "We are setting the hosts \"pubsub.googleapis.com\" and \"logging.googleapis.com\". But I wonder if the same bug that is swapping out the updater_proc object is also swapping out the host object. I'll try to add some debugging statements to the code and retry tonight. \n"
  },
  {
    "url": "https://api.github.com/repos/grpc/grpc/issues/comments/195662731",
    "html_url": "https://github.com/grpc/grpc/issues/5721#issuecomment-195662731",
    "issue_url": "https://api.github.com/repos/grpc/grpc/issues/5721",
    "id": 195662731,
    "node_id": "MDEyOklzc3VlQ29tbWVudDE5NTY2MjczMQ==",
    "user": {
      "login": "blowmage",
      "id": 730,
      "node_id": "MDQ6VXNlcjczMA==",
      "avatar_url": "https://avatars0.githubusercontent.com/u/730?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/blowmage",
      "html_url": "https://github.com/blowmage",
      "followers_url": "https://api.github.com/users/blowmage/followers",
      "following_url": "https://api.github.com/users/blowmage/following{/other_user}",
      "gists_url": "https://api.github.com/users/blowmage/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/blowmage/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/blowmage/subscriptions",
      "organizations_url": "https://api.github.com/users/blowmage/orgs",
      "repos_url": "https://api.github.com/users/blowmage/repos",
      "events_url": "https://api.github.com/users/blowmage/events{/privacy}",
      "received_events_url": "https://api.github.com/users/blowmage/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2016-03-12T05:30:39Z",
    "updated_at": "2016-03-12T05:30:39Z",
    "author_association": "CONTRIBUTOR",
    "body": "I've reproduced several times and grpc is trying to resolve \"pubsub.googleapis.com\" when the errors start, so the host value is not changing.\n"
  },
  {
    "url": "https://api.github.com/repos/grpc/grpc/issues/comments/195784003",
    "html_url": "https://github.com/grpc/grpc/issues/5721#issuecomment-195784003",
    "issue_url": "https://api.github.com/repos/grpc/grpc/issues/5721",
    "id": 195784003,
    "node_id": "MDEyOklzc3VlQ29tbWVudDE5NTc4NDAwMw==",
    "user": {
      "login": "blowmage",
      "id": 730,
      "node_id": "MDQ6VXNlcjczMA==",
      "avatar_url": "https://avatars0.githubusercontent.com/u/730?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/blowmage",
      "html_url": "https://github.com/blowmage",
      "followers_url": "https://api.github.com/users/blowmage/followers",
      "following_url": "https://api.github.com/users/blowmage/following{/other_user}",
      "gists_url": "https://api.github.com/users/blowmage/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/blowmage/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/blowmage/subscriptions",
      "organizations_url": "https://api.github.com/users/blowmage/orgs",
      "repos_url": "https://api.github.com/users/blowmage/repos",
      "events_url": "https://api.github.com/users/blowmage/events{/privacy}",
      "received_events_url": "https://api.github.com/users/blowmage/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2016-03-12T18:40:15Z",
    "updated_at": "2016-03-12T18:40:15Z",
    "author_association": "CONTRIBUTOR",
    "body": "I do suspect that the issue with the `updater_proc` object might have something to do with ruby's GC and the location of the object being moved in memory. That issue doesn't show up when we create a new service and `updater_proc` object for every API request made. But it does when we when we hold on to those object for several minutes, enough time for the GC to sweep marked objects and consolidate memory. I'll continue trying to verify if this is the case or not.\n"
  },
  {
    "url": "https://api.github.com/repos/grpc/grpc/issues/comments/196088262",
    "html_url": "https://github.com/grpc/grpc/issues/5721#issuecomment-196088262",
    "issue_url": "https://api.github.com/repos/grpc/grpc/issues/5721",
    "id": 196088262,
    "node_id": "MDEyOklzc3VlQ29tbWVudDE5NjA4ODI2Mg==",
    "user": {
      "login": "blowmage",
      "id": 730,
      "node_id": "MDQ6VXNlcjczMA==",
      "avatar_url": "https://avatars0.githubusercontent.com/u/730?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/blowmage",
      "html_url": "https://github.com/blowmage",
      "followers_url": "https://api.github.com/users/blowmage/followers",
      "following_url": "https://api.github.com/users/blowmage/following{/other_user}",
      "gists_url": "https://api.github.com/users/blowmage/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/blowmage/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/blowmage/subscriptions",
      "organizations_url": "https://api.github.com/users/blowmage/orgs",
      "repos_url": "https://api.github.com/users/blowmage/repos",
      "events_url": "https://api.github.com/users/blowmage/events{/privacy}",
      "received_events_url": "https://api.github.com/users/blowmage/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2016-03-14T00:29:58Z",
    "updated_at": "2016-03-14T00:29:58Z",
    "author_association": "CONTRIBUTOR",
    "body": "I am certain that I can prove that the issue with the `updater_proc` on long running ruby processes is because the location of the proc object is moved during GC, and GRPC is holding on to the pointer to the original location. The actual ruby error is swallowed by GRPC, and a `GRPC::BadStatus` error with code 16 is raised instead. This happens in `src/ruby/ext/grpc/rb_call_credentials.c`, where the `updater_proc` object is called.\n\nThe original rescue function is:\n\n``` c\nstatic VALUE grpc_rb_call_credentials_callback_rescue(VALUE args,\n                                                      VALUE exception_object) {\n  VALUE result = rb_hash_new();\n  (void)args;\n  rb_hash_aset(result, rb_str_new2(\"metadata\"), Qnil);\n  /* Currently only gives the exception class name. It should be possible get\n     more details */\n  rb_hash_aset(result, rb_str_new2(\"status\"),\n               INT2NUM(GRPC_STATUS_PERMISSION_DENIED));\n  rb_hash_aset(result, rb_str_new2(\"details\"),\n               rb_str_new2(rb_obj_classname(exception_object)));\n  return result;\n}\n```\n\nOf we change the code to print the error object as a string instead of showing the error object's class, we will show the object that we are invoking the `call` method on:\n\n``` c\nstatic VALUE grpc_rb_call_credentials_callback_rescue(VALUE args,\n                                                      VALUE exception_object) {\n  VALUE result = rb_hash_new();\n  (void)args;\n  rb_hash_aset(result, rb_str_new2(\"metadata\"), Qnil);\n  /* Currently only gives the exception class name. It should be possible get\n     more details */\n  rb_hash_aset(result, rb_str_new2(\"status\"),\n               INT2NUM(GRPC_STATUS_PERMISSION_DENIED));\n  rb_hash_aset(result, rb_str_new2(\"details\"),\n               rb_funcall(exception_object, rb_intern(\"to_s\"), 0));\n  return result;\n}\n```\n\nWith that change we will see the object we are trying to invoke. The original debugging message printed to stdout shows only that a NoMethodError was raised:\n\n```\nE0313 15:11:08.914634000 123145303392256 credentials.c:1162] Getting metadata from plugin failed with error: NoMethodError\nE0313 15:11:08.914648000 123145303392256 client_auth_filter.c:93] Client side authentication failure: Credentials failed to get metadata.\n```\n\nBut with the change the new debugging messages are show what object raised the NoMethodError. Here are some of the messages I've gotten:\n\n```\nE0311 11:33:36.352378000 123145303392256 credentials.c:1155] Getting metadata from plugin failed with error: undefined method `call' for [\"Content-Type\", \"application/x-protobuf\"]:Array\nE0311 11:33:36.352391000 123145303392256 client_auth_filter.c:93] Client side authentication failure: Credentials failed to get metadata.\n\nE0313 15:18:01.248642000 123145303392256 credentials.c:1162] Getting metadata from plugin failed with error: undefined method `call' for \"int32\":String\nE0313 15:18:01.248665000 123145303392256 client_auth_filter.c:93] Client side authentication failure: Credentials failed to get metadata.\n\nE0313 17:48:06.941755000 123145303392256 credentials.c:1162] Getting metadata from plugin failed with error: undefined method `call' for #<HTTP::CookieJar:0x007feb84330e88>\nE0313 17:48:06.941769000 123145303392256 client_auth_filter.c:93] Client side authentication failure: Credentials failed to get metadata.\n\n\nE0313 17:59:42.872134000 123145303392256 credentials.c:1162] Getting metadata from plugin failed with error: undefined method `call' for \"selfLink\":String\nE0313 17:59:42.872146000 123145303392256 client_auth_filter.c:93] Client side authentication failure: Credentials failed to get metadata.\n```\n\nThis establishes that the object is changed, but it doesn't prove that the GC is the cause of the change. To prove that I've run our tests a couple dozen times, the first dozen unchanged, and the second dozen with the following code added:\n\n``` ruby\nGC.disable\n```\n\nThe first dozen consumes ~225 MB of memory while the tests are run, and spikes up to ~300 MB during the cleanup process post-tests, and the second dozen consumes ~425 MB of memory while the tests are run, and spikes up to ~600 MB during the cleanup process post-tests. Every single run of the first dozen failed with several \"Getting metadata from plugin failed with error\" messages printed and GRPC::BadStatus errors (with a code of 16) raised. Some even raised a segfault during the post-test cleanup. And every single run of the second dozen with `GC.disable` passed without any messages printed or any errors raised or segfaults.\n"
  },
  {
    "url": "https://api.github.com/repos/grpc/grpc/issues/comments/196089146",
    "html_url": "https://github.com/grpc/grpc/issues/5721#issuecomment-196089146",
    "issue_url": "https://api.github.com/repos/grpc/grpc/issues/5721",
    "id": 196089146,
    "node_id": "MDEyOklzc3VlQ29tbWVudDE5NjA4OTE0Ng==",
    "user": {
      "login": "blowmage",
      "id": 730,
      "node_id": "MDQ6VXNlcjczMA==",
      "avatar_url": "https://avatars0.githubusercontent.com/u/730?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/blowmage",
      "html_url": "https://github.com/blowmage",
      "followers_url": "https://api.github.com/users/blowmage/followers",
      "following_url": "https://api.github.com/users/blowmage/following{/other_user}",
      "gists_url": "https://api.github.com/users/blowmage/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/blowmage/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/blowmage/subscriptions",
      "organizations_url": "https://api.github.com/users/blowmage/orgs",
      "repos_url": "https://api.github.com/users/blowmage/repos",
      "events_url": "https://api.github.com/users/blowmage/events{/privacy}",
      "received_events_url": "https://api.github.com/users/blowmage/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2016-03-14T00:35:26Z",
    "updated_at": "2016-03-14T00:35:26Z",
    "author_association": "CONTRIBUTOR",
    "body": "Also, I ran my tests against the master branch, because the 0.13.0 release was causing too many other problems. The `goaway` errors I mentioned in the issue description still happens, but it properly raises a GRPC::BadStatus error with code 14 now. So on master the goaway error no longer blocks indefinitely, which is super great. :+1:\n\nI have also not seen a `getaddrinfo` error since switching to the master branch. Double :+1:\n"
  },
  {
    "url": "https://api.github.com/repos/grpc/grpc/issues/comments/196470746",
    "html_url": "https://github.com/grpc/grpc/issues/5721#issuecomment-196470746",
    "issue_url": "https://api.github.com/repos/grpc/grpc/issues/5721",
    "id": 196470746,
    "node_id": "MDEyOklzc3VlQ29tbWVudDE5NjQ3MDc0Ng==",
    "user": {
      "login": "murgatroid99",
      "id": 961599,
      "node_id": "MDQ6VXNlcjk2MTU5OQ==",
      "avatar_url": "https://avatars3.githubusercontent.com/u/961599?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/murgatroid99",
      "html_url": "https://github.com/murgatroid99",
      "followers_url": "https://api.github.com/users/murgatroid99/followers",
      "following_url": "https://api.github.com/users/murgatroid99/following{/other_user}",
      "gists_url": "https://api.github.com/users/murgatroid99/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/murgatroid99/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/murgatroid99/subscriptions",
      "organizations_url": "https://api.github.com/users/murgatroid99/orgs",
      "repos_url": "https://api.github.com/users/murgatroid99/repos",
      "events_url": "https://api.github.com/users/murgatroid99/events{/privacy}",
      "received_events_url": "https://api.github.com/users/murgatroid99/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2016-03-14T18:56:21Z",
    "updated_at": "2016-03-14T18:56:21Z",
    "author_association": "MEMBER",
    "body": "I opened https://github.com/grpc/grpc/pull/5744, can you verify that this\nfixes the problem?\n\nOn Sun, Mar 13, 2016 at 5:35 PM Mike Moore notifications@github.com wrote:\n\n> Also, I ran my tests against the master branch, because the 0.13.0 release\n> was causing too many other problems. The goaway errors I mentioned in the\n> issue description still happens, but it properly raises a GRPC::BadStatus\n> error with code 14 now. So on master the goaway error no longer blocks\n> indefinitely, which is super great. [image: :+1:]\n> \n> I have also not seen a getaddrinfo error since switching to the master\n> branch. Double [image: :+1:]\n> \n> —\n> Reply to this email directly or view it on GitHub\n> https://github.com/grpc/grpc/issues/5721#issuecomment-196089146.\n"
  },
  {
    "url": "https://api.github.com/repos/grpc/grpc/issues/comments/196490129",
    "html_url": "https://github.com/grpc/grpc/issues/5721#issuecomment-196490129",
    "issue_url": "https://api.github.com/repos/grpc/grpc/issues/5721",
    "id": 196490129,
    "node_id": "MDEyOklzc3VlQ29tbWVudDE5NjQ5MDEyOQ==",
    "user": {
      "login": "blowmage",
      "id": 730,
      "node_id": "MDQ6VXNlcjczMA==",
      "avatar_url": "https://avatars0.githubusercontent.com/u/730?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/blowmage",
      "html_url": "https://github.com/blowmage",
      "followers_url": "https://api.github.com/users/blowmage/followers",
      "following_url": "https://api.github.com/users/blowmage/following{/other_user}",
      "gists_url": "https://api.github.com/users/blowmage/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/blowmage/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/blowmage/subscriptions",
      "organizations_url": "https://api.github.com/users/blowmage/orgs",
      "repos_url": "https://api.github.com/users/blowmage/repos",
      "events_url": "https://api.github.com/users/blowmage/events{/privacy}",
      "received_events_url": "https://api.github.com/users/blowmage/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2016-03-14T19:39:55Z",
    "updated_at": "2016-03-14T19:39:55Z",
    "author_association": "CONTRIBUTOR",
    "body": "@murgatroid99 Thank you for the PR! Moving the discussion there.\n"
  }
]
