[
  {
    "url": "https://api.github.com/repos/grpc/grpc/issues/comments/113274318",
    "html_url": "https://github.com/grpc/grpc/issues/1920#issuecomment-113274318",
    "issue_url": "https://api.github.com/repos/grpc/grpc/issues/1920",
    "id": 113274318,
    "node_id": "MDEyOklzc3VlQ29tbWVudDExMzI3NDMxOA==",
    "user": {
      "login": "stanley-cheung",
      "id": 11674202,
      "node_id": "MDQ6VXNlcjExNjc0MjAy",
      "avatar_url": "https://avatars2.githubusercontent.com/u/11674202?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/stanley-cheung",
      "html_url": "https://github.com/stanley-cheung",
      "followers_url": "https://api.github.com/users/stanley-cheung/followers",
      "following_url": "https://api.github.com/users/stanley-cheung/following{/other_user}",
      "gists_url": "https://api.github.com/users/stanley-cheung/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/stanley-cheung/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/stanley-cheung/subscriptions",
      "organizations_url": "https://api.github.com/users/stanley-cheung/orgs",
      "repos_url": "https://api.github.com/users/stanley-cheung/repos",
      "events_url": "https://api.github.com/users/stanley-cheung/events{/privacy}",
      "received_events_url": "https://api.github.com/users/stanley-cheung/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2015-06-18T20:03:38Z",
    "updated_at": "2015-06-18T20:07:41Z",
    "author_association": "CONTRIBUTOR",
    "body": "There is some unstability for PHP. I have seen segfault happened a few times. Will try to look into it but unsure how far I can get. I never see segfault outside of jenkins though.\n\nExamples:\n- https://grpc-testing.appspot.com/job/gRPC%20pull%20requests/109/config=opt,language=php,platform=linux/console\n"
  },
  {
    "url": "https://api.github.com/repos/grpc/grpc/issues/comments/113275526",
    "html_url": "https://github.com/grpc/grpc/issues/1920#issuecomment-113275526",
    "issue_url": "https://api.github.com/repos/grpc/grpc/issues/1920",
    "id": 113275526,
    "node_id": "MDEyOklzc3VlQ29tbWVudDExMzI3NTUyNg==",
    "user": {
      "login": "ctiller",
      "id": 10120821,
      "node_id": "MDQ6VXNlcjEwMTIwODIx",
      "avatar_url": "https://avatars3.githubusercontent.com/u/10120821?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/ctiller",
      "html_url": "https://github.com/ctiller",
      "followers_url": "https://api.github.com/users/ctiller/followers",
      "following_url": "https://api.github.com/users/ctiller/following{/other_user}",
      "gists_url": "https://api.github.com/users/ctiller/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/ctiller/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/ctiller/subscriptions",
      "organizations_url": "https://api.github.com/users/ctiller/orgs",
      "repos_url": "https://api.github.com/users/ctiller/repos",
      "events_url": "https://api.github.com/users/ctiller/events{/privacy}",
      "received_events_url": "https://api.github.com/users/ctiller/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2015-06-18T20:09:03Z",
    "updated_at": "2015-06-18T20:09:03Z",
    "author_association": "MEMBER",
    "body": "That's the wonderful part of running code in different environments :)\n\nOn Thu, Jun 18, 2015 at 1:03 PM Stanley Cheung notifications@github.com\nwrote:\n\n> There is some unstability for PHP. I have seen segfault happened a few\n> times. Will try to look into it but unsure how far I can get. I never see\n> segfault outside of jenkins though.\n> \n> â€”\n> Reply to this email directly or view it on GitHub\n> https://github.com/grpc/grpc/issues/1920#issuecomment-113274318.\n"
  },
  {
    "url": "https://api.github.com/repos/grpc/grpc/issues/comments/115007123",
    "html_url": "https://github.com/grpc/grpc/issues/1920#issuecomment-115007123",
    "issue_url": "https://api.github.com/repos/grpc/grpc/issues/1920",
    "id": 115007123,
    "node_id": "MDEyOklzc3VlQ29tbWVudDExNTAwNzEyMw==",
    "user": {
      "login": "stanley-cheung",
      "id": 11674202,
      "node_id": "MDQ6VXNlcjExNjc0MjAy",
      "avatar_url": "https://avatars2.githubusercontent.com/u/11674202?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/stanley-cheung",
      "html_url": "https://github.com/stanley-cheung",
      "followers_url": "https://api.github.com/users/stanley-cheung/followers",
      "following_url": "https://api.github.com/users/stanley-cheung/following{/other_user}",
      "gists_url": "https://api.github.com/users/stanley-cheung/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/stanley-cheung/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/stanley-cheung/subscriptions",
      "organizations_url": "https://api.github.com/users/stanley-cheung/orgs",
      "repos_url": "https://api.github.com/users/stanley-cheung/repos",
      "events_url": "https://api.github.com/users/stanley-cheung/events{/privacy}",
      "received_events_url": "https://api.github.com/users/stanley-cheung/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2015-06-24T20:46:53Z",
    "updated_at": "2015-06-30T23:08:18Z",
    "author_association": "CONTRIBUTOR",
    "body": "Able to get a core dump for the segfault\n\nI was running this inside the grpc_jenkins_slave container. Only able to reproduce this after cranking -n to 1000\n\n```\nCONFIG=tools/run_tests/prepare_travis.sh CPPFLAGS=-I/tmp/prebuilt/include ./tools/run_tests/run_tests.py -t -l php -n 1000\n```\n\n```\nPHPUnit 4.2.6 by Sebastian Bergmann.\n\n\nStarting test 'CallTest::testAddEmptyMetadata'.\nI0624 20:40:42.823417483   26132 call.c:1307] grpc_call_start_batch(call=0x1467b90, ops=0x7ffc264f0fb0, nops=1, tag=0x1467b90)\nI0624 20:40:42.823448106   26132 call.c:1307] ops[0]: SEND_INITIAL_METADATA\nI0624 20:40:42.824375732   26132 completion_queue.c:286] RETURN_EVENT[0x13f10b0]: OP_COMPLETE: tag:0x1467b90 OK\n.\nStarting test 'CallTest::testAddSingleMetadata'.\nI0624 20:40:42.825664243   26132 call.c:1307] grpc_call_start_batch(call=0x13e4200, ops=0x7ffc264f0fb0, nops=1, tag=0x13e4200)\nI0624 20:40:42.825683275   26132 call.c:1307] ops[0]: SEND_INITIAL_METADATA\nkey=key value=76 61 6c 75 65 'value'\nI0624 20:40:42.826090129   26132 completion_queue.c:286] RETURN_EVENT[0x13f10b0]: OP_COMPLETE: tag:0x13e4200 OK\n.\nStarting test 'CallTest::testAddMultiValueMetadata'.\nI0624 20:40:42.826526060   26132 call.c:1307] grpc_call_start_batch(call=0x13e5e80, ops=0x7ffc264f0fb0, nops=1, tag=0x13e5e80)\nI0624 20:40:42.826552351   26132 call.c:1307] ops[0]: SEND_INITIAL_METADATA\nkey=key value=76 61 6c 75 65 31 'value1'\nkey=key value=76 61 6c 75 65 32 'value2'\nSegmentation fault (core dumped)\nFAILED: src/php/bin/run_tests.sh [ret=139, pid=26117]\nSTART: src/php/bin/run_tests.sh\nPASSED: src/php/bin/run_tests.sh [time=10.5sec]\nSTART: src/php/bin/run_tests.sh\n```\n\n```\nroot@622064bb149e:/var/local/git/grpc/src/php/bin# gdb php core\nGNU gdb (Debian 7.7.1+dfsg-5) 7.7.1\nCopyright (C) 2014 Free Software Foundation, Inc.\nLicense GPLv3+: GNU GPL version 3 or later <http://gnu.org/licenses/gpl.html>\nThis is free software: you are free to change and redistribute it.\nThere is NO WARRANTY, to the extent permitted by law.  Type \"show copying\"\nand \"show warranty\" for details.\nThis GDB was configured as \"x86_64-linux-gnu\".\nType \"show configuration\" for configuration details.\nFor bug reporting instructions, please see:\n<http://www.gnu.org/software/gdb/bugs/>.\nFind the GDB manual and other documentation resources online at:\n<http://www.gnu.org/software/gdb/documentation/>.\nFor help, type \"help\".\nType \"apropos word\" to search for commands related to \"word\"...\nReading symbols from php...(no debugging symbols found)...done.\n\nwarning: core file may not match specified executable file.\n[New LWP 26138]\n[New LWP 26132]\n[New LWP 26143]\n[Thread debugging using libthread_db enabled]\nUsing host libthread_db library \"/lib/x86_64-linux-gnu/libthread_db.so.1\".\nCore was generated by `php -d extension_dir=../ext/grpc/modules -d extension=grpc.so /usr/bin/phpunit'.\nProgram terminated with signal SIGSEGV, Segmentation fault.\n#0  hpack_enc (c=c@entry=0x7f6c7c001e60, elem=0x0, st=st@entry=0x7f6c84df0810)\n    at src/core/transport/chttp2/stream_encoder.c:358\n358   gpr_uint32 key_hash = elem->key->hash;\n(gdb) bt\n#0  hpack_enc (c=c@entry=0x7f6c7c001e60, elem=0x0, st=st@entry=0x7f6c84df0810)\n    at src/core/transport/chttp2/stream_encoder.c:358\n#1  0x00007f6c8506b76e in grpc_chttp2_encode (ops=0x7f6c7c007fc8, ops_count=1, eof=0, \n    stream_id=<optimized out>, compressor=compressor@entry=0x7f6c7c001e60, \n    output=output@entry=0x7f6c7c0046a0) at src/core/transport/chttp2/stream_encoder.c:584\n#2  0x00007f6c8506e3d0 in finalize_outbuf (t=<optimized out>)\n    at src/core/transport/chttp2_transport.c:1008\n#3  perform_write (ep=<optimized out>, t=<optimized out>)\n    at src/core/transport/chttp2_transport.c:1060\n#4  unlock (t=0x7f6c7c001cf0) at src/core/transport/chttp2_transport.c:891\n#5  0x00007f6c850552b1 in grpc_client_channel_transport_setup_complete (\n    channel_stack=<optimized out>, transport=<optimized out>, \n    channel_filters=channel_filters@entry=0x7f6c85453aa0 <extra_filters>, \n    num_channel_filters=num_channel_filters@entry=1, mdctx=<optimized out>)\n    at src/core/channel/client_channel.c:525\n#6  0x00007f6c85063208 in complete_setup (channel_stack=<optimized out>, \n    transport=<optimized out>, mdctx=<optimized out>) at src/core/surface/channel_create.c:183\n#7  0x00007f6c85070573 in init_transport (is_client=<optimized out>, mdctx=<optimized out>, \n    nslices=<optimized out>, slices=<optimized out>, ep=<optimized out>, \n    channel_args=<optimized out>, arg=<optimized out>, setup=<optimized out>, t=<optimized out>)\n    at src/core/transport/chttp2_transport.c:575\n#8  grpc_create_chttp2_transport (setup=0x7f6c7c001e60, arg=0x0, channel_args=0x13e4050, \n    ep=0x7f6c7c001bf0, slices=slices@entry=0x0, nslices=175, nslices@entry=0, \n    mdctx=0x7f6c7c004780, is_client=1) at src/core/transport/chttp2_transport.c:2179\n#9  0x00007f6c8506330c in on_connect (rp=0x13e5220, tcp=0x7f6c7c001bf0)\n    at src/core/surface/channel_create.c:111\n#10 0x00007f6c8505bebd in on_writable (acp=0x7f6c7c001b30, success=<optimized out>)\n    at src/core/iomgr/tcp_client_posix.c:178\n#11 0x00007f6c85058de5 in background_callback_executor (ignored=ignored@entry=0x0)\n    at src/core/iomgr/iomgr.c:68\n#12 0x00007f6c84df9c47 in thread_body (v=<optimized out>) at src/core/support/thd_posix.c:57\n#13 0x00007f6c86d8b0a4 in start_thread (arg=0x7f6c84df1700) at pthread_create.c:309\n#14 0x00007f6c8708604d in clone () at ../sysdeps/unix/sysv/linux/x86_64/clone.S:111\n(gdb) \n```\n\nThis is grpc at upstream master btw. Commit grpc/grpc@1e02fed to be exact.\n\nTo get to the core dump:\n\n```\nssh into grpc-jenkins-worker1\nsudo docker start 622064bb149e\nsudo docker attach 622064bb149e\n<hit enter once to show prompt>\ncd /mnt\ngdb php core\n```\n\nSo in `src/core/transport/chttp2/stream_encoder.c:584`, `l->md` is a null pointer.\n\nThere is another similar error but did not cause a segfault, happening around 1 in several hundred runs. This seems to be happening more frequently than the segfault.\n\n```\nStarting test 'CallTest::testAddMultiValueMetadata'.\nI0624 22:27:46.626544999   12106 call.c:1307] grpc_call_start_batch(call=0x14fde80, ops=0x7ffeccabb4d0, nops=1, tag=0x14fde80)\nI0624 22:27:46.626571270   12106 call.c:1307] ops[0]: SEND_INITIAL_METADATA\nkey=key value=76 61 6c 75 65 31 'value1'\nkey=key value=76 61 6c 75 65 32 'value2'\nE0624 22:27:46.626656592   12107 stream_op.c:180] assertion failed: l->next->prev == l\nAborted\nFAILED: src/php/bin/run_tests.sh [ret=134, pid=12091]\n```\n"
  },
  {
    "url": "https://api.github.com/repos/grpc/grpc/issues/comments/132898771",
    "html_url": "https://github.com/grpc/grpc/issues/1920#issuecomment-132898771",
    "issue_url": "https://api.github.com/repos/grpc/grpc/issues/1920",
    "id": 132898771,
    "node_id": "MDEyOklzc3VlQ29tbWVudDEzMjg5ODc3MQ==",
    "user": {
      "login": "stanley-cheung",
      "id": 11674202,
      "node_id": "MDQ6VXNlcjExNjc0MjAy",
      "avatar_url": "https://avatars2.githubusercontent.com/u/11674202?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/stanley-cheung",
      "html_url": "https://github.com/stanley-cheung",
      "followers_url": "https://api.github.com/users/stanley-cheung/followers",
      "following_url": "https://api.github.com/users/stanley-cheung/following{/other_user}",
      "gists_url": "https://api.github.com/users/stanley-cheung/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/stanley-cheung/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/stanley-cheung/subscriptions",
      "organizations_url": "https://api.github.com/users/stanley-cheung/orgs",
      "repos_url": "https://api.github.com/users/stanley-cheung/repos",
      "events_url": "https://api.github.com/users/stanley-cheung/events{/privacy}",
      "received_events_url": "https://api.github.com/users/stanley-cheung/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2015-08-20T05:32:50Z",
    "updated_at": "2015-08-20T05:32:50Z",
    "author_association": "CONTRIBUTOR",
    "body": "This is no longer reproducible.\n"
  }
]
