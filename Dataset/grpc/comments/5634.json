[
  {
    "url": "https://api.github.com/repos/grpc/grpc/issues/comments/193511454",
    "html_url": "https://github.com/grpc/grpc/issues/5634#issuecomment-193511454",
    "issue_url": "https://api.github.com/repos/grpc/grpc/issues/5634",
    "id": 193511454,
    "node_id": "MDEyOklzc3VlQ29tbWVudDE5MzUxMTQ1NA==",
    "user": {
      "login": "vjpai",
      "id": 8864912,
      "node_id": "MDQ6VXNlcjg4NjQ5MTI=",
      "avatar_url": "https://avatars0.githubusercontent.com/u/8864912?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/vjpai",
      "html_url": "https://github.com/vjpai",
      "followers_url": "https://api.github.com/users/vjpai/followers",
      "following_url": "https://api.github.com/users/vjpai/following{/other_user}",
      "gists_url": "https://api.github.com/users/vjpai/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/vjpai/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/vjpai/subscriptions",
      "organizations_url": "https://api.github.com/users/vjpai/orgs",
      "repos_url": "https://api.github.com/users/vjpai/repos",
      "events_url": "https://api.github.com/users/vjpai/events{/privacy}",
      "received_events_url": "https://api.github.com/users/vjpai/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2016-03-07T23:49:39Z",
    "updated_at": "2016-03-07T23:49:39Z",
    "author_association": "MEMBER",
    "body": "Can you mention the grpc version number that you are using? There was a\npreviously-discovered issue about this in grpc 0.12 and below (\nhttps://github.com/grpc/grpc/issues/5263) but it has been resolved since\nthen.\nRegards,\nVijay\n\nOn Mon, Mar 7, 2016 at 3:18 PM Zheng Cai notifications@github.com wrote:\n\n> Hi All,\n> \n> In our project, because we need asynchronous gRPC calls, we are designing\n> our threading model in this way:\n> \n> One polling thread that dispatches results from completion queue:\n> \n> while(true) {\n>   void *tag = 0;\n>   bool ok = false;\n>   completion_queue.Next(&tag, &ok);\n>   // Dispatch the callback function in tag.\n>   ...\n> }\n> \n> Other worker threads that initiate gRPC calls:\n> \n> client_context = std::make_sharedgrpc::ClientContext();\n> status = std::make_sharedgrpc::Status();\n> std::unique_ptrgrpc::ClientAsyncResponseReader<ResultTypeName>\n>   rpc(stub->AsyncCallName(client_context.get(), request, params_.cq));\n> rpc->Finish(&result, status.get(), reinterpret_cast<void *>(callback));\n> \n> Then the code sometimes crashes with segfault in\n> \"completion_queue.Next(&tag, &ok);\". Since the failure is intermittent, my\n> guess is that it is related to multi-threading. However, even after I\n> protect the critical lines (completion_queue.Next(), creation of \"rpc\", and\n> rpc->Finish()) in bold with a semaphore, the failure still happens.\n> \n> So I was just wondering, is there anything that we did wrong that could\n> cause the segfault? If so, how should we fix the issue?\n> \n> Thanks a lot in advance.\n> \n> PS:\n> \n> I am also attaching the core stack for the segfault, just in case it might\n> help:\n> \n> #0 0x00007ffcfc6bbad0 in grpc::CompletionQueue::AsyncNextInternal(void*_,\n> bool_, gpr_timespec) () from\n> /.../software/toolchain/x86_64-linux/2.7/lib/libgrpc++.so.0\n> #1 https://github.com/grpc/grpc/pull/1 0x00007ffcfc93cbdc in Next\n> (this=0x1bdd620, tag=, ok=) at\n> /.../software/toolchain/x86_64-linux/2.7/usr/include/grpc++/completion_queue.h:127\n> #2 https://github.com/grpc/grpc/pull/2 GrpcMessageManager::PollingLoop\n> (this=0x1bdd618) at /.../grpc_message_manager.cc:73\n> \n> â€”\n> Reply to this email directly or view it on GitHub\n> https://github.com/grpc/grpc/issues/5634.\n"
  },
  {
    "url": "https://api.github.com/repos/grpc/grpc/issues/comments/193512447",
    "html_url": "https://github.com/grpc/grpc/issues/5634#issuecomment-193512447",
    "issue_url": "https://api.github.com/repos/grpc/grpc/issues/5634",
    "id": 193512447,
    "node_id": "MDEyOklzc3VlQ29tbWVudDE5MzUxMjQ0Nw==",
    "user": {
      "login": "zhengcai",
      "id": 1184906,
      "node_id": "MDQ6VXNlcjExODQ5MDY=",
      "avatar_url": "https://avatars0.githubusercontent.com/u/1184906?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/zhengcai",
      "html_url": "https://github.com/zhengcai",
      "followers_url": "https://api.github.com/users/zhengcai/followers",
      "following_url": "https://api.github.com/users/zhengcai/following{/other_user}",
      "gists_url": "https://api.github.com/users/zhengcai/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/zhengcai/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/zhengcai/subscriptions",
      "organizations_url": "https://api.github.com/users/zhengcai/orgs",
      "repos_url": "https://api.github.com/users/zhengcai/repos",
      "events_url": "https://api.github.com/users/zhengcai/events{/privacy}",
      "received_events_url": "https://api.github.com/users/zhengcai/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2016-03-07T23:54:08Z",
    "updated_at": "2016-03-07T23:54:08Z",
    "author_association": "NONE",
    "body": "We are using 0.11.0. I will try to upgrade to 0.13.0 to see whether this problem still occurs, and update here.\n\nThanks a lot for the help\n"
  },
  {
    "url": "https://api.github.com/repos/grpc/grpc/issues/comments/193927980",
    "html_url": "https://github.com/grpc/grpc/issues/5634#issuecomment-193927980",
    "issue_url": "https://api.github.com/repos/grpc/grpc/issues/5634",
    "id": 193927980,
    "node_id": "MDEyOklzc3VlQ29tbWVudDE5MzkyNzk4MA==",
    "user": {
      "login": "zhengcai",
      "id": 1184906,
      "node_id": "MDQ6VXNlcjExODQ5MDY=",
      "avatar_url": "https://avatars0.githubusercontent.com/u/1184906?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/zhengcai",
      "html_url": "https://github.com/zhengcai",
      "followers_url": "https://api.github.com/users/zhengcai/followers",
      "following_url": "https://api.github.com/users/zhengcai/following{/other_user}",
      "gists_url": "https://api.github.com/users/zhengcai/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/zhengcai/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/zhengcai/subscriptions",
      "organizations_url": "https://api.github.com/users/zhengcai/orgs",
      "repos_url": "https://api.github.com/users/zhengcai/repos",
      "events_url": "https://api.github.com/users/zhengcai/events{/privacy}",
      "received_events_url": "https://api.github.com/users/zhengcai/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2016-03-08T19:20:23Z",
    "updated_at": "2016-03-08T19:20:23Z",
    "author_association": "NONE",
    "body": "Great, upgrading to 0.13.0 fixed this issue. Thanks a lot for the help!\n"
  }
]
