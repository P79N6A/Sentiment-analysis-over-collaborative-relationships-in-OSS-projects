[
  {
    "url": "https://api.github.com/repos/grpc/grpc/issues/comments/347664807",
    "html_url": "https://github.com/grpc/grpc/issues/13474#issuecomment-347664807",
    "issue_url": "https://api.github.com/repos/grpc/grpc/issues/13474",
    "id": 347664807,
    "node_id": "MDEyOklzc3VlQ29tbWVudDM0NzY2NDgwNw==",
    "user": {
      "login": "ZhouyihaiDing",
      "id": 28968539,
      "node_id": "MDQ6VXNlcjI4OTY4NTM5",
      "avatar_url": "https://avatars3.githubusercontent.com/u/28968539?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/ZhouyihaiDing",
      "html_url": "https://github.com/ZhouyihaiDing",
      "followers_url": "https://api.github.com/users/ZhouyihaiDing/followers",
      "following_url": "https://api.github.com/users/ZhouyihaiDing/following{/other_user}",
      "gists_url": "https://api.github.com/users/ZhouyihaiDing/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/ZhouyihaiDing/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/ZhouyihaiDing/subscriptions",
      "organizations_url": "https://api.github.com/users/ZhouyihaiDing/orgs",
      "repos_url": "https://api.github.com/users/ZhouyihaiDing/repos",
      "events_url": "https://api.github.com/users/ZhouyihaiDing/events{/privacy}",
      "received_events_url": "https://api.github.com/users/ZhouyihaiDing/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2017-11-28T21:11:29Z",
    "updated_at": "2017-11-28T21:41:05Z",
    "author_association": "CONTRIBUTOR",
    "body": "Hi. I am looking into it. Client stub has [close()](https://github.com/grpc/grpc/blob/master/src/php/lib/Grpc/BaseStub.php#L136) method like `clientStub.close()`, which the channel inside the stub closed by [grpc_channel_destroy(channel)](https://github.com/grpc/grpc/blob/master/include/grpc/grpc.h#L302)\r\nCan you please give me an example reproducing it?\r\nThanks!"
  },
  {
    "url": "https://api.github.com/repos/grpc/grpc/issues/comments/347939173",
    "html_url": "https://github.com/grpc/grpc/issues/13474#issuecomment-347939173",
    "issue_url": "https://api.github.com/repos/grpc/grpc/issues/13474",
    "id": 347939173,
    "node_id": "MDEyOklzc3VlQ29tbWVudDM0NzkzOTE3Mw==",
    "user": {
      "login": "fho",
      "id": 514535,
      "node_id": "MDQ6VXNlcjUxNDUzNQ==",
      "avatar_url": "https://avatars3.githubusercontent.com/u/514535?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/fho",
      "html_url": "https://github.com/fho",
      "followers_url": "https://api.github.com/users/fho/followers",
      "following_url": "https://api.github.com/users/fho/following{/other_user}",
      "gists_url": "https://api.github.com/users/fho/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/fho/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/fho/subscriptions",
      "organizations_url": "https://api.github.com/users/fho/orgs",
      "repos_url": "https://api.github.com/users/fho/repos",
      "events_url": "https://api.github.com/users/fho/events{/privacy}",
      "received_events_url": "https://api.github.com/users/fho/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2017-11-29T17:43:57Z",
    "updated_at": "2017-11-29T17:57:03Z",
    "author_association": "CONTRIBUTOR",
    "body": "Hello @ZhouyihaiDing,\r\n\r\nthanks for your help!\r\n\r\nI build a simple PHP client + Go server to reproduce it (https://github.com/fho/grpc_issue_13474).\r\n\r\nThe server program does in a loop:\r\n-  starting a GRPC-Server\r\n- waiting 30 seconds\r\n- stopping the GRPCServer\r\n\r\nThe PHP Client script is issuing a request at the GRPC-Server. The PHP script has to be run in php server mode (`php -S`) to reproduce the issue.\r\n\r\nSteps to reproduce: \r\n1. You do a request to http://localhost:8000/greeter_client.php\r\n2. Wait until the GRPC-Server was restarted in the server.\r\nIf you check the output of `netstat -tupen`, you will see that the TCP connection from the Client to the Go-Server hangs in the `CLOSE_WAIT` state.\r\n3. You do another request to http://localhost:8000/greeter_client.php, the request will fail with status Code 14 (Unavailable). The TCP connection that was previously in `CLOSE_WAIT` will vanish\r\n4. You do another request to http://localhost:8000/greeter_client.php which will succeed\r\n\r\n\r\nI think there are multiple issues:\r\n1. Same issue than: https://github.com/grpc/grpc/issues/11043. The returned status `Unavailable` is wrong, the server was reachable at the time when the request was done.  It was fixed in the Python and Ruby Clients but still exist in PHP.\r\n2. The issue does not happen when the script is run via `php greeter_client.php`.\r\n It only happens when the php-script is run in server mode.\r\nIf I understand it correctly, the php-plugin only closes the channel (and with that the connection?) when `grpc_destroy()` is called by the zend object free handler. \r\nThe free handler is run as part of the PHP executor shutdown. Therefore channels can persist until the PHP executor terminates, which can be a very long time.\r\nMaybe the connection should be closed in the zend dtor handler of the channel object instead?\r\n3. It causes that in the Go-Server, `grpc.Server.GracefulStop()` hangs forever (or very long until the connection was closed from the php plugin?).\r\nIf you change the Go grpc server to call `GracefulStop()` instead of `Stop()` on `grpc.Server`, then issue a request from the PHP Client in PHP  server mode, the Go-Server will hang at the `GracefulStop()` call."
  },
  {
    "url": "https://api.github.com/repos/grpc/grpc/issues/comments/348367539",
    "html_url": "https://github.com/grpc/grpc/issues/13474#issuecomment-348367539",
    "issue_url": "https://api.github.com/repos/grpc/grpc/issues/13474",
    "id": 348367539,
    "node_id": "MDEyOklzc3VlQ29tbWVudDM0ODM2NzUzOQ==",
    "user": {
      "login": "sagikazarmark",
      "id": 1226384,
      "node_id": "MDQ6VXNlcjEyMjYzODQ=",
      "avatar_url": "https://avatars3.githubusercontent.com/u/1226384?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/sagikazarmark",
      "html_url": "https://github.com/sagikazarmark",
      "followers_url": "https://api.github.com/users/sagikazarmark/followers",
      "following_url": "https://api.github.com/users/sagikazarmark/following{/other_user}",
      "gists_url": "https://api.github.com/users/sagikazarmark/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/sagikazarmark/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/sagikazarmark/subscriptions",
      "organizations_url": "https://api.github.com/users/sagikazarmark/orgs",
      "repos_url": "https://api.github.com/users/sagikazarmark/repos",
      "events_url": "https://api.github.com/users/sagikazarmark/events{/privacy}",
      "received_events_url": "https://api.github.com/users/sagikazarmark/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2017-12-01T00:43:44Z",
    "updated_at": "2017-12-01T00:43:44Z",
    "author_association": "NONE",
    "body": "I can confirm this is a problem on PHP 5.6 with gRPC extension 1.6.0 (with the same symptoms).\r\n\r\nClosing the connection manually immediately after a call is finished makes things somewhat better, but I haven't don any stress tests, things may go south when there is more than one user."
  },
  {
    "url": "https://api.github.com/repos/grpc/grpc/issues/comments/350374011",
    "html_url": "https://github.com/grpc/grpc/issues/13474#issuecomment-350374011",
    "issue_url": "https://api.github.com/repos/grpc/grpc/issues/13474",
    "id": 350374011,
    "node_id": "MDEyOklzc3VlQ29tbWVudDM1MDM3NDAxMQ==",
    "user": {
      "login": "ZhouyihaiDing",
      "id": 28968539,
      "node_id": "MDQ6VXNlcjI4OTY4NTM5",
      "avatar_url": "https://avatars3.githubusercontent.com/u/28968539?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/ZhouyihaiDing",
      "html_url": "https://github.com/ZhouyihaiDing",
      "followers_url": "https://api.github.com/users/ZhouyihaiDing/followers",
      "following_url": "https://api.github.com/users/ZhouyihaiDing/following{/other_user}",
      "gists_url": "https://api.github.com/users/ZhouyihaiDing/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/ZhouyihaiDing/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/ZhouyihaiDing/subscriptions",
      "organizations_url": "https://api.github.com/users/ZhouyihaiDing/orgs",
      "repos_url": "https://api.github.com/users/ZhouyihaiDing/repos",
      "events_url": "https://api.github.com/users/ZhouyihaiDing/events{/privacy}",
      "received_events_url": "https://api.github.com/users/ZhouyihaiDing/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2017-12-08T21:16:33Z",
    "updated_at": "2017-12-08T21:16:33Z",
    "author_association": "CONTRIBUTOR",
    "body": "Sorry for the delay.\r\nReconnect the disconnected channel is fixed by [backup poller](https://github.com/grpc/grpc/pull/12732). \r\nYou can download grpc-1.8.0RC1 or [buld form source](https://github.com/grpc/grpc/tree/master/src/php#build-from-source) to solve this problem until 1.8.0 is released."
  },
  {
    "url": "https://api.github.com/repos/grpc/grpc/issues/comments/350677095",
    "html_url": "https://github.com/grpc/grpc/issues/13474#issuecomment-350677095",
    "issue_url": "https://api.github.com/repos/grpc/grpc/issues/13474",
    "id": 350677095,
    "node_id": "MDEyOklzc3VlQ29tbWVudDM1MDY3NzA5NQ==",
    "user": {
      "login": "fho",
      "id": 514535,
      "node_id": "MDQ6VXNlcjUxNDUzNQ==",
      "avatar_url": "https://avatars3.githubusercontent.com/u/514535?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/fho",
      "html_url": "https://github.com/fho",
      "followers_url": "https://api.github.com/users/fho/followers",
      "following_url": "https://api.github.com/users/fho/following{/other_user}",
      "gists_url": "https://api.github.com/users/fho/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/fho/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/fho/subscriptions",
      "organizations_url": "https://api.github.com/users/fho/orgs",
      "repos_url": "https://api.github.com/users/fho/repos",
      "events_url": "https://api.github.com/users/fho/events{/privacy}",
      "received_events_url": "https://api.github.com/users/fho/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2017-12-11T10:02:13Z",
    "updated_at": "2017-12-11T10:02:13Z",
    "author_association": "CONTRIBUTOR",
    "body": "thank you, @ZhouyihaiDing. I'll give it a try."
  },
  {
    "url": "https://api.github.com/repos/grpc/grpc/issues/comments/351463060",
    "html_url": "https://github.com/grpc/grpc/issues/13474#issuecomment-351463060",
    "issue_url": "https://api.github.com/repos/grpc/grpc/issues/13474",
    "id": 351463060,
    "node_id": "MDEyOklzc3VlQ29tbWVudDM1MTQ2MzA2MA==",
    "user": {
      "login": "fho",
      "id": 514535,
      "node_id": "MDQ6VXNlcjUxNDUzNQ==",
      "avatar_url": "https://avatars3.githubusercontent.com/u/514535?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/fho",
      "html_url": "https://github.com/fho",
      "followers_url": "https://api.github.com/users/fho/followers",
      "following_url": "https://api.github.com/users/fho/following{/other_user}",
      "gists_url": "https://api.github.com/users/fho/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/fho/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/fho/subscriptions",
      "organizations_url": "https://api.github.com/users/fho/orgs",
      "repos_url": "https://api.github.com/users/fho/repos",
      "events_url": "https://api.github.com/users/fho/events{/privacy}",
      "received_events_url": "https://api.github.com/users/fho/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2017-12-13T17:28:23Z",
    "updated_at": "2017-12-13T17:28:23Z",
    "author_association": "CONTRIBUTOR",
    "body": "I can confirm that the issue is fixed in version 1.8.0RC1.\r\nI could not reproduce the issue anymore."
  }
]
