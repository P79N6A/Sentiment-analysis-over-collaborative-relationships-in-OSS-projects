[
  {
    "url": "https://api.github.com/repos/grpc/grpc/issues/comments/265852514",
    "html_url": "https://github.com/grpc/grpc/issues/8983#issuecomment-265852514",
    "issue_url": "https://api.github.com/repos/grpc/grpc/issues/8983",
    "id": 265852514,
    "node_id": "MDEyOklzc3VlQ29tbWVudDI2NTg1MjUxNA==",
    "user": {
      "login": "apolcyn",
      "id": 9566254,
      "node_id": "MDQ6VXNlcjk1NjYyNTQ=",
      "avatar_url": "https://avatars1.githubusercontent.com/u/9566254?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/apolcyn",
      "html_url": "https://github.com/apolcyn",
      "followers_url": "https://api.github.com/users/apolcyn/followers",
      "following_url": "https://api.github.com/users/apolcyn/following{/other_user}",
      "gists_url": "https://api.github.com/users/apolcyn/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/apolcyn/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/apolcyn/subscriptions",
      "organizations_url": "https://api.github.com/users/apolcyn/orgs",
      "repos_url": "https://api.github.com/users/apolcyn/repos",
      "events_url": "https://api.github.com/users/apolcyn/events{/privacy}",
      "received_events_url": "https://api.github.com/users/apolcyn/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2016-12-08T20:54:23Z",
    "updated_at": "2016-12-09T04:29:08Z",
    "author_association": "CONTRIBUTOR",
    "body": "This leak can be seen by also tweaking helloworld examples in the grpc repo.\r\nThe `greeter_server.rb` `say_hello` changed to: \r\n```\r\n  def say_hello(hello_req, _unused_call)\r\n     sleep 1\r\n     Helloworld::HelloReply.new(message: \"Hello #{hello_req.name}\")\r\n   end\r\n``` \r\n\r\nand the client changed to: \r\n```\r\ndef run\r\n    stub = Helloworld::Greeter::Stub.new('localhost:50051', :this_channel_is_insecure)\r\n    user = ARGV.size > 0 ?  ARGV[0] : 'world'\r\n    message = stub.say_hello(Helloworld::HelloRequest.new(name: user)).message\r\n    p \"Greeting: #{message}\"\r\n  end\r\n  \r\n  def main\r\n    t = Thread.new { run }\r\n    sleep 0.5\r\n  end\r\n```\r\n\r\nthis starts the call but also lets the ruby process begin exit and run GC on the unjoined thread.\r\n\r\nthis leaves the error:\r\n`E1208 11:53:53.347635897   80628 network_status_tracker.c:48] Memory leaked as all network endpoints were not shut down`\r\n\r\nReproducing what's seen here in rails with stackdriver, logs from `GRPC_VERBOSITY=DEBUG GRPC_TRACE=all,-queue_pluck,-queue_timeout` show that there's and outstanding call that get's cancelled just before everything in grpc shutting down. \r\n\r\nIn the real repro, I think grpc is getting written to by the async child thread in https://github.com/GoogleCloudPlatform/google-cloud-ruby/blob/970e6a22b222377b8d252099229673b202d20247/google-cloud-logging/lib/google/cloud/logging/async_writer.rb, correct? In that case, I don't think that thread gets joined on process end either, so looks this is similar to the tweaked example.\r\n\r\nStill child threads shouldn't have to be joined - everything getting cleaned up on process end should probably be able to cancel the call and clean things up.\r\n\r\ncc @murgatroid99 "
  },
  {
    "url": "https://api.github.com/repos/grpc/grpc/issues/comments/267646879",
    "html_url": "https://github.com/grpc/grpc/issues/8983#issuecomment-267646879",
    "issue_url": "https://api.github.com/repos/grpc/grpc/issues/8983",
    "id": 267646879,
    "node_id": "MDEyOklzc3VlQ29tbWVudDI2NzY0Njg3OQ==",
    "user": {
      "login": "apolcyn",
      "id": 9566254,
      "node_id": "MDQ6VXNlcjk1NjYyNTQ=",
      "avatar_url": "https://avatars1.githubusercontent.com/u/9566254?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/apolcyn",
      "html_url": "https://github.com/apolcyn",
      "followers_url": "https://api.github.com/users/apolcyn/followers",
      "following_url": "https://api.github.com/users/apolcyn/following{/other_user}",
      "gists_url": "https://api.github.com/users/apolcyn/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/apolcyn/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/apolcyn/subscriptions",
      "organizations_url": "https://api.github.com/users/apolcyn/orgs",
      "repos_url": "https://api.github.com/users/apolcyn/repos",
      "events_url": "https://api.github.com/users/apolcyn/events{/privacy}",
      "received_events_url": "https://api.github.com/users/apolcyn/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2016-12-16T17:22:32Z",
    "updated_at": "2016-12-16T17:22:32Z",
    "author_association": "CONTRIBUTOR",
    "body": "closing as this seems to be the same issue as https://github.com/GoogleCloudPlatform/google-cloud-ruby/issues/1096, with same fix"
  }
]
