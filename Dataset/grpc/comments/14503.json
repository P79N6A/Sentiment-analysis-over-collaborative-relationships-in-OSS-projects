[
  {
    "url": "https://api.github.com/repos/grpc/grpc/issues/comments/369675772",
    "html_url": "https://github.com/grpc/grpc/issues/14503#issuecomment-369675772",
    "issue_url": "https://api.github.com/repos/grpc/grpc/issues/14503",
    "id": 369675772,
    "node_id": "MDEyOklzc3VlQ29tbWVudDM2OTY3NTc3Mg==",
    "user": {
      "login": "SotoiGhost",
      "id": 5924210,
      "node_id": "MDQ6VXNlcjU5MjQyMTA=",
      "avatar_url": "https://avatars3.githubusercontent.com/u/5924210?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/SotoiGhost",
      "html_url": "https://github.com/SotoiGhost",
      "followers_url": "https://api.github.com/users/SotoiGhost/followers",
      "following_url": "https://api.github.com/users/SotoiGhost/following{/other_user}",
      "gists_url": "https://api.github.com/users/SotoiGhost/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/SotoiGhost/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/SotoiGhost/subscriptions",
      "organizations_url": "https://api.github.com/users/SotoiGhost/orgs",
      "repos_url": "https://api.github.com/users/SotoiGhost/repos",
      "events_url": "https://api.github.com/users/SotoiGhost/events{/privacy}",
      "received_events_url": "https://api.github.com/users/SotoiGhost/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2018-03-01T17:57:09Z",
    "updated_at": "2018-03-01T17:57:09Z",
    "author_association": "NONE",
    "body": "Any progress on this?"
  },
  {
    "url": "https://api.github.com/repos/grpc/grpc/issues/comments/369709052",
    "html_url": "https://github.com/grpc/grpc/issues/14503#issuecomment-369709052",
    "issue_url": "https://api.github.com/repos/grpc/grpc/issues/14503",
    "id": 369709052,
    "node_id": "MDEyOklzc3VlQ29tbWVudDM2OTcwOTA1Mg==",
    "user": {
      "login": "muxi",
      "id": 1054404,
      "node_id": "MDQ6VXNlcjEwNTQ0MDQ=",
      "avatar_url": "https://avatars1.githubusercontent.com/u/1054404?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/muxi",
      "html_url": "https://github.com/muxi",
      "followers_url": "https://api.github.com/users/muxi/followers",
      "following_url": "https://api.github.com/users/muxi/following{/other_user}",
      "gists_url": "https://api.github.com/users/muxi/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/muxi/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/muxi/subscriptions",
      "organizations_url": "https://api.github.com/users/muxi/orgs",
      "repos_url": "https://api.github.com/users/muxi/repos",
      "events_url": "https://api.github.com/users/muxi/events{/privacy}",
      "received_events_url": "https://api.github.com/users/muxi/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2018-03-01T19:48:26Z",
    "updated_at": "2018-03-01T19:48:26Z",
    "author_association": "MEMBER",
    "body": "We would love to get a dump of this crash if you can. I do not see a reason [GRPCChannel:dealloc] is invoked inside init function. Does this happen *always*?"
  },
  {
    "url": "https://api.github.com/repos/grpc/grpc/issues/comments/369717213",
    "html_url": "https://github.com/grpc/grpc/issues/14503#issuecomment-369717213",
    "issue_url": "https://api.github.com/repos/grpc/grpc/issues/14503",
    "id": 369717213,
    "node_id": "MDEyOklzc3VlQ29tbWVudDM2OTcxNzIxMw==",
    "user": {
      "login": "SotoiGhost",
      "id": 5924210,
      "node_id": "MDQ6VXNlcjU5MjQyMTA=",
      "avatar_url": "https://avatars3.githubusercontent.com/u/5924210?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/SotoiGhost",
      "html_url": "https://github.com/SotoiGhost",
      "followers_url": "https://api.github.com/users/SotoiGhost/followers",
      "following_url": "https://api.github.com/users/SotoiGhost/following{/other_user}",
      "gists_url": "https://api.github.com/users/SotoiGhost/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/SotoiGhost/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/SotoiGhost/subscriptions",
      "organizations_url": "https://api.github.com/users/SotoiGhost/orgs",
      "repos_url": "https://api.github.com/users/SotoiGhost/repos",
      "events_url": "https://api.github.com/users/SotoiGhost/events{/privacy}",
      "received_events_url": "https://api.github.com/users/SotoiGhost/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2018-03-01T20:16:25Z",
    "updated_at": "2018-03-01T20:16:25Z",
    "author_association": "NONE",
    "body": "I will try to get the dump because the crash happens but the app doesn't crash, I just get the stack trace on Application Output:\r\n\r\n```\r\n2018-02-22 23:20:01.100 CloudFirestoreSample[18147:11331653] critical: \t0   CloudFirestoreSample                0x0000000102e576ac mono_handle_native_crash + 224\r\n2018-02-22 23:20:01.100 CloudFirestoreSample[18147:11331653] critical: \t1   CloudFirestoreSample                0x0000000102e626cc mono_sigsegv_signal_handler + 188\r\n2018-02-22 23:20:01.100 CloudFirestoreSample[18147:11331653] critical: \t2   libsystem_platform.dylib            0x0000000181503b50 _sigtramp + 52\r\n2018-02-22 23:20:01.100 CloudFirestoreSample[18147:11331653] critical: \t3   CloudFirestoreSample                0x0000000102dc7698 grpc_channel_destroy + 168\r\n2018-02-22 23:20:01.100 CloudFirestoreSample[18147:11331653] critical: \t4   CloudFirestoreSample                0x0000000102dbbc24 -[GRPCChannel dealloc] + 44\r\n2018-02-22 23:20:01.100 CloudFirestoreSample[18147:11331653] critical: \t5   CloudFirestoreSample                0x0000000102dbbbd4 -[GRPCChannel initWithHost:secure:credentials:channelArgs:] + 916\r\n2018-02-22 23:20:01.100 CloudFirestoreSample[18147:11331653] critical: \t6   CloudFirestoreSample                0x0000000102dbbd94 +[GRPCChannel secureChannelWithHost:credentials:channelArgs:] + 108\r\n2018-02-22 23:20:01.100 CloudFirestoreSample[18147:11331653] critical: \t7   CloudFirestoreSample                0x0000000102dbdacc -[GRPCHost newChannel] + 160\r\n2018-02-22 23:20:01.101 CloudFirestoreSample[18147:11331653] critical: \t8   CloudFirestoreSample                0x0000000102dbd3e8 -[GRPCHost unmanagedCallWithPath:serverName:timeout:completionQueue:] + 124\r\n2018-02-22 23:20:01.101 CloudFirestoreSample[18147:11331653] critical: \t9   CloudFirestoreSample                0x0000000102dbf0f0 -[GRPCWrappedCall initWithHost:serverName:path:timeout:] + 284\r\n2018-02-22 23:20:01.101 CloudFirestoreSample[18147:11331653] critical: \t10  CloudFirestoreSample                0x0000000102dbaf84 -[GRPCCall startCallWithWriteable:] + 192\r\n2018-02-22 23:20:01.101 CloudFirestoreSample[18147:11331653] critical: \t11  CloudFirestoreSample                0x0000000102dbb3e8 -[GRPCCall startWithWriteable:] + 336\r\n2018-02-22 23:20:01.101 CloudFirestoreSample[18147:11331653] critical: \t12  CloudFirestoreSample                0x0000000102d39558 -[FSTStream resumeStartWithToken:error:] + 580\r\n2018-02-22 23:20:01.101 CloudFirestoreSample[18147:11331653] critical: \t13  libdispatch.dylib                   0x000000018125ea54 <redacted> + 24\r\n2018-02-22 23:20:01.101 CloudFirestoreSample[18147:11331653] critical: \t14  libdispatch.dylib                   0x000000018125ea14 <redacted> + 16\r\n2018-02-22 23:20:01.101 CloudFirestoreSample[18147:11331653] critical: \t15  libdispatch.dylib                   0x000000018126896c <redacted> + 528\r\n2018-02-22 23:20:01.101 CloudFirestoreSample[18147:11331653] critical: \t16  libdispatch.dylib                   0x00000001812692fc <redacted> + 340\r\n2018-02-22 23:20:01.101 CloudFirestoreSample[18147:11331653] critical: \t17  libdispatch.dylib                   0x0000000181269d20 <redacted> + 404\r\n2018-02-22 23:20:01.101 CloudFirestoreSample[18147:11331653] critical: \t18  libdispatch.dylib                   0x000000018127203c <redacted> + 644\r\n2018-02-22 23:20:01.101 CloudFirestoreSample[18147:11331653] critical: \t19  libsystem_pthread.dylib             0x0000000181506f1c _pthread_wqthread + 932\r\n2018-02-22 23:20:01.101 CloudFirestoreSample[18147:11331653] critical: \t20  libsystem_pthread.dylib             0x0000000181506b6c start_wqthread + 4\r\n```\r\n\r\nI think that Firebase handles it somehow internally.\r\n\r\nAnd yes, this always happens. My guess is that `GRPCChannel` object is not being referenced by anything after initialization and that's why it's deallocating."
  },
  {
    "url": "https://api.github.com/repos/grpc/grpc/issues/comments/370549567",
    "html_url": "https://github.com/grpc/grpc/issues/14503#issuecomment-370549567",
    "issue_url": "https://api.github.com/repos/grpc/grpc/issues/14503",
    "id": 370549567,
    "node_id": "MDEyOklzc3VlQ29tbWVudDM3MDU0OTU2Nw==",
    "user": {
      "login": "SotoiGhost",
      "id": 5924210,
      "node_id": "MDQ6VXNlcjU5MjQyMTA=",
      "avatar_url": "https://avatars3.githubusercontent.com/u/5924210?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/SotoiGhost",
      "html_url": "https://github.com/SotoiGhost",
      "followers_url": "https://api.github.com/users/SotoiGhost/followers",
      "following_url": "https://api.github.com/users/SotoiGhost/following{/other_user}",
      "gists_url": "https://api.github.com/users/SotoiGhost/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/SotoiGhost/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/SotoiGhost/subscriptions",
      "organizations_url": "https://api.github.com/users/SotoiGhost/orgs",
      "repos_url": "https://api.github.com/users/SotoiGhost/repos",
      "events_url": "https://api.github.com/users/SotoiGhost/events{/privacy}",
      "received_events_url": "https://api.github.com/users/SotoiGhost/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2018-03-05T20:14:54Z",
    "updated_at": "2018-03-05T20:18:29Z",
    "author_association": "NONE",
    "body": "@muxi I finally could resolve the problem.\r\n\r\nMy problem was with this [method][1] in this [line][2]. gRPC was not finding the **roots.pem** file, was looking for it inside of **gRPCCertificates.bundle** folder and I added it at the root level of resources, I just created a folder named **gRPCCertificates.bundle** and added roots.pem into it and everything worked as expected.\r\n\r\nDue the library was not finding the file, the `_channelCreds` variable of `GRPCHost.m` was not been assigned and this caused that `GRCPChannel` `initWithHost:secure:credentials:channelArgs:` returned `nil` (due this [conditional][3]) causing the deallocation of the object.\r\n\r\nThe workaround that you suggest could work to avoid crashing but, AFAIC understand, I think there is a logic problem in `setTLSPEMRootCerts:withPrivateKey:withCertChain:error:` method in [this conditional][4]. The `return` prevents to reach the `NSAssert` below. The workaround can help to reach the `NSAssert` the second time that you try to create the `GRCPChannel` object but not the first time. My suggestion is to remove the `return` line in the workaround.\r\n\r\nI hope to be clear. If you have any doubt, don't hesitate to ask.\r\n\r\nBest,\r\nIsrael Soto.\r\n\r\n[1]: https://github.com/grpc/grpc/blob/master/src/objective-c/GRPCClient/private/GRPCHost.m#L236\r\n[2]: https://github.com/grpc/grpc/blob/master/src/objective-c/GRPCClient/private/GRPCHost.m#L141\r\n[3]: https://github.com/grpc/grpc/blob/master/src/objective-c/GRPCClient/private/GRPCChannel.m#L145\r\n[4]: https://github.com/grpc/grpc/blob/master/src/objective-c/GRPCClient/private/GRPCHost.m#L144\r\n[4]: https://github.com/grpc/grpc/blob/master/src/objective-c/GRPCClient/private/GRPCHost.m#L161"
  },
  {
    "url": "https://api.github.com/repos/grpc/grpc/issues/comments/370568153",
    "html_url": "https://github.com/grpc/grpc/issues/14503#issuecomment-370568153",
    "issue_url": "https://api.github.com/repos/grpc/grpc/issues/14503",
    "id": 370568153,
    "node_id": "MDEyOklzc3VlQ29tbWVudDM3MDU2ODE1Mw==",
    "user": {
      "login": "muxi",
      "id": 1054404,
      "node_id": "MDQ6VXNlcjEwNTQ0MDQ=",
      "avatar_url": "https://avatars1.githubusercontent.com/u/1054404?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/muxi",
      "html_url": "https://github.com/muxi",
      "followers_url": "https://api.github.com/users/muxi/followers",
      "following_url": "https://api.github.com/users/muxi/following{/other_user}",
      "gists_url": "https://api.github.com/users/muxi/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/muxi/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/muxi/subscriptions",
      "organizations_url": "https://api.github.com/users/muxi/orgs",
      "repos_url": "https://api.github.com/users/muxi/repos",
      "events_url": "https://api.github.com/users/muxi/events{/privacy}",
      "received_events_url": "https://api.github.com/users/muxi/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2018-03-05T21:14:59Z",
    "updated_at": "2018-03-05T21:14:59Z",
    "author_association": "MEMBER",
    "body": "@SotoiGhost Thanks a lot for sharing with us. What you said makes sense. I'll make a PR to fix that.."
  },
  {
    "url": "https://api.github.com/repos/grpc/grpc/issues/comments/370620139",
    "html_url": "https://github.com/grpc/grpc/issues/14503#issuecomment-370620139",
    "issue_url": "https://api.github.com/repos/grpc/grpc/issues/14503",
    "id": 370620139,
    "node_id": "MDEyOklzc3VlQ29tbWVudDM3MDYyMDEzOQ==",
    "user": {
      "login": "SotoiGhost",
      "id": 5924210,
      "node_id": "MDQ6VXNlcjU5MjQyMTA=",
      "avatar_url": "https://avatars3.githubusercontent.com/u/5924210?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/SotoiGhost",
      "html_url": "https://github.com/SotoiGhost",
      "followers_url": "https://api.github.com/users/SotoiGhost/followers",
      "following_url": "https://api.github.com/users/SotoiGhost/following{/other_user}",
      "gists_url": "https://api.github.com/users/SotoiGhost/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/SotoiGhost/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/SotoiGhost/subscriptions",
      "organizations_url": "https://api.github.com/users/SotoiGhost/orgs",
      "repos_url": "https://api.github.com/users/SotoiGhost/repos",
      "events_url": "https://api.github.com/users/SotoiGhost/events{/privacy}",
      "received_events_url": "https://api.github.com/users/SotoiGhost/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2018-03-06T00:45:05Z",
    "updated_at": "2018-03-06T00:45:05Z",
    "author_association": "NONE",
    "body": "@muxi yw\r\n\r\nI updated the [test case][1], I added an Xcode project so you can debug your native code running the Xamarin project if you need to test something. Follow this steps to able to debug the gRPC code with Xcode:\r\n\r\n1. Clone/Download the test case.\r\n2. Open your favorite Terminal app and go to **externals** folder.\r\n3. Run `make` (make sure you have [`pod`][2] command installed) and wait for the process to finish.\r\n4. Open the **CloudFirestoreSample.xcworkspace** select a simulator or device and run it. The **Launch** option is set as **Wait for executable to be launch** so it will wait for Xamarin project to run.\r\n5. Open the **CloudFirestoreSample.sln** located in **samples/CloudFirestoreSample** folder, select the same simulator/device as Xcode and run it.\r\n6. When the app launches, switch to Xcode and sometimes the debugger stops and some point randomly, continue the debug session.\r\n7. Go to `GRPCHost.m` and set a breakpoint in line 149\r\n8. Tap the **Test Firestore** button on the sample and wait for the debugger.\r\n\r\nThe sample, right out of the box, has the **roots.pem** reference outside of the bundle folder, so you can test the issue. Move the roots.pem file reference inside of the **gRPCCertificates.bundle** folder in Visual Studio for a correct execution of the sample.\r\n\r\nPlease, do a small change (comment/uncomment the `Console.WriteLine`) in the Xamarin sample between every launch, because otherwise, Visual Studio will detect that the app doesn't need to be built *and* is installed, so we won't reinstall over the Xcode dummy app.\r\n\r\nHope this helps you, don't hesitate to ask if you have any doubt.\r\n\r\nGreetings,\r\nIsrael Soto.\r\n\r\n[1]: https://github.com/SotoiGhost/Xamarin-Firebase-Cloud-Firestore-Sample\r\n[2]: https://guides.cocoapods.org/using/getting-started.html"
  },
  {
    "url": "https://api.github.com/repos/grpc/grpc/issues/comments/370620444",
    "html_url": "https://github.com/grpc/grpc/issues/14503#issuecomment-370620444",
    "issue_url": "https://api.github.com/repos/grpc/grpc/issues/14503",
    "id": 370620444,
    "node_id": "MDEyOklzc3VlQ29tbWVudDM3MDYyMDQ0NA==",
    "user": {
      "login": "muxi",
      "id": 1054404,
      "node_id": "MDQ6VXNlcjEwNTQ0MDQ=",
      "avatar_url": "https://avatars1.githubusercontent.com/u/1054404?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/muxi",
      "html_url": "https://github.com/muxi",
      "followers_url": "https://api.github.com/users/muxi/followers",
      "following_url": "https://api.github.com/users/muxi/following{/other_user}",
      "gists_url": "https://api.github.com/users/muxi/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/muxi/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/muxi/subscriptions",
      "organizations_url": "https://api.github.com/users/muxi/orgs",
      "repos_url": "https://api.github.com/users/muxi/repos",
      "events_url": "https://api.github.com/users/muxi/events{/privacy}",
      "received_events_url": "https://api.github.com/users/muxi/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2018-03-06T00:46:40Z",
    "updated_at": "2018-03-06T00:46:40Z",
    "author_association": "MEMBER",
    "body": "Appreciate the help Israel."
  },
  {
    "url": "https://api.github.com/repos/grpc/grpc/issues/comments/378627694",
    "html_url": "https://github.com/grpc/grpc/issues/14503#issuecomment-378627694",
    "issue_url": "https://api.github.com/repos/grpc/grpc/issues/14503",
    "id": 378627694,
    "node_id": "MDEyOklzc3VlQ29tbWVudDM3ODYyNzY5NA==",
    "user": {
      "login": "Aurazion",
      "id": 6509814,
      "node_id": "MDQ6VXNlcjY1MDk4MTQ=",
      "avatar_url": "https://avatars1.githubusercontent.com/u/6509814?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/Aurazion",
      "html_url": "https://github.com/Aurazion",
      "followers_url": "https://api.github.com/users/Aurazion/followers",
      "following_url": "https://api.github.com/users/Aurazion/following{/other_user}",
      "gists_url": "https://api.github.com/users/Aurazion/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/Aurazion/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/Aurazion/subscriptions",
      "organizations_url": "https://api.github.com/users/Aurazion/orgs",
      "repos_url": "https://api.github.com/users/Aurazion/repos",
      "events_url": "https://api.github.com/users/Aurazion/events{/privacy}",
      "received_events_url": "https://api.github.com/users/Aurazion/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2018-04-04T14:49:56Z",
    "updated_at": "2018-04-04T14:49:56Z",
    "author_association": "NONE",
    "body": "Hi,\r\nStill no update for this issue ? I have exactly the same problem ...\r\n\r\nThanks"
  },
  {
    "url": "https://api.github.com/repos/grpc/grpc/issues/comments/378666107",
    "html_url": "https://github.com/grpc/grpc/issues/14503#issuecomment-378666107",
    "issue_url": "https://api.github.com/repos/grpc/grpc/issues/14503",
    "id": 378666107,
    "node_id": "MDEyOklzc3VlQ29tbWVudDM3ODY2NjEwNw==",
    "user": {
      "login": "muxi",
      "id": 1054404,
      "node_id": "MDQ6VXNlcjEwNTQ0MDQ=",
      "avatar_url": "https://avatars1.githubusercontent.com/u/1054404?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/muxi",
      "html_url": "https://github.com/muxi",
      "followers_url": "https://api.github.com/users/muxi/followers",
      "following_url": "https://api.github.com/users/muxi/following{/other_user}",
      "gists_url": "https://api.github.com/users/muxi/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/muxi/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/muxi/subscriptions",
      "organizations_url": "https://api.github.com/users/muxi/orgs",
      "repos_url": "https://api.github.com/users/muxi/repos",
      "events_url": "https://api.github.com/users/muxi/events{/privacy}",
      "received_events_url": "https://api.github.com/users/muxi/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2018-04-04T16:40:34Z",
    "updated_at": "2018-04-04T16:40:34Z",
    "author_association": "MEMBER",
    "body": "@Aurazion - we are still on it but with lower priority than some other ongoing issues since from the discussion above it works correctly when .pem is put in the correct place. Let me know if you are experiencing problem that cannot be fixed."
  }
]
