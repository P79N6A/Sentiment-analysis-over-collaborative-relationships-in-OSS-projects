[
  {
    "url": "https://api.github.com/repos/grpc/grpc/issues/comments/296732636",
    "html_url": "https://github.com/grpc/grpc/issues/10782#issuecomment-296732636",
    "issue_url": "https://api.github.com/repos/grpc/grpc/issues/10782",
    "id": 296732636,
    "node_id": "MDEyOklzc3VlQ29tbWVudDI5NjczMjYzNg==",
    "user": {
      "login": "murgatroid99",
      "id": 961599,
      "node_id": "MDQ6VXNlcjk2MTU5OQ==",
      "avatar_url": "https://avatars3.githubusercontent.com/u/961599?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/murgatroid99",
      "html_url": "https://github.com/murgatroid99",
      "followers_url": "https://api.github.com/users/murgatroid99/followers",
      "following_url": "https://api.github.com/users/murgatroid99/following{/other_user}",
      "gists_url": "https://api.github.com/users/murgatroid99/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/murgatroid99/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/murgatroid99/subscriptions",
      "organizations_url": "https://api.github.com/users/murgatroid99/orgs",
      "repos_url": "https://api.github.com/users/murgatroid99/repos",
      "events_url": "https://api.github.com/users/murgatroid99/events{/privacy}",
      "received_events_url": "https://api.github.com/users/murgatroid99/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2017-04-24T16:34:05Z",
    "updated_at": "2017-04-24T16:34:05Z",
    "author_association": "MEMBER",
    "body": "The trailing metadata is in `response.status.metadata`, which goes into `error.metadata` in the error that is passed to the callback."
  },
  {
    "url": "https://api.github.com/repos/grpc/grpc/issues/comments/296748879",
    "html_url": "https://github.com/grpc/grpc/issues/10782#issuecomment-296748879",
    "issue_url": "https://api.github.com/repos/grpc/grpc/issues/10782",
    "id": 296748879,
    "node_id": "MDEyOklzc3VlQ29tbWVudDI5Njc0ODg3OQ==",
    "user": {
      "login": "vedant15",
      "id": 7704737,
      "node_id": "MDQ6VXNlcjc3MDQ3Mzc=",
      "avatar_url": "https://avatars3.githubusercontent.com/u/7704737?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/vedant15",
      "html_url": "https://github.com/vedant15",
      "followers_url": "https://api.github.com/users/vedant15/followers",
      "following_url": "https://api.github.com/users/vedant15/following{/other_user}",
      "gists_url": "https://api.github.com/users/vedant15/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/vedant15/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/vedant15/subscriptions",
      "organizations_url": "https://api.github.com/users/vedant15/orgs",
      "repos_url": "https://api.github.com/users/vedant15/repos",
      "events_url": "https://api.github.com/users/vedant15/events{/privacy}",
      "received_events_url": "https://api.github.com/users/vedant15/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2017-04-24T17:08:58Z",
    "updated_at": "2017-04-24T17:08:58Z",
    "author_association": "NONE",
    "body": "@murgatroid99 thanks a lot for the reply.\r\n\r\nThe behavior I am observing in my case is that the metadata in `response.status.metadata` is empty which in turn makes `error.metadata` empty. \r\n\r\nFirst I thought that maybe my server wasn't passing the metadata back. However on debugging further, I saw that the data was being populated in  `response.metadata` instead of `response.status.metadata`.\r\n\r\nDo I need to change the way I am reporting error from my Java Server , right now I am using the following:\r\n```\r\nresponseObserver.onError(Status.fromCodeValue(100).withDescription(\"Request for service failed\").asException(trailers));\r\n```"
  },
  {
    "url": "https://api.github.com/repos/grpc/grpc/issues/comments/296752771",
    "html_url": "https://github.com/grpc/grpc/issues/10782#issuecomment-296752771",
    "issue_url": "https://api.github.com/repos/grpc/grpc/issues/10782",
    "id": 296752771,
    "node_id": "MDEyOklzc3VlQ29tbWVudDI5Njc1Mjc3MQ==",
    "user": {
      "login": "murgatroid99",
      "id": 961599,
      "node_id": "MDQ6VXNlcjk2MTU5OQ==",
      "avatar_url": "https://avatars3.githubusercontent.com/u/961599?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/murgatroid99",
      "html_url": "https://github.com/murgatroid99",
      "followers_url": "https://api.github.com/users/murgatroid99/followers",
      "following_url": "https://api.github.com/users/murgatroid99/following{/other_user}",
      "gists_url": "https://api.github.com/users/murgatroid99/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/murgatroid99/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/murgatroid99/subscriptions",
      "organizations_url": "https://api.github.com/users/murgatroid99/orgs",
      "repos_url": "https://api.github.com/users/murgatroid99/repos",
      "events_url": "https://api.github.com/users/murgatroid99/events{/privacy}",
      "received_events_url": "https://api.github.com/users/murgatroid99/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2017-04-24T17:16:23Z",
    "updated_at": "2017-04-24T17:16:23Z",
    "author_association": "MEMBER",
    "body": "CC @ejona86 Can you weigh in on the Java side of this?"
  },
  {
    "url": "https://api.github.com/repos/grpc/grpc/issues/comments/296777871",
    "html_url": "https://github.com/grpc/grpc/issues/10782#issuecomment-296777871",
    "issue_url": "https://api.github.com/repos/grpc/grpc/issues/10782",
    "id": 296777871,
    "node_id": "MDEyOklzc3VlQ29tbWVudDI5Njc3Nzg3MQ==",
    "user": {
      "login": "ericgribkoff",
      "id": 5067076,
      "node_id": "MDQ6VXNlcjUwNjcwNzY=",
      "avatar_url": "https://avatars2.githubusercontent.com/u/5067076?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/ericgribkoff",
      "html_url": "https://github.com/ericgribkoff",
      "followers_url": "https://api.github.com/users/ericgribkoff/followers",
      "following_url": "https://api.github.com/users/ericgribkoff/following{/other_user}",
      "gists_url": "https://api.github.com/users/ericgribkoff/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/ericgribkoff/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/ericgribkoff/subscriptions",
      "organizations_url": "https://api.github.com/users/ericgribkoff/orgs",
      "repos_url": "https://api.github.com/users/ericgribkoff/repos",
      "events_url": "https://api.github.com/users/ericgribkoff/events{/privacy}",
      "received_events_url": "https://api.github.com/users/ericgribkoff/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2017-04-24T18:17:08Z",
    "updated_at": "2017-04-24T18:17:08Z",
    "author_association": "CONTRIBUTOR",
    "body": "The Java code posted will add `trailers` to the metadata returned with the error. Since it's showing up on the client in `response.metadata`, it seems like Java is propagating it as intended. \r\n\r\nWhat is the criteria for Node putting metadata into `response.status.metadata` rather than `response.metadata`?"
  },
  {
    "url": "https://api.github.com/repos/grpc/grpc/issues/comments/296779715",
    "html_url": "https://github.com/grpc/grpc/issues/10782#issuecomment-296779715",
    "issue_url": "https://api.github.com/repos/grpc/grpc/issues/10782",
    "id": 296779715,
    "node_id": "MDEyOklzc3VlQ29tbWVudDI5Njc3OTcxNQ==",
    "user": {
      "login": "ejona86",
      "id": 2811396,
      "node_id": "MDQ6VXNlcjI4MTEzOTY=",
      "avatar_url": "https://avatars2.githubusercontent.com/u/2811396?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/ejona86",
      "html_url": "https://github.com/ejona86",
      "followers_url": "https://api.github.com/users/ejona86/followers",
      "following_url": "https://api.github.com/users/ejona86/following{/other_user}",
      "gists_url": "https://api.github.com/users/ejona86/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/ejona86/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/ejona86/subscriptions",
      "organizations_url": "https://api.github.com/users/ejona86/orgs",
      "repos_url": "https://api.github.com/users/ejona86/repos",
      "events_url": "https://api.github.com/users/ejona86/events{/privacy}",
      "received_events_url": "https://api.github.com/users/ejona86/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2017-04-24T18:22:04Z",
    "updated_at": "2017-04-24T18:22:04Z",
    "author_association": "MEMBER",
    "body": "The Java code looks correct, and it does seem that `ServerCalls` [propagates the `Metadata` from the `StatusException`](https://github.com/grpc/grpc-java/blob/v1.2.0/stub/src/main/java/io/grpc/stub/ServerCalls.java#L290).\r\n\r\nI wouldn't be surprised if there was a problem with headers vs trailers. If no message was sent before the error (common), then grpc-java won't have sent headers and will only send trailers."
  },
  {
    "url": "https://api.github.com/repos/grpc/grpc/issues/comments/296783244",
    "html_url": "https://github.com/grpc/grpc/issues/10782#issuecomment-296783244",
    "issue_url": "https://api.github.com/repos/grpc/grpc/issues/10782",
    "id": 296783244,
    "node_id": "MDEyOklzc3VlQ29tbWVudDI5Njc4MzI0NA==",
    "user": {
      "login": "vedant15",
      "id": 7704737,
      "node_id": "MDQ6VXNlcjc3MDQ3Mzc=",
      "avatar_url": "https://avatars3.githubusercontent.com/u/7704737?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/vedant15",
      "html_url": "https://github.com/vedant15",
      "followers_url": "https://api.github.com/users/vedant15/followers",
      "following_url": "https://api.github.com/users/vedant15/following{/other_user}",
      "gists_url": "https://api.github.com/users/vedant15/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/vedant15/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/vedant15/subscriptions",
      "organizations_url": "https://api.github.com/users/vedant15/orgs",
      "repos_url": "https://api.github.com/users/vedant15/repos",
      "events_url": "https://api.github.com/users/vedant15/events{/privacy}",
      "received_events_url": "https://api.github.com/users/vedant15/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2017-04-24T18:33:22Z",
    "updated_at": "2017-04-24T18:33:46Z",
    "author_association": "NONE",
    "body": "I printed out the `response` object from https://github.com/murgatroid99/grpc/blob/master/src/node/src/client.js#L407 and the output was \r\n\r\n```\r\n{ \r\n  send_metadata: true,\r\n  send_message: true,\r\n  client_close: true,\r\n  metadata: { test_exception_key: [ 'test exception value' ] },\r\n  read: null,\r\n  status: { code: 2, details: 'Request for service failed', metadata: {} } \r\n}\r\n\r\n```\r\n\r\n\r\nthe `read` is set to `null`, I would assume that this means that Server didn't send any message back except for the error.  "
  },
  {
    "url": "https://api.github.com/repos/grpc/grpc/issues/comments/296798743",
    "html_url": "https://github.com/grpc/grpc/issues/10782#issuecomment-296798743",
    "issue_url": "https://api.github.com/repos/grpc/grpc/issues/10782",
    "id": 296798743,
    "node_id": "MDEyOklzc3VlQ29tbWVudDI5Njc5ODc0Mw==",
    "user": {
      "login": "ejona86",
      "id": 2811396,
      "node_id": "MDQ6VXNlcjI4MTEzOTY=",
      "avatar_url": "https://avatars2.githubusercontent.com/u/2811396?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/ejona86",
      "html_url": "https://github.com/ejona86",
      "followers_url": "https://api.github.com/users/ejona86/followers",
      "following_url": "https://api.github.com/users/ejona86/following{/other_user}",
      "gists_url": "https://api.github.com/users/ejona86/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/ejona86/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/ejona86/subscriptions",
      "organizations_url": "https://api.github.com/users/ejona86/orgs",
      "repos_url": "https://api.github.com/users/ejona86/repos",
      "events_url": "https://api.github.com/users/ejona86/events{/privacy}",
      "received_events_url": "https://api.github.com/users/ejona86/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2017-04-24T19:33:43Z",
    "updated_at": "2017-04-24T19:33:43Z",
    "author_association": "MEMBER",
    "body": "Ah, now I understand the \"status\" part of the discussion. Yeah, that looks highly-likely to me to be caused by headers vs trailers mixup."
  },
  {
    "url": "https://api.github.com/repos/grpc/grpc/issues/comments/296800056",
    "html_url": "https://github.com/grpc/grpc/issues/10782#issuecomment-296800056",
    "issue_url": "https://api.github.com/repos/grpc/grpc/issues/10782",
    "id": 296800056,
    "node_id": "MDEyOklzc3VlQ29tbWVudDI5NjgwMDA1Ng==",
    "user": {
      "login": "vedant15",
      "id": 7704737,
      "node_id": "MDQ6VXNlcjc3MDQ3Mzc=",
      "avatar_url": "https://avatars3.githubusercontent.com/u/7704737?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/vedant15",
      "html_url": "https://github.com/vedant15",
      "followers_url": "https://api.github.com/users/vedant15/followers",
      "following_url": "https://api.github.com/users/vedant15/following{/other_user}",
      "gists_url": "https://api.github.com/users/vedant15/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/vedant15/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/vedant15/subscriptions",
      "organizations_url": "https://api.github.com/users/vedant15/orgs",
      "repos_url": "https://api.github.com/users/vedant15/repos",
      "events_url": "https://api.github.com/users/vedant15/events{/privacy}",
      "received_events_url": "https://api.github.com/users/vedant15/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2017-04-24T19:39:01Z",
    "updated_at": "2017-04-24T19:39:01Z",
    "author_association": "NONE",
    "body": "@ejona86 any pointers on how I can overcome this ?\r\n\r\nI only face this issue on a node client; on a Java client the error handling works as intended. I tried it with the following snippet\r\n```\r\n     try {\r\n       response = blockingStub.getSampleResponse(request);\r\n     } catch (StatusRuntimeException e) {\r\n        System.out.println(e.getTrailers().get(Metadata.Key.of(\"test_exception_key\",Metadata.ASCII_STRING_MARSHALLER)));\r\n       logger.log(Level.WARNING, \"RPC failed: {0}\", e.getStatus());\r\n       return;\r\n     }\r\n```\r\n\r\nThanks a lot guys for your help with this !"
  },
  {
    "url": "https://api.github.com/repos/grpc/grpc/issues/comments/296817459",
    "html_url": "https://github.com/grpc/grpc/issues/10782#issuecomment-296817459",
    "issue_url": "https://api.github.com/repos/grpc/grpc/issues/10782",
    "id": 296817459,
    "node_id": "MDEyOklzc3VlQ29tbWVudDI5NjgxNzQ1OQ==",
    "user": {
      "login": "murgatroid99",
      "id": 961599,
      "node_id": "MDQ6VXNlcjk2MTU5OQ==",
      "avatar_url": "https://avatars3.githubusercontent.com/u/961599?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/murgatroid99",
      "html_url": "https://github.com/murgatroid99",
      "followers_url": "https://api.github.com/users/murgatroid99/followers",
      "following_url": "https://api.github.com/users/murgatroid99/following{/other_user}",
      "gists_url": "https://api.github.com/users/murgatroid99/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/murgatroid99/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/murgatroid99/subscriptions",
      "organizations_url": "https://api.github.com/users/murgatroid99/orgs",
      "repos_url": "https://api.github.com/users/murgatroid99/repos",
      "events_url": "https://api.github.com/users/murgatroid99/events{/privacy}",
      "received_events_url": "https://api.github.com/users/murgatroid99/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2017-04-24T20:47:18Z",
    "updated_at": "2017-04-24T20:47:18Z",
    "author_association": "MEMBER",
    "body": "It looks like there may be some difference in how Java and the C core handle trailers when there are no messages. Maybe we need an interop test for this."
  },
  {
    "url": "https://api.github.com/repos/grpc/grpc/issues/comments/296866579",
    "html_url": "https://github.com/grpc/grpc/issues/10782#issuecomment-296866579",
    "issue_url": "https://api.github.com/repos/grpc/grpc/issues/10782",
    "id": 296866579,
    "node_id": "MDEyOklzc3VlQ29tbWVudDI5Njg2NjU3OQ==",
    "user": {
      "login": "vedant15",
      "id": 7704737,
      "node_id": "MDQ6VXNlcjc3MDQ3Mzc=",
      "avatar_url": "https://avatars3.githubusercontent.com/u/7704737?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/vedant15",
      "html_url": "https://github.com/vedant15",
      "followers_url": "https://api.github.com/users/vedant15/followers",
      "following_url": "https://api.github.com/users/vedant15/following{/other_user}",
      "gists_url": "https://api.github.com/users/vedant15/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/vedant15/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/vedant15/subscriptions",
      "organizations_url": "https://api.github.com/users/vedant15/orgs",
      "repos_url": "https://api.github.com/users/vedant15/repos",
      "events_url": "https://api.github.com/users/vedant15/events{/privacy}",
      "received_events_url": "https://api.github.com/users/vedant15/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2017-04-25T01:33:53Z",
    "updated_at": "2017-04-25T01:33:53Z",
    "author_association": "NONE",
    "body": "@murgatroid99 if I am not misunderstanding, this is a limitation or an issue with the Node GRPC library, correct ?"
  },
  {
    "url": "https://api.github.com/repos/grpc/grpc/issues/comments/297145958",
    "html_url": "https://github.com/grpc/grpc/issues/10782#issuecomment-297145958",
    "issue_url": "https://api.github.com/repos/grpc/grpc/issues/10782",
    "id": 297145958,
    "node_id": "MDEyOklzc3VlQ29tbWVudDI5NzE0NTk1OA==",
    "user": {
      "login": "murgatroid99",
      "id": 961599,
      "node_id": "MDQ6VXNlcjk2MTU5OQ==",
      "avatar_url": "https://avatars3.githubusercontent.com/u/961599?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/murgatroid99",
      "html_url": "https://github.com/murgatroid99",
      "followers_url": "https://api.github.com/users/murgatroid99/followers",
      "following_url": "https://api.github.com/users/murgatroid99/following{/other_user}",
      "gists_url": "https://api.github.com/users/murgatroid99/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/murgatroid99/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/murgatroid99/subscriptions",
      "organizations_url": "https://api.github.com/users/murgatroid99/orgs",
      "repos_url": "https://api.github.com/users/murgatroid99/repos",
      "events_url": "https://api.github.com/users/murgatroid99/events{/privacy}",
      "received_events_url": "https://api.github.com/users/murgatroid99/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2017-04-25T19:54:18Z",
    "updated_at": "2017-04-25T19:54:18Z",
    "author_association": "MEMBER",
    "body": "It's a disagreement on spec implementation. If for identical responses the C core is putting the metadata into the headers and Java is putting it into the trailers, either one of them is wrong or the spec is incomplete.\r\n\r\nCC @ctiller Do you know what the deal is with this?"
  },
  {
    "url": "https://api.github.com/repos/grpc/grpc/issues/comments/470738529",
    "html_url": "https://github.com/grpc/grpc/issues/10782#issuecomment-470738529",
    "issue_url": "https://api.github.com/repos/grpc/grpc/issues/10782",
    "id": 470738529,
    "node_id": "MDEyOklzc3VlQ29tbWVudDQ3MDczODUyOQ==",
    "user": {
      "login": "shanshanzhu",
      "id": 5092813,
      "node_id": "MDQ6VXNlcjUwOTI4MTM=",
      "avatar_url": "https://avatars1.githubusercontent.com/u/5092813?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/shanshanzhu",
      "html_url": "https://github.com/shanshanzhu",
      "followers_url": "https://api.github.com/users/shanshanzhu/followers",
      "following_url": "https://api.github.com/users/shanshanzhu/following{/other_user}",
      "gists_url": "https://api.github.com/users/shanshanzhu/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/shanshanzhu/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/shanshanzhu/subscriptions",
      "organizations_url": "https://api.github.com/users/shanshanzhu/orgs",
      "repos_url": "https://api.github.com/users/shanshanzhu/repos",
      "events_url": "https://api.github.com/users/shanshanzhu/events{/privacy}",
      "received_events_url": "https://api.github.com/users/shanshanzhu/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2019-03-07T23:10:11Z",
    "updated_at": "2019-03-07T23:31:33Z",
    "author_association": "NONE",
    "body": "Our Go service send the header in trailer as well, I found that the header is emitted from the status event.\r\n\r\n```\r\n    const call = client.helloworld(request, meta,{}, () => {}); // pseudocode.\r\n    call.on('status', status => {\r\n      if (status.code === StatusCode.OK) {\r\n        console.log('status.metadata.get('<HEADER KEY SET IN TRAILER'));\r\n      }\r\n    });\r\n```\r\n\r\nThere is a handleTrailer callback added in call-stream.ts, which propagate to emit the `status` event after trailer header is received.\r\n\r\nIt would be nice if the status can be passed to the callback\r\nhttps://github.com/grpc/grpc-node/blob/master/packages/grpc-js/src/client.ts#L111\r\n```\r\ncallback(null, responseMessage as ResponseType);\r\n```\r\n can be changed to:\r\n```\r\ncallback(null, responseMessage as ResponseType, status);\r\n```\r\n"
  }
]
