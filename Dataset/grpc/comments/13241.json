[
  {
    "url": "https://api.github.com/repos/grpc/grpc/issues/comments/341544129",
    "html_url": "https://github.com/grpc/grpc/issues/13241#issuecomment-341544129",
    "issue_url": "https://api.github.com/repos/grpc/grpc/issues/13241",
    "id": 341544129,
    "node_id": "MDEyOklzc3VlQ29tbWVudDM0MTU0NDEyOQ==",
    "user": {
      "login": "murgatroid99",
      "id": 961599,
      "node_id": "MDQ6VXNlcjk2MTU5OQ==",
      "avatar_url": "https://avatars3.githubusercontent.com/u/961599?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/murgatroid99",
      "html_url": "https://github.com/murgatroid99",
      "followers_url": "https://api.github.com/users/murgatroid99/followers",
      "following_url": "https://api.github.com/users/murgatroid99/following{/other_user}",
      "gists_url": "https://api.github.com/users/murgatroid99/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/murgatroid99/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/murgatroid99/subscriptions",
      "organizations_url": "https://api.github.com/users/murgatroid99/orgs",
      "repos_url": "https://api.github.com/users/murgatroid99/repos",
      "events_url": "https://api.github.com/users/murgatroid99/events{/privacy}",
      "received_events_url": "https://api.github.com/users/murgatroid99/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2017-11-02T20:13:26Z",
    "updated_at": "2017-11-02T20:13:26Z",
    "author_association": "MEMBER",
    "body": "This is bizarre. The package `node-pre-gyp` is bundled with grpc specifically to avoid the first problem you're encountering. The download failure indicates to me that something else is going wrong, though. You mention that you can download the file manually, which means that the failure is not network related, so it must be somehow caused by your local machine. Unfortunately, it's not outputting any useful information about the error, which is probably a bug in node-pre-gyp."
  },
  {
    "url": "https://api.github.com/repos/grpc/grpc/issues/comments/341567191",
    "html_url": "https://github.com/grpc/grpc/issues/13241#issuecomment-341567191",
    "issue_url": "https://api.github.com/repos/grpc/grpc/issues/13241",
    "id": 341567191,
    "node_id": "MDEyOklzc3VlQ29tbWVudDM0MTU2NzE5MQ==",
    "user": {
      "login": "adamdaugherty",
      "id": 1966092,
      "node_id": "MDQ6VXNlcjE5NjYwOTI=",
      "avatar_url": "https://avatars0.githubusercontent.com/u/1966092?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/adamdaugherty",
      "html_url": "https://github.com/adamdaugherty",
      "followers_url": "https://api.github.com/users/adamdaugherty/followers",
      "following_url": "https://api.github.com/users/adamdaugherty/following{/other_user}",
      "gists_url": "https://api.github.com/users/adamdaugherty/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/adamdaugherty/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/adamdaugherty/subscriptions",
      "organizations_url": "https://api.github.com/users/adamdaugherty/orgs",
      "repos_url": "https://api.github.com/users/adamdaugherty/repos",
      "events_url": "https://api.github.com/users/adamdaugherty/events{/privacy}",
      "received_events_url": "https://api.github.com/users/adamdaugherty/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2017-11-02T21:43:17Z",
    "updated_at": "2017-11-02T21:43:17Z",
    "author_association": "NONE",
    "body": "The `sh: node-pre-gyp: command not found` makes me suspect that you're right in that the problem is on the `node-pre-gyp` side.\r\n\r\nAfter noodling with it a bit, I was able to get `grpc` to successfully install (I think, anyway - I haven't actually tested anything with it yet, but it's not falling over in an obvious way anymore). **It is a hacky, terrible long-term solution for a variety of reasons that should not be used by anyone.** I'm only including it here in case it's diagnostically useful.\r\n\r\nMy `package.json` looks like:\r\n\r\n```\r\n{\r\n  \"dependencies\": {\r\n    \"grpc\": \"^1.7.0\",\r\n    \"node-pre-gyp\": \"^0.6.39\"\r\n  },\r\n  \"scripts\": {\r\n    \"screaming\": \"cd node_modules/grpc && node-pre-gyp install --fallback-to-build --library=static_library\"\r\n  }\r\n}\r\n```\r\n\r\nRunning `npm install --ignore-scripts` will install `grpc` without executing the problematic `install` lifecycle hook. After the install, `npm run screaming` will fire up `node-pre-gyp` in the expected way, which seems to succeed:\r\n\r\n```\r\n# npm run screaming\r\n\r\n> @ screaming /root/api-testing\r\n> cd node_modules/grpc && node-pre-gyp install --fallback-to-build --library=static_library\r\n\r\n[grpc] Success: \"/root/api-testing/node_modules/grpc/src/node/extension_binary/node-v57-linux-x64/grpc_node.node\" is installed via remote\r\n```\r\n\r\nI am assuming that's the expected happy behavior."
  },
  {
    "url": "https://api.github.com/repos/grpc/grpc/issues/comments/341569476",
    "html_url": "https://github.com/grpc/grpc/issues/13241#issuecomment-341569476",
    "issue_url": "https://api.github.com/repos/grpc/grpc/issues/13241",
    "id": 341569476,
    "node_id": "MDEyOklzc3VlQ29tbWVudDM0MTU2OTQ3Ng==",
    "user": {
      "login": "murgatroid99",
      "id": 961599,
      "node_id": "MDQ6VXNlcjk2MTU5OQ==",
      "avatar_url": "https://avatars3.githubusercontent.com/u/961599?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/murgatroid99",
      "html_url": "https://github.com/murgatroid99",
      "followers_url": "https://api.github.com/users/murgatroid99/followers",
      "following_url": "https://api.github.com/users/murgatroid99/following{/other_user}",
      "gists_url": "https://api.github.com/users/murgatroid99/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/murgatroid99/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/murgatroid99/subscriptions",
      "organizations_url": "https://api.github.com/users/murgatroid99/orgs",
      "repos_url": "https://api.github.com/users/murgatroid99/repos",
      "events_url": "https://api.github.com/users/murgatroid99/events{/privacy}",
      "received_events_url": "https://api.github.com/users/murgatroid99/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2017-11-02T21:52:59Z",
    "updated_at": "2017-11-02T21:52:59Z",
    "author_association": "MEMBER",
    "body": "That is the expected behavior. Have you tried having that script there without having your own explicit dependency on `node-pre-gyp`? I suspect that that script is running the copy of `node-pre-gyp` bundled with grpc anyway. It seems bizarre that that script would work, but the nearly identical install script wouldn't work. That makes me think that npm is doing something weird during the installation.\r\n\r\nAlso, I want to note that I think the primary issue with `node-pre-gyp` here is missing error information. The original error you reported happened before any `node-pre-gyp` code even started executing."
  },
  {
    "url": "https://api.github.com/repos/grpc/grpc/issues/comments/341576447",
    "html_url": "https://github.com/grpc/grpc/issues/13241#issuecomment-341576447",
    "issue_url": "https://api.github.com/repos/grpc/grpc/issues/13241",
    "id": 341576447,
    "node_id": "MDEyOklzc3VlQ29tbWVudDM0MTU3NjQ0Nw==",
    "user": {
      "login": "adamdaugherty",
      "id": 1966092,
      "node_id": "MDQ6VXNlcjE5NjYwOTI=",
      "avatar_url": "https://avatars0.githubusercontent.com/u/1966092?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/adamdaugherty",
      "html_url": "https://github.com/adamdaugherty",
      "followers_url": "https://api.github.com/users/adamdaugherty/followers",
      "following_url": "https://api.github.com/users/adamdaugherty/following{/other_user}",
      "gists_url": "https://api.github.com/users/adamdaugherty/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/adamdaugherty/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/adamdaugherty/subscriptions",
      "organizations_url": "https://api.github.com/users/adamdaugherty/orgs",
      "repos_url": "https://api.github.com/users/adamdaugherty/repos",
      "events_url": "https://api.github.com/users/adamdaugherty/events{/privacy}",
      "received_events_url": "https://api.github.com/users/adamdaugherty/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2017-11-02T22:25:57Z",
    "updated_at": "2017-11-02T22:25:57Z",
    "author_association": "NONE",
    "body": "My mistake, I thought the `sh: ...` line was being emitted by `node-pre-gyp`, not npm. After testing with a local dummy library with a busted post-install script, I see that that's normal output for npm under that condition. The output is different with a broken script in the current module's scripts, which is why I was confused.\r\n\r\nIf the `node-pre-gyp` dependency is removed and `npm run screaming` is executed, then the install fails and gives the same output as the first case mentioned above. This makes sense, since the `screaming` npm script is running in the npm context of my app (with my app's `node_modules/.bin` in its path), not the context of the `node_modules/grpc` directory (`node_modules/grpc/.bin`), even though it's being used as the cwd.\r\n\r\nTo do what you suggest, if I remove the `node-pre-gyp` dependency and change `screaming` to be `cd node_modules/grpc && npm run install`, installation succeeds when I run it the same way (first `npm install --ignore-scripts` and then `npm run screaming`)."
  }
]
