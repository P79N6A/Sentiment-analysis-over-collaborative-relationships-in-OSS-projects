[
  {
    "url": "https://api.github.com/repos/grpc/grpc/issues/comments/284810573",
    "html_url": "https://github.com/grpc/grpc/issues/10002#issuecomment-284810573",
    "issue_url": "https://api.github.com/repos/grpc/grpc/issues/10002",
    "id": 284810573,
    "node_id": "MDEyOklzc3VlQ29tbWVudDI4NDgxMDU3Mw==",
    "user": {
      "login": "yang-g",
      "id": 10122250,
      "node_id": "MDQ6VXNlcjEwMTIyMjUw",
      "avatar_url": "https://avatars0.githubusercontent.com/u/10122250?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/yang-g",
      "html_url": "https://github.com/yang-g",
      "followers_url": "https://api.github.com/users/yang-g/followers",
      "following_url": "https://api.github.com/users/yang-g/following{/other_user}",
      "gists_url": "https://api.github.com/users/yang-g/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/yang-g/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/yang-g/subscriptions",
      "organizations_url": "https://api.github.com/users/yang-g/orgs",
      "repos_url": "https://api.github.com/users/yang-g/repos",
      "events_url": "https://api.github.com/users/yang-g/events{/privacy}",
      "received_events_url": "https://api.github.com/users/yang-g/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2017-03-07T18:22:21Z",
    "updated_at": "2017-03-07T18:22:21Z",
    "author_association": "MEMBER",
    "body": "I am able to repro locally."
  },
  {
    "url": "https://api.github.com/repos/grpc/grpc/issues/comments/284818569",
    "html_url": "https://github.com/grpc/grpc/issues/10002#issuecomment-284818569",
    "issue_url": "https://api.github.com/repos/grpc/grpc/issues/10002",
    "id": 284818569,
    "node_id": "MDEyOklzc3VlQ29tbWVudDI4NDgxODU2OQ==",
    "user": {
      "login": "yang-g",
      "id": 10122250,
      "node_id": "MDQ6VXNlcjEwMTIyMjUw",
      "avatar_url": "https://avatars0.githubusercontent.com/u/10122250?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/yang-g",
      "html_url": "https://github.com/yang-g",
      "followers_url": "https://api.github.com/users/yang-g/followers",
      "following_url": "https://api.github.com/users/yang-g/following{/other_user}",
      "gists_url": "https://api.github.com/users/yang-g/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/yang-g/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/yang-g/subscriptions",
      "organizations_url": "https://api.github.com/users/yang-g/orgs",
      "repos_url": "https://api.github.com/users/yang-g/repos",
      "events_url": "https://api.github.com/users/yang-g/events{/privacy}",
      "received_events_url": "https://api.github.com/users/yang-g/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2017-03-07T18:50:14Z",
    "updated_at": "2017-03-07T18:50:14Z",
    "author_association": "MEMBER",
    "body": "No I cannot...\r\nI was able to see logs of failed accept4, but have not repro the assertion failure... Running two terminals with dbg/opt build in loops for a while now..."
  },
  {
    "url": "https://api.github.com/repos/grpc/grpc/issues/comments/284842755",
    "html_url": "https://github.com/grpc/grpc/issues/10002#issuecomment-284842755",
    "issue_url": "https://api.github.com/repos/grpc/grpc/issues/10002",
    "id": 284842755,
    "node_id": "MDEyOklzc3VlQ29tbWVudDI4NDg0Mjc1NQ==",
    "user": {
      "login": "yang-g",
      "id": 10122250,
      "node_id": "MDQ6VXNlcjEwMTIyMjUw",
      "avatar_url": "https://avatars0.githubusercontent.com/u/10122250?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/yang-g",
      "html_url": "https://github.com/yang-g",
      "followers_url": "https://api.github.com/users/yang-g/followers",
      "following_url": "https://api.github.com/users/yang-g/following{/other_user}",
      "gists_url": "https://api.github.com/users/yang-g/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/yang-g/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/yang-g/subscriptions",
      "organizations_url": "https://api.github.com/users/yang-g/orgs",
      "repos_url": "https://api.github.com/users/yang-g/repos",
      "events_url": "https://api.github.com/users/yang-g/events{/privacy}",
      "received_events_url": "https://api.github.com/users/yang-g/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2017-03-07T20:05:47Z",
    "updated_at": "2017-03-07T20:05:47Z",
    "author_association": "MEMBER",
    "body": "Still cannot repro, but here is a guess of what happens by eyeballing the code. The direct cause is that we call fd_orphan on the same fd twice, which is because deactivated_all_ports is run out of the lock.\r\n\r\nOne possible sequence of repro:\r\n\r\nT1 in on_read with a accept4 failure or error, it will decrease s->active_ports to 0 under server lock, it releases the lock\r\nT2 in tcp_server_destroy, it acquires the server lock, sets s->shutdown to true, checks s->active_ports is 0, releases the lock\r\nT1 continues into deactived_all_ports, acquires the server lock, check s->shutdown to true and then orphans all fd's, each fd's refcount is now 0, it then releases the lock\r\nT2 continues in tcp_server_destroy and enters deactived_all_ports again, it will orphan all fd's again, then it triggers the assertion failure as the fd refcount is 0 when trying to ref.\r\n\r\nOne way to fix it would be to add a boolean to server to indicate we have orphaned all the fds.\r\n"
  },
  {
    "url": "https://api.github.com/repos/grpc/grpc/issues/comments/287145207",
    "html_url": "https://github.com/grpc/grpc/issues/10002#issuecomment-287145207",
    "issue_url": "https://api.github.com/repos/grpc/grpc/issues/10002",
    "id": 287145207,
    "node_id": "MDEyOklzc3VlQ29tbWVudDI4NzE0NTIwNw==",
    "user": {
      "login": "yang-g",
      "id": 10122250,
      "node_id": "MDQ6VXNlcjEwMTIyMjUw",
      "avatar_url": "https://avatars0.githubusercontent.com/u/10122250?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/yang-g",
      "html_url": "https://github.com/yang-g",
      "followers_url": "https://api.github.com/users/yang-g/followers",
      "following_url": "https://api.github.com/users/yang-g/following{/other_user}",
      "gists_url": "https://api.github.com/users/yang-g/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/yang-g/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/yang-g/subscriptions",
      "organizations_url": "https://api.github.com/users/yang-g/orgs",
      "repos_url": "https://api.github.com/users/yang-g/repos",
      "events_url": "https://api.github.com/users/yang-g/events{/privacy}",
      "received_events_url": "https://api.github.com/users/yang-g/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2017-03-16T18:12:02Z",
    "updated_at": "2017-03-16T18:12:02Z",
    "author_association": "MEMBER",
    "body": "Considered fixed."
  }
]
