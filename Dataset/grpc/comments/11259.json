[
  {
    "url": "https://api.github.com/repos/grpc/grpc/issues/comments/394557739",
    "html_url": "https://github.com/grpc/grpc/issues/11259#issuecomment-394557739",
    "issue_url": "https://api.github.com/repos/grpc/grpc/issues/11259",
    "id": 394557739,
    "node_id": "MDEyOklzc3VlQ29tbWVudDM5NDU1NzczOQ==",
    "user": {
      "login": "sreecha",
      "id": 2754995,
      "node_id": "MDQ6VXNlcjI3NTQ5OTU=",
      "avatar_url": "https://avatars1.githubusercontent.com/u/2754995?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/sreecha",
      "html_url": "https://github.com/sreecha",
      "followers_url": "https://api.github.com/users/sreecha/followers",
      "following_url": "https://api.github.com/users/sreecha/following{/other_user}",
      "gists_url": "https://api.github.com/users/sreecha/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/sreecha/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/sreecha/subscriptions",
      "organizations_url": "https://api.github.com/users/sreecha/orgs",
      "repos_url": "https://api.github.com/users/sreecha/repos",
      "events_url": "https://api.github.com/users/sreecha/events{/privacy}",
      "received_events_url": "https://api.github.com/users/sreecha/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2018-06-05T02:10:24Z",
    "updated_at": "2018-06-05T02:10:24Z",
    "author_association": "CONTRIBUTOR",
    "body": "`tcp_continue_thread` is not thread safe.  The general read workflow is like this:\r\n\r\n- Transport calls `grpc_endpoint_read` - and for TCP endpoint, that translates to the `tcp_read()` function.\r\n- The very first time `tcp_read()` registers a callback (`notify_on_read()` is the function that registers with polling engine - and the callback is `tcp_handle_read()`) with the polling engine whenever the fd has some bytes to read.\r\n- When the fd becomes readable, the polling engine calls `tcp_handle_read()`, which calls `tcp_continue_read()` which calls `tcp_do_read()`. \r\n- `tcp_do_read()` actually reads bytes from the socket (via `recvmsg()` syscall) and after it reads whatever it could, it invokes the endpoint read-completion callback (i.e `tcp->read_cb`).\r\n   -- If `recvmsg()` syscall returned EAGAIN, `tcp_do_read()` calls `notify_on_read()` to register the callback `tcp_handle_read()` with the polling engine (to be called whenever the fd becomes readable again). In this case, the `tcp_do_read()` function **does NOT** call `tcp->read_cb` since no bytes are read yet.\r\n\r\n---\r\n- The transport should call `grpc_endpoint_read()` again to read more bytes ONLY AFTER the callback `tcp->read_cb` was called without an error (i.e some bytes were read successfully and it wants to read more bytes). \r\n--\r\n\r\nSo, it is clear from the above that none of the above functions can be called in parallel by two different threads.\r\n"
  },
  {
    "url": "https://api.github.com/repos/grpc/grpc/issues/comments/394557819",
    "html_url": "https://github.com/grpc/grpc/issues/11259#issuecomment-394557819",
    "issue_url": "https://api.github.com/repos/grpc/grpc/issues/11259",
    "id": 394557819,
    "node_id": "MDEyOklzc3VlQ29tbWVudDM5NDU1NzgxOQ==",
    "user": {
      "login": "sreecha",
      "id": 2754995,
      "node_id": "MDQ6VXNlcjI3NTQ5OTU=",
      "avatar_url": "https://avatars1.githubusercontent.com/u/2754995?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/sreecha",
      "html_url": "https://github.com/sreecha",
      "followers_url": "https://api.github.com/users/sreecha/followers",
      "following_url": "https://api.github.com/users/sreecha/following{/other_user}",
      "gists_url": "https://api.github.com/users/sreecha/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/sreecha/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/sreecha/subscriptions",
      "organizations_url": "https://api.github.com/users/sreecha/orgs",
      "repos_url": "https://api.github.com/users/sreecha/repos",
      "events_url": "https://api.github.com/users/sreecha/events{/privacy}",
      "received_events_url": "https://api.github.com/users/sreecha/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2018-06-05T02:11:00Z",
    "updated_at": "2018-06-05T02:11:00Z",
    "author_association": "CONTRIBUTOR",
    "body": "I also created a PR https://github.com/grpc/grpc/pull/15634 to renamed `tcp->finished_edge`. That is a confusing name. "
  }
]
