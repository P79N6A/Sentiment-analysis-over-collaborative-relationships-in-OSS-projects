[
  {
    "url": "https://api.github.com/repos/grpc/grpc/issues/comments/381207122",
    "html_url": "https://github.com/grpc/grpc/pull/15051#issuecomment-381207122",
    "issue_url": "https://api.github.com/repos/grpc/grpc/issues/15051",
    "id": 381207122,
    "node_id": "MDEyOklzc3VlQ29tbWVudDM4MTIwNzEyMg==",
    "user": {
      "login": "ZhouyihaiDing",
      "id": 28968539,
      "node_id": "MDQ6VXNlcjI4OTY4NTM5",
      "avatar_url": "https://avatars3.githubusercontent.com/u/28968539?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/ZhouyihaiDing",
      "html_url": "https://github.com/ZhouyihaiDing",
      "followers_url": "https://api.github.com/users/ZhouyihaiDing/followers",
      "following_url": "https://api.github.com/users/ZhouyihaiDing/following{/other_user}",
      "gists_url": "https://api.github.com/users/ZhouyihaiDing/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/ZhouyihaiDing/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/ZhouyihaiDing/subscriptions",
      "organizations_url": "https://api.github.com/users/ZhouyihaiDing/orgs",
      "repos_url": "https://api.github.com/users/ZhouyihaiDing/repos",
      "events_url": "https://api.github.com/users/ZhouyihaiDing/events{/privacy}",
      "received_events_url": "https://api.github.com/users/ZhouyihaiDing/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2018-04-13T17:31:44Z",
    "updated_at": "2018-04-13T17:32:56Z",
    "author_association": "CONTRIBUTOR",
    "body": "In this PR, the `Channel->close()` only minus ref_cound with 1 if it is persisted. However, Since if the Channel calls close(), the stub doesn't know it, the stub can still call functions like getTarget or make calls. The stub who own this Channel should be invalid. There are two ways to do this:\r\n1. Add a method to Channel calls `isValid`, which returns this Channel is closed or not. And then check the Channel status every time in the stub level. For example:\r\n```\r\nprotected function clientStreamRequest(){\r\n  if (!$this->channel->isValid()) {\r\n    throw new \\RuntimeException(\"The Channel of this stub is closed.\").\r\n  }\r\n}\r\n```\r\n2. Add the channel into the call structure, and check it each time in the `startBatch` function:\r\n```\r\nPHP_GRPC_WRAP_OBJECT_START(wrapped_grpc_call)\r\n  bool owned;\r\n  grpc_call *wrapped;\r\n  wrapped_grpc_channel *channel;\r\nPHP_GRPC_WRAP_OBJECT_END(wrapped_grpc_call)\r\n\r\nPHP_METHOD(Call, startBatch) {\r\n  wrapped_grpc_call *call = Z_WRAPPED_GRPC_CALL_P(getThis());\r\n  if(call->channel->isValid) {\r\n    // throw exception.\r\n  }\r\n}\r\n```\r\n"
  },
  {
    "url": "https://api.github.com/repos/grpc/grpc/issues/comments/384771722",
    "html_url": "https://github.com/grpc/grpc/pull/15051#issuecomment-384771722",
    "issue_url": "https://api.github.com/repos/grpc/grpc/issues/15051",
    "id": 384771722,
    "node_id": "MDEyOklzc3VlQ29tbWVudDM4NDc3MTcyMg==",
    "user": {
      "login": "ZhouyihaiDing",
      "id": 28968539,
      "node_id": "MDQ6VXNlcjI4OTY4NTM5",
      "avatar_url": "https://avatars3.githubusercontent.com/u/28968539?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/ZhouyihaiDing",
      "html_url": "https://github.com/ZhouyihaiDing",
      "followers_url": "https://api.github.com/users/ZhouyihaiDing/followers",
      "following_url": "https://api.github.com/users/ZhouyihaiDing/following{/other_user}",
      "gists_url": "https://api.github.com/users/ZhouyihaiDing/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/ZhouyihaiDing/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/ZhouyihaiDing/subscriptions",
      "organizations_url": "https://api.github.com/users/ZhouyihaiDing/orgs",
      "repos_url": "https://api.github.com/users/ZhouyihaiDing/repos",
      "events_url": "https://api.github.com/users/ZhouyihaiDing/events{/privacy}",
      "received_events_url": "https://api.github.com/users/ZhouyihaiDing/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2018-04-26T20:03:52Z",
    "updated_at": "2018-04-26T20:05:29Z",
    "author_association": "CONTRIBUTOR",
    "body": "Update.\r\n\r\nThis PR only changes the behavior that when `$channal_A` and `$channel_B` shares the same channel, close `$channel_A` only disable itself without influence `$channel_B`.\r\n\r\nIt is done by adding a '`is_valid`' to `wrapped_grpc_channel`, and check it inside every methods, including `startBatch` from call method. There are other things added into the `wrapped_grpc_channel` and `grpc_channel_wrapper` which is used to free the memory. Please see the commend inside `channel.h` and `call.h`.\r\n\r\nSplit `testPersistentChannelForceNewOldChannelClose` into 2 tests to exclude the possibility that the exception is thrown not by desired method."
  },
  {
    "url": "https://api.github.com/repos/grpc/grpc/issues/comments/395131542",
    "html_url": "https://github.com/grpc/grpc/pull/15051#issuecomment-395131542",
    "issue_url": "https://api.github.com/repos/grpc/grpc/issues/15051",
    "id": 395131542,
    "node_id": "MDEyOklzc3VlQ29tbWVudDM5NTEzMTU0Mg==",
    "user": {
      "login": "ZhouyihaiDing",
      "id": 28968539,
      "node_id": "MDQ6VXNlcjI4OTY4NTM5",
      "avatar_url": "https://avatars3.githubusercontent.com/u/28968539?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/ZhouyihaiDing",
      "html_url": "https://github.com/ZhouyihaiDing",
      "followers_url": "https://api.github.com/users/ZhouyihaiDing/followers",
      "following_url": "https://api.github.com/users/ZhouyihaiDing/following{/other_user}",
      "gists_url": "https://api.github.com/users/ZhouyihaiDing/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/ZhouyihaiDing/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/ZhouyihaiDing/subscriptions",
      "organizations_url": "https://api.github.com/users/ZhouyihaiDing/orgs",
      "repos_url": "https://api.github.com/users/ZhouyihaiDing/repos",
      "events_url": "https://api.github.com/users/ZhouyihaiDing/events{/privacy}",
      "received_events_url": "https://api.github.com/users/ZhouyihaiDing/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2018-06-06T16:29:39Z",
    "updated_at": "2018-06-06T16:29:39Z",
    "author_association": "CONTRIBUTOR",
    "body": "Close it because this commit is merged as part of #15218"
  }
]
