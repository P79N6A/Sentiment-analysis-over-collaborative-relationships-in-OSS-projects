[
  {
    "url": "https://api.github.com/repos/grpc/grpc/issues/comments/128878637",
    "html_url": "https://github.com/grpc/grpc/pull/2847#issuecomment-128878637",
    "issue_url": "https://api.github.com/repos/grpc/grpc/issues/2847",
    "id": 128878637,
    "node_id": "MDEyOklzc3VlQ29tbWVudDEyODg3ODYzNw==",
    "user": {
      "login": "jcanizales",
      "id": 5120183,
      "node_id": "MDQ6VXNlcjUxMjAxODM=",
      "avatar_url": "https://avatars0.githubusercontent.com/u/5120183?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/jcanizales",
      "html_url": "https://github.com/jcanizales",
      "followers_url": "https://api.github.com/users/jcanizales/followers",
      "following_url": "https://api.github.com/users/jcanizales/following{/other_user}",
      "gists_url": "https://api.github.com/users/jcanizales/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/jcanizales/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/jcanizales/subscriptions",
      "organizations_url": "https://api.github.com/users/jcanizales/orgs",
      "repos_url": "https://api.github.com/users/jcanizales/repos",
      "events_url": "https://api.github.com/users/jcanizales/events{/privacy}",
      "received_events_url": "https://api.github.com/users/jcanizales/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2015-08-08T01:16:08Z",
    "updated_at": "2015-08-08T01:18:32Z",
    "author_association": "CONTRIBUTOR",
    "body": "Let's clarify here the details of these error cases so that (1) we make sure the choice of status code and message is appropriate, and (2) we can later incorporate it into our documentation. I'm guessing, so please edit anything that's wrong or incomplete:\n- [Unauthenticated: \"Credentials failed to get metadata\"](https://github.com/jboeuf/grpc/blob/client_auth_filter_error_handling/src/core/security/client_auth_filter.c#L97)\n  - **Cause:** This call used a credentials object that needs to add some headers, but the object wasn't able to produce them.\n  - **Is it a client bug?** No, this can happen e.g. if there's a network error when trying to refresh an OAuth2 access token. _Can a client bug cause this when using the types of credentials we're shipping?_\n  - **How should the client handle it?** Retry the call with exponential back-off. _There is actually no problem with the credentials provided?_\n- [Invalid Argument: \"Incompatible credentials set on channel and call.\"](https://github.com/jboeuf/grpc/blob/client_auth_filter_error_handling/src/core/security/client_auth_filter.c#L158)\n  - **Cause:** The channel was created with a set of credentials (via `grpc_secure_channel_create`); the call, with an additional set of credentials (via `grpc_call_set_credentials`). At least one of those sets needs to be \"headers-only\", and it wasn't the case. _But then, why do we allow users to attach credentials that aren't headers-only to a call? And what happens if e.g. I attach SSL credentials to a call that was created from a cleartext channel?_\n  - **Is it a client bug?** Yes.\n  - **How should the client prevent it?** _(Depends on the clarification of the above.)_\n- [Failed Precondition: \"Invalid host set in :authority metadata\"](https://github.com/jboeuf/grpc/blob/client_auth_filter_error_handling/src/core/security/client_auth_filter.c#L186)\n  - **Cause:** The server refuses to serve calls with the passed `:authority` value. _Can this still happen if one follows the preventive steps below?_ \n  - **Is it a client bug?** Yes.\n  - **How should the client prevent it?** Pass `NULL` as `host` to `grpc_channel_create_call` or `grpc_channel_register_call`. If you're connecting to a test server, be sure to use as `:authority` the SSL name override expected by the server (e.g. by setting it as the default `:authority` for the channel). _Otherwise?_\n- [Failed Precondition: \"Invalid host set in :authority metadata\"](https://github.com/jboeuf/grpc/blob/client_auth_filter_error_handling/src/core/security/client_auth_filter.c#L256)\n  - _Same situation as above? If so, should the source code be deduplicated into a same function?_\n"
  },
  {
    "url": "https://api.github.com/repos/grpc/grpc/issues/comments/129725284",
    "html_url": "https://github.com/grpc/grpc/pull/2847#issuecomment-129725284",
    "issue_url": "https://api.github.com/repos/grpc/grpc/issues/2847",
    "id": 129725284,
    "node_id": "MDEyOklzc3VlQ29tbWVudDEyOTcyNTI4NA==",
    "user": {
      "login": "jboeuf",
      "id": 6262765,
      "node_id": "MDQ6VXNlcjYyNjI3NjU=",
      "avatar_url": "https://avatars1.githubusercontent.com/u/6262765?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/jboeuf",
      "html_url": "https://github.com/jboeuf",
      "followers_url": "https://api.github.com/users/jboeuf/followers",
      "following_url": "https://api.github.com/users/jboeuf/following{/other_user}",
      "gists_url": "https://api.github.com/users/jboeuf/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/jboeuf/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/jboeuf/subscriptions",
      "organizations_url": "https://api.github.com/users/jboeuf/orgs",
      "repos_url": "https://api.github.com/users/jboeuf/repos",
      "events_url": "https://api.github.com/users/jboeuf/events{/privacy}",
      "received_events_url": "https://api.github.com/users/jboeuf/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2015-08-11T06:32:03Z",
    "updated_at": "2015-08-11T06:32:03Z",
    "author_association": "CONTRIBUTOR",
    "body": "Sorry for the delay and thanks much for the very thorough feedback: doc looks great. Here are a few points of clarification.\n- _Unauthenticated_: This also can happen if the refresh token is expired or just parses ok but is actually not valid anymore (has been revoked). Same thing for service accounts credentials where the key to sign the JWT has been revoked as well. Maybe I could try to have a better credentials status to map it to a more specific grpc status.\n- _Invalid argument_: \n  - We do not allow users to attach credentials that are not header-only to a call: `grpc_call_set_credentials` would return an error in this case.\n- _Failed Precondition_: The 2 code paths are actually the same error handling: one for the sync version of the call to `grpc_channel_security_connector_check_call_host` and one from the async version. I could probably simplify this function and just have an async version.\n"
  },
  {
    "url": "https://api.github.com/repos/grpc/grpc/issues/comments/130082214",
    "html_url": "https://github.com/grpc/grpc/pull/2847#issuecomment-130082214",
    "issue_url": "https://api.github.com/repos/grpc/grpc/issues/2847",
    "id": 130082214,
    "node_id": "MDEyOklzc3VlQ29tbWVudDEzMDA4MjIxNA==",
    "user": {
      "login": "jcanizales",
      "id": 5120183,
      "node_id": "MDQ6VXNlcjUxMjAxODM=",
      "avatar_url": "https://avatars0.githubusercontent.com/u/5120183?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/jcanizales",
      "html_url": "https://github.com/jcanizales",
      "followers_url": "https://api.github.com/users/jcanizales/followers",
      "following_url": "https://api.github.com/users/jcanizales/following{/other_user}",
      "gists_url": "https://api.github.com/users/jcanizales/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/jcanizales/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/jcanizales/subscriptions",
      "organizations_url": "https://api.github.com/users/jcanizales/orgs",
      "repos_url": "https://api.github.com/users/jcanizales/repos",
      "events_url": "https://api.github.com/users/jcanizales/events{/privacy}",
      "received_events_url": "https://api.github.com/users/jcanizales/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2015-08-11T21:23:53Z",
    "updated_at": "2015-08-11T21:23:53Z",
    "author_association": "CONTRIBUTOR",
    "body": "CC: @tbetbetbe @ejona86 \n"
  },
  {
    "url": "https://api.github.com/repos/grpc/grpc/issues/comments/130110358",
    "html_url": "https://github.com/grpc/grpc/pull/2847#issuecomment-130110358",
    "issue_url": "https://api.github.com/repos/grpc/grpc/issues/2847",
    "id": 130110358,
    "node_id": "MDEyOklzc3VlQ29tbWVudDEzMDExMDM1OA==",
    "user": {
      "login": "jcanizales",
      "id": 5120183,
      "node_id": "MDQ6VXNlcjUxMjAxODM=",
      "avatar_url": "https://avatars0.githubusercontent.com/u/5120183?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/jcanizales",
      "html_url": "https://github.com/jcanizales",
      "followers_url": "https://api.github.com/users/jcanizales/followers",
      "following_url": "https://api.github.com/users/jcanizales/following{/other_user}",
      "gists_url": "https://api.github.com/users/jcanizales/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/jcanizales/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/jcanizales/subscriptions",
      "organizations_url": "https://api.github.com/users/jcanizales/orgs",
      "repos_url": "https://api.github.com/users/jcanizales/repos",
      "events_url": "https://api.github.com/users/jcanizales/events{/privacy}",
      "received_events_url": "https://api.github.com/users/jcanizales/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2015-08-11T23:28:09Z",
    "updated_at": "2015-08-11T23:28:09Z",
    "author_association": "CONTRIBUTOR",
    "body": "Let's double-check I understood correctly:\n1. [Unauthenticated: \"Credentials failed to get metadata\"](https://github.com/jboeuf/grpc/blob/client_auth_filter_error_handling/src/core/security/client_auth_filter.c#L97)\n   - **Cause:** This call used a credentials object that needs to add some headers, but the object wasn't able to produce them. Either because the auth server couldn't be reached, or because the stored credentials aren't valid anymore.\n   - **Is it a client bug?** No.\n   - **How should the client handle it?** Reauthenticate.\n2. [Invalid Argument: \"Incompatible credentials set on channel and call.\"](https://github.com/jboeuf/grpc/blob/client_auth_filter_error_handling/src/core/security/client_auth_filter.c#L158)\n   - **Cause:** The channel was created with a set of credentials (via `grpc_secure_channel_create`); the call, with an additional set of credentials (via `grpc_call_set_credentials`). Both sets will try to set the same header.\n   - **Is it a client bug?** Yes.\n   - **How should the client prevent it?** Each credential type will document which other types it is incompatible with.\n3. [Invalid Argument: \"Invalid host set in :authority metadata\"](https://github.com/jboeuf/grpc/blob/client_auth_filter_error_handling/src/core/security/client_auth_filter.c#L186) ([also here](https://github.com/jboeuf/grpc/blob/client_auth_filter_error_handling/src/core/security/client_auth_filter.c#L256))\n   - **Cause:** The server doesn't have a certificate for the the passed `:authority` value.\n   - **Is it a client bug?** Yes.\n   - **How should the client prevent it?** Pass `NULL` as `host` to `grpc_channel_create_call` or `grpc_channel_register_call`. If you're connecting to a test server, be sure to use as `:authority` the SSL name override expected by the server (e.g. by setting it as the default `:authority` for the channel).\n\nFor (1.) we'll open an issue to let the credentials object pass us a status that we'll propagate (ideally with an error message too). So that we'll be able to distinguish `unavailable` (the client should retry the request) from `unauthenticated` (do the necessary auth dance).\n\nFor (2.): Does it mean that if I add OAuth2 credentials to the channel, I can't later override those per-call with different OAuth2 credentials? Because instead of the call credentials overriding the channel credentials, they'll just collide and produce this error.\n"
  },
  {
    "url": "https://api.github.com/repos/grpc/grpc/issues/comments/130112296",
    "html_url": "https://github.com/grpc/grpc/pull/2847#issuecomment-130112296",
    "issue_url": "https://api.github.com/repos/grpc/grpc/issues/2847",
    "id": 130112296,
    "node_id": "MDEyOklzc3VlQ29tbWVudDEzMDExMjI5Ng==",
    "user": {
      "login": "jboeuf",
      "id": 6262765,
      "node_id": "MDQ6VXNlcjYyNjI3NjU=",
      "avatar_url": "https://avatars1.githubusercontent.com/u/6262765?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/jboeuf",
      "html_url": "https://github.com/jboeuf",
      "followers_url": "https://api.github.com/users/jboeuf/followers",
      "following_url": "https://api.github.com/users/jboeuf/following{/other_user}",
      "gists_url": "https://api.github.com/users/jboeuf/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/jboeuf/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/jboeuf/subscriptions",
      "organizations_url": "https://api.github.com/users/jboeuf/orgs",
      "repos_url": "https://api.github.com/users/jboeuf/repos",
      "events_url": "https://api.github.com/users/jboeuf/events{/privacy}",
      "received_events_url": "https://api.github.com/users/jboeuf/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2015-08-11T23:38:58Z",
    "updated_at": "2015-08-11T23:38:58Z",
    "author_association": "CONTRIBUTOR",
    "body": "Thanks for the summary. Everything looks good. Note that the headers/metadata check for 2. is not currently preformed by the code (but we will need to have it at some point).\n"
  },
  {
    "url": "https://api.github.com/repos/grpc/grpc/issues/comments/130127079",
    "html_url": "https://github.com/grpc/grpc/pull/2847#issuecomment-130127079",
    "issue_url": "https://api.github.com/repos/grpc/grpc/issues/2847",
    "id": 130127079,
    "node_id": "MDEyOklzc3VlQ29tbWVudDEzMDEyNzA3OQ==",
    "user": {
      "login": "jcanizales",
      "id": 5120183,
      "node_id": "MDQ6VXNlcjUxMjAxODM=",
      "avatar_url": "https://avatars0.githubusercontent.com/u/5120183?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/jcanizales",
      "html_url": "https://github.com/jcanizales",
      "followers_url": "https://api.github.com/users/jcanizales/followers",
      "following_url": "https://api.github.com/users/jcanizales/following{/other_user}",
      "gists_url": "https://api.github.com/users/jcanizales/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/jcanizales/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/jcanizales/subscriptions",
      "organizations_url": "https://api.github.com/users/jcanizales/orgs",
      "repos_url": "https://api.github.com/users/jcanizales/repos",
      "events_url": "https://api.github.com/users/jcanizales/events{/privacy}",
      "received_events_url": "https://api.github.com/users/jcanizales/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2015-08-12T01:01:20Z",
    "updated_at": "2015-08-12T01:01:20Z",
    "author_association": "CONTRIBUTOR",
    "body": "The change LGTM, but apparently it broke all Jenkins tests? :)\n"
  },
  {
    "url": "https://api.github.com/repos/grpc/grpc/issues/comments/130458990",
    "html_url": "https://github.com/grpc/grpc/pull/2847#issuecomment-130458990",
    "issue_url": "https://api.github.com/repos/grpc/grpc/issues/2847",
    "id": 130458990,
    "node_id": "MDEyOklzc3VlQ29tbWVudDEzMDQ1ODk5MA==",
    "user": {
      "login": "jboeuf",
      "id": 6262765,
      "node_id": "MDQ6VXNlcjYyNjI3NjU=",
      "avatar_url": "https://avatars1.githubusercontent.com/u/6262765?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/jboeuf",
      "html_url": "https://github.com/jboeuf",
      "followers_url": "https://api.github.com/users/jboeuf/followers",
      "following_url": "https://api.github.com/users/jboeuf/following{/other_user}",
      "gists_url": "https://api.github.com/users/jboeuf/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/jboeuf/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/jboeuf/subscriptions",
      "organizations_url": "https://api.github.com/users/jboeuf/orgs",
      "repos_url": "https://api.github.com/users/jboeuf/repos",
      "events_url": "https://api.github.com/users/jboeuf/events{/privacy}",
      "received_events_url": "https://api.github.com/users/jboeuf/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2015-08-12T21:52:16Z",
    "updated_at": "2015-08-12T21:52:16Z",
    "author_association": "CONTRIBUTOR",
    "body": "Jenkins doesn't work well. Let me restart a build manually...\n"
  },
  {
    "url": "https://api.github.com/repos/grpc/grpc/issues/comments/130488388",
    "html_url": "https://github.com/grpc/grpc/pull/2847#issuecomment-130488388",
    "issue_url": "https://api.github.com/repos/grpc/grpc/issues/2847",
    "id": 130488388,
    "node_id": "MDEyOklzc3VlQ29tbWVudDEzMDQ4ODM4OA==",
    "user": {
      "login": "jcanizales",
      "id": 5120183,
      "node_id": "MDQ6VXNlcjUxMjAxODM=",
      "avatar_url": "https://avatars0.githubusercontent.com/u/5120183?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/jcanizales",
      "html_url": "https://github.com/jcanizales",
      "followers_url": "https://api.github.com/users/jcanizales/followers",
      "following_url": "https://api.github.com/users/jcanizales/following{/other_user}",
      "gists_url": "https://api.github.com/users/jcanizales/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/jcanizales/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/jcanizales/subscriptions",
      "organizations_url": "https://api.github.com/users/jcanizales/orgs",
      "repos_url": "https://api.github.com/users/jcanizales/repos",
      "events_url": "https://api.github.com/users/jcanizales/events{/privacy}",
      "received_events_url": "https://api.github.com/users/jcanizales/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2015-08-13T00:17:05Z",
    "updated_at": "2015-08-13T00:17:05Z",
    "author_association": "CONTRIBUTOR",
    "body": "All reds are git failures to checkout stuff. Merging.\n"
  }
]
