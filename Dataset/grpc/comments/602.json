[
  {
    "url": "https://api.github.com/repos/grpc/grpc/issues/comments/75884604",
    "html_url": "https://github.com/grpc/grpc/pull/602#issuecomment-75884604",
    "issue_url": "https://api.github.com/repos/grpc/grpc/issues/602",
    "id": 75884604,
    "node_id": "MDEyOklzc3VlQ29tbWVudDc1ODg0NjA0",
    "user": {
      "login": "ctiller",
      "id": 10120821,
      "node_id": "MDQ6VXNlcjEwMTIwODIx",
      "avatar_url": "https://avatars3.githubusercontent.com/u/10120821?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/ctiller",
      "html_url": "https://github.com/ctiller",
      "followers_url": "https://api.github.com/users/ctiller/followers",
      "following_url": "https://api.github.com/users/ctiller/following{/other_user}",
      "gists_url": "https://api.github.com/users/ctiller/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/ctiller/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/ctiller/subscriptions",
      "organizations_url": "https://api.github.com/users/ctiller/orgs",
      "repos_url": "https://api.github.com/users/ctiller/repos",
      "events_url": "https://api.github.com/users/ctiller/events{/privacy}",
      "received_events_url": "https://api.github.com/users/ctiller/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2015-02-25T00:56:15Z",
    "updated_at": "2015-02-25T00:56:15Z",
    "author_association": "MEMBER",
    "body": "I just ran this and saw a race between epoll_ctl and close.\n\n``` c\n==================\nWARNING: ThreadSanitizer: data race (pid=30882)\n  Write of size 8 at 0x7da000008030 by main thread:\n    #0 close <null>:0 (chttp2_simple_ssl_fullstack_cancel_after_invoke_legacy_test+0x0000000a0c0f)\n    #1 grpc_fd_orphan /home/craig/grpc-ct3/src/core/iomgr/fd_posix.c:163:3 (chttp2_simple_ssl_fullstack_cancel_after_invoke_legacy_test+0x0000001cad14)\n    #2 grpc_tcp_server_destroy /home/craig/grpc-ct3/src/core/iomgr/tcp_server_posix.c:145:5 (chttp2_simple_ssl_fullstack_cancel_after_invoke_legacy_test+0x000000144a25)\n    #3 destroy /home/craig/grpc-ct3/src/core/security/server_secure_chttp2.c:89:3 (chttp2_simple_ssl_fullstack_cancel_after_invoke_legacy_test+0x00000012d459)\n    #4 shutdown_internal /home/craig/grpc-ct3/src/core/surface/server.c:875:5 (chttp2_simple_ssl_fullstack_cancel_after_invoke_legacy_test+0x00000012ae2d)\n    #5 grpc_server_shutdown /home/craig/grpc-ct3/src/core/surface/server.c:885:3 (chttp2_simple_ssl_fullstack_cancel_after_invoke_legacy_test+0x00000012a7cd)\n    #6 shutdown_server /home/craig/grpc-ct3/test/core/end2end/tests/cancel_after_invoke_legacy.c:83:3 (chttp2_simple_ssl_fullstack_cancel_after_invoke_legacy_test+0x0000000fd8ec)\n    #7 end_test /home/craig/grpc-ct3/test/core/end2end/tests/cancel_after_invoke_legacy.c:95:3 (chttp2_simple_ssl_fullstack_cancel_after_invoke_legacy_test+0x0000000fd83a)\n    #8 test_cancel_after_invoke /home/craig/grpc-ct3/test/core/end2end/tests/cancel_after_invoke_legacy.c:131:3 (chttp2_simple_ssl_fullstack_cancel_after_invoke_legacy_test+0x0000000fd64c)\n    #9 grpc_end2end_tests /home/craig/grpc-ct3/test/core/end2end/tests/cancel_after_invoke_legacy.c:139:5 (chttp2_simple_ssl_fullstack_cancel_after_invoke_legacy_test+0x0000000fd4e4)\n    #10 main /home/craig/grpc-ct3/test/core/end2end/fixtures/chttp2_simple_ssl_fullstack.c:152:5 (chttp2_simple_ssl_fullstack_cancel_after_invoke_legacy_test+0x0000000fd076)\n\n  Previous read of size 8 at 0x7da000008030 by thread T2 (mutexes: write M39):\n    #0 epoll_ctl <null>:0 (chttp2_simple_ssl_fullstack_cancel_after_invoke_legacy_test+0x0000000a29e0)\n    #1 multipoll_with_epoll_pollset_add_fd /home/craig/grpc-ct3/src/core/iomgr/pollset_multipoller_with_epoll.c:60:9 (chttp2_simple_ssl_fullstack_cancel_after_invoke_legacy_test+0x0000001ecc92)\n    #2 grpc_platform_become_multipoller /home/craig/grpc-ct3/src/core/iomgr/pollset_multipoller_with_epoll.c:183:5 (chttp2_simple_ssl_fullstack_cancel_after_invoke_legacy_test+0x0000001ecb32)\n    #3 unary_poll_do_promote /home/craig/grpc-ct3/src/core/iomgr/pollset_posix.c:286:7 (chttp2_simple_ssl_fullstack_cancel_after_invoke_legacy_test+0x000000122180)\n    #4 background_callback_executor /home/craig/grpc-ct3/src/core/iomgr/iomgr.c:72:7 (chttp2_simple_ssl_fullstack_cancel_after_invoke_legacy_test+0x00000010a0fc)\n    #5 thread_body /home/craig/grpc-ct3/src/core/support/thd_posix.c:57:3 (chttp2_simple_ssl_fullstack_cancel_after_invoke_legacy_test+0x0000002da11b)\n\n  Location is file descriptor 3 created by main thread at:\n    #0 socket <null>:0 (chttp2_simple_ssl_fullstack_cancel_after_invoke_legacy_test+0x00000009ffe0)\n    #1 grpc_create_dualstack_socket /home/craig/grpc-ct3/src/core/iomgr/socket_utils_common_posix.c:170:12 (chttp2_simple_ssl_fullstack_cancel_after_invoke_legacy_test+0x00000021e283)\n    #2 grpc_tcp_server_add_port /home/craig/grpc-ct3/src/core/iomgr/tcp_server_posix.c:363:8 (chttp2_simple_ssl_fullstack_cancel_after_invoke_legacy_test+0x000000144d85)\n    #3 grpc_server_add_secure_http2_port /home/craig/grpc-ct3/src/core/security/server_secure_chttp2.c:111:17 (chttp2_simple_ssl_fullstack_cancel_after_invoke_legacy_test+0x00000012d2c5)\n    #4 chttp2_init_server_secure_fullstack /home/craig/grpc-ct3/test/core/end2end/fixtures/chttp2_simple_ssl_fullstack.c:92:3 (chttp2_simple_ssl_fullstack_cancel_after_invoke_legacy_test+0x0000000fd383)\n    #5 chttp2_init_server_simple_ssl_secure_fullstack /home/craig/grpc-ct3/test/core/end2end/fixtures/chttp2_simple_ssl_fullstack.c:121:3 (chttp2_simple_ssl_fullstack_cancel_after_invoke_legacy_test+0x0000000fd2d0)\n    #6 begin_test /home/craig/grpc-ct3/test/core/end2end/tests/cancel_after_invoke_legacy.c:60:3 (chttp2_simple_ssl_fullstack_cancel_after_invoke_legacy_test+0x0000000fd798)\n    #7 test_cancel_after_invoke /home/craig/grpc-ct3/test/core/end2end/tests/cancel_after_invoke_legacy.c:110:33 (chttp2_simple_ssl_fullstack_cancel_after_invoke_legacy_test+0x0000000fd53c)\n    #8 grpc_end2end_tests /home/craig/grpc-ct3/test/core/end2end/tests/cancel_after_invoke_legacy.c:139:5 (chttp2_simple_ssl_fullstack_cancel_after_invoke_legacy_test+0x0000000fd4e4)\n    #9 main /home/craig/grpc-ct3/test/core/end2end/fixtures/chttp2_simple_ssl_fullstack.c:152:5 (chttp2_simple_ssl_fullstack_cancel_after_invoke_legacy_test+0x0000000fd076)\n\n  Mutex M39 (0x7fcc129a6378) created at:\n    #0 pthread_mutex_init <null>:0 (chttp2_simple_ssl_fullstack_cancel_after_invoke_legacy_test+0x00000009a8d0)\n    #1 gpr_mu_init /home/craig/grpc-ct3/src/core/support/sync_posix.c:44:32 (chttp2_simple_ssl_fullstack_cancel_after_invoke_legacy_test+0x0000002d9aeb)\n    #2 grpc_pollset_init /home/craig/grpc-ct3/src/core/iomgr/pollset_posix.c:140:3 (chttp2_simple_ssl_fullstack_cancel_after_invoke_legacy_test+0x00000012122a)\n    #3 grpc_pollset_global_init /home/craig/grpc-ct3/src/core/iomgr/pollset_posix.c:103:3 (chttp2_simple_ssl_fullstack_cancel_after_invoke_legacy_test+0x0000001211c1)\n    #4 grpc_iomgr_platform_init /home/craig/grpc-ct3/src/core/iomgr/iomgr_posix.c:43:3 (chttp2_simple_ssl_fullstack_cancel_after_invoke_legacy_test+0x00000010a7a6)\n    #5 grpc_iomgr_init /home/craig/grpc-ct3/src/core/iomgr/iomgr.c:93:3 (chttp2_simple_ssl_fullstack_cancel_after_invoke_legacy_test+0x000000109fde)\n    #6 grpc_init /home/craig/grpc-ct3/src/core/surface/init.c:54:5 (chttp2_simple_ssl_fullstack_cancel_after_invoke_legacy_test+0x000000109e9b)\n    #7 main /home/craig/grpc-ct3/test/core/end2end/fixtures/chttp2_simple_ssl_fullstack.c:149:3 (chttp2_simple_ssl_fullstack_cancel_after_invoke_legacy_test+0x0000000fd04e)\n\n  Thread T2 (tid=30885, running) created by main thread at:\n    #0 pthread_create <null>:0 (chttp2_simple_ssl_fullstack_cancel_after_invoke_legacy_test+0x0000000994c1)\n    #1 gpr_thd_new /home/craig/grpc-ct3/src/core/support/thd_posix.c:72:21 (chttp2_simple_ssl_fullstack_cancel_after_invoke_legacy_test+0x0000002da01b)\n    #2 grpc_iomgr_init /home/craig/grpc-ct3/src/core/iomgr/iomgr.c:95:3 (chttp2_simple_ssl_fullstack_cancel_after_invoke_legacy_test+0x000000109ffe)\n    #3 grpc_init /home/craig/grpc-ct3/src/core/surface/init.c:54:5 (chttp2_simple_ssl_fullstack_cancel_after_invoke_legacy_test+0x000000109e9b)\n    #4 main /home/craig/grpc-ct3/test/core/end2end/fixtures/chttp2_simple_ssl_fullstack.c:149:3 (chttp2_simple_ssl_fullstack_cancel_after_invoke_legacy_test+0x0000000fd04e)\n\nSUMMARY: ThreadSanitizer: data race ??:0 close\n==================\n```\n"
  },
  {
    "url": "https://api.github.com/repos/grpc/grpc/issues/comments/75885917",
    "html_url": "https://github.com/grpc/grpc/pull/602#issuecomment-75885917",
    "issue_url": "https://api.github.com/repos/grpc/grpc/issues/602",
    "id": 75885917,
    "node_id": "MDEyOklzc3VlQ29tbWVudDc1ODg1OTE3",
    "user": {
      "login": "dklempner",
      "id": 10135909,
      "node_id": "MDQ6VXNlcjEwMTM1OTA5",
      "avatar_url": "https://avatars2.githubusercontent.com/u/10135909?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/dklempner",
      "html_url": "https://github.com/dklempner",
      "followers_url": "https://api.github.com/users/dklempner/followers",
      "following_url": "https://api.github.com/users/dklempner/following{/other_user}",
      "gists_url": "https://api.github.com/users/dklempner/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/dklempner/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/dklempner/subscriptions",
      "organizations_url": "https://api.github.com/users/dklempner/orgs",
      "repos_url": "https://api.github.com/users/dklempner/repos",
      "events_url": "https://api.github.com/users/dklempner/events{/privacy}",
      "received_events_url": "https://api.github.com/users/dklempner/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2015-02-25T01:08:14Z",
    "updated_at": "2015-02-25T01:08:14Z",
    "author_association": "CONTRIBUTOR",
    "body": "That would be consistent with my observing fd refcount issues -- I do not believe we can see such a race without one.\n"
  },
  {
    "url": "https://api.github.com/repos/grpc/grpc/issues/comments/75886374",
    "html_url": "https://github.com/grpc/grpc/pull/602#issuecomment-75886374",
    "issue_url": "https://api.github.com/repos/grpc/grpc/issues/602",
    "id": 75886374,
    "node_id": "MDEyOklzc3VlQ29tbWVudDc1ODg2Mzc0",
    "user": {
      "login": "dklempner",
      "id": 10135909,
      "node_id": "MDQ6VXNlcjEwMTM1OTA5",
      "avatar_url": "https://avatars2.githubusercontent.com/u/10135909?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/dklempner",
      "html_url": "https://github.com/dklempner",
      "followers_url": "https://api.github.com/users/dklempner/followers",
      "following_url": "https://api.github.com/users/dklempner/following{/other_user}",
      "gists_url": "https://api.github.com/users/dklempner/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/dklempner/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/dklempner/subscriptions",
      "organizations_url": "https://api.github.com/users/dklempner/orgs",
      "repos_url": "https://api.github.com/users/dklempner/repos",
      "events_url": "https://api.github.com/users/dklempner/events{/privacy}",
      "received_events_url": "https://api.github.com/users/dklempner/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2015-02-25T01:12:42Z",
    "updated_at": "2015-02-25T01:12:42Z",
    "author_association": "CONTRIBUTOR",
    "body": "Actually, that may be a separate issue: there's no way to prevent a concurrent fd orphan from triggering a close.\n\nCan we move the fd close to when the fd refcount drops to zero?\n"
  },
  {
    "url": "https://api.github.com/repos/grpc/grpc/issues/comments/75909200",
    "html_url": "https://github.com/grpc/grpc/pull/602#issuecomment-75909200",
    "issue_url": "https://api.github.com/repos/grpc/grpc/issues/602",
    "id": 75909200,
    "node_id": "MDEyOklzc3VlQ29tbWVudDc1OTA5MjAw",
    "user": {
      "login": "ctiller",
      "id": 10120821,
      "node_id": "MDQ6VXNlcjEwMTIwODIx",
      "avatar_url": "https://avatars3.githubusercontent.com/u/10120821?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/ctiller",
      "html_url": "https://github.com/ctiller",
      "followers_url": "https://api.github.com/users/ctiller/followers",
      "following_url": "https://api.github.com/users/ctiller/following{/other_user}",
      "gists_url": "https://api.github.com/users/ctiller/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/ctiller/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/ctiller/subscriptions",
      "organizations_url": "https://api.github.com/users/ctiller/orgs",
      "repos_url": "https://api.github.com/users/ctiller/repos",
      "events_url": "https://api.github.com/users/ctiller/events{/privacy}",
      "received_events_url": "https://api.github.com/users/ctiller/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2015-02-25T05:47:56Z",
    "updated_at": "2015-02-25T05:47:56Z",
    "author_association": "MEMBER",
    "body": "Tests out good on Mac, and it seems super stable on my laptop.\nIt also exposed a bug in the chttp2 stack on the old 32 bit box I have here (sending a PR soon).\n"
  }
]
