[
  {
    "url": "https://api.github.com/repos/grpc/grpc/issues/comments/480278593",
    "html_url": "https://github.com/grpc/grpc/issues/18416#issuecomment-480278593",
    "issue_url": "https://api.github.com/repos/grpc/grpc/issues/18416",
    "id": 480278593,
    "node_id": "MDEyOklzc3VlQ29tbWVudDQ4MDI3ODU5Mw==",
    "user": {
      "login": "jtattermusch",
      "id": 9939684,
      "node_id": "MDQ6VXNlcjk5Mzk2ODQ=",
      "avatar_url": "https://avatars1.githubusercontent.com/u/9939684?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/jtattermusch",
      "html_url": "https://github.com/jtattermusch",
      "followers_url": "https://api.github.com/users/jtattermusch/followers",
      "following_url": "https://api.github.com/users/jtattermusch/following{/other_user}",
      "gists_url": "https://api.github.com/users/jtattermusch/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/jtattermusch/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/jtattermusch/subscriptions",
      "organizations_url": "https://api.github.com/users/jtattermusch/orgs",
      "repos_url": "https://api.github.com/users/jtattermusch/repos",
      "events_url": "https://api.github.com/users/jtattermusch/events{/privacy}",
      "received_events_url": "https://api.github.com/users/jtattermusch/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2019-04-05T13:38:32Z",
    "updated_at": "2019-04-05T13:38:32Z",
    "author_association": "CONTRIBUTOR",
    "body": "Seen the same issue on run_tests.py stack:\r\nhttps://source.cloud.google.com/results/invocations/a682e6f6-87bc-4a76-a856-d680dfc4d7bd/targets/github%2Fgrpc%2Fcpp_linux_tsan_native_x64_clang7.0/tests\r\n\r\n```\r\n2019-04-05 04:26:41\r\nRunning bins/tsan/bm_chttp2_transport\r\nRun on (32 X 2600 MHz CPU s)\r\nCPU Caches:\r\n  L1 Data 32K (x16)\r\n  L1 Instruction 32K (x16)\r\n  L2 Unified 256K (x16)\r\n  L3 Unified 20480K (x1)\r\n***WARNING*** Library was built as DEBUG. Timings may be affected.\r\n==================\r\nWARNING: ThreadSanitizer: data race (pid=31556)\r\n  Write of size 8 at 0x7b7c00000008 by main thread:\r\n    #0 free /tmp/clang-build/src/compiler-rt/lib/tsan/rtl/tsan_interceptors.cc:709:3 (bm_chttp2_transport+0x548694)\r\n    #1 gpr_free /var/local/git/grpc/src/core/lib/gpr/alloc.cc:77:3 (bm_chttp2_transport+0x7263c4)\r\n    #2 Stream::~Stream() /var/local/git/grpc/test/cpp/microbenchmarks/bm_chttp2_transport.cc:201:5 (bm_chttp2_transport+0x5bbc2a)\r\n    #3 std::default_delete<Stream>::operator()(Stream*) const /usr/lib/gcc/x86_64-linux-gnu/4.9/../../../../include/c++/4.9/bits/unique_ptr.h:76:2 (bm_chttp2_transport+0x5c43f6)\r\n    #4 std::unique_ptr<Stream, std::default_delete<Stream> >::reset(Stream*) /usr/lib/gcc/x86_64-linux-gnu/4.9/../../../../include/c++/4.9/bits/unique_ptr.h:344:4 (bm_chttp2_transport+0x5bf88d)\r\n    #5 BM_TransportStreamSend(benchmark::State&) /var/local/git/grpc/test/cpp/microbenchmarks/bm_chttp2_transport.cc:456:5 (bm_chttp2_transport+0x5b4b04)\r\n    #6 benchmark::internal::FunctionBenchmark::Run(benchmark::State&) /var/local/git/grpc/third_party/benchmark/src/benchmark_register.cc:453:42 (bm_chttp2_transport+0x5ebd46)\r\n    #7 benchmark::internal::(anonymous namespace)::RunInThread(benchmark::internal::Benchmark::Instance const*, unsigned long, int, benchmark::internal::ThreadManager*) /var/local/git/grpc/third_party/benchmark/src/benchmark.cc:166:17 (bm_chttp2_transport+0x5d0bec)\r\n    #8 benchmark::internal::(anonymous namespace)::RunBenchmark(benchmark::internal::Benchmark::Instance const&, std::vector<benchmark::BenchmarkReporter::Run, std::allocator<benchmark::BenchmarkReporter::Run> >*) /var/local/git/grpc/third_party/benchmark/src/benchmark.cc:210:7 (bm_chttp2_transport+0x5cfb84)\r\n    #9 benchmark::internal::(anonymous namespace)::RunBenchmarks(std::vector<benchmark::internal::Benchmark::Instance, std::allocator<benchmark::internal::Benchmark::Instance> > const&, benchmark::BenchmarkReporter*, benchmark::BenchmarkReporter*) /var/local/git/grpc/third_party/benchmark/src/benchmark.cc:430:11 (bm_chttp2_transport+0x5ce6f5)\r\n    #10 benchmark::RunSpecifiedBenchmarks(benchmark::BenchmarkReporter*, benchmark::BenchmarkReporter*) /var/local/git/grpc/third_party/benchmark/src/benchmark.cc:544:5 (bm_chttp2_transport+0x5cddda)\r\n    #11 benchmark::RunSpecifiedBenchmarks() /var/local/git/grpc/third_party/benchmark/src/benchmark.cc:486:10 (bm_chttp2_transport+0x5cd811)\r\n    #12 benchmark::RunTheBenchmarksNamespaced() /var/local/git/grpc/test/cpp/microbenchmarks/bm_chttp2_transport.cc:641:37 (bm_chttp2_transport+0x5b5955)\r\n    #13 main /var/local/git/grpc/test/cpp/microbenchmarks/bm_chttp2_transport.cc:647:3 (bm_chttp2_transport+0x5b5a13)\r\n  Previous read of size 8 at 0x7b7c00000008 by thread T1:\r\n    #0 grpc_chttp2_stream::~grpc_chttp2_stream() /var/local/git/grpc/src/core/ext/transport/chttp2/transport/chttp2_transport.cc:692:7 (bm_chttp2_transport+0x6516c9)\r\n    #1 destroy_stream_locked(void*, grpc_error*) /var/local/git/grpc/src/core/ext/transport/chttp2/transport/chttp2_transport.cc:754:6 (bm_chttp2_transport+0x664cd1)\r\n    #2 grpc_combiner_continue_exec_ctx() /var/local/git/grpc/src/core/lib/iomgr/combiner.cc:268:5 (bm_chttp2_transport+0x6a31c2)\r\n    #3 grpc_core::ExecCtx::Flush() /var/local/git/grpc/src/core/lib/iomgr/exec_ctx.cc:151:17 (bm_chttp2_transport+0x630cba)\r\n    #4 grpc_core::Executor::RunClosures(char const*, grpc_closure_list) /var/local/git/grpc/src/core/lib/iomgr/executor.cc:138:32 (bm_chttp2_transport+0x6a58e0)\r\n    #5 grpc_core::Executor::ThreadMain(void*) /var/local/git/grpc/src/core/lib/iomgr/executor.cc:258:22 (bm_chttp2_transport+0x6a5fe8)\r\n    #6 grpc_core::(anonymous namespace)::ThreadInternalsPosix::ThreadInternalsPosix(char const*, void (*)(void*), void*, bool*, grpc_core::Thread::Options const&)::{lambda(void*)#1}::operator()(void*) const /var/local/git/grpc/src/core/lib/gprpp/thd_posix.cc:114:27 (bm_chttp2_transport+0x72f605)\r\n    #7 grpc_core::(anonymous namespace)::ThreadInternalsPosix::ThreadInternalsPosix(char const*, void (*)(void*), void*, bool*, grpc_core::Thread::Options const&)::{lambda(void*)#1}::__invoke(void*) /var/local/git/grpc/src/core/lib/gprpp/thd_posix.cc:84:25 (bm_chttp2_transport+0x72f488)\r\n  Thread T1 'default-executo' (tid=31564, running) created by main thread at:\r\n    #0 pthread_create /tmp/clang-build/src/compiler-rt/lib/tsan/rtl/tsan_interceptors.cc:992:3 (bm_chttp2_transport+0x549d25)\r\n    #1 grpc_core::(anonymous namespace)::ThreadInternalsPosix::ThreadInternalsPosix(char const*, void (*)(void*), void*, bool*, grpc_core::Thread::Options const&) /var/local/git/grpc/src/core/lib/gprpp/thd_posix.cc:83:10 (bm_chttp2_transport+0x72f179)\r\n    #2 grpc_core::(anonymous namespace)::ThreadInternalsPosix* grpc_core::New<grpc_core::(anonymous namespace)::ThreadInternalsPosix, char const*&, void (*&)(void*), void*&, bool*, grpc_core::Thread::Options const&>(char const*&, void (*&)(void*), void*&, bool*&&, grpc_core::Thread::Options const&) /var/local/git/grpc/./src/core/lib/gprpp/memory.h:47:18 (bm_chttp2_transport+0x72ed15)\r\n    #3 grpc_core::Thread::Thread(char const*, void (*)(void*), void*, bool*, grpc_core::Thread::Options const&) /var/local/git/grpc/src/core/lib/gprpp/thd_posix.cc:160:11 (bm_chttp2_transport+0x72eae7)\r\n    #4 grpc_core::Executor::SetThreading(bool) /var/local/git/grpc/src/core/lib/iomgr/executor.cc:174:9 (bm_chttp2_transport+0x6a50fa)\r\n    #5 grpc_core::Executor::Init() /var/local/git/grpc/src/core/lib/iomgr/executor.cc:109:25 (bm_chttp2_transport+0x6a4c2d)\r\n    #6 grpc_core::Executor::InitAll() /var/local/git/grpc/src/core/lib/iomgr/executor.cc:408:58 (bm_chttp2_transport+0x6a6cfb)\r\n    #7 grpc_iomgr_init() /var/local/git/grpc/src/core/lib/iomgr/iomgr.cc:55:3 (bm_chttp2_transport+0x6a81b1)\r\n    #8 grpc_init /var/local/git/grpc/src/core/lib/surface/init.cc:145:5 (bm_chttp2_transport+0x765950)\r\n    #9 grpc::internal::GrpcLibrary::init() /var/local/git/grpc/include/grpcpp/impl/grpc_library.h:34:26 (bm_chttp2_transport+0x5caaf4)\r\n    #10 Library::Library() /var/local/git/grpc/test/cpp/microbenchmarks/helpers.cc:30:13 (bm_chttp2_transport+0x5ca340)\r\n    #11 Library::get() /var/local/git/grpc/./test/cpp/microbenchmarks/helpers.h:35:20 (bm_chttp2_transport+0x5bacb7)\r\n    #12 __cxx_global_var_init.2 /var/local/git/grpc/test/cpp/microbenchmarks/bm_chttp2_transport.cc:39:38 (bm_chttp2_transport+0x5206f5)\r\n    #13 _GLOBAL__sub_I_bm_chttp2_transport.cc /var/local/git/grpc/test/cpp/microbenchmarks/bm_chttp2_transport.cc (bm_chttp2_transport+0x520c09)\r\n    #14 __libc_csu_init <null> (bm_chttp2_transport+0x8d85dc)\r\nSUMMARY: ThreadSanitizer: data race /var/local/git/grpc/src/core/lib/gpr/alloc.cc:77:3 in gpr_free\r\n==================\r\n```"
  }
]
