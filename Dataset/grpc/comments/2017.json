[
  {
    "url": "https://api.github.com/repos/grpc/grpc/issues/comments/110532391",
    "html_url": "https://github.com/grpc/grpc/issues/2017#issuecomment-110532391",
    "issue_url": "https://api.github.com/repos/grpc/grpc/issues/2017",
    "id": 110532391,
    "node_id": "MDEyOklzc3VlQ29tbWVudDExMDUzMjM5MQ==",
    "user": {
      "login": "vjpai",
      "id": 8864912,
      "node_id": "MDQ6VXNlcjg4NjQ5MTI=",
      "avatar_url": "https://avatars0.githubusercontent.com/u/8864912?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/vjpai",
      "html_url": "https://github.com/vjpai",
      "followers_url": "https://api.github.com/users/vjpai/followers",
      "following_url": "https://api.github.com/users/vjpai/following{/other_user}",
      "gists_url": "https://api.github.com/users/vjpai/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/vjpai/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/vjpai/subscriptions",
      "organizations_url": "https://api.github.com/users/vjpai/orgs",
      "repos_url": "https://api.github.com/users/vjpai/repos",
      "events_url": "https://api.github.com/users/vjpai/events{/privacy}",
      "received_events_url": "https://api.github.com/users/vjpai/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2015-06-09T23:30:43Z",
    "updated_at": "2015-06-09T23:30:43Z",
    "author_association": "MEMBER",
    "body": "I volunteer as tribute.\n"
  },
  {
    "url": "https://api.github.com/repos/grpc/grpc/issues/comments/110533933",
    "html_url": "https://github.com/grpc/grpc/issues/2017#issuecomment-110533933",
    "issue_url": "https://api.github.com/repos/grpc/grpc/issues/2017",
    "id": 110533933,
    "node_id": "MDEyOklzc3VlQ29tbWVudDExMDUzMzkzMw==",
    "user": {
      "login": "ctiller",
      "id": 10120821,
      "node_id": "MDQ6VXNlcjEwMTIwODIx",
      "avatar_url": "https://avatars3.githubusercontent.com/u/10120821?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/ctiller",
      "html_url": "https://github.com/ctiller",
      "followers_url": "https://api.github.com/users/ctiller/followers",
      "following_url": "https://api.github.com/users/ctiller/following{/other_user}",
      "gists_url": "https://api.github.com/users/ctiller/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/ctiller/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/ctiller/subscriptions",
      "organizations_url": "https://api.github.com/users/ctiller/orgs",
      "repos_url": "https://api.github.com/users/ctiller/repos",
      "events_url": "https://api.github.com/users/ctiller/events{/privacy}",
      "received_events_url": "https://api.github.com/users/ctiller/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2015-06-09T23:39:58Z",
    "updated_at": "2015-06-09T23:39:58Z",
    "author_association": "MEMBER",
    "body": "Please do any investigations against #1577 - the code significantly changed.\n"
  },
  {
    "url": "https://api.github.com/repos/grpc/grpc/issues/comments/110534722",
    "html_url": "https://github.com/grpc/grpc/issues/2017#issuecomment-110534722",
    "issue_url": "https://api.github.com/repos/grpc/grpc/issues/2017",
    "id": 110534722,
    "node_id": "MDEyOklzc3VlQ29tbWVudDExMDUzNDcyMg==",
    "user": {
      "login": "vjpai",
      "id": 8864912,
      "node_id": "MDQ6VXNlcjg4NjQ5MTI=",
      "avatar_url": "https://avatars0.githubusercontent.com/u/8864912?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/vjpai",
      "html_url": "https://github.com/vjpai",
      "followers_url": "https://api.github.com/users/vjpai/followers",
      "following_url": "https://api.github.com/users/vjpai/following{/other_user}",
      "gists_url": "https://api.github.com/users/vjpai/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/vjpai/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/vjpai/subscriptions",
      "organizations_url": "https://api.github.com/users/vjpai/orgs",
      "repos_url": "https://api.github.com/users/vjpai/repos",
      "events_url": "https://api.github.com/users/vjpai/events{/privacy}",
      "received_events_url": "https://api.github.com/users/vjpai/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2015-06-09T23:46:13Z",
    "updated_at": "2015-06-09T23:46:13Z",
    "author_association": "MEMBER",
    "body": "Ok, thanks for the tip.\n"
  },
  {
    "url": "https://api.github.com/repos/grpc/grpc/issues/comments/110615655",
    "html_url": "https://github.com/grpc/grpc/issues/2017#issuecomment-110615655",
    "issue_url": "https://api.github.com/repos/grpc/grpc/issues/2017",
    "id": 110615655,
    "node_id": "MDEyOklzc3VlQ29tbWVudDExMDYxNTY1NQ==",
    "user": {
      "login": "ctiller",
      "id": 10120821,
      "node_id": "MDQ6VXNlcjEwMTIwODIx",
      "avatar_url": "https://avatars3.githubusercontent.com/u/10120821?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/ctiller",
      "html_url": "https://github.com/ctiller",
      "followers_url": "https://api.github.com/users/ctiller/followers",
      "following_url": "https://api.github.com/users/ctiller/following{/other_user}",
      "gists_url": "https://api.github.com/users/ctiller/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/ctiller/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/ctiller/subscriptions",
      "organizations_url": "https://api.github.com/users/ctiller/orgs",
      "repos_url": "https://api.github.com/users/ctiller/repos",
      "events_url": "https://api.github.com/users/ctiller/events{/privacy}",
      "received_events_url": "https://api.github.com/users/ctiller/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2015-06-10T06:41:54Z",
    "updated_at": "2015-06-10T06:41:54Z",
    "author_association": "MEMBER",
    "body": "Note that after #2028 goes in, mutrace reports this as our primary contention point.\n"
  },
  {
    "url": "https://api.github.com/repos/grpc/grpc/issues/comments/110641522",
    "html_url": "https://github.com/grpc/grpc/issues/2017#issuecomment-110641522",
    "issue_url": "https://api.github.com/repos/grpc/grpc/issues/2017",
    "id": 110641522,
    "node_id": "MDEyOklzc3VlQ29tbWVudDExMDY0MTUyMg==",
    "user": {
      "login": "vjpai",
      "id": 8864912,
      "node_id": "MDQ6VXNlcjg4NjQ5MTI=",
      "avatar_url": "https://avatars0.githubusercontent.com/u/8864912?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/vjpai",
      "html_url": "https://github.com/vjpai",
      "followers_url": "https://api.github.com/users/vjpai/followers",
      "following_url": "https://api.github.com/users/vjpai/following{/other_user}",
      "gists_url": "https://api.github.com/users/vjpai/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/vjpai/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/vjpai/subscriptions",
      "organizations_url": "https://api.github.com/users/vjpai/orgs",
      "repos_url": "https://api.github.com/users/vjpai/repos",
      "events_url": "https://api.github.com/users/vjpai/events{/privacy}",
      "received_events_url": "https://api.github.com/users/vjpai/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2015-06-10T07:53:49Z",
    "updated_at": "2015-06-10T07:53:49Z",
    "author_association": "MEMBER",
    "body": "Ok, I will make this a higher priority for the short-term than the\nlock-free callbacks, though I will keep that in mind also.\n\nOn Tue, Jun 9, 2015 at 11:42 PM Craig Tiller notifications@github.com\nwrote:\n\n> Note that after #2028 https://github.com/grpc/grpc/pull/2028 goes in,\n> mutrace reports this as our primary contention point.\n> \n> —\n> Reply to this email directly or view it on GitHub\n> https://github.com/grpc/grpc/issues/2017#issuecomment-110615655.\n"
  },
  {
    "url": "https://api.github.com/repos/grpc/grpc/issues/comments/110997142",
    "html_url": "https://github.com/grpc/grpc/issues/2017#issuecomment-110997142",
    "issue_url": "https://api.github.com/repos/grpc/grpc/issues/2017",
    "id": 110997142,
    "node_id": "MDEyOklzc3VlQ29tbWVudDExMDk5NzE0Mg==",
    "user": {
      "login": "vjpai",
      "id": 8864912,
      "node_id": "MDQ6VXNlcjg4NjQ5MTI=",
      "avatar_url": "https://avatars0.githubusercontent.com/u/8864912?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/vjpai",
      "html_url": "https://github.com/vjpai",
      "followers_url": "https://api.github.com/users/vjpai/followers",
      "following_url": "https://api.github.com/users/vjpai/following{/other_user}",
      "gists_url": "https://api.github.com/users/vjpai/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/vjpai/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/vjpai/subscriptions",
      "organizations_url": "https://api.github.com/users/vjpai/orgs",
      "repos_url": "https://api.github.com/users/vjpai/repos",
      "events_url": "https://api.github.com/users/vjpai/events{/privacy}",
      "received_events_url": "https://api.github.com/users/vjpai/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2015-06-11T04:43:03Z",
    "updated_at": "2015-06-11T04:43:03Z",
    "author_association": "MEMBER",
    "body": "Yes, I can see from mutrace that something like 80% of the lock contention is coming from here. I also believe that only one of the static code paths that holds this lock for a substantial amount of time is on the critical path, so hopefully that helps. I should have something quantitative to report tomorrow.\n"
  },
  {
    "url": "https://api.github.com/repos/grpc/grpc/issues/comments/113197978",
    "html_url": "https://github.com/grpc/grpc/issues/2017#issuecomment-113197978",
    "issue_url": "https://api.github.com/repos/grpc/grpc/issues/2017",
    "id": 113197978,
    "node_id": "MDEyOklzc3VlQ29tbWVudDExMzE5Nzk3OA==",
    "user": {
      "login": "ctiller",
      "id": 10120821,
      "node_id": "MDQ6VXNlcjEwMTIwODIx",
      "avatar_url": "https://avatars3.githubusercontent.com/u/10120821?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/ctiller",
      "html_url": "https://github.com/ctiller",
      "followers_url": "https://api.github.com/users/ctiller/followers",
      "following_url": "https://api.github.com/users/ctiller/following{/other_user}",
      "gists_url": "https://api.github.com/users/ctiller/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/ctiller/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/ctiller/subscriptions",
      "organizations_url": "https://api.github.com/users/ctiller/orgs",
      "repos_url": "https://api.github.com/users/ctiller/repos",
      "events_url": "https://api.github.com/users/ctiller/events{/privacy}",
      "received_events_url": "https://api.github.com/users/ctiller/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2015-06-18T15:46:54Z",
    "updated_at": "2015-06-18T15:46:54Z",
    "author_association": "MEMBER",
    "body": "One thought I had:\n\nWe currently keep the ALL_CALLS list around:\n- so we know when we've got none left\n- so we can cancel them all at shutdown\n\nThis structure should be trivially shard-able (just split it N ways, N = k \\* numcpus()?), but I was thinking:\n- transports already need to track all the calls on the transport\n- servers have to track all the channels (and therefore all the transports)\n- is there a way we can re-use that knowledge and ditch the ALL_CALLS list entirely?\n"
  },
  {
    "url": "https://api.github.com/repos/grpc/grpc/issues/comments/113293744",
    "html_url": "https://github.com/grpc/grpc/issues/2017#issuecomment-113293744",
    "issue_url": "https://api.github.com/repos/grpc/grpc/issues/2017",
    "id": 113293744,
    "node_id": "MDEyOklzc3VlQ29tbWVudDExMzI5Mzc0NA==",
    "user": {
      "login": "vjpai",
      "id": 8864912,
      "node_id": "MDQ6VXNlcjg4NjQ5MTI=",
      "avatar_url": "https://avatars0.githubusercontent.com/u/8864912?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/vjpai",
      "html_url": "https://github.com/vjpai",
      "followers_url": "https://api.github.com/users/vjpai/followers",
      "following_url": "https://api.github.com/users/vjpai/following{/other_user}",
      "gists_url": "https://api.github.com/users/vjpai/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/vjpai/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/vjpai/subscriptions",
      "organizations_url": "https://api.github.com/users/vjpai/orgs",
      "repos_url": "https://api.github.com/users/vjpai/repos",
      "events_url": "https://api.github.com/users/vjpai/events{/privacy}",
      "received_events_url": "https://api.github.com/users/vjpai/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2015-06-18T21:24:49Z",
    "updated_at": "2015-06-18T21:24:49Z",
    "author_association": "MEMBER",
    "body": "I like the idea of CLEAN ALL THE CALLS! or rather CLEAN THE ALL CALLS! . I'll look things over and see what the effects of that area.\n"
  },
  {
    "url": "https://api.github.com/repos/grpc/grpc/issues/comments/113296191",
    "html_url": "https://github.com/grpc/grpc/issues/2017#issuecomment-113296191",
    "issue_url": "https://api.github.com/repos/grpc/grpc/issues/2017",
    "id": 113296191,
    "node_id": "MDEyOklzc3VlQ29tbWVudDExMzI5NjE5MQ==",
    "user": {
      "login": "ctiller",
      "id": 10120821,
      "node_id": "MDQ6VXNlcjEwMTIwODIx",
      "avatar_url": "https://avatars3.githubusercontent.com/u/10120821?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/ctiller",
      "html_url": "https://github.com/ctiller",
      "followers_url": "https://api.github.com/users/ctiller/followers",
      "following_url": "https://api.github.com/users/ctiller/following{/other_user}",
      "gists_url": "https://api.github.com/users/ctiller/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/ctiller/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/ctiller/subscriptions",
      "organizations_url": "https://api.github.com/users/ctiller/orgs",
      "repos_url": "https://api.github.com/users/ctiller/repos",
      "events_url": "https://api.github.com/users/ctiller/events{/privacy}",
      "received_events_url": "https://api.github.com/users/ctiller/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2015-06-18T21:34:03Z",
    "updated_at": "2015-06-18T21:34:03Z",
    "author_association": "MEMBER",
    "body": "So I think we can ensure that all calls are gone before all channels are gone (by refcounting alone).\nWhich means it suffices on the server to just wait for all channels to be gone.\n\nWe can introduce a channel op (into channel_stack.h) that cancels all calls on a channel to aid the implementation of grpc_server_cancel_all_calls. It could tunnel its way down the channel stack to the transport, and then the transport could do its transport thing. There's some existing code to do that on disconnection.\n"
  },
  {
    "url": "https://api.github.com/repos/grpc/grpc/issues/comments/113298421",
    "html_url": "https://github.com/grpc/grpc/issues/2017#issuecomment-113298421",
    "issue_url": "https://api.github.com/repos/grpc/grpc/issues/2017",
    "id": 113298421,
    "node_id": "MDEyOklzc3VlQ29tbWVudDExMzI5ODQyMQ==",
    "user": {
      "login": "vjpai",
      "id": 8864912,
      "node_id": "MDQ6VXNlcjg4NjQ5MTI=",
      "avatar_url": "https://avatars0.githubusercontent.com/u/8864912?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/vjpai",
      "html_url": "https://github.com/vjpai",
      "followers_url": "https://api.github.com/users/vjpai/followers",
      "following_url": "https://api.github.com/users/vjpai/following{/other_user}",
      "gists_url": "https://api.github.com/users/vjpai/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/vjpai/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/vjpai/subscriptions",
      "organizations_url": "https://api.github.com/users/vjpai/orgs",
      "repos_url": "https://api.github.com/users/vjpai/repos",
      "events_url": "https://api.github.com/users/vjpai/events{/privacy}",
      "received_events_url": "https://api.github.com/users/vjpai/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2015-06-18T21:46:44Z",
    "updated_at": "2015-06-18T21:46:44Z",
    "author_association": "MEMBER",
    "body": "So, the first part about refcounting alone looks good.\nAs for the second part, are you saying that the relevant information is already there, or would this require creating a list of all-calls in each channel? If so, the current mu_global will get contended for managing that list and we'll need to move toward a sharded lock per channel. But that may not be as rough, will have to see.\n"
  },
  {
    "url": "https://api.github.com/repos/grpc/grpc/issues/comments/113299010",
    "html_url": "https://github.com/grpc/grpc/issues/2017#issuecomment-113299010",
    "issue_url": "https://api.github.com/repos/grpc/grpc/issues/2017",
    "id": 113299010,
    "node_id": "MDEyOklzc3VlQ29tbWVudDExMzI5OTAxMA==",
    "user": {
      "login": "ctiller",
      "id": 10120821,
      "node_id": "MDQ6VXNlcjEwMTIwODIx",
      "avatar_url": "https://avatars3.githubusercontent.com/u/10120821?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/ctiller",
      "html_url": "https://github.com/ctiller",
      "followers_url": "https://api.github.com/users/ctiller/followers",
      "following_url": "https://api.github.com/users/ctiller/following{/other_user}",
      "gists_url": "https://api.github.com/users/ctiller/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/ctiller/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/ctiller/subscriptions",
      "organizations_url": "https://api.github.com/users/ctiller/orgs",
      "repos_url": "https://api.github.com/users/ctiller/repos",
      "events_url": "https://api.github.com/users/ctiller/events{/privacy}",
      "received_events_url": "https://api.github.com/users/ctiller/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2015-06-18T21:50:11Z",
    "updated_at": "2015-06-18T21:50:11Z",
    "author_association": "MEMBER",
    "body": "So transports are required to keep track of the list of all calls active on\nthem, which should suffice. We need to drill down from the channel layer to\nthe transport layer to do this, and that's what the event types\nin grpc_channel_op_type are for... consider making something\nlike GRPC_CHANNEL_GOAWAY but called GRPC_CHANNEL_CANCEL_ALL_CALLS.\n\nOn Thu, Jun 18, 2015 at 2:47 PM Vijay Pai notifications@github.com wrote:\n\n> So, the first part about refcounting alone looks good.\n> As for the second part, are you saying that the relevant information is\n> already there, or would this require creating a list of all-calls in each\n> channel? If so, the current mu_global will get contended for managing that\n> list and we'll need to move toward a sharded lock per channel. But that may\n> not be as rough, will have to see.\n> \n> —\n> Reply to this email directly or view it on GitHub\n> https://github.com/grpc/grpc/issues/2017#issuecomment-113298421.\n"
  },
  {
    "url": "https://api.github.com/repos/grpc/grpc/issues/comments/113302394",
    "html_url": "https://github.com/grpc/grpc/issues/2017#issuecomment-113302394",
    "issue_url": "https://api.github.com/repos/grpc/grpc/issues/2017",
    "id": 113302394,
    "node_id": "MDEyOklzc3VlQ29tbWVudDExMzMwMjM5NA==",
    "user": {
      "login": "vjpai",
      "id": 8864912,
      "node_id": "MDQ6VXNlcjg4NjQ5MTI=",
      "avatar_url": "https://avatars0.githubusercontent.com/u/8864912?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/vjpai",
      "html_url": "https://github.com/vjpai",
      "followers_url": "https://api.github.com/users/vjpai/followers",
      "following_url": "https://api.github.com/users/vjpai/following{/other_user}",
      "gists_url": "https://api.github.com/users/vjpai/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/vjpai/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/vjpai/subscriptions",
      "organizations_url": "https://api.github.com/users/vjpai/orgs",
      "repos_url": "https://api.github.com/users/vjpai/repos",
      "events_url": "https://api.github.com/users/vjpai/events{/privacy}",
      "received_events_url": "https://api.github.com/users/vjpai/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2015-06-18T22:09:47Z",
    "updated_at": "2015-06-18T22:09:47Z",
    "author_association": "MEMBER",
    "body": "ok, I see. Will investigate.\n"
  },
  {
    "url": "https://api.github.com/repos/grpc/grpc/issues/comments/120049124",
    "html_url": "https://github.com/grpc/grpc/issues/2017#issuecomment-120049124",
    "issue_url": "https://api.github.com/repos/grpc/grpc/issues/2017",
    "id": 120049124,
    "node_id": "MDEyOklzc3VlQ29tbWVudDEyMDA0OTEyNA==",
    "user": {
      "login": "vjpai",
      "id": 8864912,
      "node_id": "MDQ6VXNlcjg4NjQ5MTI=",
      "avatar_url": "https://avatars0.githubusercontent.com/u/8864912?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/vjpai",
      "html_url": "https://github.com/vjpai",
      "followers_url": "https://api.github.com/users/vjpai/followers",
      "following_url": "https://api.github.com/users/vjpai/following{/other_user}",
      "gists_url": "https://api.github.com/users/vjpai/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/vjpai/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/vjpai/subscriptions",
      "organizations_url": "https://api.github.com/users/vjpai/orgs",
      "repos_url": "https://api.github.com/users/vjpai/repos",
      "events_url": "https://api.github.com/users/vjpai/events{/privacy}",
      "received_events_url": "https://api.github.com/users/vjpai/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2015-07-09T16:01:33Z",
    "updated_at": "2015-07-09T16:01:33Z",
    "author_association": "MEMBER",
    "body": "This issue has been resolved by PR #2105, #2303, #2315, and others. There may be new issues that need investigation, but it is not about any server-wide serialization anymore. Issue #2016 remains open and the lock-free structure built for that will also help improve server performance in general.\n"
  }
]
