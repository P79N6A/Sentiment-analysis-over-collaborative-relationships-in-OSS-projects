[
  {
    "url": "https://api.github.com/repos/grpc/grpc/issues/comments/252095386",
    "html_url": "https://github.com/grpc/grpc/pull/8312#issuecomment-252095386",
    "issue_url": "https://api.github.com/repos/grpc/grpc/issues/8312",
    "id": 252095386,
    "node_id": "MDEyOklzc3VlQ29tbWVudDI1MjA5NTM4Ng==",
    "user": {
      "login": "ctiller",
      "id": 10120821,
      "node_id": "MDQ6VXNlcjEwMTIwODIx",
      "avatar_url": "https://avatars3.githubusercontent.com/u/10120821?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/ctiller",
      "html_url": "https://github.com/ctiller",
      "followers_url": "https://api.github.com/users/ctiller/followers",
      "following_url": "https://api.github.com/users/ctiller/following{/other_user}",
      "gists_url": "https://api.github.com/users/ctiller/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/ctiller/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/ctiller/subscriptions",
      "organizations_url": "https://api.github.com/users/ctiller/orgs",
      "repos_url": "https://api.github.com/users/ctiller/repos",
      "events_url": "https://api.github.com/users/ctiller/events{/privacy}",
      "received_events_url": "https://api.github.com/users/ctiller/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2016-10-06T21:33:59Z",
    "updated_at": "2016-10-06T21:33:59Z",
    "author_association": "MEMBER",
    "body": "Why is this desirable?\n\nOn Thu, Oct 6, 2016, 2:30 PM Nicolas Noble notifications@github.com wrote:\n\n> ## _@nicolasnoble_ requested changes on this pull request.\n> \n> In test/core/util/test_config.c\n> https://github.com/grpc/grpc/pull/8312#pullrequestreview-3207647:\n> \n> > +void grpc_test_before_shutdown(void (*function)(void)) {\n> > -  shutdown_handler_list_elem *elem =\n> > -      gpr_malloc(sizeof(shutdown_handler_list_elem));\n> > -  elem->function = function;\n> > -  elem->next = NULL;\n> > -  if (shutdown_handlers.head == NULL) {\n> > -    shutdown_handlers.head = shutdown_handlers.tail = elem;\n> > -  } else {\n> > -    shutdown_handlers.tail->next = elem;\n> > -    shutdown_handlers.tail = elem;\n> > -  }\n> >   +}\n> >   +\n> >   +void grpc_test_shutdown() {\n> > -  for (shutdown_handler_list_elem *handler = shutdown_handlers.head;\n> > -       handler != NULL; handler = handler->next) {\n> \n> That's a use after free. (handler = handler->next)\n> \n> —\n> You are receiving this because you are subscribed to this thread.\n> Reply to this email directly, view it on GitHub\n> https://github.com/grpc/grpc/pull/8312#pullrequestreview-3207647, or mute\n> the thread\n> https://github.com/notifications/unsubscribe-auth/AJpudZ5BUsZJjrOx_pG-jIWrONBeg15pks5qxWiTgaJpZM4KQbdc\n> .\n"
  },
  {
    "url": "https://api.github.com/repos/grpc/grpc/issues/comments/252100058",
    "html_url": "https://github.com/grpc/grpc/pull/8312#issuecomment-252100058",
    "issue_url": "https://api.github.com/repos/grpc/grpc/issues/8312",
    "id": 252100058,
    "node_id": "MDEyOklzc3VlQ29tbWVudDI1MjEwMDA1OA==",
    "user": {
      "login": "murgatroid99",
      "id": 961599,
      "node_id": "MDQ6VXNlcjk2MTU5OQ==",
      "avatar_url": "https://avatars3.githubusercontent.com/u/961599?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/murgatroid99",
      "html_url": "https://github.com/murgatroid99",
      "followers_url": "https://api.github.com/users/murgatroid99/followers",
      "following_url": "https://api.github.com/users/murgatroid99/following{/other_user}",
      "gists_url": "https://api.github.com/users/murgatroid99/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/murgatroid99/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/murgatroid99/subscriptions",
      "organizations_url": "https://api.github.com/users/murgatroid99/orgs",
      "repos_url": "https://api.github.com/users/murgatroid99/repos",
      "events_url": "https://api.github.com/users/murgatroid99/events{/privacy}",
      "received_events_url": "https://api.github.com/users/murgatroid99/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2016-10-06T21:55:18Z",
    "updated_at": "2016-10-06T22:00:12Z",
    "author_association": "MEMBER",
    "body": "We currently use `atexit` to clean up ports requested from the port server. Doing that touches C core internals (`grpc_pollset_work`), so it should not be called after `grpc_shutdown`.\n"
  },
  {
    "url": "https://api.github.com/repos/grpc/grpc/issues/comments/252106035",
    "html_url": "https://github.com/grpc/grpc/pull/8312#issuecomment-252106035",
    "issue_url": "https://api.github.com/repos/grpc/grpc/issues/8312",
    "id": 252106035,
    "node_id": "MDEyOklzc3VlQ29tbWVudDI1MjEwNjAzNQ==",
    "user": {
      "login": "ctiller",
      "id": 10120821,
      "node_id": "MDQ6VXNlcjEwMTIwODIx",
      "avatar_url": "https://avatars3.githubusercontent.com/u/10120821?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/ctiller",
      "html_url": "https://github.com/ctiller",
      "followers_url": "https://api.github.com/users/ctiller/followers",
      "following_url": "https://api.github.com/users/ctiller/following{/other_user}",
      "gists_url": "https://api.github.com/users/ctiller/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/ctiller/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/ctiller/subscriptions",
      "organizations_url": "https://api.github.com/users/ctiller/orgs",
      "repos_url": "https://api.github.com/users/ctiller/repos",
      "events_url": "https://api.github.com/users/ctiller/events{/privacy}",
      "received_events_url": "https://api.github.com/users/ctiller/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2016-10-06T22:26:02Z",
    "updated_at": "2016-10-06T22:26:02Z",
    "author_association": "MEMBER",
    "body": "But we bracket that with a grpc_init and grpc_shutdown pair already, so the\npollset_work is not called after grpc_shutdown.\n\nOn Thu, Oct 6, 2016 at 2:55 PM Michael Lumish notifications@github.com\nwrote:\n\n> We currently use atexit to clean up ports requested from the port server.\n> Doing that touches C internals (grpc_pollset_work), so it should not be\n> called after grpc_shutdown.\n> \n> —\n> You are receiving this because you commented.\n> \n> Reply to this email directly, view it on GitHub\n> https://github.com/grpc/grpc/pull/8312#issuecomment-252100058, or mute\n> the thread\n> https://github.com/notifications/unsubscribe-auth/AJpudYdht4abI1vwGWyk10tfjfunk1Neks5qxW5ZgaJpZM4KQbdc\n> .\n"
  },
  {
    "url": "https://api.github.com/repos/grpc/grpc/issues/comments/252109160",
    "html_url": "https://github.com/grpc/grpc/pull/8312#issuecomment-252109160",
    "issue_url": "https://api.github.com/repos/grpc/grpc/issues/8312",
    "id": 252109160,
    "node_id": "MDEyOklzc3VlQ29tbWVudDI1MjEwOTE2MA==",
    "user": {
      "login": "murgatroid99",
      "id": 961599,
      "node_id": "MDQ6VXNlcjk2MTU5OQ==",
      "avatar_url": "https://avatars3.githubusercontent.com/u/961599?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/murgatroid99",
      "html_url": "https://github.com/murgatroid99",
      "followers_url": "https://api.github.com/users/murgatroid99/followers",
      "following_url": "https://api.github.com/users/murgatroid99/following{/other_user}",
      "gists_url": "https://api.github.com/users/murgatroid99/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/murgatroid99/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/murgatroid99/subscriptions",
      "organizations_url": "https://api.github.com/users/murgatroid99/orgs",
      "repos_url": "https://api.github.com/users/murgatroid99/repos",
      "events_url": "https://api.github.com/users/murgatroid99/events{/privacy}",
      "received_events_url": "https://api.github.com/users/murgatroid99/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2016-10-06T22:43:24Z",
    "updated_at": "2016-10-06T22:43:24Z",
    "author_association": "MEMBER",
    "body": "I see. I guess the problem I was facing only applies to libuv, because the uv implementation has fake pollsets. Every pollset polls on everything, so the pollset in `atexit` was polling on things that were cleaned up in the previous `grpc_shutdown`. I'm OK with closing this and fixing that back in the uv pull request if we don't expect this to be a problem anywhere else.\n"
  },
  {
    "url": "https://api.github.com/repos/grpc/grpc/issues/comments/252110270",
    "html_url": "https://github.com/grpc/grpc/pull/8312#issuecomment-252110270",
    "issue_url": "https://api.github.com/repos/grpc/grpc/issues/8312",
    "id": 252110270,
    "node_id": "MDEyOklzc3VlQ29tbWVudDI1MjExMDI3MA==",
    "user": {
      "login": "ctiller",
      "id": 10120821,
      "node_id": "MDQ6VXNlcjEwMTIwODIx",
      "avatar_url": "https://avatars3.githubusercontent.com/u/10120821?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/ctiller",
      "html_url": "https://github.com/ctiller",
      "followers_url": "https://api.github.com/users/ctiller/followers",
      "following_url": "https://api.github.com/users/ctiller/following{/other_user}",
      "gists_url": "https://api.github.com/users/ctiller/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/ctiller/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/ctiller/subscriptions",
      "organizations_url": "https://api.github.com/users/ctiller/orgs",
      "repos_url": "https://api.github.com/users/ctiller/repos",
      "events_url": "https://api.github.com/users/ctiller/events{/privacy}",
      "received_events_url": "https://api.github.com/users/ctiller/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2016-10-06T22:50:21Z",
    "updated_at": "2016-10-06T22:50:21Z",
    "author_association": "MEMBER",
    "body": "I think that would be better: it's more correct (init/shutdown are forced\nto do the right thing), and it's less of a tax on every test that we write\n(and less taxes there is a really hugely good thing).\n\nOn Thu, Oct 6, 2016 at 3:43 PM Michael Lumish notifications@github.com\nwrote:\n\n> I see. I guess the problem I was facing only applies to libuv, because the\n> uv implementation has fake pollsets. Every pollset polls on everything, so\n> the pollset in atexit was polling on things that were cleaned up in the\n> previous grpc_shutdown. I'm OK with closing this and fixing that back in\n> the uv pull request if we don't expect this to be a problem anywhere else.\n> \n> —\n> You are receiving this because you commented.\n> \n> Reply to this email directly, view it on GitHub\n> https://github.com/grpc/grpc/pull/8312#issuecomment-252109160, or mute\n> the thread\n> https://github.com/notifications/unsubscribe-auth/AJpudTfdboPkUu51Z9bIkccPL7hY9nvZks5qxXmegaJpZM4KQbdc\n> .\n"
  }
]
