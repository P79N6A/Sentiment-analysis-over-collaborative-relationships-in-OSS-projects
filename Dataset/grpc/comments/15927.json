[
  {
    "url": "https://api.github.com/repos/grpc/grpc/issues/comments/402228830",
    "html_url": "https://github.com/grpc/grpc/issues/15927#issuecomment-402228830",
    "issue_url": "https://api.github.com/repos/grpc/grpc/issues/15927",
    "id": 402228830,
    "node_id": "MDEyOklzc3VlQ29tbWVudDQwMjIyODgzMA==",
    "user": {
      "login": "markdroth",
      "id": 18664614,
      "node_id": "MDQ6VXNlcjE4NjY0NjE0",
      "avatar_url": "https://avatars2.githubusercontent.com/u/18664614?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/markdroth",
      "html_url": "https://github.com/markdroth",
      "followers_url": "https://api.github.com/users/markdroth/followers",
      "following_url": "https://api.github.com/users/markdroth/following{/other_user}",
      "gists_url": "https://api.github.com/users/markdroth/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/markdroth/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/markdroth/subscriptions",
      "organizations_url": "https://api.github.com/users/markdroth/orgs",
      "repos_url": "https://api.github.com/users/markdroth/repos",
      "events_url": "https://api.github.com/users/markdroth/events{/privacy}",
      "received_events_url": "https://api.github.com/users/markdroth/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2018-07-03T17:10:14Z",
    "updated_at": "2018-07-03T17:10:14Z",
    "author_association": "MEMBER",
    "body": "More context:\r\n\r\nWe ran into this problem when trying to change the client_auth filter to set the auth context in `init_call_elem()` instead of in `start_transport_stream_op_batch()` in #15879.\r\n\r\nThe problem is that the client_channel code creates a separate context for the subchannel call.  It passes this context down to `init_call_elem()`, but it does not alter the context passed down in each batch in the non-retry case.  Thus, the filters in the subchannel stack see a different context in `init_call_elem()` than in `start_transport_stream_op_batch()`.\r\n\r\nThere are a few possible approaches to fix this, none of them particularly appealing:\r\n\r\n- Fix client_channel code to reset the context passed down with each batch to be the subchannel context even in the non-retry case.  This would not be a complete solution, because any filter can alter the context at any time, and we would need a way to propagate those changes between the subchannel context and the parent context.\r\n- Stop using a separate context for the subchannel stack.  The only reason we did this was to support client-side load reporting in grpclb, in which we need to pass down a refcounted client stats object to each subchannel stack (see #10821).  There are two possible options here:\r\n  - Instead of using context, pass down the client stats object via metadata.  The problem with this is that we don't currently have a clean way to pass down non-string data via metadata.\r\n  - Alternatively, we could just set the client stats object in the parent context and pass that down.  This would work fine today for both non-retry and retry cases, but it would not work later when we go to implement hedging.\r\n\r\nWe'll need to think about the best way to fix this."
  },
  {
    "url": "https://api.github.com/repos/grpc/grpc/issues/comments/465257972",
    "html_url": "https://github.com/grpc/grpc/issues/15927#issuecomment-465257972",
    "issue_url": "https://api.github.com/repos/grpc/grpc/issues/15927",
    "id": 465257972,
    "node_id": "MDEyOklzc3VlQ29tbWVudDQ2NTI1Nzk3Mg==",
    "user": {
      "login": "markdroth",
      "id": 18664614,
      "node_id": "MDQ6VXNlcjE4NjY0NjE0",
      "avatar_url": "https://avatars2.githubusercontent.com/u/18664614?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/markdroth",
      "html_url": "https://github.com/markdroth",
      "followers_url": "https://api.github.com/users/markdroth/followers",
      "following_url": "https://api.github.com/users/markdroth/following{/other_user}",
      "gists_url": "https://api.github.com/users/markdroth/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/markdroth/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/markdroth/subscriptions",
      "organizations_url": "https://api.github.com/users/markdroth/orgs",
      "repos_url": "https://api.github.com/users/markdroth/repos",
      "events_url": "https://api.github.com/users/markdroth/events{/privacy}",
      "received_events_url": "https://api.github.com/users/markdroth/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2019-02-19T18:41:26Z",
    "updated_at": "2019-02-19T18:41:26Z",
    "author_association": "MEMBER",
    "body": "I'm going to solve this by passing down the client stats object in user data attached to the LB token metadata element.\r\n\r\nThere will still be future work needed here when we later to go to implement hedging support, but we can deal with that when the time comes."
  }
]
