[
  {
    "url": "https://api.github.com/repos/grpc/grpc/issues/comments/338728781",
    "html_url": "https://github.com/grpc/grpc/issues/13103#issuecomment-338728781",
    "issue_url": "https://api.github.com/repos/grpc/grpc/issues/13103",
    "id": 338728781,
    "node_id": "MDEyOklzc3VlQ29tbWVudDMzODcyODc4MQ==",
    "user": {
      "login": "apolcyn",
      "id": 9566254,
      "node_id": "MDQ6VXNlcjk1NjYyNTQ=",
      "avatar_url": "https://avatars1.githubusercontent.com/u/9566254?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/apolcyn",
      "html_url": "https://github.com/apolcyn",
      "followers_url": "https://api.github.com/users/apolcyn/followers",
      "following_url": "https://api.github.com/users/apolcyn/following{/other_user}",
      "gists_url": "https://api.github.com/users/apolcyn/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/apolcyn/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/apolcyn/subscriptions",
      "organizations_url": "https://api.github.com/users/apolcyn/orgs",
      "repos_url": "https://api.github.com/users/apolcyn/repos",
      "events_url": "https://api.github.com/users/apolcyn/events{/privacy}",
      "received_events_url": "https://api.github.com/users/apolcyn/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2017-10-23T17:07:43Z",
    "updated_at": "2017-10-23T17:07:43Z",
    "author_association": "CONTRIBUTOR",
    "body": "From the trace here, it looks like this is happening during unmarshalling of a protobuf message. But it also looks like this was using an older version of the `google-protobuf` gem, at `google-protobuf-3.2.0.2-x86_64-linux`.\r\n\r\nThere have been some bug fixes for the `google-protobuf` gem since that version was released. Are you able to see if upgrading to the latest version of `google-protobuf` fixes this issue for you."
  },
  {
    "url": "https://api.github.com/repos/grpc/grpc/issues/comments/338942752",
    "html_url": "https://github.com/grpc/grpc/issues/13103#issuecomment-338942752",
    "issue_url": "https://api.github.com/repos/grpc/grpc/issues/13103",
    "id": 338942752,
    "node_id": "MDEyOklzc3VlQ29tbWVudDMzODk0Mjc1Mg==",
    "user": {
      "login": "shaunakpp",
      "id": 3170078,
      "node_id": "MDQ6VXNlcjMxNzAwNzg=",
      "avatar_url": "https://avatars0.githubusercontent.com/u/3170078?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/shaunakpp",
      "html_url": "https://github.com/shaunakpp",
      "followers_url": "https://api.github.com/users/shaunakpp/followers",
      "following_url": "https://api.github.com/users/shaunakpp/following{/other_user}",
      "gists_url": "https://api.github.com/users/shaunakpp/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/shaunakpp/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/shaunakpp/subscriptions",
      "organizations_url": "https://api.github.com/users/shaunakpp/orgs",
      "repos_url": "https://api.github.com/users/shaunakpp/repos",
      "events_url": "https://api.github.com/users/shaunakpp/events{/privacy}",
      "received_events_url": "https://api.github.com/users/shaunakpp/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2017-10-24T10:13:18Z",
    "updated_at": "2017-10-24T10:13:18Z",
    "author_association": "NONE",
    "body": "Yes, that worked! @apolcyn Thank you so much for such a quick response! "
  },
  {
    "url": "https://api.github.com/repos/grpc/grpc/issues/comments/339568628",
    "html_url": "https://github.com/grpc/grpc/issues/13103#issuecomment-339568628",
    "issue_url": "https://api.github.com/repos/grpc/grpc/issues/13103",
    "id": 339568628,
    "node_id": "MDEyOklzc3VlQ29tbWVudDMzOTU2ODYyOA==",
    "user": {
      "login": "shaunakpp",
      "id": 3170078,
      "node_id": "MDQ6VXNlcjMxNzAwNzg=",
      "avatar_url": "https://avatars0.githubusercontent.com/u/3170078?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/shaunakpp",
      "html_url": "https://github.com/shaunakpp",
      "followers_url": "https://api.github.com/users/shaunakpp/followers",
      "following_url": "https://api.github.com/users/shaunakpp/following{/other_user}",
      "gists_url": "https://api.github.com/users/shaunakpp/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/shaunakpp/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/shaunakpp/subscriptions",
      "organizations_url": "https://api.github.com/users/shaunakpp/orgs",
      "repos_url": "https://api.github.com/users/shaunakpp/repos",
      "events_url": "https://api.github.com/users/shaunakpp/events{/privacy}",
      "received_events_url": "https://api.github.com/users/shaunakpp/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2017-10-26T06:48:54Z",
    "updated_at": "2017-10-26T06:48:54Z",
    "author_association": "NONE",
    "body": "Hi @apolcyn, I'm sorry to re-open this, but even after updating the necessary gems I'm still getting this error, although now it occurs less frequently than before. I've listed the gems installed which use grpc in my system.\r\n~~~shell\r\ngrpc (1.6.7 x86_64-linux, 1.6.6 x86_64-linux)\r\ngoogle-cloud-core (1.0.0)\r\ngoogle-cloud-datastore (1.1.0)\r\ngoogle-cloud-env (1.0.1)\r\ngoogle-gax (0.8.12)\r\ngoogle-protobuf (3.4.1.1 x86_64-linux, 3.2.0.2 x86_64-linux)\r\ngoogleapis-common-protos (1.3.6)\r\ngoogleapis-common-protos-types (1.0.0)\r\ngoogleauth (0.5.3)\r\n~~~"
  },
  {
    "url": "https://api.github.com/repos/grpc/grpc/issues/comments/342663948",
    "html_url": "https://github.com/grpc/grpc/issues/13103#issuecomment-342663948",
    "issue_url": "https://api.github.com/repos/grpc/grpc/issues/13103",
    "id": 342663948,
    "node_id": "MDEyOklzc3VlQ29tbWVudDM0MjY2Mzk0OA==",
    "user": {
      "login": "apolcyn",
      "id": 9566254,
      "node_id": "MDQ6VXNlcjk1NjYyNTQ=",
      "avatar_url": "https://avatars1.githubusercontent.com/u/9566254?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/apolcyn",
      "html_url": "https://github.com/apolcyn",
      "followers_url": "https://api.github.com/users/apolcyn/followers",
      "following_url": "https://api.github.com/users/apolcyn/following{/other_user}",
      "gists_url": "https://api.github.com/users/apolcyn/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/apolcyn/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/apolcyn/subscriptions",
      "organizations_url": "https://api.github.com/users/apolcyn/orgs",
      "repos_url": "https://api.github.com/users/apolcyn/repos",
      "events_url": "https://api.github.com/users/apolcyn/events{/privacy}",
      "received_events_url": "https://api.github.com/users/apolcyn/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2017-11-07T23:56:01Z",
    "updated_at": "2017-11-07T23:56:01Z",
    "author_association": "CONTRIBUTOR",
    "body": "@shaunakpp are you able to describe an example of the messages in these queries, the exact data strore APIs being called, and the pattern of how they are called? Ideally, do you have example code to reproduce?"
  },
  {
    "url": "https://api.github.com/repos/grpc/grpc/issues/comments/343019769",
    "html_url": "https://github.com/grpc/grpc/issues/13103#issuecomment-343019769",
    "issue_url": "https://api.github.com/repos/grpc/grpc/issues/13103",
    "id": 343019769,
    "node_id": "MDEyOklzc3VlQ29tbWVudDM0MzAxOTc2OQ==",
    "user": {
      "login": "apolcyn",
      "id": 9566254,
      "node_id": "MDQ6VXNlcjk1NjYyNTQ=",
      "avatar_url": "https://avatars1.githubusercontent.com/u/9566254?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/apolcyn",
      "html_url": "https://github.com/apolcyn",
      "followers_url": "https://api.github.com/users/apolcyn/followers",
      "following_url": "https://api.github.com/users/apolcyn/following{/other_user}",
      "gists_url": "https://api.github.com/users/apolcyn/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/apolcyn/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/apolcyn/subscriptions",
      "organizations_url": "https://api.github.com/users/apolcyn/orgs",
      "repos_url": "https://api.github.com/users/apolcyn/repos",
      "events_url": "https://api.github.com/users/apolcyn/events{/privacy}",
      "received_events_url": "https://api.github.com/users/apolcyn/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2017-11-09T01:38:52Z",
    "updated_at": "2017-11-09T01:40:42Z",
    "author_association": "CONTRIBUTOR",
    "body": "@shaunakpp are you certain that `google-protobuf` is actually getting used here?\r\n\r\n`google-cloud-datastore-1.1.0` has a dependency on `google-protobuf ~> 3.2.0`, which as far as I can tell prevents it from using `google-protobuf` version 3.4.1.1, even though it may be installed.\r\n\r\nI was able to reproduce the stack trace posted here with both `google-protobuf (3.4.1.1 x86_64-linux, 3.2.0.2 x86_64-linux)` installed, as you have posted above, but the stack trace of the segfault shows that `google-protobuf` version `3.2.0.2` is the one that has actually been loaded in the process.\r\n\r\nSo I believe that to fix this we need to see if we can allow the datastore gem to increase it's max-allowed version of protobuf, in order to pick up the bug fixes in the latest version. cc @@geigerj about this\r\n\r\n\r\n\r\n"
  },
  {
    "url": "https://api.github.com/repos/grpc/grpc/issues/comments/343050031",
    "html_url": "https://github.com/grpc/grpc/issues/13103#issuecomment-343050031",
    "issue_url": "https://api.github.com/repos/grpc/grpc/issues/13103",
    "id": 343050031,
    "node_id": "MDEyOklzc3VlQ29tbWVudDM0MzA1MDAzMQ==",
    "user": {
      "login": "apolcyn",
      "id": 9566254,
      "node_id": "MDQ6VXNlcjk1NjYyNTQ=",
      "avatar_url": "https://avatars1.githubusercontent.com/u/9566254?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/apolcyn",
      "html_url": "https://github.com/apolcyn",
      "followers_url": "https://api.github.com/users/apolcyn/followers",
      "following_url": "https://api.github.com/users/apolcyn/following{/other_user}",
      "gists_url": "https://api.github.com/users/apolcyn/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/apolcyn/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/apolcyn/subscriptions",
      "organizations_url": "https://api.github.com/users/apolcyn/orgs",
      "repos_url": "https://api.github.com/users/apolcyn/repos",
      "events_url": "https://api.github.com/users/apolcyn/events{/privacy}",
      "received_events_url": "https://api.github.com/users/apolcyn/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2017-11-09T05:18:16Z",
    "updated_at": "2017-11-09T05:18:16Z",
    "author_association": "CONTRIBUTOR",
    "body": "* update to above comment, wanted to see if you are able to run google-protobuf version 3.4 with the datastore... I don't think this is possible but just checking"
  },
  {
    "url": "https://api.github.com/repos/grpc/grpc/issues/comments/343059544",
    "html_url": "https://github.com/grpc/grpc/issues/13103#issuecomment-343059544",
    "issue_url": "https://api.github.com/repos/grpc/grpc/issues/13103",
    "id": 343059544,
    "node_id": "MDEyOklzc3VlQ29tbWVudDM0MzA1OTU0NA==",
    "user": {
      "login": "shaunakpp",
      "id": 3170078,
      "node_id": "MDQ6VXNlcjMxNzAwNzg=",
      "avatar_url": "https://avatars0.githubusercontent.com/u/3170078?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/shaunakpp",
      "html_url": "https://github.com/shaunakpp",
      "followers_url": "https://api.github.com/users/shaunakpp/followers",
      "following_url": "https://api.github.com/users/shaunakpp/following{/other_user}",
      "gists_url": "https://api.github.com/users/shaunakpp/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/shaunakpp/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/shaunakpp/subscriptions",
      "organizations_url": "https://api.github.com/users/shaunakpp/orgs",
      "repos_url": "https://api.github.com/users/shaunakpp/repos",
      "events_url": "https://api.github.com/users/shaunakpp/events{/privacy}",
      "received_events_url": "https://api.github.com/users/shaunakpp/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2017-11-09T06:26:55Z",
    "updated_at": "2017-11-09T06:32:26Z",
    "author_association": "NONE",
    "body": "Hi @apolcyn, I did try to update `google-protobuf` but couldn't. And I also did some backtracking to find out why `google-protobuf` was locked to `3.2.0.2`, so it seems that [`google-cloud-datastore 1.1.0`](https://github.com/GoogleCloudPlatform/google-cloud-ruby/blob/master/google-cloud-datastore/google-cloud-datastore.gemspec#L22) has a dependency of `google-gax 0.8.0` which locks `google-protobuf` to versions  [~> 3.2](https://github.com/googleapis/gax-ruby/blob/master/google-gax.gemspec#L27)."
  },
  {
    "url": "https://api.github.com/repos/grpc/grpc/issues/comments/343064689",
    "html_url": "https://github.com/grpc/grpc/issues/13103#issuecomment-343064689",
    "issue_url": "https://api.github.com/repos/grpc/grpc/issues/13103",
    "id": 343064689,
    "node_id": "MDEyOklzc3VlQ29tbWVudDM0MzA2NDY4OQ==",
    "user": {
      "login": "apolcyn",
      "id": 9566254,
      "node_id": "MDQ6VXNlcjk1NjYyNTQ=",
      "avatar_url": "https://avatars1.githubusercontent.com/u/9566254?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/apolcyn",
      "html_url": "https://github.com/apolcyn",
      "followers_url": "https://api.github.com/users/apolcyn/followers",
      "following_url": "https://api.github.com/users/apolcyn/following{/other_user}",
      "gists_url": "https://api.github.com/users/apolcyn/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/apolcyn/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/apolcyn/subscriptions",
      "organizations_url": "https://api.github.com/users/apolcyn/orgs",
      "repos_url": "https://api.github.com/users/apolcyn/repos",
      "events_url": "https://api.github.com/users/apolcyn/events{/privacy}",
      "received_events_url": "https://api.github.com/users/apolcyn/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2017-11-09T06:59:31Z",
    "updated_at": "2017-11-09T08:44:24Z",
    "author_association": "CONTRIBUTOR",
    "body": "Indeed, I'm interested to see if that <s>`google-gax`'s protobuf dependency can be bumped to the latest version.</s>\r\n\r\nActually, it looks like the problem is that `google-cloud-datastore-1.1.0` (the latest), has a dependency on `google-protobuf-3.2.0.2`. This dependency was updgraded in [this PR](https://github.com/GoogleCloudPlatform/google-cloud-ruby/pull/1658) and is now present on master, but AFAICS it is only on datastore's master and hasn't been released yet. cc @blowmage do you know when the next release of datastore will be?"
  },
  {
    "url": "https://api.github.com/repos/grpc/grpc/issues/comments/343119616",
    "html_url": "https://github.com/grpc/grpc/issues/13103#issuecomment-343119616",
    "issue_url": "https://api.github.com/repos/grpc/grpc/issues/13103",
    "id": 343119616,
    "node_id": "MDEyOklzc3VlQ29tbWVudDM0MzExOTYxNg==",
    "user": {
      "login": "blowmage",
      "id": 730,
      "node_id": "MDQ6VXNlcjczMA==",
      "avatar_url": "https://avatars0.githubusercontent.com/u/730?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/blowmage",
      "html_url": "https://github.com/blowmage",
      "followers_url": "https://api.github.com/users/blowmage/followers",
      "following_url": "https://api.github.com/users/blowmage/following{/other_user}",
      "gists_url": "https://api.github.com/users/blowmage/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/blowmage/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/blowmage/subscriptions",
      "organizations_url": "https://api.github.com/users/blowmage/orgs",
      "repos_url": "https://api.github.com/users/blowmage/repos",
      "events_url": "https://api.github.com/users/blowmage/events{/privacy}",
      "received_events_url": "https://api.github.com/users/blowmage/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2017-11-09T10:55:43Z",
    "updated_at": "2017-11-09T10:55:43Z",
    "author_association": "CONTRIBUTOR",
    "body": "We are working on upgrades right now, and expect to release within a week. "
  },
  {
    "url": "https://api.github.com/repos/grpc/grpc/issues/comments/344787104",
    "html_url": "https://github.com/grpc/grpc/issues/13103#issuecomment-344787104",
    "issue_url": "https://api.github.com/repos/grpc/grpc/issues/13103",
    "id": 344787104,
    "node_id": "MDEyOklzc3VlQ29tbWVudDM0NDc4NzEwNA==",
    "user": {
      "login": "apolcyn",
      "id": 9566254,
      "node_id": "MDQ6VXNlcjk1NjYyNTQ=",
      "avatar_url": "https://avatars1.githubusercontent.com/u/9566254?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/apolcyn",
      "html_url": "https://github.com/apolcyn",
      "followers_url": "https://api.github.com/users/apolcyn/followers",
      "following_url": "https://api.github.com/users/apolcyn/following{/other_user}",
      "gists_url": "https://api.github.com/users/apolcyn/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/apolcyn/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/apolcyn/subscriptions",
      "organizations_url": "https://api.github.com/users/apolcyn/orgs",
      "repos_url": "https://api.github.com/users/apolcyn/repos",
      "events_url": "https://api.github.com/users/apolcyn/events{/privacy}",
      "received_events_url": "https://api.github.com/users/apolcyn/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2017-11-16T01:36:03Z",
    "updated_at": "2017-11-16T01:36:03Z",
    "author_association": "CONTRIBUTOR",
    "body": "I tried my repro of this now that datastore 1.2.0 is out, and so far I haven't been able to trigger it.\r\n\r\nFTR my repro was:\r\n\r\n```\r\nrequire \"google/cloud/datastore\"\r\n\r\ndatastore = Google::Cloud::Datastore.new(\r\n  project: <project>,\r\n) \r\n\r\nthds = []\r\n\r\n10000.times do\r\n  thds << Thread.new do\r\n    loop do\r\n      query = datastore.query(\"Task\").where(\"done\", \"=\", false)\r\n      tasks = datastore.run query\r\n    end\r\n  end\r\nend\r\n\r\nthds.each(&:join)\r\n```\r\n\r\nrunning that script in 3 concurrent processes on the same 2 core machine will see a segfault in at least on of those processes relatively quickly (within ~1 minute or so).\r\n\r\nI haven't been able to reproduce that same crash though since updating.\r\n\r\nClosing as I think this has been fixed. Please reopen if you're still seeing it."
  },
  {
    "url": "https://api.github.com/repos/grpc/grpc/issues/comments/344804134",
    "html_url": "https://github.com/grpc/grpc/issues/13103#issuecomment-344804134",
    "issue_url": "https://api.github.com/repos/grpc/grpc/issues/13103",
    "id": 344804134,
    "node_id": "MDEyOklzc3VlQ29tbWVudDM0NDgwNDEzNA==",
    "user": {
      "login": "shaunakpp",
      "id": 3170078,
      "node_id": "MDQ6VXNlcjMxNzAwNzg=",
      "avatar_url": "https://avatars0.githubusercontent.com/u/3170078?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/shaunakpp",
      "html_url": "https://github.com/shaunakpp",
      "followers_url": "https://api.github.com/users/shaunakpp/followers",
      "following_url": "https://api.github.com/users/shaunakpp/following{/other_user}",
      "gists_url": "https://api.github.com/users/shaunakpp/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/shaunakpp/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/shaunakpp/subscriptions",
      "organizations_url": "https://api.github.com/users/shaunakpp/orgs",
      "repos_url": "https://api.github.com/users/shaunakpp/repos",
      "events_url": "https://api.github.com/users/shaunakpp/events{/privacy}",
      "received_events_url": "https://api.github.com/users/shaunakpp/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2017-11-16T03:24:38Z",
    "updated_at": "2017-11-16T03:24:38Z",
    "author_association": "NONE",
    "body": "Awesome! Thanks a lot for helping me!"
  }
]
