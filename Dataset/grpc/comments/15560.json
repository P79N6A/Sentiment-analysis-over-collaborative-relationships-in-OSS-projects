[
  {
    "url": "https://api.github.com/repos/grpc/grpc/issues/comments/392800222",
    "html_url": "https://github.com/grpc/grpc/issues/15560#issuecomment-392800222",
    "issue_url": "https://api.github.com/repos/grpc/grpc/issues/15560",
    "id": 392800222,
    "node_id": "MDEyOklzc3VlQ29tbWVudDM5MjgwMDIyMg==",
    "user": {
      "login": "SVilgelm",
      "id": 523825,
      "node_id": "MDQ6VXNlcjUyMzgyNQ==",
      "avatar_url": "https://avatars2.githubusercontent.com/u/523825?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/SVilgelm",
      "html_url": "https://github.com/SVilgelm",
      "followers_url": "https://api.github.com/users/SVilgelm/followers",
      "following_url": "https://api.github.com/users/SVilgelm/following{/other_user}",
      "gists_url": "https://api.github.com/users/SVilgelm/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/SVilgelm/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/SVilgelm/subscriptions",
      "organizations_url": "https://api.github.com/users/SVilgelm/orgs",
      "repos_url": "https://api.github.com/users/SVilgelm/repos",
      "events_url": "https://api.github.com/users/SVilgelm/events{/privacy}",
      "received_events_url": "https://api.github.com/users/SVilgelm/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2018-05-29T14:36:58Z",
    "updated_at": "2018-05-29T14:36:58Z",
    "author_association": "NONE",
    "body": "Try with `--proto_path=.`. I cannot reproduce this error, but I can generate the code:\r\n```\r\n(misc-K4qDnAGa) bash-3.2$ ls -alh\r\ntotal 0\r\ndrwxr-xr-x   6 svilgelm  staff   192B May 29 09:28 .\r\ndrwxr-xr-x  21 svilgelm  staff   672B May 29 09:28 ..\r\ndrwxr-xr-x  22 svilgelm  staff   704B May 29 09:13 data-plane-api\r\ndrwxr-xr-x  16 svilgelm  staff   512B May 29 09:27 googleapis\r\ndrwxr-xr-x  24 svilgelm  staff   768B May 29 09:25 protoc-gen-validate\r\ndrwxr-xr-x   3 svilgelm  staff    96B May 29 09:29 src\r\n(misc-K4qDnAGa) bash-3.2$ python -m grpc_tools.protoc -I data-plane-api/ -I protoc-gen-validate/ -I googleapis/ --python_out=src/ --grpc_python_out=src/ data-plane-api/envoy/api/v2/cds.proto\r\n(misc-K4qDnAGa) bash-3.2$ ls -alh src/envoy/api/v2/\r\ntotal 112\r\ndrwxr-xr-x  4 svilgelm  staff   128B May 29 09:29 .\r\ndrwxr-xr-x  3 svilgelm  staff    96B May 29 09:29 ..\r\n-rw-r--r--  1 svilgelm  staff    50K May 29 09:30 cds_pb2.py\r\n-rw-r--r--  1 svilgelm  staff   2.6K May 29 09:30 cds_pb2_grpc.py\r\n```"
  },
  {
    "url": "https://api.github.com/repos/grpc/grpc/issues/comments/392824501",
    "html_url": "https://github.com/grpc/grpc/issues/15560#issuecomment-392824501",
    "issue_url": "https://api.github.com/repos/grpc/grpc/issues/15560",
    "id": 392824501,
    "node_id": "MDEyOklzc3VlQ29tbWVudDM5MjgyNDUwMQ==",
    "user": {
      "login": "SVilgelm",
      "id": 523825,
      "node_id": "MDQ6VXNlcjUyMzgyNQ==",
      "avatar_url": "https://avatars2.githubusercontent.com/u/523825?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/SVilgelm",
      "html_url": "https://github.com/SVilgelm",
      "followers_url": "https://api.github.com/users/SVilgelm/followers",
      "following_url": "https://api.github.com/users/SVilgelm/following{/other_user}",
      "gists_url": "https://api.github.com/users/SVilgelm/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/SVilgelm/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/SVilgelm/subscriptions",
      "organizations_url": "https://api.github.com/users/SVilgelm/orgs",
      "repos_url": "https://api.github.com/users/SVilgelm/repos",
      "events_url": "https://api.github.com/users/SVilgelm/events{/privacy}",
      "received_events_url": "https://api.github.com/users/SVilgelm/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2018-05-29T15:40:00Z",
    "updated_at": "2018-05-29T15:40:00Z",
    "author_association": "NONE",
    "body": "I found. Please take a look carefully at this code: https://github.com/grpc/grpc/blob/master/tools/distrib/python/grpcio_tools/grpc_tools/protoc.py#L35\r\n\r\nLooks like `protoc` uses a path from `sys.argv[0]`, so we need to provide `__file__`, also it includes a path to `grpc_tools` package.\r\n\r\nHere is working code:\r\n```\r\n(misc-K4qDnAGa) bash-3.2$ cat gen.py\r\n#!/usr/bin/env python\r\n\r\nfrom grpc_tools import protoc\r\n\r\nproto_include = protoc.pkg_resources.resource_filename('grpc_tools', '_proto')\r\n\r\nprotoc.main((\r\n    __file__,\r\n    '--proto_path={}'.format(proto_include),\r\n    '--proto_path=data-plane-api',\r\n    '--proto_path=protoc-gen-validate',\r\n    '--proto_path=googleapis',\r\n    '--python_out=src/',\r\n    '--grpc_python_out=src/',\r\n    'data-plane-api/envoy/api/v2/cds.proto',\r\n))\r\n```"
  },
  {
    "url": "https://api.github.com/repos/grpc/grpc/issues/comments/393018569",
    "html_url": "https://github.com/grpc/grpc/issues/15560#issuecomment-393018569",
    "issue_url": "https://api.github.com/repos/grpc/grpc/issues/15560",
    "id": 393018569,
    "node_id": "MDEyOklzc3VlQ29tbWVudDM5MzAxODU2OQ==",
    "user": {
      "login": "cetanu",
      "id": 2289018,
      "node_id": "MDQ6VXNlcjIyODkwMTg=",
      "avatar_url": "https://avatars0.githubusercontent.com/u/2289018?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/cetanu",
      "html_url": "https://github.com/cetanu",
      "followers_url": "https://api.github.com/users/cetanu/followers",
      "following_url": "https://api.github.com/users/cetanu/following{/other_user}",
      "gists_url": "https://api.github.com/users/cetanu/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/cetanu/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/cetanu/subscriptions",
      "organizations_url": "https://api.github.com/users/cetanu/orgs",
      "repos_url": "https://api.github.com/users/cetanu/repos",
      "events_url": "https://api.github.com/users/cetanu/events{/privacy}",
      "received_events_url": "https://api.github.com/users/cetanu/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2018-05-30T03:26:06Z",
    "updated_at": "2018-05-30T03:26:06Z",
    "author_association": "NONE",
    "body": "Some of your proto paths, I assumed that they are github repos. It turns out that they are. This is what ultimately helped me.\r\n\r\nI found a library on pypi for generating protobuf files, and used that instead.\r\n\r\nThis is ultimately how I generated the code:\r\n\r\n```\r\nimport os\r\nfrom protobuf_gen import remap\r\n\r\nos.makedirs(\r\n    'proto_build/repos',\r\n    exist_ok=True\r\n)\r\n\r\nrepo_deps = {\r\n    './proto_build/repos/data-plane-api': 'https://github.com/envoyproxy/data-plane-api.git',\r\n    './proto_build/repos/googleapis': 'https://github.com/googleapis/googleapis.git',\r\n    './proto_build/repos/protoc-gen-validate': 'https://github.com/lyft/protoc-gen-validate.git',\r\n}\r\n\r\nfor folder, repo in repo_deps.items():\r\n    os.system(f'git clone {repo} {folder}')\r\n\r\nremap(\r\n    output_dir_autogen='.',\r\n    root_autogen='envoy_protos',\r\n    includes=list(repo_deps),\r\n    input_proto=[\r\n        # Types\r\n        'envoy/type/percent.proto',\r\n        'envoy/type/range.proto',\r\n        # Core\r\n        'envoy/api/v2/core/address.proto',\r\n        'envoy/api/v2/core/base.proto',\r\n        'envoy/api/v2/core/config_source.proto',\r\n        'envoy/api/v2/core/health_check.proto',\r\n        'envoy/api/v2/core/protocol.proto',\r\n        'envoy/api/v2/core/grpc_service.proto',\r\n        # Cluster\r\n        'envoy/api/v2/cluster/circuit_breaker.proto',\r\n        'envoy/api/v2/cluster/outlier_detection.proto',\r\n        # Endpoint\r\n        'envoy/api/v2/endpoint/endpoint.proto',\r\n        # Listener\r\n        'envoy/api/v2/listener/listener.proto',\r\n        # Route\r\n        'envoy/api/v2/route/route.proto',\r\n        # Auth\r\n        'envoy/api/v2/auth/cert.proto',\r\n        # XDS\r\n        'envoy/api/v2/discovery.proto',\r\n        'envoy/api/v2/cds.proto',\r\n        'envoy/api/v2/eds.proto',\r\n        'envoy/api/v2/lds.proto',\r\n        'envoy/api/v2/rds.proto',\r\n        # 3rd party\r\n        'google/api/annotations.proto',\r\n        'gogoproto/gogo.proto',\r\n        'validate/validate.proto',\r\n    ]\r\n)\r\n```"
  }
]
