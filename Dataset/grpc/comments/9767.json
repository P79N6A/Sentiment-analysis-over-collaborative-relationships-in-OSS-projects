[
  {
    "url": "https://api.github.com/repos/grpc/grpc/issues/comments/280826588",
    "html_url": "https://github.com/grpc/grpc/issues/9767#issuecomment-280826588",
    "issue_url": "https://api.github.com/repos/grpc/grpc/issues/9767",
    "id": 280826588,
    "node_id": "MDEyOklzc3VlQ29tbWVudDI4MDgyNjU4OA==",
    "user": {
      "login": "cysnake4713",
      "id": 275267,
      "node_id": "MDQ6VXNlcjI3NTI2Nw==",
      "avatar_url": "https://avatars3.githubusercontent.com/u/275267?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/cysnake4713",
      "html_url": "https://github.com/cysnake4713",
      "followers_url": "https://api.github.com/users/cysnake4713/followers",
      "following_url": "https://api.github.com/users/cysnake4713/following{/other_user}",
      "gists_url": "https://api.github.com/users/cysnake4713/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/cysnake4713/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/cysnake4713/subscriptions",
      "organizations_url": "https://api.github.com/users/cysnake4713/orgs",
      "repos_url": "https://api.github.com/users/cysnake4713/repos",
      "events_url": "https://api.github.com/users/cysnake4713/events{/privacy}",
      "received_events_url": "https://api.github.com/users/cysnake4713/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2017-02-18T06:43:04Z",
    "updated_at": "2017-02-18T06:43:04Z",
    "author_association": "NONE",
    "body": "same problem here!! +1"
  },
  {
    "url": "https://api.github.com/repos/grpc/grpc/issues/comments/280889663",
    "html_url": "https://github.com/grpc/grpc/issues/9767#issuecomment-280889663",
    "issue_url": "https://api.github.com/repos/grpc/grpc/issues/9767",
    "id": 280889663,
    "node_id": "MDEyOklzc3VlQ29tbWVudDI4MDg4OTY2Mw==",
    "user": {
      "login": "ncteisen",
      "id": 6148140,
      "node_id": "MDQ6VXNlcjYxNDgxNDA=",
      "avatar_url": "https://avatars1.githubusercontent.com/u/6148140?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/ncteisen",
      "html_url": "https://github.com/ncteisen",
      "followers_url": "https://api.github.com/users/ncteisen/followers",
      "following_url": "https://api.github.com/users/ncteisen/following{/other_user}",
      "gists_url": "https://api.github.com/users/ncteisen/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/ncteisen/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/ncteisen/subscriptions",
      "organizations_url": "https://api.github.com/users/ncteisen/orgs",
      "repos_url": "https://api.github.com/users/ncteisen/repos",
      "events_url": "https://api.github.com/users/ncteisen/events{/privacy}",
      "received_events_url": "https://api.github.com/users/ncteisen/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2017-02-19T01:58:23Z",
    "updated_at": "2017-02-19T01:58:23Z",
    "author_association": "CONTRIBUTOR",
    "body": "This is a known issue with the c core. TL;DR, we know why it happens, and it will be addressed by the retry implementation coming in the next few months. Check out this [gRFC](https://github.com/grpc/proposal/pull/12) for more details. Specifically [this section](https://github.com/ncteisen/proposal/blob/4d61d04e3db298b1c2503e1ab0245f16e1b86967/A6.md#transparent-retries).\r\n\r\nBasically this occurs because the RPC goes all the way through the channel, lb_policy, subchannel, to the transport before it realizes the connection has terminated, and at that point it is too late to try to reconnect, so the RPC fails. But again, this will soon be fixed.\r\n\r\nFor now hacking together your own simple retry logic is the best fix."
  },
  {
    "url": "https://api.github.com/repos/grpc/grpc/issues/comments/281119472",
    "html_url": "https://github.com/grpc/grpc/issues/9767#issuecomment-281119472",
    "issue_url": "https://api.github.com/repos/grpc/grpc/issues/9767",
    "id": 281119472,
    "node_id": "MDEyOklzc3VlQ29tbWVudDI4MTExOTQ3Mg==",
    "user": {
      "login": "yyh-graphsql",
      "id": 18043285,
      "node_id": "MDQ6VXNlcjE4MDQzMjg1",
      "avatar_url": "https://avatars1.githubusercontent.com/u/18043285?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/yyh-graphsql",
      "html_url": "https://github.com/yyh-graphsql",
      "followers_url": "https://api.github.com/users/yyh-graphsql/followers",
      "following_url": "https://api.github.com/users/yyh-graphsql/following{/other_user}",
      "gists_url": "https://api.github.com/users/yyh-graphsql/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/yyh-graphsql/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/yyh-graphsql/subscriptions",
      "organizations_url": "https://api.github.com/users/yyh-graphsql/orgs",
      "repos_url": "https://api.github.com/users/yyh-graphsql/repos",
      "events_url": "https://api.github.com/users/yyh-graphsql/events{/privacy}",
      "received_events_url": "https://api.github.com/users/yyh-graphsql/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2017-02-20T16:12:30Z",
    "updated_at": "2017-02-20T16:12:30Z",
    "author_association": "NONE",
    "body": "@ncteisen  Have you notice the retry logic I posted above. The thing is even the retry logic succeed, but when it comes to \"stub.xxx\", it will also get UNAVAILABLE.\r\n@cysnake4713 Did you get the exactly same problem? For me, it showed randomly when ran in my local virtual machine."
  },
  {
    "url": "https://api.github.com/repos/grpc/grpc/issues/comments/281185321",
    "html_url": "https://github.com/grpc/grpc/issues/9767#issuecomment-281185321",
    "issue_url": "https://api.github.com/repos/grpc/grpc/issues/9767",
    "id": 281185321,
    "node_id": "MDEyOklzc3VlQ29tbWVudDI4MTE4NTMyMQ==",
    "user": {
      "login": "yyh-graphsql",
      "id": 18043285,
      "node_id": "MDQ6VXNlcjE4MDQzMjg1",
      "avatar_url": "https://avatars1.githubusercontent.com/u/18043285?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/yyh-graphsql",
      "html_url": "https://github.com/yyh-graphsql",
      "followers_url": "https://api.github.com/users/yyh-graphsql/followers",
      "following_url": "https://api.github.com/users/yyh-graphsql/following{/other_user}",
      "gists_url": "https://api.github.com/users/yyh-graphsql/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/yyh-graphsql/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/yyh-graphsql/subscriptions",
      "organizations_url": "https://api.github.com/users/yyh-graphsql/orgs",
      "repos_url": "https://api.github.com/users/yyh-graphsql/repos",
      "events_url": "https://api.github.com/users/yyh-graphsql/events{/privacy}",
      "received_events_url": "https://api.github.com/users/yyh-graphsql/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2017-02-20T21:29:18Z",
    "updated_at": "2017-02-20T21:29:18Z",
    "author_association": "NONE",
    "body": "@ncteisen  The situation I encountered is actually like this:\r\n\r\n- Set up channel to Server A\r\n- Send an RPC and succeed\r\n- Restart Server A until it can receive RPCs\r\n- Re-send an RPC and this RPC got UNAVAILABLE\r\n\r\nSeems the thing is not like the server restart at the middle stage of one RPC. I just reuse a channel before and after server restart."
  },
  {
    "url": "https://api.github.com/repos/grpc/grpc/issues/comments/281188730",
    "html_url": "https://github.com/grpc/grpc/issues/9767#issuecomment-281188730",
    "issue_url": "https://api.github.com/repos/grpc/grpc/issues/9767",
    "id": 281188730,
    "node_id": "MDEyOklzc3VlQ29tbWVudDI4MTE4ODczMA==",
    "user": {
      "login": "ncteisen",
      "id": 6148140,
      "node_id": "MDQ6VXNlcjYxNDgxNDA=",
      "avatar_url": "https://avatars1.githubusercontent.com/u/6148140?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/ncteisen",
      "html_url": "https://github.com/ncteisen",
      "followers_url": "https://api.github.com/users/ncteisen/followers",
      "following_url": "https://api.github.com/users/ncteisen/following{/other_user}",
      "gists_url": "https://api.github.com/users/ncteisen/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/ncteisen/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/ncteisen/subscriptions",
      "organizations_url": "https://api.github.com/users/ncteisen/orgs",
      "repos_url": "https://api.github.com/users/ncteisen/repos",
      "events_url": "https://api.github.com/users/ncteisen/events{/privacy}",
      "received_events_url": "https://api.github.com/users/ncteisen/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2017-02-20T21:44:40Z",
    "updated_at": "2017-02-20T21:44:40Z",
    "author_association": "CONTRIBUTOR",
    "body": "That situation is expected behavior. Try doing this:\r\n* Set up channel to Server A\r\n* Send an RPC and succeed\r\n* Restart Server A until it can receive RPCs\r\n* Re-send an RPC and this RPC got UNAVAILABLE\r\n* Send another RPC, this one should work fine."
  },
  {
    "url": "https://api.github.com/repos/grpc/grpc/issues/comments/281189460",
    "html_url": "https://github.com/grpc/grpc/issues/9767#issuecomment-281189460",
    "issue_url": "https://api.github.com/repos/grpc/grpc/issues/9767",
    "id": 281189460,
    "node_id": "MDEyOklzc3VlQ29tbWVudDI4MTE4OTQ2MA==",
    "user": {
      "login": "ncteisen",
      "id": 6148140,
      "node_id": "MDQ6VXNlcjYxNDgxNDA=",
      "avatar_url": "https://avatars1.githubusercontent.com/u/6148140?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/ncteisen",
      "html_url": "https://github.com/ncteisen",
      "followers_url": "https://api.github.com/users/ncteisen/followers",
      "following_url": "https://api.github.com/users/ncteisen/following{/other_user}",
      "gists_url": "https://api.github.com/users/ncteisen/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/ncteisen/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/ncteisen/subscriptions",
      "organizations_url": "https://api.github.com/users/ncteisen/orgs",
      "repos_url": "https://api.github.com/users/ncteisen/repos",
      "events_url": "https://api.github.com/users/ncteisen/events{/privacy}",
      "received_events_url": "https://api.github.com/users/ncteisen/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2017-02-20T21:47:52Z",
    "updated_at": "2017-02-20T21:47:52Z",
    "author_association": "CONTRIBUTOR",
    "body": "Also, would suggest checking out [WaitForConnected](https://github.com/grpc/grpc/blob/5098508d2d41a116113f7e333c516cd9ef34a943/include/grpc%2B%2B/impl/codegen/channel_interface.h#L90) and [set_wait_for_ready](https://github.com/grpc/grpc/blob/46357c882df1afc28f7a5228c40fde522093fa32/include/grpc%2B%2B/impl/codegen/client_context.h#L232). They have some of the functionality that your pseudocode was using."
  },
  {
    "url": "https://api.github.com/repos/grpc/grpc/issues/comments/281702888",
    "html_url": "https://github.com/grpc/grpc/issues/9767#issuecomment-281702888",
    "issue_url": "https://api.github.com/repos/grpc/grpc/issues/9767",
    "id": 281702888,
    "node_id": "MDEyOklzc3VlQ29tbWVudDI4MTcwMjg4OA==",
    "user": {
      "login": "yyh-graphsql",
      "id": 18043285,
      "node_id": "MDQ6VXNlcjE4MDQzMjg1",
      "avatar_url": "https://avatars1.githubusercontent.com/u/18043285?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/yyh-graphsql",
      "html_url": "https://github.com/yyh-graphsql",
      "followers_url": "https://api.github.com/users/yyh-graphsql/followers",
      "following_url": "https://api.github.com/users/yyh-graphsql/following{/other_user}",
      "gists_url": "https://api.github.com/users/yyh-graphsql/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/yyh-graphsql/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/yyh-graphsql/subscriptions",
      "organizations_url": "https://api.github.com/users/yyh-graphsql/orgs",
      "repos_url": "https://api.github.com/users/yyh-graphsql/repos",
      "events_url": "https://api.github.com/users/yyh-graphsql/events{/privacy}",
      "received_events_url": "https://api.github.com/users/yyh-graphsql/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2017-02-22T15:30:47Z",
    "updated_at": "2017-02-22T15:30:47Z",
    "author_association": "NONE",
    "body": "@ncteisen You mean before re-send the RPC, if I WaitForConnected for the channel I used, the re-sent RPC will also work fine? Actually, I'm also curious about why when restarting the server the first RPC will fail and the second is ok. Can you explain me a little bit or give me some references? Thank you!"
  },
  {
    "url": "https://api.github.com/repos/grpc/grpc/issues/comments/281722719",
    "html_url": "https://github.com/grpc/grpc/issues/9767#issuecomment-281722719",
    "issue_url": "https://api.github.com/repos/grpc/grpc/issues/9767",
    "id": 281722719,
    "node_id": "MDEyOklzc3VlQ29tbWVudDI4MTcyMjcxOQ==",
    "user": {
      "login": "ncteisen",
      "id": 6148140,
      "node_id": "MDQ6VXNlcjYxNDgxNDA=",
      "avatar_url": "https://avatars1.githubusercontent.com/u/6148140?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/ncteisen",
      "html_url": "https://github.com/ncteisen",
      "followers_url": "https://api.github.com/users/ncteisen/followers",
      "following_url": "https://api.github.com/users/ncteisen/following{/other_user}",
      "gists_url": "https://api.github.com/users/ncteisen/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/ncteisen/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/ncteisen/subscriptions",
      "organizations_url": "https://api.github.com/users/ncteisen/orgs",
      "repos_url": "https://api.github.com/users/ncteisen/repos",
      "events_url": "https://api.github.com/users/ncteisen/events{/privacy}",
      "received_events_url": "https://api.github.com/users/ncteisen/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2017-02-22T16:32:21Z",
    "updated_at": "2017-02-22T16:32:21Z",
    "author_association": "CONTRIBUTOR",
    "body": "When you kill the server, there is no mechanism in place to let the client know that the connection has gone bad. Instead, the client will believe that their channel is in a good state, and thus when an RPC is sent, it will travel all the way down to the transport layer before realizing that the connection had been closed.\r\n\r\nAt that point the failure is bubbled up to the client application. But, as I mentioned earlier, there is a work in progress to implement transparent retries in these situations.\r\n\r\nCheck out this [gRFC](https://github.com/grpc/proposal/pull/12) for more details. Specifically [this section](https://github.com/ncteisen/proposal/blob/4d61d04e3db298b1c2503e1ab0245f16e1b86967/A6.md#transparent-retries)."
  }
]
