[
  {
    "url": "https://api.github.com/repos/pandas-dev/pandas/issues/comments/313380154",
    "html_url": "https://github.com/pandas-dev/pandas/issues/16836#issuecomment-313380154",
    "issue_url": "https://api.github.com/repos/pandas-dev/pandas/issues/16836",
    "id": 313380154,
    "node_id": "MDEyOklzc3VlQ29tbWVudDMxMzM4MDE1NA==",
    "user": {
      "login": "jreback",
      "id": 953992,
      "node_id": "MDQ6VXNlcjk1Mzk5Mg==",
      "avatar_url": "https://avatars2.githubusercontent.com/u/953992?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/jreback",
      "html_url": "https://github.com/jreback",
      "followers_url": "https://api.github.com/users/jreback/followers",
      "following_url": "https://api.github.com/users/jreback/following{/other_user}",
      "gists_url": "https://api.github.com/users/jreback/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/jreback/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/jreback/subscriptions",
      "organizations_url": "https://api.github.com/users/jreback/orgs",
      "repos_url": "https://api.github.com/users/jreback/repos",
      "events_url": "https://api.github.com/users/jreback/events{/privacy}",
      "received_events_url": "https://api.github.com/users/jreback/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2017-07-06T12:20:12Z",
    "updated_at": "2017-07-06T12:20:12Z",
    "author_association": "CONTRIBUTOR",
    "body": "yeah looks a bit buggy. happy to have you take a look."
  },
  {
    "url": "https://api.github.com/repos/pandas-dev/pandas/issues/comments/315438188",
    "html_url": "https://github.com/pandas-dev/pandas/issues/16836#issuecomment-315438188",
    "issue_url": "https://api.github.com/repos/pandas-dev/pandas/issues/16836",
    "id": 315438188,
    "node_id": "MDEyOklzc3VlQ29tbWVudDMxNTQzODE4OA==",
    "user": {
      "login": "jdeschenes",
      "id": 9948816,
      "node_id": "MDQ6VXNlcjk5NDg4MTY=",
      "avatar_url": "https://avatars3.githubusercontent.com/u/9948816?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/jdeschenes",
      "html_url": "https://github.com/jdeschenes",
      "followers_url": "https://api.github.com/users/jdeschenes/followers",
      "following_url": "https://api.github.com/users/jdeschenes/following{/other_user}",
      "gists_url": "https://api.github.com/users/jdeschenes/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/jdeschenes/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/jdeschenes/subscriptions",
      "organizations_url": "https://api.github.com/users/jdeschenes/orgs",
      "repos_url": "https://api.github.com/users/jdeschenes/repos",
      "events_url": "https://api.github.com/users/jdeschenes/events{/privacy}",
      "received_events_url": "https://api.github.com/users/jdeschenes/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2017-07-14T18:50:10Z",
    "updated_at": "2017-07-14T18:50:10Z",
    "author_association": "CONTRIBUTOR",
    "body": "A bit of investigation:\r\n\r\nThe problem starts [here](https://github.com/pandas-dev/pandas/blob/6000c5b9624fdd8925099f215eba282bfbef87ce/pandas/core/frame.py#L3317) \r\n\r\nThe array is converted to a int64 view and the nan is thus lost. I presume this is done for speed up?\r\n\r\nI think `lexsort_indexer` will need to be aware that it is being passed a converted datetime and special case the code for NaT. What do you think?"
  },
  {
    "url": "https://api.github.com/repos/pandas-dev/pandas/issues/comments/315440427",
    "html_url": "https://github.com/pandas-dev/pandas/issues/16836#issuecomment-315440427",
    "issue_url": "https://api.github.com/repos/pandas-dev/pandas/issues/16836",
    "id": 315440427,
    "node_id": "MDEyOklzc3VlQ29tbWVudDMxNTQ0MDQyNw==",
    "user": {
      "login": "jreback",
      "id": 953992,
      "node_id": "MDQ6VXNlcjk1Mzk5Mg==",
      "avatar_url": "https://avatars2.githubusercontent.com/u/953992?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/jreback",
      "html_url": "https://github.com/jreback",
      "followers_url": "https://api.github.com/users/jreback/followers",
      "following_url": "https://api.github.com/users/jreback/following{/other_user}",
      "gists_url": "https://api.github.com/users/jreback/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/jreback/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/jreback/subscriptions",
      "organizations_url": "https://api.github.com/users/jreback/orgs",
      "repos_url": "https://api.github.com/users/jreback/repos",
      "events_url": "https://api.github.com/users/jreback/events{/privacy}",
      "received_events_url": "https://api.github.com/users/jreback/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2017-07-14T18:59:12Z",
    "updated_at": "2017-07-14T18:59:12Z",
    "author_association": "CONTRIBUTOR",
    "body": "These are converted just fine. (now I wouldn't mind actually moving the key conversions *inside* ``lexsort_indexer`` though (e.g. we do this for Categoricals now).\r\n\r\n```\r\nIn [6]: pd.DatetimeIndex(['20170101', 'nat'])\r\nOut[6]: DatetimeIndex(['2017-01-01', 'NaT'], dtype='datetime64[ns]', freq=None)\r\n\r\nIn [7]: pd.DatetimeIndex(['20170101', 'nat']).view('i8')\r\nOut[7]: array([ 1483228800000000000, -9223372036854775808])\r\n\r\n```"
  },
  {
    "url": "https://api.github.com/repos/pandas-dev/pandas/issues/comments/315442851",
    "html_url": "https://github.com/pandas-dev/pandas/issues/16836#issuecomment-315442851",
    "issue_url": "https://api.github.com/repos/pandas-dev/pandas/issues/16836",
    "id": 315442851,
    "node_id": "MDEyOklzc3VlQ29tbWVudDMxNTQ0Mjg1MQ==",
    "user": {
      "login": "jdeschenes",
      "id": 9948816,
      "node_id": "MDQ6VXNlcjk5NDg4MTY=",
      "avatar_url": "https://avatars3.githubusercontent.com/u/9948816?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/jdeschenes",
      "html_url": "https://github.com/jdeschenes",
      "followers_url": "https://api.github.com/users/jdeschenes/followers",
      "following_url": "https://api.github.com/users/jdeschenes/following{/other_user}",
      "gists_url": "https://api.github.com/users/jdeschenes/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/jdeschenes/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/jdeschenes/subscriptions",
      "organizations_url": "https://api.github.com/users/jdeschenes/orgs",
      "repos_url": "https://api.github.com/users/jdeschenes/repos",
      "events_url": "https://api.github.com/users/jdeschenes/events{/privacy}",
      "received_events_url": "https://api.github.com/users/jdeschenes/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2017-07-14T19:08:19Z",
    "updated_at": "2017-07-14T19:08:19Z",
    "author_association": "CONTRIBUTOR",
    "body": "The problem is that `lexsort_indexer` doesn't know that it is being passed a datetime instead of a `i8`.\r\n\r\nIf the function was converting the array instead, it could special case the NaT."
  },
  {
    "url": "https://api.github.com/repos/pandas-dev/pandas/issues/comments/315444890",
    "html_url": "https://github.com/pandas-dev/pandas/issues/16836#issuecomment-315444890",
    "issue_url": "https://api.github.com/repos/pandas-dev/pandas/issues/16836",
    "id": 315444890,
    "node_id": "MDEyOklzc3VlQ29tbWVudDMxNTQ0NDg5MA==",
    "user": {
      "login": "jreback",
      "id": 953992,
      "node_id": "MDQ6VXNlcjk1Mzk5Mg==",
      "avatar_url": "https://avatars2.githubusercontent.com/u/953992?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/jreback",
      "html_url": "https://github.com/jreback",
      "followers_url": "https://api.github.com/users/jreback/followers",
      "following_url": "https://api.github.com/users/jreback/following{/other_user}",
      "gists_url": "https://api.github.com/users/jreback/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/jreback/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/jreback/subscriptions",
      "organizations_url": "https://api.github.com/users/jreback/orgs",
      "repos_url": "https://api.github.com/users/jreback/repos",
      "events_url": "https://api.github.com/users/jreback/events{/privacy}",
      "received_events_url": "https://api.github.com/users/jreback/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2017-07-14T19:17:14Z",
    "updated_at": "2017-07-14T19:17:14Z",
    "author_association": "CONTRIBUTOR",
    "body": "actually in this case these can be simply converted to categoricals before passing to lexsort_indexer which will solve the problem (they are converted internallly anyhow).\r\n\r\n```\r\nIn [2]: pd.Categorical(pd.DatetimeIndex(['20170101', 'nat']))\r\nOut[2]: \r\n[2017-01-01, NaT]\r\nCategories (1, datetime64[ns]): [2017-01-01]\r\n\r\nIn [3]: pd.Categorical(pd.DatetimeIndex(['20170101', 'nat'])).codes\r\nOut[3]: array([ 0, -1], dtype=int8)\r\n```\r\n\r\nso first thing to try is to remove the i8 conversion entirely (as Categoricals already handle all of these endge cases)."
  },
  {
    "url": "https://api.github.com/repos/pandas-dev/pandas/issues/comments/315445693",
    "html_url": "https://github.com/pandas-dev/pandas/issues/16836#issuecomment-315445693",
    "issue_url": "https://api.github.com/repos/pandas-dev/pandas/issues/16836",
    "id": 315445693,
    "node_id": "MDEyOklzc3VlQ29tbWVudDMxNTQ0NTY5Mw==",
    "user": {
      "login": "jdeschenes",
      "id": 9948816,
      "node_id": "MDQ6VXNlcjk5NDg4MTY=",
      "avatar_url": "https://avatars3.githubusercontent.com/u/9948816?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/jdeschenes",
      "html_url": "https://github.com/jdeschenes",
      "followers_url": "https://api.github.com/users/jdeschenes/followers",
      "following_url": "https://api.github.com/users/jdeschenes/following{/other_user}",
      "gists_url": "https://api.github.com/users/jdeschenes/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/jdeschenes/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/jdeschenes/subscriptions",
      "organizations_url": "https://api.github.com/users/jdeschenes/orgs",
      "repos_url": "https://api.github.com/users/jdeschenes/repos",
      "events_url": "https://api.github.com/users/jdeschenes/events{/privacy}",
      "received_events_url": "https://api.github.com/users/jdeschenes/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2017-07-14T19:21:09Z",
    "updated_at": "2017-07-14T19:21:09Z",
    "author_association": "CONTRIBUTOR",
    "body": "as you suggested, just removing the conversion seems to solve the problem."
  },
  {
    "url": "https://api.github.com/repos/pandas-dev/pandas/issues/comments/315449285",
    "html_url": "https://github.com/pandas-dev/pandas/issues/16836#issuecomment-315449285",
    "issue_url": "https://api.github.com/repos/pandas-dev/pandas/issues/16836",
    "id": 315449285,
    "node_id": "MDEyOklzc3VlQ29tbWVudDMxNTQ0OTI4NQ==",
    "user": {
      "login": "jreback",
      "id": 953992,
      "node_id": "MDQ6VXNlcjk1Mzk5Mg==",
      "avatar_url": "https://avatars2.githubusercontent.com/u/953992?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/jreback",
      "html_url": "https://github.com/jreback",
      "followers_url": "https://api.github.com/users/jreback/followers",
      "following_url": "https://api.github.com/users/jreback/following{/other_user}",
      "gists_url": "https://api.github.com/users/jreback/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/jreback/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/jreback/subscriptions",
      "organizations_url": "https://api.github.com/users/jreback/orgs",
      "repos_url": "https://api.github.com/users/jreback/repos",
      "events_url": "https://api.github.com/users/jreback/events{/privacy}",
      "received_events_url": "https://api.github.com/users/jreback/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2017-07-14T19:39:38Z",
    "updated_at": "2017-07-14T19:39:38Z",
    "author_association": "CONTRIBUTOR",
    "body": "great!"
  }
]
