[
  {
    "url": "https://api.github.com/repos/pandas-dev/pandas/issues/comments/137842911",
    "html_url": "https://github.com/pandas-dev/pandas/pull/10993#issuecomment-137842911",
    "issue_url": "https://api.github.com/repos/pandas-dev/pandas/issues/10993",
    "id": 137842911,
    "node_id": "MDEyOklzc3VlQ29tbWVudDEzNzg0MjkxMQ==",
    "user": {
      "login": "jakevdp",
      "id": 781659,
      "node_id": "MDQ6VXNlcjc4MTY1OQ==",
      "avatar_url": "https://avatars0.githubusercontent.com/u/781659?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/jakevdp",
      "html_url": "https://github.com/jakevdp",
      "followers_url": "https://api.github.com/users/jakevdp/followers",
      "following_url": "https://api.github.com/users/jakevdp/following{/other_user}",
      "gists_url": "https://api.github.com/users/jakevdp/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/jakevdp/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/jakevdp/subscriptions",
      "organizations_url": "https://api.github.com/users/jakevdp/orgs",
      "repos_url": "https://api.github.com/users/jakevdp/repos",
      "events_url": "https://api.github.com/users/jakevdp/events{/privacy}",
      "received_events_url": "https://api.github.com/users/jakevdp/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2015-09-04T20:14:05Z",
    "updated_at": "2015-09-04T20:14:05Z",
    "author_association": "CONTRIBUTOR",
    "body": "I should add one thing: I decided that rather than adding a new item to the category, it would be cleaner to simply change categories to objects rather than trying to track down all the corner cases of hierarchical indices with categorical levels.\n"
  },
  {
    "url": "https://api.github.com/repos/pandas-dev/pandas/issues/comments/137846837",
    "html_url": "https://github.com/pandas-dev/pandas/pull/10993#issuecomment-137846837",
    "issue_url": "https://api.github.com/repos/pandas-dev/pandas/issues/10993",
    "id": 137846837,
    "node_id": "MDEyOklzc3VlQ29tbWVudDEzNzg0NjgzNw==",
    "user": {
      "login": "jakevdp",
      "id": 781659,
      "node_id": "MDQ6VXNlcjc4MTY1OQ==",
      "avatar_url": "https://avatars0.githubusercontent.com/u/781659?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/jakevdp",
      "html_url": "https://github.com/jakevdp",
      "followers_url": "https://api.github.com/users/jakevdp/followers",
      "following_url": "https://api.github.com/users/jakevdp/following{/other_user}",
      "gists_url": "https://api.github.com/users/jakevdp/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/jakevdp/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/jakevdp/subscriptions",
      "organizations_url": "https://api.github.com/users/jakevdp/orgs",
      "repos_url": "https://api.github.com/users/jakevdp/repos",
      "events_url": "https://api.github.com/users/jakevdp/events{/privacy}",
      "received_events_url": "https://api.github.com/users/jakevdp/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2015-09-04T20:38:10Z",
    "updated_at": "2015-09-04T20:38:44Z",
    "author_association": "CONTRIBUTOR",
    "body": "A much cleaner solution, IMO, would be to add a utility function that does something along the lines of \"add a new entry to this index, even if it requires a new category\". I imagine there are other places in the package where this sort of thing might happen, and such a utility could be used there as well.\n"
  },
  {
    "url": "https://api.github.com/repos/pandas-dev/pandas/issues/comments/137853833",
    "html_url": "https://github.com/pandas-dev/pandas/pull/10993#issuecomment-137853833",
    "issue_url": "https://api.github.com/repos/pandas-dev/pandas/issues/10993",
    "id": 137853833,
    "node_id": "MDEyOklzc3VlQ29tbWVudDEzNzg1MzgzMw==",
    "user": {
      "login": "TomAugspurger",
      "id": 1312546,
      "node_id": "MDQ6VXNlcjEzMTI1NDY=",
      "avatar_url": "https://avatars3.githubusercontent.com/u/1312546?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/TomAugspurger",
      "html_url": "https://github.com/TomAugspurger",
      "followers_url": "https://api.github.com/users/TomAugspurger/followers",
      "following_url": "https://api.github.com/users/TomAugspurger/following{/other_user}",
      "gists_url": "https://api.github.com/users/TomAugspurger/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/TomAugspurger/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/TomAugspurger/subscriptions",
      "organizations_url": "https://api.github.com/users/TomAugspurger/orgs",
      "repos_url": "https://api.github.com/users/TomAugspurger/repos",
      "events_url": "https://api.github.com/users/TomAugspurger/events{/privacy}",
      "received_events_url": "https://api.github.com/users/TomAugspurger/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2015-09-04T21:08:36Z",
    "updated_at": "2015-09-04T21:08:36Z",
    "author_association": "CONTRIBUTOR",
    "body": "I think we should return a regular Index with object dtypes. What happens if the user has a `category` called 'All'? I suspect that any fix involving categories will break/be fragile (just a hunch, haven't tried).\n"
  },
  {
    "url": "https://api.github.com/repos/pandas-dev/pandas/issues/comments/137855818",
    "html_url": "https://github.com/pandas-dev/pandas/pull/10993#issuecomment-137855818",
    "issue_url": "https://api.github.com/repos/pandas-dev/pandas/issues/10993",
    "id": 137855818,
    "node_id": "MDEyOklzc3VlQ29tbWVudDEzNzg1NTgxOA==",
    "user": {
      "login": "jakevdp",
      "id": 781659,
      "node_id": "MDQ6VXNlcjc4MTY1OQ==",
      "avatar_url": "https://avatars0.githubusercontent.com/u/781659?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/jakevdp",
      "html_url": "https://github.com/jakevdp",
      "followers_url": "https://api.github.com/users/jakevdp/followers",
      "following_url": "https://api.github.com/users/jakevdp/following{/other_user}",
      "gists_url": "https://api.github.com/users/jakevdp/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/jakevdp/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/jakevdp/subscriptions",
      "organizations_url": "https://api.github.com/users/jakevdp/orgs",
      "repos_url": "https://api.github.com/users/jakevdp/repos",
      "events_url": "https://api.github.com/users/jakevdp/events{/privacy}",
      "received_events_url": "https://api.github.com/users/jakevdp/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2015-09-04T21:18:17Z",
    "updated_at": "2015-09-04T21:18:50Z",
    "author_association": "CONTRIBUTOR",
    "body": "@TomAugspurger – I checked – it turns out this is another bug in the current codebase, even if you're not using categories! If one of the index entries is called `All`, the attempt to compute margins will overwrite it:\n\n``` python\nIn [19]: data = pd.DataFrame({'x': np.arange(99),\n                     'y': np.arange(99) // 50,\n                     'z': np.arange(99) % 3})\n\nIn [20]: data.z = np.array(['Any', 'All', 'None'])[data.z]\n\nIn [21]: data.pivot_table('x', 'y', 'z')\nOut[21]: \nz   All   Any  None\ny                  \n0  25.0  24.0  24.5\n1  74.5  73.5  74.0\n\nIn [22]: data.pivot_table('x', 'y', 'z', margins=True)\nOut[22]: \nz     All   Any  None\ny                    \n0    24.5  24.0  24.5\n1    74.0  73.5  74.0\nAll  49.0  48.0  50.0\n```\n"
  },
  {
    "url": "https://api.github.com/repos/pandas-dev/pandas/issues/comments/149019299",
    "html_url": "https://github.com/pandas-dev/pandas/pull/10993#issuecomment-149019299",
    "issue_url": "https://api.github.com/repos/pandas-dev/pandas/issues/10993",
    "id": 149019299,
    "node_id": "MDEyOklzc3VlQ29tbWVudDE0OTAxOTI5OQ==",
    "user": {
      "login": "jreback",
      "id": 953992,
      "node_id": "MDQ6VXNlcjk1Mzk5Mg==",
      "avatar_url": "https://avatars2.githubusercontent.com/u/953992?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/jreback",
      "html_url": "https://github.com/jreback",
      "followers_url": "https://api.github.com/users/jreback/followers",
      "following_url": "https://api.github.com/users/jreback/following{/other_user}",
      "gists_url": "https://api.github.com/users/jreback/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/jreback/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/jreback/subscriptions",
      "organizations_url": "https://api.github.com/users/jreback/orgs",
      "repos_url": "https://api.github.com/users/jreback/repos",
      "events_url": "https://api.github.com/users/jreback/events{/privacy}",
      "received_events_url": "https://api.github.com/users/jreback/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2015-10-18T14:04:44Z",
    "updated_at": "2015-10-18T14:04:44Z",
    "author_association": "CONTRIBUTOR",
    "body": "@jakevdp can you update according to comments\n"
  },
  {
    "url": "https://api.github.com/repos/pandas-dev/pandas/issues/comments/149027171",
    "html_url": "https://github.com/pandas-dev/pandas/pull/10993#issuecomment-149027171",
    "issue_url": "https://api.github.com/repos/pandas-dev/pandas/issues/10993",
    "id": 149027171,
    "node_id": "MDEyOklzc3VlQ29tbWVudDE0OTAyNzE3MQ==",
    "user": {
      "login": "jakevdp",
      "id": 781659,
      "node_id": "MDQ6VXNlcjc4MTY1OQ==",
      "avatar_url": "https://avatars0.githubusercontent.com/u/781659?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/jakevdp",
      "html_url": "https://github.com/jakevdp",
      "followers_url": "https://api.github.com/users/jakevdp/followers",
      "following_url": "https://api.github.com/users/jakevdp/following{/other_user}",
      "gists_url": "https://api.github.com/users/jakevdp/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/jakevdp/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/jakevdp/subscriptions",
      "organizations_url": "https://api.github.com/users/jakevdp/orgs",
      "repos_url": "https://api.github.com/users/jakevdp/repos",
      "events_url": "https://api.github.com/users/jakevdp/events{/privacy}",
      "received_events_url": "https://api.github.com/users/jakevdp/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2015-10-18T16:08:31Z",
    "updated_at": "2015-10-18T16:08:31Z",
    "author_association": "CONTRIBUTOR",
    "body": "I think I've already addressed all comments above – any others you have in mind? Any reason you closed this without merging?\n"
  },
  {
    "url": "https://api.github.com/repos/pandas-dev/pandas/issues/comments/149027817",
    "html_url": "https://github.com/pandas-dev/pandas/pull/10993#issuecomment-149027817",
    "issue_url": "https://api.github.com/repos/pandas-dev/pandas/issues/10993",
    "id": 149027817,
    "node_id": "MDEyOklzc3VlQ29tbWVudDE0OTAyNzgxNw==",
    "user": {
      "login": "jreback",
      "id": 953992,
      "node_id": "MDQ6VXNlcjk1Mzk5Mg==",
      "avatar_url": "https://avatars2.githubusercontent.com/u/953992?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/jreback",
      "html_url": "https://github.com/jreback",
      "followers_url": "https://api.github.com/users/jreback/followers",
      "following_url": "https://api.github.com/users/jreback/following{/other_user}",
      "gists_url": "https://api.github.com/users/jreback/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/jreback/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/jreback/subscriptions",
      "organizations_url": "https://api.github.com/users/jreback/orgs",
      "repos_url": "https://api.github.com/users/jreback/repos",
      "events_url": "https://api.github.com/users/jreback/events{/privacy}",
      "received_events_url": "https://api.github.com/users/jreback/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2015-10-18T16:21:55Z",
    "updated_at": "2015-10-18T16:21:55Z",
    "author_association": "CONTRIBUTOR",
    "body": "I thought I put the comments before\n\nthis needs a more general soln as it too much if/then on type determination\n"
  },
  {
    "url": "https://api.github.com/repos/pandas-dev/pandas/issues/comments/149029737",
    "html_url": "https://github.com/pandas-dev/pandas/pull/10993#issuecomment-149029737",
    "issue_url": "https://api.github.com/repos/pandas-dev/pandas/issues/10993",
    "id": 149029737,
    "node_id": "MDEyOklzc3VlQ29tbWVudDE0OTAyOTczNw==",
    "user": {
      "login": "jakevdp",
      "id": 781659,
      "node_id": "MDQ6VXNlcjc4MTY1OQ==",
      "avatar_url": "https://avatars0.githubusercontent.com/u/781659?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/jakevdp",
      "html_url": "https://github.com/jakevdp",
      "followers_url": "https://api.github.com/users/jakevdp/followers",
      "following_url": "https://api.github.com/users/jakevdp/following{/other_user}",
      "gists_url": "https://api.github.com/users/jakevdp/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/jakevdp/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/jakevdp/subscriptions",
      "organizations_url": "https://api.github.com/users/jakevdp/orgs",
      "repos_url": "https://api.github.com/users/jakevdp/repos",
      "events_url": "https://api.github.com/users/jakevdp/events{/privacy}",
      "received_events_url": "https://api.github.com/users/jakevdp/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2015-10-18T16:50:06Z",
    "updated_at": "2015-10-18T16:50:06Z",
    "author_association": "CONTRIBUTOR",
    "body": "I guess I'm not entirely clear about what you're wanting as a \"more general\" solution. Any specific ideas?\n"
  },
  {
    "url": "https://api.github.com/repos/pandas-dev/pandas/issues/comments/149054893",
    "html_url": "https://github.com/pandas-dev/pandas/pull/10993#issuecomment-149054893",
    "issue_url": "https://api.github.com/repos/pandas-dev/pandas/issues/10993",
    "id": 149054893,
    "node_id": "MDEyOklzc3VlQ29tbWVudDE0OTA1NDg5Mw==",
    "user": {
      "login": "jreback",
      "id": 953992,
      "node_id": "MDQ6VXNlcjk1Mzk5Mg==",
      "avatar_url": "https://avatars2.githubusercontent.com/u/953992?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/jreback",
      "html_url": "https://github.com/jreback",
      "followers_url": "https://api.github.com/users/jreback/followers",
      "following_url": "https://api.github.com/users/jreback/following{/other_user}",
      "gists_url": "https://api.github.com/users/jreback/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/jreback/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/jreback/subscriptions",
      "organizations_url": "https://api.github.com/users/jreback/orgs",
      "repos_url": "https://api.github.com/users/jreback/repos",
      "events_url": "https://api.github.com/users/jreback/events{/privacy}",
      "received_events_url": "https://api.github.com/users/jreback/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2015-10-18T22:12:48Z",
    "updated_at": "2015-10-18T22:12:48Z",
    "author_association": "CONTRIBUTOR",
    "body": "So there is something more going on here; this bug report is a sympton of a different issue. Namely,\nthat we allow a Categorical as a _level_ of a MultiIndex. But in fact we should simply convert them directly to an object dtype when creating the multi-index in the first place; these are de-facto the same.\n\n```\nIn [4]: data = pd.DataFrame({'x': np.arange(8),'y': Series(np.arange(8) // 4).astype('category'),'z': Series(np.arange(8) % 2).astype('category')})\n\nIn [5]: data\nOut[5]: \n   x  y  z\n0  0  0  0\n1  1  0  1\n2  2  0  0\n3  3  0  1\n4  4  1  0\n5  5  1  1\n6  6  1  0\n7  7  1  1\n\nIn [6]: data.dtypes\nOut[6]: \nx       int64\ny    category\nz    category\ndtype: object\n\nIn [7]: data.groupby(['y','z']).agg('mean')\nOut[7]: \n     x\ny z   \n0 0  1\n  1  2\n1 0  5\n  1  6\n```\n\n```\nIn [7]: data.groupby(['y','z']).agg('mean')\nOut[7]: \n     x\ny z   \n0 0  1\n  1  2\n1 0  5\n  1  6\n\nIn [8]: data.groupby(['y','z']).agg('mean').index.levels[0]\nOut[8]: CategoricalIndex([0, 1], categories=[0, 1], ordered=False, name=u'y', dtype='category')\n\nIn [9]: data.groupby(['y','z']).agg('mean').index.levels[1]\nOut[9]: CategoricalIndex([0, 1], categories=[0, 1], ordered=False, name=u'z', dtype='category')\n\nIn [10]: data.groupby(['y','z']).agg('mean').index.values   \nOut[10]: array([(0, 0), (0, 1), (1, 0), (1, 1)], dtype=object)\n```\n\nSo this is the _same_ as the index in [10]\n\n```\nIn [15]: idx = pd.MultiIndex.from_tuples([(0, 0), (0, 1), (1, 0), (1, 1)],names=['y','z'])\n\nIn [16]: idx\nOut[16]: \nMultiIndex(levels=[[0, 1], [0, 1]],\n           labels=[[0, 0, 1, 1], [0, 1, 0, 1]],\n           names=[u'y', u'z'])\n```\n\nSo I think that `MultiIndex` creation should coerce `Categoricals` on construction. This can be done in the `MultiIndex.__init__` (keep all of these existing test), prob need a couple more.\n"
  },
  {
    "url": "https://api.github.com/repos/pandas-dev/pandas/issues/comments/149064203",
    "html_url": "https://github.com/pandas-dev/pandas/pull/10993#issuecomment-149064203",
    "issue_url": "https://api.github.com/repos/pandas-dev/pandas/issues/10993",
    "id": 149064203,
    "node_id": "MDEyOklzc3VlQ29tbWVudDE0OTA2NDIwMw==",
    "user": {
      "login": "jakevdp",
      "id": 781659,
      "node_id": "MDQ6VXNlcjc4MTY1OQ==",
      "avatar_url": "https://avatars0.githubusercontent.com/u/781659?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/jakevdp",
      "html_url": "https://github.com/jakevdp",
      "followers_url": "https://api.github.com/users/jakevdp/followers",
      "following_url": "https://api.github.com/users/jakevdp/following{/other_user}",
      "gists_url": "https://api.github.com/users/jakevdp/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/jakevdp/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/jakevdp/subscriptions",
      "organizations_url": "https://api.github.com/users/jakevdp/orgs",
      "repos_url": "https://api.github.com/users/jakevdp/repos",
      "events_url": "https://api.github.com/users/jakevdp/events{/privacy}",
      "received_events_url": "https://api.github.com/users/jakevdp/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2015-10-18T23:27:17Z",
    "updated_at": "2015-10-18T23:27:17Z",
    "author_association": "CONTRIBUTOR",
    "body": "I suppose we should close this PR then, and leave the issue open. Hacking into the internals of MultiIndex is well beyond my level of comfort with the library.\n"
  },
  {
    "url": "https://api.github.com/repos/pandas-dev/pandas/issues/comments/149064486",
    "html_url": "https://github.com/pandas-dev/pandas/pull/10993#issuecomment-149064486",
    "issue_url": "https://api.github.com/repos/pandas-dev/pandas/issues/10993",
    "id": 149064486,
    "node_id": "MDEyOklzc3VlQ29tbWVudDE0OTA2NDQ4Ng==",
    "user": {
      "login": "jreback",
      "id": 953992,
      "node_id": "MDQ6VXNlcjk1Mzk5Mg==",
      "avatar_url": "https://avatars2.githubusercontent.com/u/953992?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/jreback",
      "html_url": "https://github.com/jreback",
      "followers_url": "https://api.github.com/users/jreback/followers",
      "following_url": "https://api.github.com/users/jreback/following{/other_user}",
      "gists_url": "https://api.github.com/users/jreback/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/jreback/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/jreback/subscriptions",
      "organizations_url": "https://api.github.com/users/jreback/orgs",
      "repos_url": "https://api.github.com/users/jreback/repos",
      "events_url": "https://api.github.com/users/jreback/events{/privacy}",
      "received_events_url": "https://api.github.com/users/jreback/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2015-10-18T23:33:16Z",
    "updated_at": "2015-10-18T23:33:16Z",
    "author_association": "CONTRIBUTOR",
    "body": "haha. well, I'll take your tests in any event. So going to leave open for a bit.\n"
  },
  {
    "url": "https://api.github.com/repos/pandas-dev/pandas/issues/comments/149254699",
    "html_url": "https://github.com/pandas-dev/pandas/pull/10993#issuecomment-149254699",
    "issue_url": "https://api.github.com/repos/pandas-dev/pandas/issues/10993",
    "id": 149254699,
    "node_id": "MDEyOklzc3VlQ29tbWVudDE0OTI1NDY5OQ==",
    "user": {
      "login": "jakevdp",
      "id": 781659,
      "node_id": "MDQ6VXNlcjc4MTY1OQ==",
      "avatar_url": "https://avatars0.githubusercontent.com/u/781659?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/jakevdp",
      "html_url": "https://github.com/jakevdp",
      "followers_url": "https://api.github.com/users/jakevdp/followers",
      "following_url": "https://api.github.com/users/jakevdp/following{/other_user}",
      "gists_url": "https://api.github.com/users/jakevdp/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/jakevdp/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/jakevdp/subscriptions",
      "organizations_url": "https://api.github.com/users/jakevdp/orgs",
      "repos_url": "https://api.github.com/users/jakevdp/repos",
      "events_url": "https://api.github.com/users/jakevdp/events{/privacy}",
      "received_events_url": "https://api.github.com/users/jakevdp/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2015-10-19T15:47:37Z",
    "updated_at": "2015-10-19T15:47:37Z",
    "author_association": "CONTRIBUTOR",
    "body": "Sounds good – thanks!\n"
  }
]
