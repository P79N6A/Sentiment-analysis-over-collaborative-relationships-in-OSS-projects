[
  {
    "url": "https://api.github.com/repos/pandas-dev/pandas/issues/comments/423314105",
    "html_url": "https://github.com/pandas-dev/pandas/issues/22023#issuecomment-423314105",
    "issue_url": "https://api.github.com/repos/pandas-dev/pandas/issues/22023",
    "id": 423314105,
    "node_id": "MDEyOklzc3VlQ29tbWVudDQyMzMxNDEwNQ==",
    "user": {
      "login": "hhuuggoo",
      "id": 249407,
      "node_id": "MDQ6VXNlcjI0OTQwNw==",
      "avatar_url": "https://avatars2.githubusercontent.com/u/249407?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/hhuuggoo",
      "html_url": "https://github.com/hhuuggoo",
      "followers_url": "https://api.github.com/users/hhuuggoo/followers",
      "following_url": "https://api.github.com/users/hhuuggoo/following{/other_user}",
      "gists_url": "https://api.github.com/users/hhuuggoo/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/hhuuggoo/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/hhuuggoo/subscriptions",
      "organizations_url": "https://api.github.com/users/hhuuggoo/orgs",
      "repos_url": "https://api.github.com/users/hhuuggoo/repos",
      "events_url": "https://api.github.com/users/hhuuggoo/events{/privacy}",
      "received_events_url": "https://api.github.com/users/hhuuggoo/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2018-09-20T20:02:16Z",
    "updated_at": "2018-09-20T20:02:16Z",
    "author_association": "CONTRIBUTOR",
    "body": "So the error has changed into \r\n\r\n```\r\n    def __init__(self, values, mask, copy=False):                                                                                                                                                                                                                               \r\n        if not (isinstance(values, np.ndarray)                                                                                                                                                                                                                                  \r\n                and is_integer_dtype(values.dtype)):                                                                                                                                                                                                                            \r\n>           raise TypeError(\"values should be integer numpy array. Use \"                                                                                                                                                                                                        \r\n                            \"the 'integer_array' function instead\")                                                                                                                                                                                                             \r\nE           TypeError: values should be integer numpy array. Use the 'integer_array' function instead                                                                                                                                                                           \r\n```\r\nBut that is because of what happens in _maybe_mask_result.  \r\n                                                   \r\nhttps://github.com/pandas-dev/pandas/blob/0480f4c183a95712cb8ceaf5682c5b8dd02e0f21/pandas/core/arrays/integer.py#L532\r\n\r\nThat code has some logic for detecting when it should be outputting floats.  Does anyone know why we do that instead of just checking the dtype of result?\r\n\r\nIf we don't want to rely on the dtype of result, then we would have to add operations between uint64 and int64 to the list of cases where we get floats back from numpy \r\n```\r\nIn [10]: (np.array([1], dtype='uint64') - np.array([1], dtype='int64')).dtype                                                                                                                                                                                                   \r\nOut[10]: dtype('float64')                                                                                                                                                                                                                                                       \r\n                                                                                                                                                                                                                                                                                \r\nIn [11]: (np.array([1], dtype='uint32') - np.array([1], dtype='int64')).dtype                                                                                                                                                                                                   \r\nOut[11]: dtype('int64')      \r\n```\r\n"
  },
  {
    "url": "https://api.github.com/repos/pandas-dev/pandas/issues/comments/423476963",
    "html_url": "https://github.com/pandas-dev/pandas/issues/22023#issuecomment-423476963",
    "issue_url": "https://api.github.com/repos/pandas-dev/pandas/issues/22023",
    "id": 423476963,
    "node_id": "MDEyOklzc3VlQ29tbWVudDQyMzQ3Njk2Mw==",
    "user": {
      "login": "jorisvandenbossche",
      "id": 1020496,
      "node_id": "MDQ6VXNlcjEwMjA0OTY=",
      "avatar_url": "https://avatars2.githubusercontent.com/u/1020496?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/jorisvandenbossche",
      "html_url": "https://github.com/jorisvandenbossche",
      "followers_url": "https://api.github.com/users/jorisvandenbossche/followers",
      "following_url": "https://api.github.com/users/jorisvandenbossche/following{/other_user}",
      "gists_url": "https://api.github.com/users/jorisvandenbossche/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/jorisvandenbossche/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/jorisvandenbossche/subscriptions",
      "organizations_url": "https://api.github.com/users/jorisvandenbossche/orgs",
      "repos_url": "https://api.github.com/users/jorisvandenbossche/repos",
      "events_url": "https://api.github.com/users/jorisvandenbossche/events{/privacy}",
      "received_events_url": "https://api.github.com/users/jorisvandenbossche/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2018-09-21T09:44:40Z",
    "updated_at": "2018-09-21T09:44:40Z",
    "author_association": "MEMBER",
    "body": "> That code has some logic for detecting when it should be outputting floats. Does anyone know why we do that instead of just checking the dtype of result?\r\n\r\nI can't directly think of cases where numpy will return float, but where we want to convert again to an integer dtype. But since it is written that way, there might be cases (@jreback do you remember?) \r\nYou can maybe do the change and see if there are tests failing then"
  },
  {
    "url": "https://api.github.com/repos/pandas-dev/pandas/issues/comments/423676111",
    "html_url": "https://github.com/pandas-dev/pandas/issues/22023#issuecomment-423676111",
    "issue_url": "https://api.github.com/repos/pandas-dev/pandas/issues/22023",
    "id": 423676111,
    "node_id": "MDEyOklzc3VlQ29tbWVudDQyMzY3NjExMQ==",
    "user": {
      "login": "hhuuggoo",
      "id": 249407,
      "node_id": "MDQ6VXNlcjI0OTQwNw==",
      "avatar_url": "https://avatars2.githubusercontent.com/u/249407?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/hhuuggoo",
      "html_url": "https://github.com/hhuuggoo",
      "followers_url": "https://api.github.com/users/hhuuggoo/followers",
      "following_url": "https://api.github.com/users/hhuuggoo/following{/other_user}",
      "gists_url": "https://api.github.com/users/hhuuggoo/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/hhuuggoo/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/hhuuggoo/subscriptions",
      "organizations_url": "https://api.github.com/users/hhuuggoo/orgs",
      "repos_url": "https://api.github.com/users/hhuuggoo/repos",
      "events_url": "https://api.github.com/users/hhuuggoo/events{/privacy}",
      "received_events_url": "https://api.github.com/users/hhuuggoo/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2018-09-21T21:30:22Z",
    "updated_at": "2018-09-21T21:30:22Z",
    "author_association": "CONTRIBUTOR",
    "body": "if I just change it to return the float array (apply nan mask) whenever the result dtype is a float, all tests pass.\r\n\r\nhttps://github.com/hhuuggoo/pandas/tree/remove_float_logic\r\n\r\nhttps://github.com/hhuuggoo/pandas/blob/remove_float_logic/pandas/core/arrays/integer.py#L532\r\n\r\nseems ok - but I don't completely understand what was there to begin with\r\n\r\n"
  }
]
