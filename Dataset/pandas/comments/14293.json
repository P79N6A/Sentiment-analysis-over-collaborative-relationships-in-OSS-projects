[
  {
    "url": "https://api.github.com/repos/pandas-dev/pandas/issues/comments/249328722",
    "html_url": "https://github.com/pandas-dev/pandas/issues/14293#issuecomment-249328722",
    "issue_url": "https://api.github.com/repos/pandas-dev/pandas/issues/14293",
    "id": 249328722,
    "node_id": "MDEyOklzc3VlQ29tbWVudDI0OTMyODcyMg==",
    "user": {
      "login": "jreback",
      "id": 953992,
      "node_id": "MDQ6VXNlcjk1Mzk5Mg==",
      "avatar_url": "https://avatars2.githubusercontent.com/u/953992?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/jreback",
      "html_url": "https://github.com/jreback",
      "followers_url": "https://api.github.com/users/jreback/followers",
      "following_url": "https://api.github.com/users/jreback/following{/other_user}",
      "gists_url": "https://api.github.com/users/jreback/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/jreback/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/jreback/subscriptions",
      "organizations_url": "https://api.github.com/users/jreback/orgs",
      "repos_url": "https://api.github.com/users/jreback/repos",
      "events_url": "https://api.github.com/users/jreback/events{/privacy}",
      "received_events_url": "https://api.github.com/users/jreback/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2016-09-23T23:59:06Z",
    "updated_at": "2016-09-23T23:59:06Z",
    "author_association": "CONTRIBUTOR",
    "body": "can u show a particular example that you have been timing (so all on the same page)\n"
  },
  {
    "url": "https://api.github.com/repos/pandas-dev/pandas/issues/comments/249330379",
    "html_url": "https://github.com/pandas-dev/pandas/issues/14293#issuecomment-249330379",
    "issue_url": "https://api.github.com/repos/pandas-dev/pandas/issues/14293",
    "id": 249330379,
    "node_id": "MDEyOklzc3VlQ29tbWVudDI0OTMzMDM3OQ==",
    "user": {
      "login": "wesm",
      "id": 329591,
      "node_id": "MDQ6VXNlcjMyOTU5MQ==",
      "avatar_url": "https://avatars2.githubusercontent.com/u/329591?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/wesm",
      "html_url": "https://github.com/wesm",
      "followers_url": "https://api.github.com/users/wesm/followers",
      "following_url": "https://api.github.com/users/wesm/following{/other_user}",
      "gists_url": "https://api.github.com/users/wesm/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/wesm/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/wesm/subscriptions",
      "organizations_url": "https://api.github.com/users/wesm/orgs",
      "repos_url": "https://api.github.com/users/wesm/repos",
      "events_url": "https://api.github.com/users/wesm/events{/privacy}",
      "received_events_url": "https://api.github.com/users/wesm/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2016-09-24T00:15:47Z",
    "updated_at": "2016-09-24T00:15:47Z",
    "author_association": "MEMBER",
    "body": "Those `groupby_*` functions are a real bummer. \n\nThe right way to do this that avoids the GIL (assuming that `labels` does not contain Python objects):\n- Specialize on the labels array type\n- Use a native hash table rather than a Python dict\n- Do not use Python lists\n- Compute categories, then do a O(n) stable counting sort (depending on the cardinality, if large cardinality do a merge sort), then you can do the groupby.apply take operations using the counting sort array.\n\nFor example, if the labels are:\n\n`[a, b, c, a, b, c, a, b, c]`\n\nThen you factorize (which will cause GIL contention if object dtype) to get\n\n`[0, 1, 2, 0, 1, 2, 0, 1, 2]`\n\nStable argsort (either by counting sort or mergesort) yields\n\n`[0, 3, 6, 1, 4, 7, 2, 5, 8]`\n\nNow, you iterate through this array to delimit each contiguous group.\n- 0, 3, 6 are all 0's\n- when you hit 1 (index 3 in the argsort array) you know you have reached the end of the group\n- and so on\n"
  },
  {
    "url": "https://api.github.com/repos/pandas-dev/pandas/issues/comments/249330523",
    "html_url": "https://github.com/pandas-dev/pandas/issues/14293#issuecomment-249330523",
    "issue_url": "https://api.github.com/repos/pandas-dev/pandas/issues/14293",
    "id": 249330523,
    "node_id": "MDEyOklzc3VlQ29tbWVudDI0OTMzMDUyMw==",
    "user": {
      "login": "wesm",
      "id": 329591,
      "node_id": "MDQ6VXNlcjMyOTU5MQ==",
      "avatar_url": "https://avatars2.githubusercontent.com/u/329591?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/wesm",
      "html_url": "https://github.com/wesm",
      "followers_url": "https://api.github.com/users/wesm/followers",
      "following_url": "https://api.github.com/users/wesm/following{/other_user}",
      "gists_url": "https://api.github.com/users/wesm/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/wesm/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/wesm/subscriptions",
      "organizations_url": "https://api.github.com/users/wesm/orgs",
      "repos_url": "https://api.github.com/users/wesm/repos",
      "events_url": "https://api.github.com/users/wesm/events{/privacy}",
      "received_events_url": "https://api.github.com/users/wesm/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2016-09-24T00:17:17Z",
    "updated_at": "2016-09-24T00:17:17Z",
    "author_association": "MEMBER",
    "body": "Note that in pandas 2.0, factorizing strings (assuming we implement https://pydata.github.io/pandas-design/strings.html) will not require the GIL -> multicore happiness. \n"
  },
  {
    "url": "https://api.github.com/repos/pandas-dev/pandas/issues/comments/249362316",
    "html_url": "https://github.com/pandas-dev/pandas/issues/14293#issuecomment-249362316",
    "issue_url": "https://api.github.com/repos/pandas-dev/pandas/issues/14293",
    "id": 249362316,
    "node_id": "MDEyOklzc3VlQ29tbWVudDI0OTM2MjMxNg==",
    "user": {
      "login": "mrocklin",
      "id": 306380,
      "node_id": "MDQ6VXNlcjMwNjM4MA==",
      "avatar_url": "https://avatars3.githubusercontent.com/u/306380?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/mrocklin",
      "html_url": "https://github.com/mrocklin",
      "followers_url": "https://api.github.com/users/mrocklin/followers",
      "following_url": "https://api.github.com/users/mrocklin/following{/other_user}",
      "gists_url": "https://api.github.com/users/mrocklin/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/mrocklin/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/mrocklin/subscriptions",
      "organizations_url": "https://api.github.com/users/mrocklin/orgs",
      "repos_url": "https://api.github.com/users/mrocklin/repos",
      "events_url": "https://api.github.com/users/mrocklin/events{/privacy}",
      "received_events_url": "https://api.github.com/users/mrocklin/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2016-09-24T12:27:15Z",
    "updated_at": "2016-09-24T12:27:15Z",
    "author_association": "CONTRIBUTOR",
    "body": "@jreback \n\n``` python\nimport numpy as np\nimport pandas as pd\ns = pd.Series(np.random.randint(0, 100, size=2**24))\ns.groupby(s).groups\n```\n\n```\n         412 function calls (408 primitive calls) in 5.913 seconds\n\n   Ordered by: internal time\n\n   ncalls  tottime  percall  cumtime  percall filename:lineno(function)\n        1    5.120    5.120    5.120    5.120 {pandas.algos.groupby_int64}\n        1    0.792    0.792    5.913    5.913 <string>:1(<module>)\n        1    0.000    0.000    5.120    5.120 base.py:2355(groupby)\n```\n"
  },
  {
    "url": "https://api.github.com/repos/pandas-dev/pandas/issues/comments/249362523",
    "html_url": "https://github.com/pandas-dev/pandas/issues/14293#issuecomment-249362523",
    "issue_url": "https://api.github.com/repos/pandas-dev/pandas/issues/14293",
    "id": 249362523,
    "node_id": "MDEyOklzc3VlQ29tbWVudDI0OTM2MjUyMw==",
    "user": {
      "login": "mrocklin",
      "id": 306380,
      "node_id": "MDQ6VXNlcjMwNjM4MA==",
      "avatar_url": "https://avatars3.githubusercontent.com/u/306380?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/mrocklin",
      "html_url": "https://github.com/mrocklin",
      "followers_url": "https://api.github.com/users/mrocklin/followers",
      "following_url": "https://api.github.com/users/mrocklin/following{/other_user}",
      "gists_url": "https://api.github.com/users/mrocklin/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/mrocklin/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/mrocklin/subscriptions",
      "organizations_url": "https://api.github.com/users/mrocklin/orgs",
      "repos_url": "https://api.github.com/users/mrocklin/repos",
      "events_url": "https://api.github.com/users/mrocklin/events{/privacy}",
      "received_events_url": "https://api.github.com/users/mrocklin/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2016-09-24T12:32:55Z",
    "updated_at": "2016-09-24T12:32:55Z",
    "author_association": "CONTRIBUTOR",
    "body": "@wesm FWIW I only care about `groupby_int*`.  For me the index here is the eventual partition number so labels are always in `0..n`.  Obviously you don't want to assume this for general pandas groupby algorithms but it might be useful to pull out the argsort-partition logic into a separate function.\n"
  },
  {
    "url": "https://api.github.com/repos/pandas-dev/pandas/issues/comments/249364089",
    "html_url": "https://github.com/pandas-dev/pandas/issues/14293#issuecomment-249364089",
    "issue_url": "https://api.github.com/repos/pandas-dev/pandas/issues/14293",
    "id": 249364089,
    "node_id": "MDEyOklzc3VlQ29tbWVudDI0OTM2NDA4OQ==",
    "user": {
      "login": "jreback",
      "id": 953992,
      "node_id": "MDQ6VXNlcjk1Mzk5Mg==",
      "avatar_url": "https://avatars2.githubusercontent.com/u/953992?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/jreback",
      "html_url": "https://github.com/jreback",
      "followers_url": "https://api.github.com/users/jreback/followers",
      "following_url": "https://api.github.com/users/jreback/following{/other_user}",
      "gists_url": "https://api.github.com/users/jreback/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/jreback/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/jreback/subscriptions",
      "organizations_url": "https://api.github.com/users/jreback/orgs",
      "repos_url": "https://api.github.com/users/jreback/repos",
      "events_url": "https://api.github.com/users/jreback/events{/privacy}",
      "received_events_url": "https://api.github.com/users/jreback/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2016-09-24T13:10:15Z",
    "updated_at": "2016-09-24T13:16:34Z",
    "author_association": "CONTRIBUTOR",
    "body": "master\n\n```\nIn [1]: np.random.seed(1234)\n   ...: \n   ...: s = pd.Series(np.random.randint(0, 100, size=2**24))\n   ...: \n\nIn [2]: %timeit -n 1 -r 1 s.groupby(s).groups\n1 loop, best of 1: 5.26 s per loop\n\nIn [3]: s.groupby(s).groups[0][-10:]\nOut[3]: \n[16776669,\n 16776672,\n 16776713,\n 16776752,\n 16776875,\n 16777047,\n 16777110,\n 16777131,\n 16777139,\n 16777165]\n\nIn [4]: pd.__version__\nOut[4]: '0.19.0rc1+31.gd9e51fe'\n```\n\npatch\n\n```\nIn [1]: np.random.seed(1234)\n   ...: \n   ...: s = pd.Series(np.random.randint(0, 100, size=2**24))\n   ...: \n\nIn [2]: %timeit -n 1 -r 1 s.groupby(s).groups\n1 loop, best of 1: 742 ms per loop\n\nIn [3]: s.groupby(s).groups[0][-10:]\nOut[3]: \narray([16776669, 16776672, 16776713, 16776752, 16776875, 16777047,\n       16777110, 16777131, 16777139, 16777165])\n\nIn [4]: pd.__version__\nOut[4]: '0.19.0rc1+32.g6256f2f'\n```\n\n```\n[jreback-~/pandas] git diff master\ndiff --git a/pandas/algos.pyx b/pandas/algos.pyx\nindex 8710ef3..0a1e806 100644\n--- a/pandas/algos.pyx\n+++ b/pandas/algos.pyx\n@@ -1024,16 +1024,17 @@ def groupby_indices(dict ids, ndarray[int64_t] labels,\n         result[ids[i]] = arr\n         vecs[i] = <int64_t*> arr.data\n\n-    for i from 0 <= i < n:\n-        k = labels[i]\n+    with nogil:\n+        for i from 0 <= i < n:\n+            k = labels[i]\n\n-        # was NaN\n-        if k == -1:\n-            continue\n+            # was NaN\n+            if k == -1:\n+                continue\n\n-        loc = seen[k]\n-        vecs[k][loc] = i\n-        seen[k] = loc + 1\n+            loc = seen[k]\n+            vecs[k][loc] = i\n+            seen[k] = loc + 1\n\n     free(vecs)\n     return result\ndiff --git a/pandas/indexes/base.py b/pandas/indexes/base.py\nindex f430305..16fe13c 100644\n--- a/pandas/indexes/base.py\n+++ b/pandas/indexes/base.py\n@@ -2366,7 +2366,11 @@ class Index(IndexOpsMixin, StringAccessorMixin, PandasObject):\n         groups : dict\n             {group name -> group labels}\n         \"\"\"\n-        return self._groupby(self.values, _values_from_object(to_groupby))\n+        from pandas import Categorical\n+        from pandas.core.groupby import _groupby_indices\n+        result = _groupby_indices(Categorical(to_groupby))\n+\n+        return result\n\n     def map(self, mapper):\n         \"\"\"\n```\n"
  },
  {
    "url": "https://api.github.com/repos/pandas-dev/pandas/issues/comments/249364144",
    "html_url": "https://github.com/pandas-dev/pandas/issues/14293#issuecomment-249364144",
    "issue_url": "https://api.github.com/repos/pandas-dev/pandas/issues/14293",
    "id": 249364144,
    "node_id": "MDEyOklzc3VlQ29tbWVudDI0OTM2NDE0NA==",
    "user": {
      "login": "jreback",
      "id": 953992,
      "node_id": "MDQ6VXNlcjk1Mzk5Mg==",
      "avatar_url": "https://avatars2.githubusercontent.com/u/953992?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/jreback",
      "html_url": "https://github.com/jreback",
      "followers_url": "https://api.github.com/users/jreback/followers",
      "following_url": "https://api.github.com/users/jreback/following{/other_user}",
      "gists_url": "https://api.github.com/users/jreback/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/jreback/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/jreback/subscriptions",
      "organizations_url": "https://api.github.com/users/jreback/orgs",
      "repos_url": "https://api.github.com/users/jreback/repos",
      "events_url": "https://api.github.com/users/jreback/events{/privacy}",
      "received_events_url": "https://api.github.com/users/jreback/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2016-09-24T13:11:28Z",
    "updated_at": "2016-09-24T13:13:16Z",
    "author_association": "CONTRIBUTOR",
    "body": "I had added a special case for categorical grouping because `merge_asof` needed it (it make things a lot faster). So just converting to categoricals and using it here is a pretty good speedup.\n\na couple of minor tests fail with this (edge case with all nan categories), but no big deal to fix.\n\nThis _still_ hits a dictionary encoding path (in cython), but _could_ have the GIL released for part of it.\n"
  },
  {
    "url": "https://api.github.com/repos/pandas-dev/pandas/issues/comments/249364379",
    "html_url": "https://github.com/pandas-dev/pandas/issues/14293#issuecomment-249364379",
    "issue_url": "https://api.github.com/repos/pandas-dev/pandas/issues/14293",
    "id": 249364379,
    "node_id": "MDEyOklzc3VlQ29tbWVudDI0OTM2NDM3OQ==",
    "user": {
      "login": "jreback",
      "id": 953992,
      "node_id": "MDQ6VXNlcjk1Mzk5Mg==",
      "avatar_url": "https://avatars2.githubusercontent.com/u/953992?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/jreback",
      "html_url": "https://github.com/jreback",
      "followers_url": "https://api.github.com/users/jreback/followers",
      "following_url": "https://api.github.com/users/jreback/following{/other_user}",
      "gists_url": "https://api.github.com/users/jreback/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/jreback/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/jreback/subscriptions",
      "organizations_url": "https://api.github.com/users/jreback/orgs",
      "repos_url": "https://api.github.com/users/jreback/repos",
      "events_url": "https://api.github.com/users/jreback/events{/privacy}",
      "received_events_url": "https://api.github.com/users/jreback/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2016-09-24T13:17:16Z",
    "updated_at": "2016-09-24T13:17:16Z",
    "author_association": "CONTRIBUTOR",
    "body": "you should get gil releasing in the factorize and now the groupby_indices (these are about 2/3 of the time), rest is python-ish\n"
  },
  {
    "url": "https://api.github.com/repos/pandas-dev/pandas/issues/comments/249364455",
    "html_url": "https://github.com/pandas-dev/pandas/issues/14293#issuecomment-249364455",
    "issue_url": "https://api.github.com/repos/pandas-dev/pandas/issues/14293",
    "id": 249364455,
    "node_id": "MDEyOklzc3VlQ29tbWVudDI0OTM2NDQ1NQ==",
    "user": {
      "login": "mrocklin",
      "id": 306380,
      "node_id": "MDQ6VXNlcjMwNjM4MA==",
      "avatar_url": "https://avatars3.githubusercontent.com/u/306380?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/mrocklin",
      "html_url": "https://github.com/mrocklin",
      "followers_url": "https://api.github.com/users/mrocklin/followers",
      "following_url": "https://api.github.com/users/mrocklin/following{/other_user}",
      "gists_url": "https://api.github.com/users/mrocklin/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/mrocklin/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/mrocklin/subscriptions",
      "organizations_url": "https://api.github.com/users/mrocklin/orgs",
      "repos_url": "https://api.github.com/users/mrocklin/repos",
      "events_url": "https://api.github.com/users/mrocklin/events{/privacy}",
      "received_events_url": "https://api.github.com/users/mrocklin/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2016-09-24T13:18:53Z",
    "updated_at": "2016-09-24T13:18:53Z",
    "author_association": "CONTRIBUTOR",
    "body": "That performance gain would definitely resolve my immediate needs and likely move Pandas well away from being a bottleneck.\n"
  },
  {
    "url": "https://api.github.com/repos/pandas-dev/pandas/issues/comments/249364558",
    "html_url": "https://github.com/pandas-dev/pandas/issues/14293#issuecomment-249364558",
    "issue_url": "https://api.github.com/repos/pandas-dev/pandas/issues/14293",
    "id": 249364558,
    "node_id": "MDEyOklzc3VlQ29tbWVudDI0OTM2NDU1OA==",
    "user": {
      "login": "jreback",
      "id": 953992,
      "node_id": "MDQ6VXNlcjk1Mzk5Mg==",
      "avatar_url": "https://avatars2.githubusercontent.com/u/953992?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/jreback",
      "html_url": "https://github.com/jreback",
      "followers_url": "https://api.github.com/users/jreback/followers",
      "following_url": "https://api.github.com/users/jreback/following{/other_user}",
      "gists_url": "https://api.github.com/users/jreback/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/jreback/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/jreback/subscriptions",
      "organizations_url": "https://api.github.com/users/jreback/orgs",
      "repos_url": "https://api.github.com/users/jreback/repos",
      "events_url": "https://api.github.com/users/jreback/events{/privacy}",
      "received_events_url": "https://api.github.com/users/jreback/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2016-09-24T13:21:11Z",
    "updated_at": "2016-09-24T13:21:11Z",
    "author_association": "CONTRIBUTOR",
    "body": "I pushed it up: https://github.com/jreback/pandas/tree/groupby\n\n(as s I said, running some perf numbers and a couple of edge cases), but give it a go\n"
  },
  {
    "url": "https://api.github.com/repos/pandas-dev/pandas/issues/comments/249365759",
    "html_url": "https://github.com/pandas-dev/pandas/issues/14293#issuecomment-249365759",
    "issue_url": "https://api.github.com/repos/pandas-dev/pandas/issues/14293",
    "id": 249365759,
    "node_id": "MDEyOklzc3VlQ29tbWVudDI0OTM2NTc1OQ==",
    "user": {
      "login": "jreback",
      "id": 953992,
      "node_id": "MDQ6VXNlcjk1Mzk5Mg==",
      "avatar_url": "https://avatars2.githubusercontent.com/u/953992?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/jreback",
      "html_url": "https://github.com/jreback",
      "followers_url": "https://api.github.com/users/jreback/followers",
      "following_url": "https://api.github.com/users/jreback/following{/other_user}",
      "gists_url": "https://api.github.com/users/jreback/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/jreback/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/jreback/subscriptions",
      "organizations_url": "https://api.github.com/users/jreback/orgs",
      "repos_url": "https://api.github.com/users/jreback/repos",
      "events_url": "https://api.github.com/users/jreback/events{/privacy}",
      "received_events_url": "https://api.github.com/users/jreback/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2016-09-24T13:47:17Z",
    "updated_at": "2016-09-24T13:47:17Z",
    "author_association": "CONTRIBUTOR",
    "body": "```\n  [d9e51fe7] [3da4a8d7]\n+  610.20Î¼s     2.54ms      4.17  groupby.groupby_ngroups_float_100.time_sum\n+    2.91ms    11.70ms      4.02  groupby.groupby_ngroups_float_10000.time_count\n+   12.49ms    45.73ms      3.66  groupby.groupby_ngroups_float_100.time_unique\n+    1.50ms     5.24ms      3.50  groupby.groupby_ngroups_float_100.time_tail\n+  484.40ms      1.48s      3.06  groupby.groupby_multi_index.time_groupby_multi_index\nSOME BENCHMARKS HAVE CHANGED SIGNIFICANTLY.\n```\n"
  }
]
