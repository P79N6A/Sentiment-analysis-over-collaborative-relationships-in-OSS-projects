[
  {
    "url": "https://api.github.com/repos/pandas-dev/pandas/issues/comments/275877823",
    "html_url": "https://github.com/pandas-dev/pandas/issues/15239#issuecomment-275877823",
    "issue_url": "https://api.github.com/repos/pandas-dev/pandas/issues/15239",
    "id": 275877823,
    "node_id": "MDEyOklzc3VlQ29tbWVudDI3NTg3NzgyMw==",
    "user": {
      "login": "jorisvandenbossche",
      "id": 1020496,
      "node_id": "MDQ6VXNlcjEwMjA0OTY=",
      "avatar_url": "https://avatars2.githubusercontent.com/u/1020496?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/jorisvandenbossche",
      "html_url": "https://github.com/jorisvandenbossche",
      "followers_url": "https://api.github.com/users/jorisvandenbossche/followers",
      "following_url": "https://api.github.com/users/jorisvandenbossche/following{/other_user}",
      "gists_url": "https://api.github.com/users/jorisvandenbossche/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/jorisvandenbossche/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/jorisvandenbossche/subscriptions",
      "organizations_url": "https://api.github.com/users/jorisvandenbossche/orgs",
      "repos_url": "https://api.github.com/users/jorisvandenbossche/repos",
      "events_url": "https://api.github.com/users/jorisvandenbossche/events{/privacy}",
      "received_events_url": "https://api.github.com/users/jorisvandenbossche/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2017-01-28T22:01:30Z",
    "updated_at": "2017-01-28T22:01:30Z",
    "author_association": "MEMBER",
    "body": "@Kevin-McIsaac Thanks for the report, that sounds like a bug. \r\n\r\nFrom a quick look, the categorical is lost in the `stack` call.\r\n\r\n"
  },
  {
    "url": "https://api.github.com/repos/pandas-dev/pandas/issues/comments/275878520",
    "html_url": "https://github.com/pandas-dev/pandas/issues/15239#issuecomment-275878520",
    "issue_url": "https://api.github.com/repos/pandas-dev/pandas/issues/15239",
    "id": 275878520,
    "node_id": "MDEyOklzc3VlQ29tbWVudDI3NTg3ODUyMA==",
    "user": {
      "login": "jorisvandenbossche",
      "id": 1020496,
      "node_id": "MDQ6VXNlcjEwMjA0OTY=",
      "avatar_url": "https://avatars2.githubusercontent.com/u/1020496?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/jorisvandenbossche",
      "html_url": "https://github.com/jorisvandenbossche",
      "followers_url": "https://api.github.com/users/jorisvandenbossche/followers",
      "following_url": "https://api.github.com/users/jorisvandenbossche/following{/other_user}",
      "gists_url": "https://api.github.com/users/jorisvandenbossche/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/jorisvandenbossche/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/jorisvandenbossche/subscriptions",
      "organizations_url": "https://api.github.com/users/jorisvandenbossche/orgs",
      "repos_url": "https://api.github.com/users/jorisvandenbossche/repos",
      "events_url": "https://api.github.com/users/jorisvandenbossche/events{/privacy}",
      "received_events_url": "https://api.github.com/users/jorisvandenbossche/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2017-01-28T22:15:22Z",
    "updated_at": "2017-01-28T22:15:22Z",
    "author_association": "MEMBER",
    "body": "@Kevin-McIsaac BTW, another way to do this instead of using the sequential unstacking/stacking is to reindex with the desired index (which you can construct with `MultiIndex.from_product`):\r\n\r\n```\r\nIn [45]: temp = df.set_index(['Date', 'Hours', 'Station'])\r\n\r\nIn [46]: temp.reindex(pd.MultiIndex.from_product(temp.index.levels, names=['Date', 'Hour', 'Stations'])).reset_index()\r\nOut[46]: \r\n         Date Hour     Stations  Entry  Exit\r\n0  2016-01-03  1PM  Kings Cross    0.0  10.0\r\n1  2016-01-03  1PM      Newtown    NaN   NaN\r\n2  2016-01-03  1PM       Sydney    NaN   NaN\r\n3  2016-01-03  2PM  Kings Cross    NaN   NaN\r\n4  2016-01-03  2PM      Newtown    NaN   NaN\r\n5  2016-01-03  2PM       Sydney    NaN   NaN\r\n6  2016-01-03  3PM  Kings Cross    NaN   NaN\r\n7  2016-01-03  3PM      Newtown    NaN   NaN\r\n8  2016-01-03  3PM       Sydney    NaN   NaN\r\n9  2016-01-10  1PM  Kings Cross    NaN   NaN\r\n10 2016-01-10  1PM      Newtown    NaN   NaN\r\n11 2016-01-10  1PM       Sydney    NaN   NaN\r\n12 2016-01-10  2PM  Kings Cross    NaN   NaN\r\n13 2016-01-10  2PM      Newtown    NaN   NaN\r\n14 2016-01-10  2PM       Sydney   60.0  30.0\r\n15 2016-01-10  3PM  Kings Cross    NaN   NaN\r\n16 2016-01-10  3PM      Newtown    NaN   NaN\r\n17 2016-01-10  3PM       Sydney    NaN   NaN\r\n18 2016-01-17  1PM  Kings Cross    NaN   NaN\r\n19 2016-01-17  1PM      Newtown    NaN   NaN\r\n20 2016-01-17  1PM       Sydney    NaN   NaN\r\n21 2016-01-17  2PM  Kings Cross    NaN   NaN\r\n22 2016-01-17  2PM      Newtown    NaN   NaN\r\n23 2016-01-17  2PM       Sydney    NaN   NaN\r\n24 2016-01-17  3PM  Kings Cross    NaN   NaN\r\n25 2016-01-17  3PM      Newtown   20.0  50.0\r\n26 2016-01-17  3PM       Sydney    NaN   NaN\r\n\r\nIn [47]: temp.reindex(pd.MultiIndex.from_product(temp.index.levels, names=['Date', 'Hour', 'Stations'])).reset_index().dtypes\r\nOut[47]: \r\nDate        datetime64[ns]\r\nHour              category\r\nStations          category\r\nEntry              float64\r\nExit               float64\r\ndtype: object\r\n```"
  },
  {
    "url": "https://api.github.com/repos/pandas-dev/pandas/issues/comments/275878671",
    "html_url": "https://github.com/pandas-dev/pandas/issues/15239#issuecomment-275878671",
    "issue_url": "https://api.github.com/repos/pandas-dev/pandas/issues/15239",
    "id": 275878671,
    "node_id": "MDEyOklzc3VlQ29tbWVudDI3NTg3ODY3MQ==",
    "user": {
      "login": "jreback",
      "id": 953992,
      "node_id": "MDQ6VXNlcjk1Mzk5Mg==",
      "avatar_url": "https://avatars2.githubusercontent.com/u/953992?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/jreback",
      "html_url": "https://github.com/jreback",
      "followers_url": "https://api.github.com/users/jreback/followers",
      "following_url": "https://api.github.com/users/jreback/following{/other_user}",
      "gists_url": "https://api.github.com/users/jreback/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/jreback/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/jreback/subscriptions",
      "organizations_url": "https://api.github.com/users/jreback/orgs",
      "repos_url": "https://api.github.com/users/jreback/repos",
      "events_url": "https://api.github.com/users/jreback/events{/privacy}",
      "received_events_url": "https://api.github.com/users/jreback/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2017-01-28T22:18:10Z",
    "updated_at": "2017-01-28T22:18:10Z",
    "author_association": "CONTRIBUTOR",
    "body": "this is a dupe of #14018 "
  },
  {
    "url": "https://api.github.com/repos/pandas-dev/pandas/issues/comments/275878672",
    "html_url": "https://github.com/pandas-dev/pandas/issues/15239#issuecomment-275878672",
    "issue_url": "https://api.github.com/repos/pandas-dev/pandas/issues/15239",
    "id": 275878672,
    "node_id": "MDEyOklzc3VlQ29tbWVudDI3NTg3ODY3Mg==",
    "user": {
      "login": "jorisvandenbossche",
      "id": 1020496,
      "node_id": "MDQ6VXNlcjEwMjA0OTY=",
      "avatar_url": "https://avatars2.githubusercontent.com/u/1020496?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/jorisvandenbossche",
      "html_url": "https://github.com/jorisvandenbossche",
      "followers_url": "https://api.github.com/users/jorisvandenbossche/followers",
      "following_url": "https://api.github.com/users/jorisvandenbossche/following{/other_user}",
      "gists_url": "https://api.github.com/users/jorisvandenbossche/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/jorisvandenbossche/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/jorisvandenbossche/subscriptions",
      "organizations_url": "https://api.github.com/users/jorisvandenbossche/orgs",
      "repos_url": "https://api.github.com/users/jorisvandenbossche/repos",
      "events_url": "https://api.github.com/users/jorisvandenbossche/events{/privacy}",
      "received_events_url": "https://api.github.com/users/jorisvandenbossche/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2017-01-28T22:18:11Z",
    "updated_at": "2017-01-28T22:21:46Z",
    "author_association": "MEMBER",
    "body": "A smaller reproducible example:\r\n\r\nStacking one categorical level keeps the categorical intact:\r\n```\r\nIn [48]: midx = pd.MultiIndex.from_arrays([['A']*2 + ['B']*2, \r\n                                           pd.Categorical(list('abab'))])\r\n\r\nIn [49]: df = pd.DataFrame(np.arange(8).reshape(2, 4), columns=midx)\r\n\r\nIn [50]: df.stack()\r\nOut[50]: \r\n     A  B\r\n0 a  0  2\r\n  b  1  3\r\n1 a  4  6\r\n  b  5  7\r\n\r\nIn [51]: df.stack().index.get_level_values(1)\r\nOut[51]: CategoricalIndex(['a', 'b', 'a', 'b'], categories=['a', 'b'], ordered=False, dtype='category')\r\n```\r\n\r\nStacking two categorical levels: the second becomes a plain index:\r\n```\r\nIn [52]: midx = pd.MultiIndex.from_arrays([['A']*2 + ['B']*2, \r\n                                           pd.Categorical(list('abab')), \r\n                                           pd.Categorical(list('ccdd'))])\r\n\r\nIn [53]: df = pd.DataFrame(np.arange(8).reshape(2, 4), columns=midx)\r\n\r\nIn [54]: df.stack([1,2])\r\nOut[54]: \r\n         A    B\r\n0 a c  0.0  NaN\r\n    d  NaN  2.0\r\n  b c  1.0  NaN\r\n    d  NaN  3.0\r\n1 a c  4.0  NaN\r\n    d  NaN  6.0\r\n  b c  5.0  NaN\r\n    d  NaN  7.0\r\n\r\nIn [55]: df.stack([1,2]).index.get_level_values(1)\r\nOut[55]: CategoricalIndex(['a', 'a', 'b', 'b', 'a', 'a', 'b', 'b'], categories=['a', 'b'], ordered=False, dtype='category')\r\n\r\nIn [56]: df.stack([1,2]).index.get_level_values(2)\r\nOut[56]: Index(['c', 'd', 'c', 'd', 'c', 'd', 'c', 'd'], dtype='object')\r\n```"
  },
  {
    "url": "https://api.github.com/repos/pandas-dev/pandas/issues/comments/275878697",
    "html_url": "https://github.com/pandas-dev/pandas/issues/15239#issuecomment-275878697",
    "issue_url": "https://api.github.com/repos/pandas-dev/pandas/issues/15239",
    "id": 275878697,
    "node_id": "MDEyOklzc3VlQ29tbWVudDI3NTg3ODY5Nw==",
    "user": {
      "login": "jreback",
      "id": 953992,
      "node_id": "MDQ6VXNlcjk1Mzk5Mg==",
      "avatar_url": "https://avatars2.githubusercontent.com/u/953992?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/jreback",
      "html_url": "https://github.com/jreback",
      "followers_url": "https://api.github.com/users/jreback/followers",
      "following_url": "https://api.github.com/users/jreback/following{/other_user}",
      "gists_url": "https://api.github.com/users/jreback/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/jreback/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/jreback/subscriptions",
      "organizations_url": "https://api.github.com/users/jreback/orgs",
      "repos_url": "https://api.github.com/users/jreback/repos",
      "events_url": "https://api.github.com/users/jreback/events{/privacy}",
      "received_events_url": "https://api.github.com/users/jreback/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2017-01-28T22:18:43Z",
    "updated_at": "2017-01-28T22:18:50Z",
    "author_association": "CONTRIBUTOR",
    "body": "@jorisvandenbossche its the ``.unstack``"
  },
  {
    "url": "https://api.github.com/repos/pandas-dev/pandas/issues/comments/275878721",
    "html_url": "https://github.com/pandas-dev/pandas/issues/15239#issuecomment-275878721",
    "issue_url": "https://api.github.com/repos/pandas-dev/pandas/issues/15239",
    "id": 275878721,
    "node_id": "MDEyOklzc3VlQ29tbWVudDI3NTg3ODcyMQ==",
    "user": {
      "login": "jorisvandenbossche",
      "id": 1020496,
      "node_id": "MDQ6VXNlcjEwMjA0OTY=",
      "avatar_url": "https://avatars2.githubusercontent.com/u/1020496?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/jorisvandenbossche",
      "html_url": "https://github.com/jorisvandenbossche",
      "followers_url": "https://api.github.com/users/jorisvandenbossche/followers",
      "following_url": "https://api.github.com/users/jorisvandenbossche/following{/other_user}",
      "gists_url": "https://api.github.com/users/jorisvandenbossche/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/jorisvandenbossche/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/jorisvandenbossche/subscriptions",
      "organizations_url": "https://api.github.com/users/jorisvandenbossche/orgs",
      "repos_url": "https://api.github.com/users/jorisvandenbossche/repos",
      "events_url": "https://api.github.com/users/jorisvandenbossche/events{/privacy}",
      "received_events_url": "https://api.github.com/users/jorisvandenbossche/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2017-01-28T22:19:13Z",
    "updated_at": "2017-01-28T22:24:09Z",
    "author_association": "MEMBER",
    "body": "@jreback the other issue is about the values, here it is index itself, see my example in the comment above"
  },
  {
    "url": "https://api.github.com/repos/pandas-dev/pandas/issues/comments/275884609",
    "html_url": "https://github.com/pandas-dev/pandas/issues/15239#issuecomment-275884609",
    "issue_url": "https://api.github.com/repos/pandas-dev/pandas/issues/15239",
    "id": 275884609,
    "node_id": "MDEyOklzc3VlQ29tbWVudDI3NTg4NDYwOQ==",
    "user": {
      "login": "Kevin-McIsaac",
      "id": 16606323,
      "node_id": "MDQ6VXNlcjE2NjA2MzIz",
      "avatar_url": "https://avatars2.githubusercontent.com/u/16606323?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/Kevin-McIsaac",
      "html_url": "https://github.com/Kevin-McIsaac",
      "followers_url": "https://api.github.com/users/Kevin-McIsaac/followers",
      "following_url": "https://api.github.com/users/Kevin-McIsaac/following{/other_user}",
      "gists_url": "https://api.github.com/users/Kevin-McIsaac/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/Kevin-McIsaac/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/Kevin-McIsaac/subscriptions",
      "organizations_url": "https://api.github.com/users/Kevin-McIsaac/orgs",
      "repos_url": "https://api.github.com/users/Kevin-McIsaac/repos",
      "events_url": "https://api.github.com/users/Kevin-McIsaac/events{/privacy}",
      "received_events_url": "https://api.github.com/users/Kevin-McIsaac/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2017-01-29T00:19:46Z",
    "updated_at": "2017-01-29T00:19:46Z",
    "author_association": "NONE",
    "body": "@jorisvandenbossche thanks for sharing a much simpler way to get the same result. I learnt something useful."
  }
]
