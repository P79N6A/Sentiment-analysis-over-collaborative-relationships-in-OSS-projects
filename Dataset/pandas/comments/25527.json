[
  {
    "url": "https://api.github.com/repos/pandas-dev/pandas/issues/comments/469071354",
    "html_url": "https://github.com/pandas-dev/pandas/issues/25527#issuecomment-469071354",
    "issue_url": "https://api.github.com/repos/pandas-dev/pandas/issues/25527",
    "id": 469071354,
    "node_id": "MDEyOklzc3VlQ29tbWVudDQ2OTA3MTM1NA==",
    "user": {
      "login": "mroeschke",
      "id": 10647082,
      "node_id": "MDQ6VXNlcjEwNjQ3MDgy",
      "avatar_url": "https://avatars0.githubusercontent.com/u/10647082?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/mroeschke",
      "html_url": "https://github.com/mroeschke",
      "followers_url": "https://api.github.com/users/mroeschke/followers",
      "following_url": "https://api.github.com/users/mroeschke/following{/other_user}",
      "gists_url": "https://api.github.com/users/mroeschke/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/mroeschke/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/mroeschke/subscriptions",
      "organizations_url": "https://api.github.com/users/mroeschke/orgs",
      "repos_url": "https://api.github.com/users/mroeschke/repos",
      "events_url": "https://api.github.com/users/mroeschke/events{/privacy}",
      "received_events_url": "https://api.github.com/users/mroeschke/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2019-03-03T22:25:37Z",
    "updated_at": "2019-03-03T22:25:37Z",
    "author_association": "MEMBER",
    "body": "We would need a reproducible (copy-pasteable) example to help identify the potential issue (and eventually unit test) http://matthewrocklin.com/blog/work/2018/02/28/minimal-bug-reports"
  },
  {
    "url": "https://api.github.com/repos/pandas-dev/pandas/issues/comments/469072133",
    "html_url": "https://github.com/pandas-dev/pandas/issues/25527#issuecomment-469072133",
    "issue_url": "https://api.github.com/repos/pandas-dev/pandas/issues/25527",
    "id": 469072133,
    "node_id": "MDEyOklzc3VlQ29tbWVudDQ2OTA3MjEzMw==",
    "user": {
      "login": "DavidMertz",
      "id": 2380665,
      "node_id": "MDQ6VXNlcjIzODA2NjU=",
      "avatar_url": "https://avatars2.githubusercontent.com/u/2380665?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/DavidMertz",
      "html_url": "https://github.com/DavidMertz",
      "followers_url": "https://api.github.com/users/DavidMertz/followers",
      "following_url": "https://api.github.com/users/DavidMertz/following{/other_user}",
      "gists_url": "https://api.github.com/users/DavidMertz/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/DavidMertz/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/DavidMertz/subscriptions",
      "organizations_url": "https://api.github.com/users/DavidMertz/orgs",
      "repos_url": "https://api.github.com/users/DavidMertz/repos",
      "events_url": "https://api.github.com/users/DavidMertz/events{/privacy}",
      "received_events_url": "https://api.github.com/users/DavidMertz/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2019-03-03T22:34:30Z",
    "updated_at": "2019-03-03T22:34:30Z",
    "author_association": "NONE",
    "body": "Yes, I recognize the deficit in the details. I have encountered the error several times, but always on large and confidential data. I'm hoping someone experienced in Pandas might have some ideas on how to go about replicating it on a small artificial DataFrame.\r\n\r\nIt's really unclear to me what properties the DataFrames I tried have that cause the error. Any ideas where to look?"
  },
  {
    "url": "https://api.github.com/repos/pandas-dev/pandas/issues/comments/469075492",
    "html_url": "https://github.com/pandas-dev/pandas/issues/25527#issuecomment-469075492",
    "issue_url": "https://api.github.com/repos/pandas-dev/pandas/issues/25527",
    "id": 469075492,
    "node_id": "MDEyOklzc3VlQ29tbWVudDQ2OTA3NTQ5Mg==",
    "user": {
      "login": "DavidMertz",
      "id": 2380665,
      "node_id": "MDQ6VXNlcjIzODA2NjU=",
      "avatar_url": "https://avatars2.githubusercontent.com/u/2380665?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/DavidMertz",
      "html_url": "https://github.com/DavidMertz",
      "followers_url": "https://api.github.com/users/DavidMertz/followers",
      "following_url": "https://api.github.com/users/DavidMertz/following{/other_user}",
      "gists_url": "https://api.github.com/users/DavidMertz/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/DavidMertz/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/DavidMertz/subscriptions",
      "organizations_url": "https://api.github.com/users/DavidMertz/orgs",
      "repos_url": "https://api.github.com/users/DavidMertz/repos",
      "events_url": "https://api.github.com/users/DavidMertz/events{/privacy}",
      "received_events_url": "https://api.github.com/users/DavidMertz/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2019-03-03T23:12:31Z",
    "updated_at": "2019-03-03T23:14:52Z",
    "author_association": "NONE",
    "body": "Here's some confusing details.  The crash is dependent on the specific **values** of the `.groupby()` column.  Not just their types, but the values.  My example has integers I am grouping by.  I was trying to prepare an anonymized version of the data, and that accidentally fixes the problem:\r\n\r\n```python\r\n>>> df = sklearn.externals.joblib.load('modal-crash.joblib')[['_member_key','TARGET']]\r\n>>> try:\r\n...     modes = pd.DataFrame(df.groupby('_member_key').TARGET.agg(pd.Series.mode))\r\n... except Exception as err:\r\n...     print(err)\r\n...\r\nMust produce aggregated value\r\n>>> len(df._member_key.unique())\r\n8017\r\n>>> df['_member_key'] = df._member_key % 1234567890\r\n>>> len(df._member_key.unique())\r\n8017\r\n>>> # The translated keys remain distinct, no collision\r\n>>> try:\r\n...     modes = pd.DataFrame(df.groupby('_member_key').TARGET.agg(pd.Series.mode))\r\n... except Exception as err:\r\n...     print(err)\r\n...\r\n>>> modes.head(15)\r\n             TARGET\r\n_member_key\r\n734               S\r\n2240              M\r\n7951              L\r\n44730             M\r\n76205             M\r\n104934            S\r\n110136            M\r\n140722            S\r\n170215       [M, S]\r\n207047            M\r\n211359       [M, S]\r\n211756            L\r\n211908            M\r\n235569            S\r\n238314           XS\r\n```"
  },
  {
    "url": "https://api.github.com/repos/pandas-dev/pandas/issues/comments/469080862",
    "html_url": "https://github.com/pandas-dev/pandas/issues/25527#issuecomment-469080862",
    "issue_url": "https://api.github.com/repos/pandas-dev/pandas/issues/25527",
    "id": 469080862,
    "node_id": "MDEyOklzc3VlQ29tbWVudDQ2OTA4MDg2Mg==",
    "user": {
      "login": "DavidMertz",
      "id": 2380665,
      "node_id": "MDQ6VXNlcjIzODA2NjU=",
      "avatar_url": "https://avatars2.githubusercontent.com/u/2380665?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/DavidMertz",
      "html_url": "https://github.com/DavidMertz",
      "followers_url": "https://api.github.com/users/DavidMertz/followers",
      "following_url": "https://api.github.com/users/DavidMertz/following{/other_user}",
      "gists_url": "https://api.github.com/users/DavidMertz/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/DavidMertz/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/DavidMertz/subscriptions",
      "organizations_url": "https://api.github.com/users/DavidMertz/orgs",
      "repos_url": "https://api.github.com/users/DavidMertz/repos",
      "events_url": "https://api.github.com/users/DavidMertz/events{/privacy}",
      "received_events_url": "https://api.github.com/users/DavidMertz/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2019-03-04T00:10:54Z",
    "updated_at": "2019-03-04T00:26:27Z",
    "author_association": "NONE",
    "body": "@mroeschke ... OK, as I mention in comment above, **some** modifications of the groupby column make the error disappear, while other modifications do not resolve it.  I tried a variety of add/multiply/modulo/divide/etc of the integer keys, and see no obvious pattern of what fixes the problem and what does not.\r\n\r\nI *do* feel that I need to obscure the keys that relate to a particular client (possibly in an abundance of caution since the member numbers are not inherently meaningful.  Simply converting the integers to strings keeps the problem I'm trying to replicate.  And *some* modifications of those strings make the problem go away while other modifications keep the problem.  Again, no obvious pattern.\r\n\r\nContinuing that, *some* subselection of rows to get a smaller working DataFrame resolve the problem, while others retain the problem.  It is also not at all obvious what that pattern is.  I took every tenth row for the attached data; if I took every 15th the issue is somehow fixed, as it is if I take every tenth but exclude the first few thousand to reduce the size.  I am certain what is attached is not the *minimal* possible demonstration, but it is a reproducible demonstration.\r\n\r\n```python\r\n>>> import pandas as pd\r\n>>> import gzip\r\n>>> import pickle\r\n>>> df = pickle.load(gzip.open('modal-crash.pkl.gz'))\r\n>>> modes = pd.DataFrame(df.groupby('key').value.agg(pd.Series.mode))\r\nTraceback (most recent call last):\r\n  File \"<ipython-input-11-e565c12aa473>\", line 1, in <module>\r\n    modes = pd.DataFrame(df.groupby('key').value.agg(pd.Series.mode))\r\n  File \"/anaconda3/envs/boldmetrics-analysis/lib/python3.7/site-packages/pandas/core/groupby/generic.py\", line 778, in aggregate\r\n    result = self._aggregate_named(func_or_funcs, *args, **kwargs)\r\n  File \"/anaconda3/envs/boldmetrics-analysis/lib/python3.7/site-packages/pandas/core/groupby/generic.py\", line 909, in _aggregate_named\r\n    raise Exception('Must produce aggregated value')\r\nException: Must produce aggregated value\r\n```\r\n\r\n[modal-crash.pkl.gz](https://github.com/pandas-dev/pandas/files/2923871/modal-crash.pkl.gz)\r\n\r\n"
  }
]
