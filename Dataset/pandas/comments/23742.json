[
  {
    "url": "https://api.github.com/repos/pandas-dev/pandas/issues/comments/439473511",
    "html_url": "https://github.com/pandas-dev/pandas/issues/23742#issuecomment-439473511",
    "issue_url": "https://api.github.com/repos/pandas-dev/pandas/issues/23742",
    "id": 439473511,
    "node_id": "MDEyOklzc3VlQ29tbWVudDQzOTQ3MzUxMQ==",
    "user": {
      "login": "mroeschke",
      "id": 10647082,
      "node_id": "MDQ6VXNlcjEwNjQ3MDgy",
      "avatar_url": "https://avatars0.githubusercontent.com/u/10647082?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/mroeschke",
      "html_url": "https://github.com/mroeschke",
      "followers_url": "https://api.github.com/users/mroeschke/followers",
      "following_url": "https://api.github.com/users/mroeschke/following{/other_user}",
      "gists_url": "https://api.github.com/users/mroeschke/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/mroeschke/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/mroeschke/subscriptions",
      "organizations_url": "https://api.github.com/users/mroeschke/orgs",
      "repos_url": "https://api.github.com/users/mroeschke/repos",
      "events_url": "https://api.github.com/users/mroeschke/events{/privacy}",
      "received_events_url": "https://api.github.com/users/mroeschke/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2018-11-16T17:52:18Z",
    "updated_at": "2018-11-16T17:52:18Z",
    "author_association": "MEMBER",
    "body": "I get the same error as you in the latest release v0.23.4, but this does not raise on master (as lot of timezone things were fixed recently) and will be available with the upcomming v0.24.0 release.\r\n\r\n```\r\nIn [3]: pd.__version__\r\nOut[3]: '0.24.0.dev0+1028.gdb2066b7d'\r\n\r\nIn [4]: import pandas as pd\r\n   ...: idx = pd.date_range(start='2017-10-10', end='2017-10-20', fre\r\n   ...: q='1H')\r\n   ...: idx = idx.tz_localize('UTC').tz_convert('America/Sao_Paulo')\r\n   ...: df = pd.DataFrame(data=list(range(len(idx))), index=idx)\r\n   ...: groups = df.groupby(pd.Grouper(freq='1D'))\r\n   ...:\r\n   ...:\r\n\r\nIn [5]: groups\r\nOut[5]: <pandas.core.groupby.generic.DataFrameGroupBy object at 0x117b940b8>\r\n```\r\n\r\nCanonically though, `df.groupby(pd.Grouper(freq='1D'))` is equivalent to `df.resample('D')`"
  },
  {
    "url": "https://api.github.com/repos/pandas-dev/pandas/issues/comments/439555777",
    "html_url": "https://github.com/pandas-dev/pandas/issues/23742#issuecomment-439555777",
    "issue_url": "https://api.github.com/repos/pandas-dev/pandas/issues/23742",
    "id": 439555777,
    "node_id": "MDEyOklzc3VlQ29tbWVudDQzOTU1NTc3Nw==",
    "user": {
      "login": "gfyoung",
      "id": 9273653,
      "node_id": "MDQ6VXNlcjkyNzM2NTM=",
      "avatar_url": "https://avatars0.githubusercontent.com/u/9273653?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/gfyoung",
      "html_url": "https://github.com/gfyoung",
      "followers_url": "https://api.github.com/users/gfyoung/followers",
      "following_url": "https://api.github.com/users/gfyoung/following{/other_user}",
      "gists_url": "https://api.github.com/users/gfyoung/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/gfyoung/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/gfyoung/subscriptions",
      "organizations_url": "https://api.github.com/users/gfyoung/orgs",
      "repos_url": "https://api.github.com/users/gfyoung/repos",
      "events_url": "https://api.github.com/users/gfyoung/events{/privacy}",
      "received_events_url": "https://api.github.com/users/gfyoung/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2018-11-16T23:05:22Z",
    "updated_at": "2018-11-16T23:05:22Z",
    "author_association": "MEMBER",
    "body": "@mroeschke : Add a test to close this?  Or is this sufficiently covered?"
  },
  {
    "url": "https://api.github.com/repos/pandas-dev/pandas/issues/comments/439556521",
    "html_url": "https://github.com/pandas-dev/pandas/issues/23742#issuecomment-439556521",
    "issue_url": "https://api.github.com/repos/pandas-dev/pandas/issues/23742",
    "id": 439556521,
    "node_id": "MDEyOklzc3VlQ29tbWVudDQzOTU1NjUyMQ==",
    "user": {
      "login": "mroeschke",
      "id": 10647082,
      "node_id": "MDQ6VXNlcjEwNjQ3MDgy",
      "avatar_url": "https://avatars0.githubusercontent.com/u/10647082?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/mroeschke",
      "html_url": "https://github.com/mroeschke",
      "followers_url": "https://api.github.com/users/mroeschke/followers",
      "following_url": "https://api.github.com/users/mroeschke/following{/other_user}",
      "gists_url": "https://api.github.com/users/mroeschke/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/mroeschke/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/mroeschke/subscriptions",
      "organizations_url": "https://api.github.com/users/mroeschke/orgs",
      "repos_url": "https://api.github.com/users/mroeschke/repos",
      "events_url": "https://api.github.com/users/mroeschke/events{/privacy}",
      "received_events_url": "https://api.github.com/users/mroeschke/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2018-11-16T23:09:26Z",
    "updated_at": "2018-11-16T23:09:26Z",
    "author_association": "MEMBER",
    "body": "I _think_ this test covers a similar `resample` case, but I don't think we strictly have a test like this for `groupby(Grouper(...))`\r\n\r\nhttps://github.com/pandas-dev/pandas/blob/db2066b7d31450aaa87f2efcef492162a3d08309/pandas/tests/test_resample.py#L2510"
  },
  {
    "url": "https://api.github.com/repos/pandas-dev/pandas/issues/comments/439558560",
    "html_url": "https://github.com/pandas-dev/pandas/issues/23742#issuecomment-439558560",
    "issue_url": "https://api.github.com/repos/pandas-dev/pandas/issues/23742",
    "id": 439558560,
    "node_id": "MDEyOklzc3VlQ29tbWVudDQzOTU1ODU2MA==",
    "user": {
      "login": "gfyoung",
      "id": 9273653,
      "node_id": "MDQ6VXNlcjkyNzM2NTM=",
      "avatar_url": "https://avatars0.githubusercontent.com/u/9273653?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/gfyoung",
      "html_url": "https://github.com/gfyoung",
      "followers_url": "https://api.github.com/users/gfyoung/followers",
      "following_url": "https://api.github.com/users/gfyoung/following{/other_user}",
      "gists_url": "https://api.github.com/users/gfyoung/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/gfyoung/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/gfyoung/subscriptions",
      "organizations_url": "https://api.github.com/users/gfyoung/orgs",
      "repos_url": "https://api.github.com/users/gfyoung/repos",
      "events_url": "https://api.github.com/users/gfyoung/events{/privacy}",
      "received_events_url": "https://api.github.com/users/gfyoung/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2018-11-16T23:21:18Z",
    "updated_at": "2018-11-16T23:21:18Z",
    "author_association": "MEMBER",
    "body": "Hmm...might as well add a test specifically for this case then.  Doesn't hurt ðŸ™‚ "
  },
  {
    "url": "https://api.github.com/repos/pandas-dev/pandas/issues/comments/439891462",
    "html_url": "https://github.com/pandas-dev/pandas/issues/23742#issuecomment-439891462",
    "issue_url": "https://api.github.com/repos/pandas-dev/pandas/issues/23742",
    "id": 439891462,
    "node_id": "MDEyOklzc3VlQ29tbWVudDQzOTg5MTQ2Mg==",
    "user": {
      "login": "pierremoulinier",
      "id": 7794440,
      "node_id": "MDQ6VXNlcjc3OTQ0NDA=",
      "avatar_url": "https://avatars1.githubusercontent.com/u/7794440?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/pierremoulinier",
      "html_url": "https://github.com/pierremoulinier",
      "followers_url": "https://api.github.com/users/pierremoulinier/followers",
      "following_url": "https://api.github.com/users/pierremoulinier/following{/other_user}",
      "gists_url": "https://api.github.com/users/pierremoulinier/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/pierremoulinier/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/pierremoulinier/subscriptions",
      "organizations_url": "https://api.github.com/users/pierremoulinier/orgs",
      "repos_url": "https://api.github.com/users/pierremoulinier/repos",
      "events_url": "https://api.github.com/users/pierremoulinier/events{/privacy}",
      "received_events_url": "https://api.github.com/users/pierremoulinier/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2018-11-19T13:25:05Z",
    "updated_at": "2018-11-19T13:25:05Z",
    "author_association": "NONE",
    "body": "Sorry for the late reply, I only just had a look at the behavior for 0.24.0 -- indeed it does not raise anymore but I am not sure the new behavior is correct.\r\n\r\nIt looks like if I call `groups.aggregate(pd.np.mean)` the timestamps in the resulting dataframe will be the following:\r\n```\r\n2017-10-10 00:00:00-03:00\r\n2017-10-11 00:00:00-03:00\r\n...\r\n2017-10-14 00:00:00-03:00\r\n2017-10-15 01:00:00-02:00\r\n2017-10-16 01:00:00-02:00\r\n2017-10-17 01:00:00-02:00\r\n...\r\n```\r\n\r\nIn other words all the days get 'shifted' by the clock change, and timestamps on or after the 16th of October no longer represent the start of the local day.\r\n\r\nI guess this is correct if we consider that `1D` acually means \"24 hours\", however this is not the behavior I was expecting when using localized timestamps in a timezone with a DST offset (I would use a fixed UTC offset timezone such as `\"Etc/GMT+3\"` to achieve that result).\r\n\r\nNote that pandas 0.23 *does* have the behavior I expect for New York timezone, for instance:\r\n\r\n```\r\npd.date_range(start='2018-03-10', end='2018-03-13', freq='D', tz=\"America/New_York\")\r\n\r\nDatetimeIndex(['2018-03-10 00:00:00-05:00', '2018-03-11 00:00:00-05:00',\r\n               '2018-03-12 00:00:00-04:00', '2018-03-13 00:00:00-04:00'],\r\n              dtype='datetime64[ns, America/New_York]', freq='D')\r\n```\r\n\r\nIn the example above, `1D` is *not* a synonym for 24 hours, as there is only a 23 hour interval between the timestamp on the 11th and the one on the 12th.\r\n\r\nIs the new behavior a conscious change or did this go unnoticed?"
  },
  {
    "url": "https://api.github.com/repos/pandas-dev/pandas/issues/comments/439953593",
    "html_url": "https://github.com/pandas-dev/pandas/issues/23742#issuecomment-439953593",
    "issue_url": "https://api.github.com/repos/pandas-dev/pandas/issues/23742",
    "id": 439953593,
    "node_id": "MDEyOklzc3VlQ29tbWVudDQzOTk1MzU5Mw==",
    "user": {
      "login": "mroeschke",
      "id": 10647082,
      "node_id": "MDQ6VXNlcjEwNjQ3MDgy",
      "avatar_url": "https://avatars0.githubusercontent.com/u/10647082?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/mroeschke",
      "html_url": "https://github.com/mroeschke",
      "followers_url": "https://api.github.com/users/mroeschke/followers",
      "following_url": "https://api.github.com/users/mroeschke/following{/other_user}",
      "gists_url": "https://api.github.com/users/mroeschke/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/mroeschke/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/mroeschke/subscriptions",
      "organizations_url": "https://api.github.com/users/mroeschke/orgs",
      "repos_url": "https://api.github.com/users/mroeschke/repos",
      "events_url": "https://api.github.com/users/mroeschke/events{/privacy}",
      "received_events_url": "https://api.github.com/users/mroeschke/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2018-11-19T16:25:58Z",
    "updated_at": "2018-11-19T16:25:58Z",
    "author_association": "MEMBER",
    "body": "In current master, the `'CD'` offset was introduced to preserve the \"1 calendar day\"  behavior and `'D'` was changed to always mean 24 Hours; however, this is in the process of being reversed. https://github.com/pandas-dev/pandas/pull/22867 "
  },
  {
    "url": "https://api.github.com/repos/pandas-dev/pandas/issues/comments/440262437",
    "html_url": "https://github.com/pandas-dev/pandas/issues/23742#issuecomment-440262437",
    "issue_url": "https://api.github.com/repos/pandas-dev/pandas/issues/23742",
    "id": 440262437,
    "node_id": "MDEyOklzc3VlQ29tbWVudDQ0MDI2MjQzNw==",
    "user": {
      "login": "pierremoulinier",
      "id": 7794440,
      "node_id": "MDQ6VXNlcjc3OTQ0NDA=",
      "avatar_url": "https://avatars1.githubusercontent.com/u/7794440?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/pierremoulinier",
      "html_url": "https://github.com/pierremoulinier",
      "followers_url": "https://api.github.com/users/pierremoulinier/followers",
      "following_url": "https://api.github.com/users/pierremoulinier/following{/other_user}",
      "gists_url": "https://api.github.com/users/pierremoulinier/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/pierremoulinier/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/pierremoulinier/subscriptions",
      "organizations_url": "https://api.github.com/users/pierremoulinier/orgs",
      "repos_url": "https://api.github.com/users/pierremoulinier/repos",
      "events_url": "https://api.github.com/users/pierremoulinier/events{/privacy}",
      "received_events_url": "https://api.github.com/users/pierremoulinier/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2018-11-20T12:51:13Z",
    "updated_at": "2018-11-20T12:51:13Z",
    "author_association": "NONE",
    "body": "Hi Matthew, thanks for your reply above, this makes things clearer. I tried using `'CD'` on 0.24 and got the same `NonExistentTimeError` I mentionned initially.\r\n\r\n```\r\n> date_range(start='2017-10-09', end='2017-10-20', freq='CD', tz=\"America/Sao_Paulo\")\r\nTraceback (most recent call last):\r\n  File \"<stdin>\", line 1, in <module>\r\n  File \"/Users/github/pandas/pandas/core/indexes/datetimes.py\", line 1521, in date_range\r\n    closed=closed, **kwargs)\r\n  File \"/Users/github/pandas/pandas/core/indexes/datetimes.py\", line 229, in __new__\r\n    closed=closed, ambiguous=ambiguous)\r\n  File \"/Users/github/pandas/pandas/core/arrays/datetimes.py\", line 310, in _generate_range\r\n    tz, ambiguous=ambiguous)\r\n  File \"pandas/_libs/tslibs/conversion.pyx\", line 1044, in pandas._libs.tslibs.conversion.tz_localize_to_utc\r\n    raise pytz.NonExistentTimeError(stamp)\r\npytz.exceptions.NonExistentTimeError: 2017-10-15 00:00:00 \r\n```\r\n\r\nI suspect the original problem was not fixed in 0.24 but only hidden by the 'Day' vs 'Calendar Day' behavior change. I think issue will reappear when reverting this behavior change unless it is addressed in PR #22867 \r\n\r\nWhat's the best way to track this? Should we re-open this issue?\r\n\r\n"
  },
  {
    "url": "https://api.github.com/repos/pandas-dev/pandas/issues/comments/440337737",
    "html_url": "https://github.com/pandas-dev/pandas/issues/23742#issuecomment-440337737",
    "issue_url": "https://api.github.com/repos/pandas-dev/pandas/issues/23742",
    "id": 440337737,
    "node_id": "MDEyOklzc3VlQ29tbWVudDQ0MDMzNzczNw==",
    "user": {
      "login": "mroeschke",
      "id": 10647082,
      "node_id": "MDQ6VXNlcjEwNjQ3MDgy",
      "avatar_url": "https://avatars0.githubusercontent.com/u/10647082?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/mroeschke",
      "html_url": "https://github.com/mroeschke",
      "followers_url": "https://api.github.com/users/mroeschke/followers",
      "following_url": "https://api.github.com/users/mroeschke/following{/other_user}",
      "gists_url": "https://api.github.com/users/mroeschke/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/mroeschke/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/mroeschke/subscriptions",
      "organizations_url": "https://api.github.com/users/mroeschke/orgs",
      "repos_url": "https://api.github.com/users/mroeschke/repos",
      "events_url": "https://api.github.com/users/mroeschke/events{/privacy}",
      "received_events_url": "https://api.github.com/users/mroeschke/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2018-11-20T16:31:37Z",
    "updated_at": "2018-11-20T16:31:37Z",
    "author_association": "MEMBER",
    "body": "Thanks for the example. A `nonexistent` keyword argument was added recently in `tz_localize` that can help solve this problem.\r\n\r\n```\r\ndate_range(start='2017-10-09', end='2017-10-20', freq='CD').tz_localize(\"America/Sao_Paulo\", nonexistent='shift')\r\n```\r\n\r\nThe `tz` kwarg is similar to `tz_localize` except it lacks the error handling kwargs of ambiguous or nonexistent times and therefore does not make any assumptions of how to handle these times.."
  }
]
