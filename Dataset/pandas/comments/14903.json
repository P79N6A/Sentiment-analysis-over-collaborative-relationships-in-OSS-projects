[
  {
    "url": "https://api.github.com/repos/pandas-dev/pandas/issues/comments/267777718",
    "html_url": "https://github.com/pandas-dev/pandas/issues/14903#issuecomment-267777718",
    "issue_url": "https://api.github.com/repos/pandas-dev/pandas/issues/14903",
    "id": 267777718,
    "node_id": "MDEyOklzc3VlQ29tbWVudDI2Nzc3NzcxOA==",
    "user": {
      "login": "jreback",
      "id": 953992,
      "node_id": "MDQ6VXNlcjk1Mzk5Mg==",
      "avatar_url": "https://avatars2.githubusercontent.com/u/953992?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/jreback",
      "html_url": "https://github.com/jreback",
      "followers_url": "https://api.github.com/users/jreback/followers",
      "following_url": "https://api.github.com/users/jreback/following{/other_user}",
      "gists_url": "https://api.github.com/users/jreback/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/jreback/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/jreback/subscriptions",
      "organizations_url": "https://api.github.com/users/jreback/orgs",
      "repos_url": "https://api.github.com/users/jreback/repos",
      "events_url": "https://api.github.com/users/jreback/events{/privacy}",
      "received_events_url": "https://api.github.com/users/jreback/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2016-12-17T18:10:10Z",
    "updated_at": "2016-12-17T18:10:10Z",
    "author_association": "CONTRIBUTOR",
    "body": "cc @MaximilianR \r\n@shoyer "
  },
  {
    "url": "https://api.github.com/repos/pandas-dev/pandas/issues/comments/267779151",
    "html_url": "https://github.com/pandas-dev/pandas/issues/14903#issuecomment-267779151",
    "issue_url": "https://api.github.com/repos/pandas-dev/pandas/issues/14903",
    "id": 267779151,
    "node_id": "MDEyOklzc3VlQ29tbWVudDI2Nzc3OTE1MQ==",
    "user": {
      "login": "shoyer",
      "id": 1217238,
      "node_id": "MDQ6VXNlcjEyMTcyMzg=",
      "avatar_url": "https://avatars2.githubusercontent.com/u/1217238?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/shoyer",
      "html_url": "https://github.com/shoyer",
      "followers_url": "https://api.github.com/users/shoyer/followers",
      "following_url": "https://api.github.com/users/shoyer/following{/other_user}",
      "gists_url": "https://api.github.com/users/shoyer/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/shoyer/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/shoyer/subscriptions",
      "organizations_url": "https://api.github.com/users/shoyer/orgs",
      "repos_url": "https://api.github.com/users/shoyer/repos",
      "events_url": "https://api.github.com/users/shoyer/events{/privacy}",
      "received_events_url": "https://api.github.com/users/shoyer/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2016-12-17T18:37:53Z",
    "updated_at": "2016-12-17T18:37:53Z",
    "author_association": "MEMBER",
    "body": "I agree that this is unintuitive, but unfortunately it's not obvious what the right fix is.\r\n\r\nYou can actually see the same sorting behavior with pandas's `.unstack()` method, for the same reason:\r\n```\r\nIn [8]: solution.unstack()\r\nOut[8]:\r\n     tmp\r\nlev    0    1    2    3\r\nlag\r\n0    0.0  0.0  0.0  0.0\r\n1    0.0  0.0  0.0  0.0\r\n2    0.0  0.0  0.0  0.0\r\n3    0.0  0.0  0.0  0.0\r\n```\r\n\r\nThe problem is that for unstacking (in pandas or with `to_xarray()`), we simply use the order of `MultiIndex.labels`, instead of order of appearance on the `MultiIndex`. See https://github.com/pydata/xarray/issues/906 for an extensive discussion of the issue in the context of xarray's `unstack()` method.\r\n\r\nOne possible fix would be to change `unstack()` in both pandas and xarray to no longer use MultiIndex `labels` directly but instead always pull out in order of appearance, i.e.,\r\n```\r\nIn [14]: solution.index.levels[0].take(pd.unique(solution.index.labels[0]))\r\nOut[14]: Int64Index([3, 2, 1, 0], dtype='int64', name='lag')\r\n```\r\nThis would be an API change but possibly would be a welcome development. The order of `levels` is mostly an implementation detail that users would rather not need to think about. I suppose there could also potentially be a keyword argument to switch this behavior on/off in `unstack()` (and possibly `to_xarray()`).\r\n\r\nAlternatively, https://github.com/pandas-dev/pandas/issues/14672 proposes a new keyword argument to `MultiIndex.from_product` to avoid sorting levels when constructing the MultiIndex."
  },
  {
    "url": "https://api.github.com/repos/pandas-dev/pandas/issues/comments/267793881",
    "html_url": "https://github.com/pandas-dev/pandas/issues/14903#issuecomment-267793881",
    "issue_url": "https://api.github.com/repos/pandas-dev/pandas/issues/14903",
    "id": 267793881,
    "node_id": "MDEyOklzc3VlQ29tbWVudDI2Nzc5Mzg4MQ==",
    "user": {
      "login": "jreback",
      "id": 953992,
      "node_id": "MDQ6VXNlcjk1Mzk5Mg==",
      "avatar_url": "https://avatars2.githubusercontent.com/u/953992?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/jreback",
      "html_url": "https://github.com/jreback",
      "followers_url": "https://api.github.com/users/jreback/followers",
      "following_url": "https://api.github.com/users/jreback/following{/other_user}",
      "gists_url": "https://api.github.com/users/jreback/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/jreback/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/jreback/subscriptions",
      "organizations_url": "https://api.github.com/users/jreback/orgs",
      "repos_url": "https://api.github.com/users/jreback/repos",
      "events_url": "https://api.github.com/users/jreback/events{/privacy}",
      "received_events_url": "https://api.github.com/users/jreback/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2016-12-17T23:33:19Z",
    "updated_at": "2016-12-17T23:33:19Z",
    "author_association": "CONTRIBUTOR",
    "body": "ok will close this then pending what we do with #14672 / MI sorting in general."
  }
]
