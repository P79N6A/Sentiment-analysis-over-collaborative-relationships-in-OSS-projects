[
  {
    "url": "https://api.github.com/repos/pandas-dev/pandas/issues/comments/235594218",
    "html_url": "https://github.com/pandas-dev/pandas/pull/13819#issuecomment-235594218",
    "issue_url": "https://api.github.com/repos/pandas-dev/pandas/issues/13819",
    "id": 235594218,
    "node_id": "MDEyOklzc3VlQ29tbWVudDIzNTU5NDIxOA==",
    "user": {
      "login": "ivannz",
      "id": 2227377,
      "node_id": "MDQ6VXNlcjIyMjczNzc=",
      "avatar_url": "https://avatars1.githubusercontent.com/u/2227377?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/ivannz",
      "html_url": "https://github.com/ivannz",
      "followers_url": "https://api.github.com/users/ivannz/followers",
      "following_url": "https://api.github.com/users/ivannz/following{/other_user}",
      "gists_url": "https://api.github.com/users/ivannz/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/ivannz/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/ivannz/subscriptions",
      "organizations_url": "https://api.github.com/users/ivannz/orgs",
      "repos_url": "https://api.github.com/users/ivannz/repos",
      "events_url": "https://api.github.com/users/ivannz/events{/privacy}",
      "received_events_url": "https://api.github.com/users/ivannz/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2016-07-27T14:01:31Z",
    "updated_at": "2016-07-27T14:40:46Z",
    "author_association": "CONTRIBUTOR",
    "body": "Upon further consideration I came to the conclusion that the FIX could also have looked like this:\n\n``` python\n...\n                # Skip null keys\n                if lab == -1:\n                    out[ii] = -1\n                    continue\n...\n```\n\nNow, this raises the question of how groups with partially missing keys should be handled:\n- either partial matching of group keys is used, in which case the _-1_ in labels should be converted to proper group identifiers (probably, use [get_group_index](https://github.com/pydata/pandas/blob/master/pandas/core/groupby.py#L4062) with `xnull=False` in [_get_compressed_labels](https://github.com/pydata/pandas/blob/master/pandas/core/groupby.py#L1649));\n- or the incomplete keys are ignored (like in **nunique()**, **value_counts()**), and specifically in **shift()** should be filled with missing values.\n\nFor example, as far as I understand, in SQL **WHERE** clauses **NULL != NULL**, but in GROUP BY clauses **NULL == NULL**. This means that if pandas's **groupby()** were to be compatible with SQL, it should perform partial key matching.\n\nWhat do you think, @jreback?\n\nFor example how should shifted groupings by ['B', 'C'] of this\n\n```\n       B    C     F\n0    0.0  NaN   0.0\n1    1.0  1.0   1.0\n2    2.0  2.0   2.0\n3    3.0  NaN   3.0\n4    4.0  1.0   4.0\n5    5.0  2.0   5.0\n6    6.0  NaN   6.0\n7    7.0  1.0   7.0\n8    8.0  2.0   8.0\n9    9.0  NaN   9.0\n10  10.0  1.0  10.0\n11  11.0  2.0  11.0\n12   0.0  NaN  12.0\n13   1.0  1.0  13.0\n14   2.0  2.0  14.0\n15   3.0  NaN  15.0\n16   4.0  1.0  16.0\n```\n\ndiffer from this\n\n```\n       B    C     F\n0    0.0  0.0   0.0\n1    1.0  1.0   1.0\n2    2.0  2.0   2.0\n3    3.0  0.0   3.0\n4    4.0  1.0   4.0\n5    5.0  2.0   5.0\n6    6.0  0.0   6.0\n7    7.0  1.0   7.0\n8    8.0  2.0   8.0\n9    9.0  0.0   9.0\n10  10.0  1.0  10.0\n11  11.0  2.0  11.0\n12   0.0  0.0  12.0\n13   1.0  1.0  13.0\n14   2.0  2.0  14.0\n15   3.0  0.0  15.0\n16   4.0  1.0  16.0\n```\n\nThe shifted grouping of the latter gives\n\n```\n       F\n0   12.0\n1   13.0\n2   14.0\n3   15.0\n4   16.0\n5    NaN\n6    NaN\n7    NaN\n8    NaN\n9    NaN\n10   NaN\n11   NaN\n12   NaN\n13   NaN\n14   NaN\n15   NaN\n16   NaN\n```\n\nIn the case of partial groupby keys the second alternative could yield:\n\n```\n       F\n0    NaN\n1   13.0\n2   14.0\n3    NaN\n4   16.0\n5    NaN\n6    NaN\n7    NaN\n8    NaN\n9    NaN\n10   NaN\n11   NaN\n12   NaN\n13   NaN\n14   NaN\n15   NaN\n16   NaN\n```\n\nI used this code\n\n``` python\nimport pandas as pd\ndf = pd.DataFrame([(i%12, i%3 if i%3 else float(\"nan\"), i)\n                   for i in range(17)], dtype=float,\n                  columns=[\"B\", \"C\", \"F\"], index=None)\n\ndf = pd.DataFrame([(i%12, i%3, i) for i in range(17)], dtype=float,\n                  columns=[\"B\", \"C\", \"F\"], index=None)\n\nresult = df.groupby(['B', 'C']).shift(-1)\n```\n"
  },
  {
    "url": "https://api.github.com/repos/pandas-dev/pandas/issues/comments/235710217",
    "html_url": "https://github.com/pandas-dev/pandas/pull/13819#issuecomment-235710217",
    "issue_url": "https://api.github.com/repos/pandas-dev/pandas/issues/13819",
    "id": 235710217,
    "node_id": "MDEyOklzc3VlQ29tbWVudDIzNTcxMDIxNw==",
    "user": {
      "login": "codecov-io",
      "id": 8655789,
      "node_id": "MDQ6VXNlcjg2NTU3ODk=",
      "avatar_url": "https://avatars0.githubusercontent.com/u/8655789?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/codecov-io",
      "html_url": "https://github.com/codecov-io",
      "followers_url": "https://api.github.com/users/codecov-io/followers",
      "following_url": "https://api.github.com/users/codecov-io/following{/other_user}",
      "gists_url": "https://api.github.com/users/codecov-io/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/codecov-io/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/codecov-io/subscriptions",
      "organizations_url": "https://api.github.com/users/codecov-io/orgs",
      "repos_url": "https://api.github.com/users/codecov-io/repos",
      "events_url": "https://api.github.com/users/codecov-io/events{/privacy}",
      "received_events_url": "https://api.github.com/users/codecov-io/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2016-07-27T20:28:07Z",
    "updated_at": "2016-07-29T07:53:41Z",
    "author_association": "NONE",
    "body": "## [Current coverage](https://codecov.io/gh/pydata/pandas/pull/13819?src=pr) is 85.25% (diff: 100%)\n\n> Merging [#13819](https://codecov.io/gh/pydata/pandas/pull/13819?src=pr) into [master](https://codecov.io/gh/pydata/pandas/branch/master?src=pr) will not change coverage\n\n``` diff\n@@             master     #13819   diff @@\n==========================================\n  Files           140        140          \n  Lines         50449      50449          \n  Methods           0          0          \n  Messages          0          0          \n  Branches          0          0          \n==========================================\n  Hits          43008      43008          \n  Misses         7441       7441          \n  Partials          0          0          \n```\n\n> Powered by [Codecov](https://codecov.io?src=pr). Last update [2c55f28...bddf799](https://codecov.io/gh/pydata/pandas/compare/2c55f28fa7e6468d347894f26d6ecddcfada9cd9...bddf799812202357ca94009206654f44f50cd1a3?src=pr)\n"
  },
  {
    "url": "https://api.github.com/repos/pandas-dev/pandas/issues/comments/235726410",
    "html_url": "https://github.com/pandas-dev/pandas/pull/13819#issuecomment-235726410",
    "issue_url": "https://api.github.com/repos/pandas-dev/pandas/issues/13819",
    "id": 235726410,
    "node_id": "MDEyOklzc3VlQ29tbWVudDIzNTcyNjQxMA==",
    "user": {
      "login": "jreback",
      "id": 953992,
      "node_id": "MDQ6VXNlcjk1Mzk5Mg==",
      "avatar_url": "https://avatars2.githubusercontent.com/u/953992?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/jreback",
      "html_url": "https://github.com/jreback",
      "followers_url": "https://api.github.com/users/jreback/followers",
      "following_url": "https://api.github.com/users/jreback/following{/other_user}",
      "gists_url": "https://api.github.com/users/jreback/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/jreback/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/jreback/subscriptions",
      "organizations_url": "https://api.github.com/users/jreback/orgs",
      "repos_url": "https://api.github.com/users/jreback/repos",
      "events_url": "https://api.github.com/users/jreback/events{/privacy}",
      "received_events_url": "https://api.github.com/users/jreback/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2016-07-27T21:26:41Z",
    "updated_at": "2016-07-27T21:26:41Z",
    "author_association": "CONTRIBUTOR",
    "body": "pls add some tests\n"
  },
  {
    "url": "https://api.github.com/repos/pandas-dev/pandas/issues/comments/235731616",
    "html_url": "https://github.com/pandas-dev/pandas/pull/13819#issuecomment-235731616",
    "issue_url": "https://api.github.com/repos/pandas-dev/pandas/issues/13819",
    "id": 235731616,
    "node_id": "MDEyOklzc3VlQ29tbWVudDIzNTczMTYxNg==",
    "user": {
      "login": "ivannz",
      "id": 2227377,
      "node_id": "MDQ6VXNlcjIyMjczNzc=",
      "avatar_url": "https://avatars1.githubusercontent.com/u/2227377?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/ivannz",
      "html_url": "https://github.com/ivannz",
      "followers_url": "https://api.github.com/users/ivannz/followers",
      "following_url": "https://api.github.com/users/ivannz/following{/other_user}",
      "gists_url": "https://api.github.com/users/ivannz/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/ivannz/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/ivannz/subscriptions",
      "organizations_url": "https://api.github.com/users/ivannz/orgs",
      "repos_url": "https://api.github.com/users/ivannz/repos",
      "events_url": "https://api.github.com/users/ivannz/events{/privacy}",
      "received_events_url": "https://api.github.com/users/ivannz/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2016-07-27T21:46:59Z",
    "updated_at": "2016-07-27T21:46:59Z",
    "author_association": "CONTRIBUTOR",
    "body": "Ok, I will make a concise test and add it to [test_groupby.py](https://github.com/pydata/pandas/blob/master/pandas/tests/test_groupby.py).\n"
  },
  {
    "url": "https://api.github.com/repos/pandas-dev/pandas/issues/comments/235756713",
    "html_url": "https://github.com/pandas-dev/pandas/pull/13819#issuecomment-235756713",
    "issue_url": "https://api.github.com/repos/pandas-dev/pandas/issues/13819",
    "id": 235756713,
    "node_id": "MDEyOklzc3VlQ29tbWVudDIzNTc1NjcxMw==",
    "user": {
      "login": "chris-b1",
      "id": 1924092,
      "node_id": "MDQ6VXNlcjE5MjQwOTI=",
      "avatar_url": "https://avatars1.githubusercontent.com/u/1924092?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/chris-b1",
      "html_url": "https://github.com/chris-b1",
      "followers_url": "https://api.github.com/users/chris-b1/followers",
      "following_url": "https://api.github.com/users/chris-b1/following{/other_user}",
      "gists_url": "https://api.github.com/users/chris-b1/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/chris-b1/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/chris-b1/subscriptions",
      "organizations_url": "https://api.github.com/users/chris-b1/orgs",
      "repos_url": "https://api.github.com/users/chris-b1/repos",
      "events_url": "https://api.github.com/users/chris-b1/events{/privacy}",
      "received_events_url": "https://api.github.com/users/chris-b1/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2016-07-27T23:52:48Z",
    "updated_at": "2016-07-28T00:02:28Z",
    "author_association": "CONTRIBUTOR",
    "body": "Note that the file you're editing is from a template, you will need to make the change here:\nhttps://github.com/pydata/pandas/blob/master/pandas/src/algos_groupby_helper.pxi.in\n\nI think your second approach is correct (or at least consistent) - in fact the current impl seems to handle it?\n\n``` python\nIn [1]: pd.__version__\nOut[1]: u'0.18.1'\n\nIn [2]: df = pd.DataFrame([(i%12, i%3 if i%3 else float(\"nan\"), i)\n   ...:                    for i in range(17)], dtype=float,\n   ...:                   columns=[\"B\", \"C\", \"F\"], index=None)\n\nIn [3]: df.groupby(['B', 'C']).shift(-1)\nOut[3]:\n       F\n0    NaN\n1   13.0\n2   14.0\n3    NaN\n4   16.0\n5    NaN\n6    NaN\n7    NaN\n8    NaN\n9    NaN\n10   NaN\n11   NaN\n12   NaN\n13   NaN\n14   NaN\n15   NaN\n16   NaN\n```\n\nedit: ok, actually it seem to be dumb luck the current version (which I had written) gives this answer - it has bounds issues, but just sometimes doesn't crash.  But, it is also what `shift()` would have done before this bug was introduced.\n\n``` python\nIn [7]: pd.__version__\nOut[7]: '0.16.1'\n\nIn [8]: df = pd.DataFrame([(i%12, i%3 if i%3 else float(\"nan\"), i)\n   ...:                    for i in range(17)], dtype=float,\n   ...:                   columns=[\"B\", \"C\", \"F\"], index=None)\n\nIn [9]: df.groupby(['B', 'C']).shift(-1)\nOut[9]: \n     F\n0  NaN\n1   13\n2   14\n3  NaN\n4   16\n5  NaN\n6  NaN\n7  NaN\n8  NaN\n9  NaN\n10 NaN\n11 NaN\n12 NaN\n13 NaN\n14 NaN\n15 NaN\n16 NaN\n```\n"
  },
  {
    "url": "https://api.github.com/repos/pandas-dev/pandas/issues/comments/236118261",
    "html_url": "https://github.com/pandas-dev/pandas/pull/13819#issuecomment-236118261",
    "issue_url": "https://api.github.com/repos/pandas-dev/pandas/issues/13819",
    "id": 236118261,
    "node_id": "MDEyOklzc3VlQ29tbWVudDIzNjExODI2MQ==",
    "user": {
      "login": "ivannz",
      "id": 2227377,
      "node_id": "MDQ6VXNlcjIyMjczNzc=",
      "avatar_url": "https://avatars1.githubusercontent.com/u/2227377?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/ivannz",
      "html_url": "https://github.com/ivannz",
      "followers_url": "https://api.github.com/users/ivannz/followers",
      "following_url": "https://api.github.com/users/ivannz/following{/other_user}",
      "gists_url": "https://api.github.com/users/ivannz/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/ivannz/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/ivannz/subscriptions",
      "organizations_url": "https://api.github.com/users/ivannz/orgs",
      "repos_url": "https://api.github.com/users/ivannz/repos",
      "events_url": "https://api.github.com/users/ivannz/events{/privacy}",
      "received_events_url": "https://api.github.com/users/ivannz/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2016-07-29T07:56:53Z",
    "updated_at": "2016-07-29T07:58:30Z",
    "author_association": "CONTRIBUTOR",
    "body": "Can somebody tell me, please, what my actions should be when the Travis CI job [#21159](https://travis-ci.org/pydata/pandas/builds/148239405) of this PR fails, whilst the [build job](https://travis-ci.org/ivannz/pandas/builds/148239391) for the same commit on my forked (and rebased) repository succeeded.\n"
  },
  {
    "url": "https://api.github.com/repos/pandas-dev/pandas/issues/comments/236119806",
    "html_url": "https://github.com/pandas-dev/pandas/pull/13819#issuecomment-236119806",
    "issue_url": "https://api.github.com/repos/pandas-dev/pandas/issues/13819",
    "id": 236119806,
    "node_id": "MDEyOklzc3VlQ29tbWVudDIzNjExOTgwNg==",
    "user": {
      "login": "jorisvandenbossche",
      "id": 1020496,
      "node_id": "MDQ6VXNlcjEwMjA0OTY=",
      "avatar_url": "https://avatars2.githubusercontent.com/u/1020496?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/jorisvandenbossche",
      "html_url": "https://github.com/jorisvandenbossche",
      "followers_url": "https://api.github.com/users/jorisvandenbossche/followers",
      "following_url": "https://api.github.com/users/jorisvandenbossche/following{/other_user}",
      "gists_url": "https://api.github.com/users/jorisvandenbossche/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/jorisvandenbossche/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/jorisvandenbossche/subscriptions",
      "organizations_url": "https://api.github.com/users/jorisvandenbossche/orgs",
      "repos_url": "https://api.github.com/users/jorisvandenbossche/repos",
      "events_url": "https://api.github.com/users/jorisvandenbossche/events{/privacy}",
      "received_events_url": "https://api.github.com/users/jorisvandenbossche/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2016-07-29T08:05:23Z",
    "updated_at": "2016-07-29T08:05:23Z",
    "author_association": "MEMBER",
    "body": "@ivannz Something went wrong with that build, but probably not your fault. I restarted the build\n"
  },
  {
    "url": "https://api.github.com/repos/pandas-dev/pandas/issues/comments/236120966",
    "html_url": "https://github.com/pandas-dev/pandas/pull/13819#issuecomment-236120966",
    "issue_url": "https://api.github.com/repos/pandas-dev/pandas/issues/13819",
    "id": 236120966,
    "node_id": "MDEyOklzc3VlQ29tbWVudDIzNjEyMDk2Ng==",
    "user": {
      "login": "ivannz",
      "id": 2227377,
      "node_id": "MDQ6VXNlcjIyMjczNzc=",
      "avatar_url": "https://avatars1.githubusercontent.com/u/2227377?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/ivannz",
      "html_url": "https://github.com/ivannz",
      "followers_url": "https://api.github.com/users/ivannz/followers",
      "following_url": "https://api.github.com/users/ivannz/following{/other_user}",
      "gists_url": "https://api.github.com/users/ivannz/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/ivannz/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/ivannz/subscriptions",
      "organizations_url": "https://api.github.com/users/ivannz/orgs",
      "repos_url": "https://api.github.com/users/ivannz/repos",
      "events_url": "https://api.github.com/users/ivannz/events{/privacy}",
      "received_events_url": "https://api.github.com/users/ivannz/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2016-07-29T08:11:58Z",
    "updated_at": "2016-07-29T08:11:58Z",
    "author_association": "CONTRIBUTOR",
    "body": "Great! Thank you, @jorisvandenbossche .\n"
  },
  {
    "url": "https://api.github.com/repos/pandas-dev/pandas/issues/comments/236146615",
    "html_url": "https://github.com/pandas-dev/pandas/pull/13819#issuecomment-236146615",
    "issue_url": "https://api.github.com/repos/pandas-dev/pandas/issues/13819",
    "id": 236146615,
    "node_id": "MDEyOklzc3VlQ29tbWVudDIzNjE0NjYxNQ==",
    "user": {
      "login": "jreback",
      "id": 953992,
      "node_id": "MDQ6VXNlcjk1Mzk5Mg==",
      "avatar_url": "https://avatars2.githubusercontent.com/u/953992?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/jreback",
      "html_url": "https://github.com/jreback",
      "followers_url": "https://api.github.com/users/jreback/followers",
      "following_url": "https://api.github.com/users/jreback/following{/other_user}",
      "gists_url": "https://api.github.com/users/jreback/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/jreback/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/jreback/subscriptions",
      "organizations_url": "https://api.github.com/users/jreback/orgs",
      "repos_url": "https://api.github.com/users/jreback/repos",
      "events_url": "https://api.github.com/users/jreback/events{/privacy}",
      "received_events_url": "https://api.github.com/users/jreback/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2016-07-29T10:23:06Z",
    "updated_at": "2016-07-29T10:23:06Z",
    "author_association": "CONTRIBUTOR",
    "body": "thanks @ivannz \n"
  }
]
