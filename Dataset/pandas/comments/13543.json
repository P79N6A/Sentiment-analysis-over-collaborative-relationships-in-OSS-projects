[
  {
    "url": "https://api.github.com/repos/pandas-dev/pandas/issues/comments/229940977",
    "html_url": "https://github.com/pandas-dev/pandas/issues/13543#issuecomment-229940977",
    "issue_url": "https://api.github.com/repos/pandas-dev/pandas/issues/13543",
    "id": 229940977,
    "node_id": "MDEyOklzc3VlQ29tbWVudDIyOTk0MDk3Nw==",
    "user": {
      "login": "jreback",
      "id": 953992,
      "node_id": "MDQ6VXNlcjk1Mzk5Mg==",
      "avatar_url": "https://avatars2.githubusercontent.com/u/953992?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/jreback",
      "html_url": "https://github.com/jreback",
      "followers_url": "https://api.github.com/users/jreback/followers",
      "following_url": "https://api.github.com/users/jreback/following{/other_user}",
      "gists_url": "https://api.github.com/users/jreback/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/jreback/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/jreback/subscriptions",
      "organizations_url": "https://api.github.com/users/jreback/orgs",
      "repos_url": "https://api.github.com/users/jreback/repos",
      "events_url": "https://api.github.com/users/jreback/events{/privacy}",
      "received_events_url": "https://api.github.com/users/jreback/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2016-07-01T13:03:33Z",
    "updated_at": "2016-07-01T13:03:33Z",
    "author_association": "CONTRIBUTOR",
    "body": "this is correct, it tries a series reduction first. not sure why this implementation detail actually matters.\n"
  },
  {
    "url": "https://api.github.com/repos/pandas-dev/pandas/issues/comments/229941874",
    "html_url": "https://github.com/pandas-dev/pandas/issues/13543#issuecomment-229941874",
    "issue_url": "https://api.github.com/repos/pandas-dev/pandas/issues/13543",
    "id": 229941874,
    "node_id": "MDEyOklzc3VlQ29tbWVudDIyOTk0MTg3NA==",
    "user": {
      "login": "bashtage",
      "id": 5585221,
      "node_id": "MDQ6VXNlcjU1ODUyMjE=",
      "avatar_url": "https://avatars3.githubusercontent.com/u/5585221?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/bashtage",
      "html_url": "https://github.com/bashtage",
      "followers_url": "https://api.github.com/users/bashtage/followers",
      "following_url": "https://api.github.com/users/bashtage/following{/other_user}",
      "gists_url": "https://api.github.com/users/bashtage/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/bashtage/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/bashtage/subscriptions",
      "organizations_url": "https://api.github.com/users/bashtage/orgs",
      "repos_url": "https://api.github.com/users/bashtage/repos",
      "events_url": "https://api.github.com/users/bashtage/events{/privacy}",
      "received_events_url": "https://api.github.com/users/bashtage/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2016-07-01T13:08:08Z",
    "updated_at": "2016-07-01T13:08:08Z",
    "author_association": "CONTRIBUTOR",
    "body": "Because when the transformation makes use of DataFrame only attributes\ngroupby.transform produces an error.\n\nOn Fri, Jul 1, 2016, 2:04 PM Jeff Reback notifications@github.com wrote:\n\n> Closed #13543 https://github.com/pydata/pandas/issues/13543.\n> \n> —\n> You are receiving this because you authored the thread.\n> Reply to this email directly, view it on GitHub\n> https://github.com/pydata/pandas/issues/13543#event-710464452, or mute\n> the thread\n> https://github.com/notifications/unsubscribe/AFU5RcV9LjNXtj31MzXCRyxpDf-scxJdks5qRRA2gaJpZM4JDH31\n> .\n"
  },
  {
    "url": "https://api.github.com/repos/pandas-dev/pandas/issues/comments/229945104",
    "html_url": "https://github.com/pandas-dev/pandas/issues/13543#issuecomment-229945104",
    "issue_url": "https://api.github.com/repos/pandas-dev/pandas/issues/13543",
    "id": 229945104,
    "node_id": "MDEyOklzc3VlQ29tbWVudDIyOTk0NTEwNA==",
    "user": {
      "login": "jreback",
      "id": 953992,
      "node_id": "MDQ6VXNlcjk1Mzk5Mg==",
      "avatar_url": "https://avatars2.githubusercontent.com/u/953992?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/jreback",
      "html_url": "https://github.com/jreback",
      "followers_url": "https://api.github.com/users/jreback/followers",
      "following_url": "https://api.github.com/users/jreback/following{/other_user}",
      "gists_url": "https://api.github.com/users/jreback/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/jreback/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/jreback/subscriptions",
      "organizations_url": "https://api.github.com/users/jreback/orgs",
      "repos_url": "https://api.github.com/users/jreback/repos",
      "events_url": "https://api.github.com/users/jreback/events{/privacy}",
      "received_events_url": "https://api.github.com/users/jreback/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2016-07-01T13:22:13Z",
    "updated_at": "2016-07-01T13:22:13Z",
    "author_association": "CONTRIBUTOR",
    "body": "this doesn't matter as the exception is caught and next things are tried. you would have to show a compelling example.\n"
  },
  {
    "url": "https://api.github.com/repos/pandas-dev/pandas/issues/comments/229945971",
    "html_url": "https://github.com/pandas-dev/pandas/issues/13543#issuecomment-229945971",
    "issue_url": "https://api.github.com/repos/pandas-dev/pandas/issues/13543",
    "id": 229945971,
    "node_id": "MDEyOklzc3VlQ29tbWVudDIyOTk0NTk3MQ==",
    "user": {
      "login": "bashtage",
      "id": 5585221,
      "node_id": "MDQ6VXNlcjU1ODUyMjE=",
      "avatar_url": "https://avatars3.githubusercontent.com/u/5585221?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/bashtage",
      "html_url": "https://github.com/bashtage",
      "followers_url": "https://api.github.com/users/bashtage/followers",
      "following_url": "https://api.github.com/users/bashtage/following{/other_user}",
      "gists_url": "https://api.github.com/users/bashtage/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/bashtage/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/bashtage/subscriptions",
      "organizations_url": "https://api.github.com/users/bashtage/orgs",
      "repos_url": "https://api.github.com/users/bashtage/repos",
      "events_url": "https://api.github.com/users/bashtage/events{/privacy}",
      "received_events_url": "https://api.github.com/users/bashtage/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2016-07-01T13:25:55Z",
    "updated_at": "2016-07-01T13:25:55Z",
    "author_association": "CONTRIBUTOR",
    "body": "I will when I get back to the office. IMO there is a really simple fix -\nonly run slow path if fast path fails, rather than requiring slow path to\nwork.\n\nOn Fri, Jul 1, 2016, 2:22 PM Jeff Reback notifications@github.com wrote:\n\n> this doesn't matter as the exception is caught and next things are tried.\n> you would have to show a compelling example.\n> \n> —\n> You are receiving this because you authored the thread.\n> Reply to this email directly, view it on GitHub\n> https://github.com/pydata/pandas/issues/13543#issuecomment-229945104,\n> or mute the thread\n> https://github.com/notifications/unsubscribe/AFU5RWmVFVjGR1OlNLjgI3G20y08S2Kyks5qRRSWgaJpZM4JDH31\n> .\n"
  },
  {
    "url": "https://api.github.com/repos/pandas-dev/pandas/issues/comments/229948055",
    "html_url": "https://github.com/pandas-dev/pandas/issues/13543#issuecomment-229948055",
    "issue_url": "https://api.github.com/repos/pandas-dev/pandas/issues/13543",
    "id": 229948055,
    "node_id": "MDEyOklzc3VlQ29tbWVudDIyOTk0ODA1NQ==",
    "user": {
      "login": "jreback",
      "id": 953992,
      "node_id": "MDQ6VXNlcjk1Mzk5Mg==",
      "avatar_url": "https://avatars2.githubusercontent.com/u/953992?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/jreback",
      "html_url": "https://github.com/jreback",
      "followers_url": "https://api.github.com/users/jreback/followers",
      "following_url": "https://api.github.com/users/jreback/following{/other_user}",
      "gists_url": "https://api.github.com/users/jreback/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/jreback/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/jreback/subscriptions",
      "organizations_url": "https://api.github.com/users/jreback/orgs",
      "repos_url": "https://api.github.com/users/jreback/repos",
      "events_url": "https://api.github.com/users/jreback/events{/privacy}",
      "received_events_url": "https://api.github.com/users/jreback/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2016-07-01T13:35:32Z",
    "updated_at": "2016-07-01T13:35:32Z",
    "author_association": "CONTRIBUTOR",
    "body": "could be\n"
  },
  {
    "url": "https://api.github.com/repos/pandas-dev/pandas/issues/comments/229988782",
    "html_url": "https://github.com/pandas-dev/pandas/issues/13543#issuecomment-229988782",
    "issue_url": "https://api.github.com/repos/pandas-dev/pandas/issues/13543",
    "id": 229988782,
    "node_id": "MDEyOklzc3VlQ29tbWVudDIyOTk4ODc4Mg==",
    "user": {
      "login": "bashtage",
      "id": 5585221,
      "node_id": "MDQ6VXNlcjU1ODUyMjE=",
      "avatar_url": "https://avatars3.githubusercontent.com/u/5585221?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/bashtage",
      "html_url": "https://github.com/bashtage",
      "followers_url": "https://api.github.com/users/bashtage/followers",
      "following_url": "https://api.github.com/users/bashtage/following{/other_user}",
      "gists_url": "https://api.github.com/users/bashtage/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/bashtage/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/bashtage/subscriptions",
      "organizations_url": "https://api.github.com/users/bashtage/orgs",
      "repos_url": "https://api.github.com/users/bashtage/repos",
      "events_url": "https://api.github.com/users/bashtage/events{/privacy}",
      "received_events_url": "https://api.github.com/users/bashtage/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2016-07-01T16:21:11Z",
    "updated_at": "2016-07-01T16:21:11Z",
    "author_association": "CONTRIBUTOR",
    "body": "Here is my real example -- I am trying to do a selective groupby-demeaning where onlly a subset of columns are demeaned, but the retruend DataFrame has all columns.  \n\n``` python\n# Setup\nnp.random.seed(12345)\npanel = pd.Panel(np.random.randn(125,200,10))\npanel.iloc[:,:,0] = np.round(panel.iloc[:,:,0])\npanel.iloc[:,:,1] = np.round(panel.iloc[:,:,1])\nx = panel\ncols = [0,1]\n\ndemean_cols = []\nfor df_col in _x:\n    if df_col not in cols and pd.core.common.is_numeric_dtype(_x[df_col].dtype):\n        demean_cols.append(df_col)\n\n# Function start\n_x = x.swapaxes(0, 2).to_frame()\ndef _safe_demean(df):\n    print(type(df))\n    df[demean_cols] -= df[demean_cols].mean(0)\n    return df\n\nindex = _x.index\n_x.index = pd.RangeIndex(0, _x.shape[0])\ngroups = _x.groupby(cols)\nout = groups.transform(_safe_demean)\nout.index = index\n```\n\nThe function fulfils the requrements in the docstring.  It fails when it gets a `Series` since `demean_cols` is not in the series index.  I can, of course, workaroudn with using an `isinstance` and handling paths, but this requires knowledge of the implementation.  So at least this is a doc-bug, but I think it is an actual bug in the sense that the described (and reasonably correct) behavior of applying a group-wise transform to a DataFrame does not work when the callable returns a DataFrame.  Another \"real world\" bug can be produced by using a group-wise grand demeaning, which would be a function like\n\n``` python\ndef grand_demean(df):\n    return df - df.mean().mean()\n```\n\nin this case, I don't think it is possible to ever get the correct answer in the current implementation since it isn't possible to compute the grand mean without the entire group DF.  Even a simpler method would produce incorrect numbers:\n\n``` python\ndef grand_demean_numpy(df):\n    return df - np.mean(df) #  np-mean is all elements\n```\n\nThe errors are\n\n``` python\n\nC:\\anaconda\\lib\\site-packages\\pandas\\core\\series.py in _set_labels(self, key, value)\n    806         if mask.any():\n--> 807             raise ValueError('%s not contained in the index' % str(key[mask]))\n    808         self._set_values(indexer, value)\n\nValueError: ('[2 3 4 5 6 7 8 9] not contained in the index', 'occurred at index 2')\n\nDuring handling of the above exception, another exception occurred:\n\nValueErrorTraceback (most recent call last)\n<ipython-input-143-07044111bf11> in <module>()\n     22 _x.index = pd.RangeIndex(0, _x.shape[0])\n     23 groups = _x.groupby(cols)\n---> 24 out = groups.transform(_safe_demean)\n     25 out.index = index\n     26 \n\nC:\\anaconda\\lib\\site-packages\\pandas\\core\\groupby.py in transform(self, func, *args, **kwargs)\n   3455                 result = getattr(self, func)(*args, **kwargs)\n   3456         else:\n-> 3457             return self._transform_general(func, *args, **kwargs)\n   3458 \n   3459         # a reduction transform\n\nC:\\anaconda\\lib\\site-packages\\pandas\\core\\groupby.py in _transform_general(self, func, *args, **kwargs)\n   3403                 except ValueError:\n   3404                     msg = 'transform must return a scalar value for each group'\n-> 3405                     raise ValueError(msg)\n   3406             else:\n   3407                 res = path(group)\n\nValueError: transform must return a scalar value for each group\n```\n"
  },
  {
    "url": "https://api.github.com/repos/pandas-dev/pandas/issues/comments/229989407",
    "html_url": "https://github.com/pandas-dev/pandas/issues/13543#issuecomment-229989407",
    "issue_url": "https://api.github.com/repos/pandas-dev/pandas/issues/13543",
    "id": 229989407,
    "node_id": "MDEyOklzc3VlQ29tbWVudDIyOTk4OTQwNw==",
    "user": {
      "login": "bashtage",
      "id": 5585221,
      "node_id": "MDQ6VXNlcjU1ODUyMjE=",
      "avatar_url": "https://avatars3.githubusercontent.com/u/5585221?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/bashtage",
      "html_url": "https://github.com/bashtage",
      "followers_url": "https://api.github.com/users/bashtage/followers",
      "following_url": "https://api.github.com/users/bashtage/following{/other_user}",
      "gists_url": "https://api.github.com/users/bashtage/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/bashtage/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/bashtage/subscriptions",
      "organizations_url": "https://api.github.com/users/bashtage/orgs",
      "repos_url": "https://api.github.com/users/bashtage/repos",
      "events_url": "https://api.github.com/users/bashtage/events{/privacy}",
      "received_events_url": "https://api.github.com/users/bashtage/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2016-07-01T16:23:59Z",
    "updated_at": "2016-07-01T16:23:59Z",
    "author_association": "CONTRIBUTOR",
    "body": "FWIW the worksournd function to implement the selective group-wise demeaning looks like\n\n``` python\ndef _safe_demean(df):\n    if isinstance(df, pd.Series):\n        if df.name in demean_cols:\n            return df - df.mean()\n        else:\n            return df\n    df = df.copy()\n    df[demean_cols] -= df[demean_cols].mean(0)\n    return df\n```\n"
  },
  {
    "url": "https://api.github.com/repos/pandas-dev/pandas/issues/comments/229997892",
    "html_url": "https://github.com/pandas-dev/pandas/issues/13543#issuecomment-229997892",
    "issue_url": "https://api.github.com/repos/pandas-dev/pandas/issues/13543",
    "id": 229997892,
    "node_id": "MDEyOklzc3VlQ29tbWVudDIyOTk5Nzg5Mg==",
    "user": {
      "login": "jreback",
      "id": 953992,
      "node_id": "MDQ6VXNlcjk1Mzk5Mg==",
      "avatar_url": "https://avatars2.githubusercontent.com/u/953992?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/jreback",
      "html_url": "https://github.com/jreback",
      "followers_url": "https://api.github.com/users/jreback/followers",
      "following_url": "https://api.github.com/users/jreback/following{/other_user}",
      "gists_url": "https://api.github.com/users/jreback/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/jreback/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/jreback/subscriptions",
      "organizations_url": "https://api.github.com/users/jreback/orgs",
      "repos_url": "https://api.github.com/users/jreback/repos",
      "events_url": "https://api.github.com/users/jreback/events{/privacy}",
      "received_events_url": "https://api.github.com/users/jreback/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2016-07-01T17:02:24Z",
    "updated_at": "2016-07-01T17:02:24Z",
    "author_association": "CONTRIBUTOR",
    "body": "this is VERY inefficient and not idiomatic. It might technically fulfull the doc-string, but that should simply be fixed.\n\nyou are MUCH better off doing something like this:\n\n```\ndf - df.groupby(....).transform('mean')\n```\n"
  },
  {
    "url": "https://api.github.com/repos/pandas-dev/pandas/issues/comments/229998429",
    "html_url": "https://github.com/pandas-dev/pandas/issues/13543#issuecomment-229998429",
    "issue_url": "https://api.github.com/repos/pandas-dev/pandas/issues/13543",
    "id": 229998429,
    "node_id": "MDEyOklzc3VlQ29tbWVudDIyOTk5ODQyOQ==",
    "user": {
      "login": "jreback",
      "id": 953992,
      "node_id": "MDQ6VXNlcjk1Mzk5Mg==",
      "avatar_url": "https://avatars2.githubusercontent.com/u/953992?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/jreback",
      "html_url": "https://github.com/jreback",
      "followers_url": "https://api.github.com/users/jreback/followers",
      "following_url": "https://api.github.com/users/jreback/following{/other_user}",
      "gists_url": "https://api.github.com/users/jreback/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/jreback/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/jreback/subscriptions",
      "organizations_url": "https://api.github.com/users/jreback/orgs",
      "repos_url": "https://api.github.com/users/jreback/repos",
      "events_url": "https://api.github.com/users/jreback/events{/privacy}",
      "received_events_url": "https://api.github.com/users/jreback/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2016-07-01T17:04:40Z",
    "updated_at": "2016-07-01T17:04:40Z",
    "author_association": "CONTRIBUTOR",
    "body": "its realated to this: https://github.com/pydata/pandas/issues/13281\n\ngroupby/transform is an immutable operation though its not technically marked as such. modification in the function should be banned (at least in the doc-string). If not actually banned (which is quite tricky to detect).\n"
  },
  {
    "url": "https://api.github.com/repos/pandas-dev/pandas/issues/comments/230006332",
    "html_url": "https://github.com/pandas-dev/pandas/issues/13543#issuecomment-230006332",
    "issue_url": "https://api.github.com/repos/pandas-dev/pandas/issues/13543",
    "id": 230006332,
    "node_id": "MDEyOklzc3VlQ29tbWVudDIzMDAwNjMzMg==",
    "user": {
      "login": "bashtage",
      "id": 5585221,
      "node_id": "MDQ6VXNlcjU1ODUyMjE=",
      "avatar_url": "https://avatars3.githubusercontent.com/u/5585221?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/bashtage",
      "html_url": "https://github.com/bashtage",
      "followers_url": "https://api.github.com/users/bashtage/followers",
      "following_url": "https://api.github.com/users/bashtage/following{/other_user}",
      "gists_url": "https://api.github.com/users/bashtage/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/bashtage/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/bashtage/subscriptions",
      "organizations_url": "https://api.github.com/users/bashtage/orgs",
      "repos_url": "https://api.github.com/users/bashtage/repos",
      "events_url": "https://api.github.com/users/bashtage/events{/privacy}",
      "received_events_url": "https://api.github.com/users/bashtage/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2016-07-01T17:40:13Z",
    "updated_at": "2016-07-01T17:40:13Z",
    "author_association": "CONTRIBUTOR",
    "body": "I agree that the df should be considered immutable - my first example is poor (and in fact has terrible performance, a `.copy()` fixes that though).  \n\nI suppose a better docstring would highlight that\n- `transform` is only safe for within-variable transformations.  In particular the transform function must produce the same results if applied to the target df using `.apply` or directly.  This will make it clear that operations like a groupby-grand-demeaning aren't possible.\n- the function will be executed column-by-column.\n"
  },
  {
    "url": "https://api.github.com/repos/pandas-dev/pandas/issues/comments/230023115",
    "html_url": "https://github.com/pandas-dev/pandas/issues/13543#issuecomment-230023115",
    "issue_url": "https://api.github.com/repos/pandas-dev/pandas/issues/13543",
    "id": 230023115,
    "node_id": "MDEyOklzc3VlQ29tbWVudDIzMDAyMzExNQ==",
    "user": {
      "login": "jreback",
      "id": 953992,
      "node_id": "MDQ6VXNlcjk1Mzk5Mg==",
      "avatar_url": "https://avatars2.githubusercontent.com/u/953992?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/jreback",
      "html_url": "https://github.com/jreback",
      "followers_url": "https://api.github.com/users/jreback/followers",
      "following_url": "https://api.github.com/users/jreback/following{/other_user}",
      "gists_url": "https://api.github.com/users/jreback/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/jreback/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/jreback/subscriptions",
      "organizations_url": "https://api.github.com/users/jreback/orgs",
      "repos_url": "https://api.github.com/users/jreback/repos",
      "events_url": "https://api.github.com/users/jreback/events{/privacy}",
      "received_events_url": "https://api.github.com/users/jreback/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2016-07-01T18:56:54Z",
    "updated_at": "2016-07-01T18:56:54Z",
    "author_association": "CONTRIBUTOR",
    "body": "ok @bashtage if you want to do a better do-string (and maybe just turn off allowing mutation for transform), changing for apply would be too much ATM. Then I think that would be great.\n"
  }
]
