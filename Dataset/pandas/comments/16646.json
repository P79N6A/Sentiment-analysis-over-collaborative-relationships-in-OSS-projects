[
  {
    "url": "https://api.github.com/repos/pandas-dev/pandas/issues/comments/307312195",
    "html_url": "https://github.com/pandas-dev/pandas/issues/16646#issuecomment-307312195",
    "issue_url": "https://api.github.com/repos/pandas-dev/pandas/issues/16646",
    "id": 307312195,
    "node_id": "MDEyOklzc3VlQ29tbWVudDMwNzMxMjE5NQ==",
    "user": {
      "login": "bdforbes",
      "id": 15697539,
      "node_id": "MDQ6VXNlcjE1Njk3NTM5",
      "avatar_url": "https://avatars0.githubusercontent.com/u/15697539?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/bdforbes",
      "html_url": "https://github.com/bdforbes",
      "followers_url": "https://api.github.com/users/bdforbes/followers",
      "following_url": "https://api.github.com/users/bdforbes/following{/other_user}",
      "gists_url": "https://api.github.com/users/bdforbes/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/bdforbes/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/bdforbes/subscriptions",
      "organizations_url": "https://api.github.com/users/bdforbes/orgs",
      "repos_url": "https://api.github.com/users/bdforbes/repos",
      "events_url": "https://api.github.com/users/bdforbes/events{/privacy}",
      "received_events_url": "https://api.github.com/users/bdforbes/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2017-06-09T07:01:43Z",
    "updated_at": "2017-06-09T07:01:43Z",
    "author_association": "NONE",
    "body": "I've just found a simpler MWE. This fails:\r\n\r\n```python\r\n(\r\n    df\r\n    .groupby(level=0, axis=1)\r\n    .apply(\r\n        lambda df: 2*df.xs(df.name, axis=1)\r\n    )\r\n)\r\n```\r\n\r\nThis succeeds:\r\n```python\r\n(\r\n    df.T\r\n    .groupby(level=0)\r\n    .apply(\r\n        lambda df: 2*df.xs(df.name)\r\n    )\r\n)\r\n```"
  },
  {
    "url": "https://api.github.com/repos/pandas-dev/pandas/issues/comments/307355439",
    "html_url": "https://github.com/pandas-dev/pandas/issues/16646#issuecomment-307355439",
    "issue_url": "https://api.github.com/repos/pandas-dev/pandas/issues/16646",
    "id": 307355439,
    "node_id": "MDEyOklzc3VlQ29tbWVudDMwNzM1NTQzOQ==",
    "user": {
      "login": "jreback",
      "id": 953992,
      "node_id": "MDQ6VXNlcjk1Mzk5Mg==",
      "avatar_url": "https://avatars2.githubusercontent.com/u/953992?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/jreback",
      "html_url": "https://github.com/jreback",
      "followers_url": "https://api.github.com/users/jreback/followers",
      "following_url": "https://api.github.com/users/jreback/following{/other_user}",
      "gists_url": "https://api.github.com/users/jreback/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/jreback/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/jreback/subscriptions",
      "organizations_url": "https://api.github.com/users/jreback/orgs",
      "repos_url": "https://api.github.com/users/jreback/repos",
      "events_url": "https://api.github.com/users/jreback/events{/privacy}",
      "received_events_url": "https://api.github.com/users/jreback/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2017-06-09T10:33:01Z",
    "updated_at": "2017-06-09T10:33:01Z",
    "author_association": "CONTRIBUTOR",
    "body": "this is very very odd to odd. what are you actually trying to do? \r\n\r\n"
  },
  {
    "url": "https://api.github.com/repos/pandas-dev/pandas/issues/comments/307355921",
    "html_url": "https://github.com/pandas-dev/pandas/issues/16646#issuecomment-307355921",
    "issue_url": "https://api.github.com/repos/pandas-dev/pandas/issues/16646",
    "id": 307355921,
    "node_id": "MDEyOklzc3VlQ29tbWVudDMwNzM1NTkyMQ==",
    "user": {
      "login": "jreback",
      "id": 953992,
      "node_id": "MDQ6VXNlcjk1Mzk5Mg==",
      "avatar_url": "https://avatars2.githubusercontent.com/u/953992?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/jreback",
      "html_url": "https://github.com/jreback",
      "followers_url": "https://api.github.com/users/jreback/followers",
      "following_url": "https://api.github.com/users/jreback/following{/other_user}",
      "gists_url": "https://api.github.com/users/jreback/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/jreback/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/jreback/subscriptions",
      "organizations_url": "https://api.github.com/users/jreback/orgs",
      "repos_url": "https://api.github.com/users/jreback/repos",
      "events_url": "https://api.github.com/users/jreback/events{/privacy}",
      "received_events_url": "https://api.github.com/users/jreback/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2017-06-09T10:35:41Z",
    "updated_at": "2017-06-09T10:35:41Z",
    "author_association": "CONTRIBUTOR",
    "body": "for example your 'failing' ones:\r\n\r\n```\r\nOut[11]: \r\nA    [[1, 1, 2], [1, 1, 2], [1, 1, 2], [1, 1, 2], [...\r\nB    [[1, 1, 2], [1, 1, 2], [1, 1, 2], [1, 1, 2], [...\r\ndtype: object\r\n```\r\n\r\n```\r\nIn [10]: (\r\n    ...:     df\r\n    ...:     .groupby(level=0, axis=1)\r\n    ...:     .apply(\r\n    ...:         lambda df: 2*df.xs(df.name, axis=1).values\r\n    ...:     )\r\n    ...: )\r\nOut[10]: \r\nA    [[2, 2], [2, 2], [2, 2], [2, 2], [2, 2], [2, 2]]\r\nB    [[2, 2], [2, 2], [2, 2], [2, 2], [2, 2], [2, 2]]\r\ndtype: object\r\n```\r\n\r\nMakes no sense to do this. You can certainly iterate over the groups yourself and concat (though you will find exactly the same issue if you don't drop the indexes). By definition pandas wants to align return objects. "
  },
  {
    "url": "https://api.github.com/repos/pandas-dev/pandas/issues/comments/307366634",
    "html_url": "https://github.com/pandas-dev/pandas/issues/16646#issuecomment-307366634",
    "issue_url": "https://api.github.com/repos/pandas-dev/pandas/issues/16646",
    "id": 307366634,
    "node_id": "MDEyOklzc3VlQ29tbWVudDMwNzM2NjYzNA==",
    "user": {
      "login": "bdforbes",
      "id": 15697539,
      "node_id": "MDQ6VXNlcjE1Njk3NTM5",
      "avatar_url": "https://avatars0.githubusercontent.com/u/15697539?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/bdforbes",
      "html_url": "https://github.com/bdforbes",
      "followers_url": "https://api.github.com/users/bdforbes/followers",
      "following_url": "https://api.github.com/users/bdforbes/following{/other_user}",
      "gists_url": "https://api.github.com/users/bdforbes/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/bdforbes/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/bdforbes/subscriptions",
      "organizations_url": "https://api.github.com/users/bdforbes/orgs",
      "repos_url": "https://api.github.com/users/bdforbes/repos",
      "events_url": "https://api.github.com/users/bdforbes/events{/privacy}",
      "received_events_url": "https://api.github.com/users/bdforbes/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2017-06-09T11:39:24Z",
    "updated_at": "2017-06-09T11:39:24Z",
    "author_association": "NONE",
    "body": "I'm actually trying to adapt the code at https://stackoverflow.com/a/38964596/336001, which recursively adds subtotal rows into a DataFrame, to work along columns instead. Here is the original code, which adds subtotal rows:\r\n\r\n```python\r\ndef append_tot(df):\r\n    if hasattr(df, 'name') and df.name is not None:\r\n        xs = df.xs(df.name)\r\n    else:\r\n        xs = df\r\n    gb = xs.groupby(level=0)\r\n    n = xs.index.nlevels\r\n    name = tuple('Total' if i == 0 else '' for i in range(n))\r\n    tot = gb.sum().sum().rename(name).to_frame().T\r\n    if n > 1:\r\n        sm = gb.apply(append_tot)\r\n    else:\r\n        sm = gb.sum()\r\n    return pd.concat([sm, tot])\r\n```\r\n\r\nThe adapted version to add subtotal columns looks like this:\r\n\r\n```python\r\ndef append_tot(df):\r\n    if hasattr(df, 'name') and df.name is not None:\r\n        xs = df.xs(df.name, axis=1)\r\n    else:\r\n        xs = df\r\n    gb = xs.groupby(level=0, axis=1)\r\n    n = xs.columns.nlevels\r\n    name = tuple('Total' if i == 0 else '' for i in range(n))\r\n    tot = gb.sum().sum(axis=1).rename(name).to_frame()\r\n    if n > 1:\r\n        sm = gb.apply(append_tot)\r\n    else:\r\n        sm = gb.sum()\r\n    return pd.concat([sm, tot], axis=1)\r\n```\r\n\r\nThis code will produce the \"cannot reindex from a duplicate index\" error, whereas the original code provided in the Stack Overflow thread works fine.\r\n\r\nThe minimal working example I've found was just the simplest way to reproduce the error."
  },
  {
    "url": "https://api.github.com/repos/pandas-dev/pandas/issues/comments/326542649",
    "html_url": "https://github.com/pandas-dev/pandas/issues/16646#issuecomment-326542649",
    "issue_url": "https://api.github.com/repos/pandas-dev/pandas/issues/16646",
    "id": 326542649,
    "node_id": "MDEyOklzc3VlQ29tbWVudDMyNjU0MjY0OQ==",
    "user": {
      "login": "kernc",
      "id": 684364,
      "node_id": "MDQ6VXNlcjY4NDM2NA==",
      "avatar_url": "https://avatars2.githubusercontent.com/u/684364?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/kernc",
      "html_url": "https://github.com/kernc",
      "followers_url": "https://api.github.com/users/kernc/followers",
      "following_url": "https://api.github.com/users/kernc/following{/other_user}",
      "gists_url": "https://api.github.com/users/kernc/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/kernc/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/kernc/subscriptions",
      "organizations_url": "https://api.github.com/users/kernc/orgs",
      "repos_url": "https://api.github.com/users/kernc/repos",
      "events_url": "https://api.github.com/users/kernc/events{/privacy}",
      "received_events_url": "https://api.github.com/users/kernc/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2017-09-01T10:04:08Z",
    "updated_at": "2017-09-01T10:15:06Z",
    "author_association": "CONTRIBUTOR",
    "body": "I'm facing the same issue when trying to interpolate each series within a group:\r\n```py\r\n>>> df = pd.DataFrame({\r\n...     'node': [59, 59, 59, 314, 314, 314, 59],\r\n...     'ping': [116, np.nan, 106, 87, 80, np.nan, 118],\r\n...     'mode': ['2G', np.nan, '4G', '3G', np.nan, '3G', '2G']},\r\n...     columns=['node', 'ping', 'mode'],\r\n...     index=pd.to_datetime(['2017-07-13 00:30:00',\r\n...                           '2017-07-13 00:30:00',\r\n...                           '2017-07-13 00:30:00',\r\n...                           '2017-07-13 00:30:00',\r\n...                           '2017-07-13 01:00:00',\r\n...                           '2017-07-13 01:00:00',\r\n...                           '2017-07-13 01:00:00']))\r\n>>> df\r\n                     node   ping mode\r\n2017-07-13 00:30:00    59  116.0   2G\r\n2017-07-13 00:30:00    59    NaN  NaN\r\n2017-07-13 00:30:00    59  106.0   4G\r\n2017-07-13 00:30:00   314   87.0   3G\r\n2017-07-13 01:00:00   314   80.0  NaN\r\n2017-07-13 01:00:00   314    NaN   3G\r\n2017-07-13 01:00:00    59  118.0   2G\r\n\r\n>>> def interpolator(series):  # ffill for categoricals, linear otherwise\r\n...     if series.dtype == object:\r\n...         return series.ffill()\r\n...     return series.interpolate()\r\n\r\n>>> df.groupby('node').apply(lambda subdf: subdf.apply(interpolator))\r\n---------------------------------------------------------------------------\r\nValueError: cannot reindex from a duplicate axis\r\n```\r\n\r\nAnything obvious?\r\n\r\n**Edit**: It works, however, if I `df.reset_index(inplace=True)` before grouping."
  },
  {
    "url": "https://api.github.com/repos/pandas-dev/pandas/issues/comments/326698987",
    "html_url": "https://github.com/pandas-dev/pandas/issues/16646#issuecomment-326698987",
    "issue_url": "https://api.github.com/repos/pandas-dev/pandas/issues/16646",
    "id": 326698987,
    "node_id": "MDEyOklzc3VlQ29tbWVudDMyNjY5ODk4Nw==",
    "user": {
      "login": "bdforbes",
      "id": 15697539,
      "node_id": "MDQ6VXNlcjE1Njk3NTM5",
      "avatar_url": "https://avatars0.githubusercontent.com/u/15697539?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/bdforbes",
      "html_url": "https://github.com/bdforbes",
      "followers_url": "https://api.github.com/users/bdforbes/followers",
      "following_url": "https://api.github.com/users/bdforbes/following{/other_user}",
      "gists_url": "https://api.github.com/users/bdforbes/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/bdforbes/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/bdforbes/subscriptions",
      "organizations_url": "https://api.github.com/users/bdforbes/orgs",
      "repos_url": "https://api.github.com/users/bdforbes/repos",
      "events_url": "https://api.github.com/users/bdforbes/events{/privacy}",
      "received_events_url": "https://api.github.com/users/bdforbes/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2017-09-01T22:44:46Z",
    "updated_at": "2017-09-01T22:44:46Z",
    "author_association": "NONE",
    "body": "I never resolved my earlier problem, I managed to get around it by performing my operations along the other axis and transposing. It doesn't appear that your issue fits that pattern however."
  },
  {
    "url": "https://api.github.com/repos/pandas-dev/pandas/issues/comments/334601180",
    "html_url": "https://github.com/pandas-dev/pandas/issues/16646#issuecomment-334601180",
    "issue_url": "https://api.github.com/repos/pandas-dev/pandas/issues/16646",
    "id": 334601180,
    "node_id": "MDEyOklzc3VlQ29tbWVudDMzNDYwMTE4MA==",
    "user": {
      "login": "dayuhuang",
      "id": 7169117,
      "node_id": "MDQ6VXNlcjcxNjkxMTc=",
      "avatar_url": "https://avatars2.githubusercontent.com/u/7169117?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/dayuhuang",
      "html_url": "https://github.com/dayuhuang",
      "followers_url": "https://api.github.com/users/dayuhuang/followers",
      "following_url": "https://api.github.com/users/dayuhuang/following{/other_user}",
      "gists_url": "https://api.github.com/users/dayuhuang/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/dayuhuang/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/dayuhuang/subscriptions",
      "organizations_url": "https://api.github.com/users/dayuhuang/orgs",
      "repos_url": "https://api.github.com/users/dayuhuang/repos",
      "events_url": "https://api.github.com/users/dayuhuang/events{/privacy}",
      "received_events_url": "https://api.github.com/users/dayuhuang/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2017-10-05T21:46:29Z",
    "updated_at": "2017-10-05T21:46:29Z",
    "author_association": "NONE",
    "body": "I have the same issue here. This seems to have something to do with index of the data frame. Please see the following example to reproduce the error:\r\n```\r\ndata = pd.DataFrame({'x':[1,2,3],'y':[0,1,0]}, index=[0,0,1])\r\ndata.groupby(by='y').apply(lambda u: u)\r\n```\r\nError: `ValueError: cannot reindex from a duplicate axis`\r\n\r\nHowever, the following code which only differs by one element in the index will execute without producing the error:\r\n```\r\ndata = pd.DataFrame({'x':[1,2,3],'y':[0,1,0]}, index=[0,1,1])\r\ndata.groupby(by='y').apply(lambda u: u)\r\n```\r\nNote that the only change is the index of the second row.\r\n\r\npython 3.5\r\npandas 0.20.3"
  },
  {
    "url": "https://api.github.com/repos/pandas-dev/pandas/issues/comments/334718886",
    "html_url": "https://github.com/pandas-dev/pandas/issues/16646#issuecomment-334718886",
    "issue_url": "https://api.github.com/repos/pandas-dev/pandas/issues/16646",
    "id": 334718886,
    "node_id": "MDEyOklzc3VlQ29tbWVudDMzNDcxODg4Ng==",
    "user": {
      "login": "jreback",
      "id": 953992,
      "node_id": "MDQ6VXNlcjk1Mzk5Mg==",
      "avatar_url": "https://avatars2.githubusercontent.com/u/953992?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/jreback",
      "html_url": "https://github.com/jreback",
      "followers_url": "https://api.github.com/users/jreback/followers",
      "following_url": "https://api.github.com/users/jreback/following{/other_user}",
      "gists_url": "https://api.github.com/users/jreback/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/jreback/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/jreback/subscriptions",
      "organizations_url": "https://api.github.com/users/jreback/orgs",
      "repos_url": "https://api.github.com/users/jreback/repos",
      "events_url": "https://api.github.com/users/jreback/events{/privacy}",
      "received_events_url": "https://api.github.com/users/jreback/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2017-10-06T10:30:42Z",
    "updated_at": "2017-10-06T10:30:42Z",
    "author_association": "CONTRIBUTOR",
    "body": "I think you can just set the index in this case (this is internally where the error happens), rather than re-index, as its a transformation. PR's welcome."
  },
  {
    "url": "https://api.github.com/repos/pandas-dev/pandas/issues/comments/361964670",
    "html_url": "https://github.com/pandas-dev/pandas/issues/16646#issuecomment-361964670",
    "issue_url": "https://api.github.com/repos/pandas-dev/pandas/issues/16646",
    "id": 361964670,
    "node_id": "MDEyOklzc3VlQ29tbWVudDM2MTk2NDY3MA==",
    "user": {
      "login": "TomAugspurger",
      "id": 1312546,
      "node_id": "MDQ6VXNlcjEzMTI1NDY=",
      "avatar_url": "https://avatars3.githubusercontent.com/u/1312546?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/TomAugspurger",
      "html_url": "https://github.com/TomAugspurger",
      "followers_url": "https://api.github.com/users/TomAugspurger/followers",
      "following_url": "https://api.github.com/users/TomAugspurger/following{/other_user}",
      "gists_url": "https://api.github.com/users/TomAugspurger/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/TomAugspurger/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/TomAugspurger/subscriptions",
      "organizations_url": "https://api.github.com/users/TomAugspurger/orgs",
      "repos_url": "https://api.github.com/users/TomAugspurger/repos",
      "events_url": "https://api.github.com/users/TomAugspurger/events{/privacy}",
      "received_events_url": "https://api.github.com/users/TomAugspurger/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2018-01-31T15:21:00Z",
    "updated_at": "2018-01-31T15:21:00Z",
    "author_association": "CONTRIBUTOR",
    "body": "Duplicate of https://github.com/pandas-dev/pandas/issues/19437 (that's for duplicate index, this is for duplicate columns with axis=1). Should be the same fix."
  },
  {
    "url": "https://api.github.com/repos/pandas-dev/pandas/issues/comments/389430875",
    "html_url": "https://github.com/pandas-dev/pandas/issues/16646#issuecomment-389430875",
    "issue_url": "https://api.github.com/repos/pandas-dev/pandas/issues/16646",
    "id": 389430875,
    "node_id": "MDEyOklzc3VlQ29tbWVudDM4OTQzMDg3NQ==",
    "user": {
      "login": "jtlz2",
      "id": 3842318,
      "node_id": "MDQ6VXNlcjM4NDIzMTg=",
      "avatar_url": "https://avatars2.githubusercontent.com/u/3842318?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/jtlz2",
      "html_url": "https://github.com/jtlz2",
      "followers_url": "https://api.github.com/users/jtlz2/followers",
      "following_url": "https://api.github.com/users/jtlz2/following{/other_user}",
      "gists_url": "https://api.github.com/users/jtlz2/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/jtlz2/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/jtlz2/subscriptions",
      "organizations_url": "https://api.github.com/users/jtlz2/orgs",
      "repos_url": "https://api.github.com/users/jtlz2/repos",
      "events_url": "https://api.github.com/users/jtlz2/events{/privacy}",
      "received_events_url": "https://api.github.com/users/jtlz2/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2018-05-16T08:01:43Z",
    "updated_at": "2018-05-16T08:01:43Z",
    "author_association": "NONE",
    "body": "@kernc Thank you thank you for the amazing workaround!\r\n\r\ni.e. \r\n\r\n> It works, however, if I df.reset_index(inplace=True) before grouping."
  }
]
