[
  {
    "url": "https://api.github.com/repos/pandas-dev/pandas/issues/comments/398692094",
    "html_url": "https://github.com/pandas-dev/pandas/pull/21549#issuecomment-398692094",
    "issue_url": "https://api.github.com/repos/pandas-dev/pandas/issues/21549",
    "id": 398692094,
    "node_id": "MDEyOklzc3VlQ29tbWVudDM5ODY5MjA5NA==",
    "user": {
      "login": "jreback",
      "id": 953992,
      "node_id": "MDQ6VXNlcjk1Mzk5Mg==",
      "avatar_url": "https://avatars2.githubusercontent.com/u/953992?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/jreback",
      "html_url": "https://github.com/jreback",
      "followers_url": "https://api.github.com/users/jreback/followers",
      "following_url": "https://api.github.com/users/jreback/following{/other_user}",
      "gists_url": "https://api.github.com/users/jreback/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/jreback/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/jreback/subscriptions",
      "organizations_url": "https://api.github.com/users/jreback/orgs",
      "repos_url": "https://api.github.com/users/jreback/repos",
      "events_url": "https://api.github.com/users/jreback/events{/privacy}",
      "received_events_url": "https://api.github.com/users/jreback/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2018-06-20T09:51:35Z",
    "updated_at": "2018-06-20T09:51:45Z",
    "author_association": "CONTRIBUTOR",
    "body": "what does the generated code look like? (for that function)"
  },
  {
    "url": "https://api.github.com/repos/pandas-dev/pandas/issues/comments/398846233",
    "html_url": "https://github.com/pandas-dev/pandas/pull/21549#issuecomment-398846233",
    "issue_url": "https://api.github.com/repos/pandas-dev/pandas/issues/21549",
    "id": 398846233,
    "node_id": "MDEyOklzc3VlQ29tbWVudDM5ODg0NjIzMw==",
    "user": {
      "login": "jbrockmendel",
      "id": 8078968,
      "node_id": "MDQ6VXNlcjgwNzg5Njg=",
      "avatar_url": "https://avatars1.githubusercontent.com/u/8078968?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/jbrockmendel",
      "html_url": "https://github.com/jbrockmendel",
      "followers_url": "https://api.github.com/users/jbrockmendel/followers",
      "following_url": "https://api.github.com/users/jbrockmendel/following{/other_user}",
      "gists_url": "https://api.github.com/users/jbrockmendel/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/jbrockmendel/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/jbrockmendel/subscriptions",
      "organizations_url": "https://api.github.com/users/jbrockmendel/orgs",
      "repos_url": "https://api.github.com/users/jbrockmendel/repos",
      "events_url": "https://api.github.com/users/jbrockmendel/events{/privacy}",
      "received_events_url": "https://api.github.com/users/jbrockmendel/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2018-06-20T18:14:09Z",
    "updated_at": "2018-06-20T18:14:09Z",
    "author_association": "MEMBER",
    "body": "> what does the generated code look like? (for that function)\r\n\r\nAfter stripping out a bunch of comments:\r\n\r\n```\r\nstatic CYTHON_INLINE __pyx_t_5numpy_int32_t __pyx_f_6pandas_5_libs_6tslibs_9ccalendar_get_days_in_month(int __pyx_v_year, Py_ssize_t __pyx_v_month, CYTHON_UNUSED int __pyx_skip_dispatch) {\r\n  __pyx_t_5numpy_int32_t __pyx_r;\r\n\r\n  __pyx_r = (__pyx_v_6pandas_5_libs_6tslibs_9ccalendar_days_per_month_array[(((12 * __pyx_f_6pandas_5_libs_6tslibs_9ccalendar_is_leapyear(__pyx_v_year)) + __pyx_v_month) - 1)]);\r\n  goto __pyx_L0;\r\n\r\n  /* function exit code */\r\n  __pyx_L0:;\r\n  return __pyx_r;\r\n}```"
  },
  {
    "url": "https://api.github.com/repos/pandas-dev/pandas/issues/comments/399710033",
    "html_url": "https://github.com/pandas-dev/pandas/pull/21549#issuecomment-399710033",
    "issue_url": "https://api.github.com/repos/pandas-dev/pandas/issues/21549",
    "id": 399710033,
    "node_id": "MDEyOklzc3VlQ29tbWVudDM5OTcxMDAzMw==",
    "user": {
      "login": "chris-b1",
      "id": 1924092,
      "node_id": "MDQ6VXNlcjE5MjQwOTI=",
      "avatar_url": "https://avatars1.githubusercontent.com/u/1924092?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/chris-b1",
      "html_url": "https://github.com/chris-b1",
      "followers_url": "https://api.github.com/users/chris-b1/followers",
      "following_url": "https://api.github.com/users/chris-b1/following{/other_user}",
      "gists_url": "https://api.github.com/users/chris-b1/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/chris-b1/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/chris-b1/subscriptions",
      "organizations_url": "https://api.github.com/users/chris-b1/orgs",
      "repos_url": "https://api.github.com/users/chris-b1/repos",
      "events_url": "https://api.github.com/users/chris-b1/events{/privacy}",
      "received_events_url": "https://api.github.com/users/chris-b1/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2018-06-23T20:53:46Z",
    "updated_at": "2018-06-23T20:53:46Z",
    "author_association": "CONTRIBUTOR",
    "body": "I think this will all get inlined so performance shouldn't differ anyways, but FYI you can equivalently define/import `days_per_month_array` if you wanted to. \r\n\r\n```python\r\n# ccalender.pyx\r\ncdef int* days_per_month_array\r\n\r\n#tslib.pyx\r\nfrom ccalender cimport days_per_month_array\r\n```"
  },
  {
    "url": "https://api.github.com/repos/pandas-dev/pandas/issues/comments/399720016",
    "html_url": "https://github.com/pandas-dev/pandas/pull/21549#issuecomment-399720016",
    "issue_url": "https://api.github.com/repos/pandas-dev/pandas/issues/21549",
    "id": 399720016,
    "node_id": "MDEyOklzc3VlQ29tbWVudDM5OTcyMDAxNg==",
    "user": {
      "login": "jbrockmendel",
      "id": 8078968,
      "node_id": "MDQ6VXNlcjgwNzg5Njg=",
      "avatar_url": "https://avatars1.githubusercontent.com/u/8078968?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/jbrockmendel",
      "html_url": "https://github.com/jbrockmendel",
      "followers_url": "https://api.github.com/users/jbrockmendel/followers",
      "following_url": "https://api.github.com/users/jbrockmendel/following{/other_user}",
      "gists_url": "https://api.github.com/users/jbrockmendel/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/jbrockmendel/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/jbrockmendel/subscriptions",
      "organizations_url": "https://api.github.com/users/jbrockmendel/orgs",
      "repos_url": "https://api.github.com/users/jbrockmendel/repos",
      "events_url": "https://api.github.com/users/jbrockmendel/events{/privacy}",
      "received_events_url": "https://api.github.com/users/jbrockmendel/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2018-06-24T00:33:43Z",
    "updated_at": "2018-06-24T00:33:43Z",
    "author_association": "MEMBER",
    "body": "@chris-b1 I'm not sure we're on the same page as to the goal/problem.\r\n\r\n- Seemingly-equivalent implementations in C appear to continue outperforming those in cython\r\n- I think it has to do with the type of array that is used in the C file that can't be constructed as a global in the cython file. (see also comment above regarding cython's new \"verbatim C\" feature)\r\n- I've been an advocate for reducing C dependencies and implementing things directly in cython; if there are unavoidable performance implications, I may need to rethink that position.\r\n    - not having cython boilerplate leads (I think) to smaller .so files and (I expect) quicker compilation.  Not sure how much either of those matter.\r\n- Profiling these functions is tricky, so all of this comes with a grain of salt\r\n"
  },
  {
    "url": "https://api.github.com/repos/pandas-dev/pandas/issues/comments/399721634",
    "html_url": "https://github.com/pandas-dev/pandas/pull/21549#issuecomment-399721634",
    "issue_url": "https://api.github.com/repos/pandas-dev/pandas/issues/21549",
    "id": 399721634,
    "node_id": "MDEyOklzc3VlQ29tbWVudDM5OTcyMTYzNA==",
    "user": {
      "login": "chris-b1",
      "id": 1924092,
      "node_id": "MDQ6VXNlcjE5MjQwOTI=",
      "avatar_url": "https://avatars1.githubusercontent.com/u/1924092?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/chris-b1",
      "html_url": "https://github.com/chris-b1",
      "followers_url": "https://api.github.com/users/chris-b1/followers",
      "following_url": "https://api.github.com/users/chris-b1/following{/other_user}",
      "gists_url": "https://api.github.com/users/chris-b1/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/chris-b1/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/chris-b1/subscriptions",
      "organizations_url": "https://api.github.com/users/chris-b1/orgs",
      "repos_url": "https://api.github.com/users/chris-b1/repos",
      "events_url": "https://api.github.com/users/chris-b1/events{/privacy}",
      "received_events_url": "https://api.github.com/users/chris-b1/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2018-06-24T01:19:35Z",
    "updated_at": "2018-06-24T01:19:35Z",
    "author_association": "CONTRIBUTOR",
    "body": "Thanks for the color, I was attempting to say that I think this part is false, or at least seemed to work with what I showed above\r\n > the type of array that is used in the C file that can't be constructed as a global in the cython file. (see also comment above regarding cython's new \"verbatim C\" feature)\r\n\r\nInteresting (surprising) that performance is different, I will look closer"
  },
  {
    "url": "https://api.github.com/repos/pandas-dev/pandas/issues/comments/399722918",
    "html_url": "https://github.com/pandas-dev/pandas/pull/21549#issuecomment-399722918",
    "issue_url": "https://api.github.com/repos/pandas-dev/pandas/issues/21549",
    "id": 399722918,
    "node_id": "MDEyOklzc3VlQ29tbWVudDM5OTcyMjkxOA==",
    "user": {
      "login": "chris-b1",
      "id": 1924092,
      "node_id": "MDQ6VXNlcjE5MjQwOTI=",
      "avatar_url": "https://avatars1.githubusercontent.com/u/1924092?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/chris-b1",
      "html_url": "https://github.com/chris-b1",
      "followers_url": "https://api.github.com/users/chris-b1/followers",
      "following_url": "https://api.github.com/users/chris-b1/following{/other_user}",
      "gists_url": "https://api.github.com/users/chris-b1/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/chris-b1/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/chris-b1/subscriptions",
      "organizations_url": "https://api.github.com/users/chris-b1/orgs",
      "repos_url": "https://api.github.com/users/chris-b1/repos",
      "events_url": "https://api.github.com/users/chris-b1/events{/privacy}",
      "received_events_url": "https://api.github.com/users/chris-b1/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2018-06-24T01:56:47Z",
    "updated_at": "2018-06-24T01:56:47Z",
    "author_association": "CONTRIBUTOR",
    "body": "At least with `days_in_month` getting similar performance both ways\r\n```python\r\n# master\r\nbig_ts = pd.date_range('1999-01-01', periods=1_000_000, freq='H')\r\n%timeit big_ts.daysinmonth\r\n91.6 ms ± 11.7 ms per loop (mean ± std. dev. of 7 runs, 10 loops each)\r\n\r\n# patch\r\nbig_ts = pd.date_range('1999-01-01', periods=1_000_000, freq='H')\r\n%timeit big_ts.daysinmonth\r\n94.7 ms ± 6.98 ms per loop (mean ± std. dev. of 7 runs, 10 loops each)\r\n```\r\n\r\npatch\r\n```diff\r\ndiff --git a/pandas/_libs/tslibs/fields.pyx b/pandas/_libs/tslibs/fields.pyx\r\nindex ccf67e765..be53dfe8b 100644\r\n--- a/pandas/_libs/tslibs/fields.pyx\r\n+++ b/pandas/_libs/tslibs/fields.pyx\r\n@@ -14,13 +14,19 @@ from numpy cimport ndarray, int64_t, int32_t, int8_t\r\n cnp.import_array()\r\n\r\n from ccalendar import get_locale_names, MONTHS_FULL, DAYS_FULL\r\n-from ccalendar cimport (get_days_in_month, is_leapyear, dayofweek,\r\n+from ccalendar cimport (is_leapyear, dayofweek,\r\n                         get_week_of_year, get_day_of_year)\r\n from np_datetime cimport (pandas_datetimestruct, pandas_timedeltastruct,\r\n+                          days_per_month_table,\r\n                           dt64_to_dtstruct, td64_to_tdstruct)\r\n from nattype cimport NPY_NAT\r\n\r\n\r\n+@cython.wraparound(False)\r\n+@cython.boundscheck(False)\r\n+cdef inline int get_days_in_month(int year, int month) nogil:\r\n+    return days_per_month_table[is_leapyear(year)][month - 1]\r\n+\r\n def get_time_micros(ndarray[int64_t] dtindex):\r\n     \"\"\"\r\n     Return the number of microseconds in the time component of a\r\n```"
  },
  {
    "url": "https://api.github.com/repos/pandas-dev/pandas/issues/comments/399727376",
    "html_url": "https://github.com/pandas-dev/pandas/pull/21549#issuecomment-399727376",
    "issue_url": "https://api.github.com/repos/pandas-dev/pandas/issues/21549",
    "id": 399727376,
    "node_id": "MDEyOklzc3VlQ29tbWVudDM5OTcyNzM3Ng==",
    "user": {
      "login": "codecov[bot]",
      "id": 22429695,
      "node_id": "MDM6Qm90MjI0Mjk2OTU=",
      "avatar_url": "https://avatars2.githubusercontent.com/in/254?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/codecov%5Bbot%5D",
      "html_url": "https://github.com/apps/codecov",
      "followers_url": "https://api.github.com/users/codecov%5Bbot%5D/followers",
      "following_url": "https://api.github.com/users/codecov%5Bbot%5D/following{/other_user}",
      "gists_url": "https://api.github.com/users/codecov%5Bbot%5D/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/codecov%5Bbot%5D/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/codecov%5Bbot%5D/subscriptions",
      "organizations_url": "https://api.github.com/users/codecov%5Bbot%5D/orgs",
      "repos_url": "https://api.github.com/users/codecov%5Bbot%5D/repos",
      "events_url": "https://api.github.com/users/codecov%5Bbot%5D/events{/privacy}",
      "received_events_url": "https://api.github.com/users/codecov%5Bbot%5D/received_events",
      "type": "Bot",
      "site_admin": false
    },
    "created_at": "2018-06-24T04:06:16Z",
    "updated_at": "2018-06-26T22:29:55Z",
    "author_association": "NONE",
    "body": "# [Codecov](https://codecov.io/gh/pandas-dev/pandas/pull/21549?src=pr&el=h1) Report\n> Merging [#21549](https://codecov.io/gh/pandas-dev/pandas/pull/21549?src=pr&el=desc) into [master](https://codecov.io/gh/pandas-dev/pandas/commit/f1aa08c4631aea435d66c161557e44f7c72a618e?src=pr&el=desc) will **not change** coverage.\n> The diff coverage is `n/a`.\n\n[![Impacted file tree graph](https://codecov.io/gh/pandas-dev/pandas/pull/21549/graphs/tree.svg?src=pr&token=eZ4WkYLtcO&height=150&width=650)](https://codecov.io/gh/pandas-dev/pandas/pull/21549?src=pr&el=tree)\n\n```diff\n@@           Coverage Diff           @@\n##           master   #21549   +/-   ##\n=======================================\n  Coverage    91.9%    91.9%           \n=======================================\n  Files         153      153           \n  Lines       49547    49547           \n=======================================\n  Hits        45537    45537           \n  Misses       4010     4010\n```\n\n| Flag | Coverage Δ | |\n|---|---|---|\n| #multiple | `90.3% <ø> (ø)` | :arrow_up: |\n| #single | `41.78% <ø> (ø)` | :arrow_up: |\n\n\n------\n\n[Continue to review full report at Codecov](https://codecov.io/gh/pandas-dev/pandas/pull/21549?src=pr&el=continue).\n> **Legend** - [Click here to learn more](https://docs.codecov.io/docs/codecov-delta)\n> `Δ = absolute <relative> (impact)`, `ø = not affected`, `? = missing data`\n> Powered by [Codecov](https://codecov.io/gh/pandas-dev/pandas/pull/21549?src=pr&el=footer). Last update [f1aa08c...f986a5c](https://codecov.io/gh/pandas-dev/pandas/pull/21549?src=pr&el=lastupdated). Read the [comment docs](https://docs.codecov.io/docs/pull-request-comments).\n"
  },
  {
    "url": "https://api.github.com/repos/pandas-dev/pandas/issues/comments/400117816",
    "html_url": "https://github.com/pandas-dev/pandas/pull/21549#issuecomment-400117816",
    "issue_url": "https://api.github.com/repos/pandas-dev/pandas/issues/21549",
    "id": 400117816,
    "node_id": "MDEyOklzc3VlQ29tbWVudDQwMDExNzgxNg==",
    "user": {
      "login": "jreback",
      "id": 953992,
      "node_id": "MDQ6VXNlcjk1Mzk5Mg==",
      "avatar_url": "https://avatars2.githubusercontent.com/u/953992?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/jreback",
      "html_url": "https://github.com/jreback",
      "followers_url": "https://api.github.com/users/jreback/followers",
      "following_url": "https://api.github.com/users/jreback/following{/other_user}",
      "gists_url": "https://api.github.com/users/jreback/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/jreback/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/jreback/subscriptions",
      "organizations_url": "https://api.github.com/users/jreback/orgs",
      "repos_url": "https://api.github.com/users/jreback/repos",
      "events_url": "https://api.github.com/users/jreback/events{/privacy}",
      "received_events_url": "https://api.github.com/users/jreback/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2018-06-25T22:37:15Z",
    "updated_at": "2018-06-25T22:37:15Z",
    "author_association": "CONTRIBUTOR",
    "body": "@jbrockmendel status of this? (as the DO NOT MERGE at the top is clear!)"
  },
  {
    "url": "https://api.github.com/repos/pandas-dev/pandas/issues/comments/400403550",
    "html_url": "https://github.com/pandas-dev/pandas/pull/21549#issuecomment-400403550",
    "issue_url": "https://api.github.com/repos/pandas-dev/pandas/issues/21549",
    "id": 400403550,
    "node_id": "MDEyOklzc3VlQ29tbWVudDQwMDQwMzU1MA==",
    "user": {
      "login": "jbrockmendel",
      "id": 8078968,
      "node_id": "MDQ6VXNlcjgwNzg5Njg=",
      "avatar_url": "https://avatars1.githubusercontent.com/u/8078968?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/jbrockmendel",
      "html_url": "https://github.com/jbrockmendel",
      "followers_url": "https://api.github.com/users/jbrockmendel/followers",
      "following_url": "https://api.github.com/users/jbrockmendel/following{/other_user}",
      "gists_url": "https://api.github.com/users/jbrockmendel/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/jbrockmendel/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/jbrockmendel/subscriptions",
      "organizations_url": "https://api.github.com/users/jbrockmendel/orgs",
      "repos_url": "https://api.github.com/users/jbrockmendel/repos",
      "events_url": "https://api.github.com/users/jbrockmendel/events{/privacy}",
      "received_events_url": "https://api.github.com/users/jbrockmendel/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2018-06-26T17:45:53Z",
    "updated_at": "2018-06-26T17:45:53Z",
    "author_association": "MEMBER",
    "body": "If I understand @chris-b1 correctly then the perf discrepancy may not be an issue, in which case this is a clear (albeit small) improvement, so merge is OK."
  },
  {
    "url": "https://api.github.com/repos/pandas-dev/pandas/issues/comments/400483681",
    "html_url": "https://github.com/pandas-dev/pandas/pull/21549#issuecomment-400483681",
    "issue_url": "https://api.github.com/repos/pandas-dev/pandas/issues/21549",
    "id": 400483681,
    "node_id": "MDEyOklzc3VlQ29tbWVudDQwMDQ4MzY4MQ==",
    "user": {
      "login": "jreback",
      "id": 953992,
      "node_id": "MDQ6VXNlcjk1Mzk5Mg==",
      "avatar_url": "https://avatars2.githubusercontent.com/u/953992?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/jreback",
      "html_url": "https://github.com/jreback",
      "followers_url": "https://api.github.com/users/jreback/followers",
      "following_url": "https://api.github.com/users/jreback/following{/other_user}",
      "gists_url": "https://api.github.com/users/jreback/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/jreback/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/jreback/subscriptions",
      "organizations_url": "https://api.github.com/users/jreback/orgs",
      "repos_url": "https://api.github.com/users/jreback/repos",
      "events_url": "https://api.github.com/users/jreback/events{/privacy}",
      "received_events_url": "https://api.github.com/users/jreback/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2018-06-26T22:29:55Z",
    "updated_at": "2018-06-26T22:29:55Z",
    "author_association": "CONTRIBUTOR",
    "body": "thanks @jbrockmendel "
  }
]
