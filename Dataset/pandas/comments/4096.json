[
  {
    "url": "https://api.github.com/repos/pandas-dev/pandas/issues/comments/20300454",
    "html_url": "https://github.com/pandas-dev/pandas/issues/4096#issuecomment-20300454",
    "issue_url": "https://api.github.com/repos/pandas-dev/pandas/issues/4096",
    "id": 20300454,
    "node_id": "MDEyOklzc3VlQ29tbWVudDIwMzAwNDU0",
    "user": {
      "login": "jreback",
      "id": 953992,
      "node_id": "MDQ6VXNlcjk1Mzk5Mg==",
      "avatar_url": "https://avatars2.githubusercontent.com/u/953992?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/jreback",
      "html_url": "https://github.com/jreback",
      "followers_url": "https://api.github.com/users/jreback/followers",
      "following_url": "https://api.github.com/users/jreback/following{/other_user}",
      "gists_url": "https://api.github.com/users/jreback/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/jreback/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/jreback/subscriptions",
      "organizations_url": "https://api.github.com/users/jreback/orgs",
      "repos_url": "https://api.github.com/users/jreback/repos",
      "events_url": "https://api.github.com/users/jreback/events{/privacy}",
      "received_events_url": "https://api.github.com/users/jreback/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2013-07-01T18:24:52Z",
    "updated_at": "2013-07-01T18:24:52Z",
    "author_association": "CONTRIBUTOR",
    "body": "See your modified code below\n- you can move the store outside of the loop\n- add `Current Ric` and `GMT Offset` as data columns, this creates them separately from other blocks\n\nNote, that if you read and create this csv all at once then this works fine (with your existing code)\n\nThis is a buglet, but as you note, tricky to reproduce. The error message is basically saying: hey you are trying to write columns differently from what exists on disk, namely the Current Ric and GMT Offset are reversed.\n\nThis is because they are constructed internally in a different order (namely the internal representation which has differernt dtypes in different blocks), gives a different order to the blocks. I am not exactly sure why that would be the case. Will look further.\n\n```\nimport pandas as pd\n\niter_csv = pd.read_csv('t4.csv.gz', compression='gzip',\n                       parse_dates={'timestamp': [2,3]},\n                       dayfirst=True, iterator=True, chunksize=10)\n\n\nstore = pd.HDFStore('bug.h5',mode='w')\nfor chunk in iter_csv:\n        raw = chunk\n        del raw['#RIC']\n\n        ### These del's are not important. But the types in error message depend on them\n        del raw['Exch Time']\n        del raw['Quote Time']\n        del raw['Type']\n        del raw['Qualifiers']\n\n        mapping = {'None': 0, 'SSTN0': 2, 'SSTc1': 1}\n        raw = raw.replace({'Current RIC': mapping})\n\n        ### If we replace int32 here with float (or int8) everything will work\n        raw['Current RIC'] = raw['Current RIC'].fillna(-1).astype('int16')\n\n        ### Now: if you uncomment the next line and comment following two - again it will work\n        #raw = raw[['Current RIC','timestamp']]\n        for fld in ['Price','Volume', 'Bid Size','Ask Size','Bid Price','Ask Price']:\n                raw[fld] = raw[fld].astype('float')\n\n        raw.set_index('timestamp', inplace=True)\n\n        print raw.dtypes\n        store.append('raw', raw, data_columns=['Current RIC','GMT Offset'])\n\nstore.close()\n```\n"
  },
  {
    "url": "https://api.github.com/repos/pandas-dev/pandas/issues/comments/20360963",
    "html_url": "https://github.com/pandas-dev/pandas/issues/4096#issuecomment-20360963",
    "issue_url": "https://api.github.com/repos/pandas-dev/pandas/issues/4096",
    "id": 20360963,
    "node_id": "MDEyOklzc3VlQ29tbWVudDIwMzYwOTYz",
    "user": {
      "login": "vfilimonov",
      "id": 1324881,
      "node_id": "MDQ6VXNlcjEzMjQ4ODE=",
      "avatar_url": "https://avatars2.githubusercontent.com/u/1324881?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/vfilimonov",
      "html_url": "https://github.com/vfilimonov",
      "followers_url": "https://api.github.com/users/vfilimonov/followers",
      "following_url": "https://api.github.com/users/vfilimonov/following{/other_user}",
      "gists_url": "https://api.github.com/users/vfilimonov/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/vfilimonov/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/vfilimonov/subscriptions",
      "organizations_url": "https://api.github.com/users/vfilimonov/orgs",
      "repos_url": "https://api.github.com/users/vfilimonov/repos",
      "events_url": "https://api.github.com/users/vfilimonov/events{/privacy}",
      "received_events_url": "https://api.github.com/users/vfilimonov/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2013-07-02T17:20:43Z",
    "updated_at": "2013-07-02T17:20:59Z",
    "author_association": "CONTRIBUTOR",
    "body": "Hi, jreback. Thank you very much for your suggestion and prompt bug fix! \n\nCould you please point to some docs where I can read about `data_columns` argument? In particular, I am interested in the question if it does indexing or creates additional overhead in size of HDF file?\n"
  },
  {
    "url": "https://api.github.com/repos/pandas-dev/pandas/issues/comments/20361197",
    "html_url": "https://github.com/pandas-dev/pandas/issues/4096#issuecomment-20361197",
    "issue_url": "https://api.github.com/repos/pandas-dev/pandas/issues/4096",
    "id": 20361197,
    "node_id": "MDEyOklzc3VlQ29tbWVudDIwMzYxMTk3",
    "user": {
      "login": "jreback",
      "id": 953992,
      "node_id": "MDQ6VXNlcjk1Mzk5Mg==",
      "avatar_url": "https://avatars2.githubusercontent.com/u/953992?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/jreback",
      "html_url": "https://github.com/jreback",
      "followers_url": "https://api.github.com/users/jreback/followers",
      "following_url": "https://api.github.com/users/jreback/following{/other_user}",
      "gists_url": "https://api.github.com/users/jreback/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/jreback/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/jreback/subscriptions",
      "organizations_url": "https://api.github.com/users/jreback/orgs",
      "repos_url": "https://api.github.com/users/jreback/repos",
      "events_url": "https://api.github.com/users/jreback/events{/privacy}",
      "received_events_url": "https://api.github.com/users/jreback/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2013-07-02T17:23:52Z",
    "updated_at": "2013-07-02T17:23:52Z",
    "author_association": "CONTRIBUTOR",
    "body": "http://pandas.pydata.org/pandas-docs/dev/io.html#query-via-data-columns\n\nessentially `data_columns` allow you to control how the data is store (e.g. these will generate a one-to-one field mapping in PyTables, automatically index, and allow selection via them). downside it is somewhat slower (not a lot, but don't make _every_ field a data_column), only the ones you think that you will need for indexing\n"
  },
  {
    "url": "https://api.github.com/repos/pandas-dev/pandas/issues/comments/20361972",
    "html_url": "https://github.com/pandas-dev/pandas/issues/4096#issuecomment-20361972",
    "issue_url": "https://api.github.com/repos/pandas-dev/pandas/issues/4096",
    "id": 20361972,
    "node_id": "MDEyOklzc3VlQ29tbWVudDIwMzYxOTcy",
    "user": {
      "login": "vfilimonov",
      "id": 1324881,
      "node_id": "MDQ6VXNlcjEzMjQ4ODE=",
      "avatar_url": "https://avatars2.githubusercontent.com/u/1324881?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/vfilimonov",
      "html_url": "https://github.com/vfilimonov",
      "followers_url": "https://api.github.com/users/vfilimonov/followers",
      "following_url": "https://api.github.com/users/vfilimonov/following{/other_user}",
      "gists_url": "https://api.github.com/users/vfilimonov/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/vfilimonov/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/vfilimonov/subscriptions",
      "organizations_url": "https://api.github.com/users/vfilimonov/orgs",
      "repos_url": "https://api.github.com/users/vfilimonov/repos",
      "events_url": "https://api.github.com/users/vfilimonov/events{/privacy}",
      "received_events_url": "https://api.github.com/users/vfilimonov/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2013-07-02T17:35:13Z",
    "updated_at": "2013-07-02T17:35:13Z",
    "author_association": "CONTRIBUTOR",
    "body": "jreback, thanks again for the explanation!\n"
  }
]
