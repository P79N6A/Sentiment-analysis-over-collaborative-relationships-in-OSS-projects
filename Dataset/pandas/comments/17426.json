[
  {
    "url": "https://api.github.com/repos/pandas-dev/pandas/issues/comments/327029495",
    "html_url": "https://github.com/pandas-dev/pandas/issues/17426#issuecomment-327029495",
    "issue_url": "https://api.github.com/repos/pandas-dev/pandas/issues/17426",
    "id": 327029495,
    "node_id": "MDEyOklzc3VlQ29tbWVudDMyNzAyOTQ5NQ==",
    "user": {
      "login": "gfyoung",
      "id": 9273653,
      "node_id": "MDQ6VXNlcjkyNzM2NTM=",
      "avatar_url": "https://avatars0.githubusercontent.com/u/9273653?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/gfyoung",
      "html_url": "https://github.com/gfyoung",
      "followers_url": "https://api.github.com/users/gfyoung/followers",
      "following_url": "https://api.github.com/users/gfyoung/following{/other_user}",
      "gists_url": "https://api.github.com/users/gfyoung/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/gfyoung/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/gfyoung/subscriptions",
      "organizations_url": "https://api.github.com/users/gfyoung/orgs",
      "repos_url": "https://api.github.com/users/gfyoung/repos",
      "events_url": "https://api.github.com/users/gfyoung/events{/privacy}",
      "received_events_url": "https://api.github.com/users/gfyoung/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2017-09-04T21:20:56Z",
    "updated_at": "2017-09-04T21:20:56Z",
    "author_association": "MEMBER",
    "body": "@MattWoodhead : Hmm...that seems a little odd.  Feel free to investigate to see if there is a bug in our handling of `openpyxl`.  Just curious: does calling `writer.save()` before you create the graph make a difference for you?"
  },
  {
    "url": "https://api.github.com/repos/pandas-dev/pandas/issues/comments/327132287",
    "html_url": "https://github.com/pandas-dev/pandas/issues/17426#issuecomment-327132287",
    "issue_url": "https://api.github.com/repos/pandas-dev/pandas/issues/17426",
    "id": 327132287,
    "node_id": "MDEyOklzc3VlQ29tbWVudDMyNzEzMjI4Nw==",
    "user": {
      "login": "jreback",
      "id": 953992,
      "node_id": "MDQ6VXNlcjk1Mzk5Mg==",
      "avatar_url": "https://avatars2.githubusercontent.com/u/953992?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/jreback",
      "html_url": "https://github.com/jreback",
      "followers_url": "https://api.github.com/users/jreback/followers",
      "following_url": "https://api.github.com/users/jreback/following{/other_user}",
      "gists_url": "https://api.github.com/users/jreback/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/jreback/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/jreback/subscriptions",
      "organizations_url": "https://api.github.com/users/jreback/orgs",
      "repos_url": "https://api.github.com/users/jreback/repos",
      "events_url": "https://api.github.com/users/jreback/events{/privacy}",
      "received_events_url": "https://api.github.com/users/jreback/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2017-09-05T10:09:15Z",
    "updated_at": "2017-09-05T10:09:15Z",
    "author_association": "CONTRIBUTOR",
    "body": "this is almost certainly a bug in ``openpyxl`` (or incorrect usage) and not pandas. pls report there."
  },
  {
    "url": "https://api.github.com/repos/pandas-dev/pandas/issues/comments/327155672",
    "html_url": "https://github.com/pandas-dev/pandas/issues/17426#issuecomment-327155672",
    "issue_url": "https://api.github.com/repos/pandas-dev/pandas/issues/17426",
    "id": 327155672,
    "node_id": "MDEyOklzc3VlQ29tbWVudDMyNzE1NTY3Mg==",
    "user": {
      "login": "TomAugspurger",
      "id": 1312546,
      "node_id": "MDQ6VXNlcjEzMTI1NDY=",
      "avatar_url": "https://avatars3.githubusercontent.com/u/1312546?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/TomAugspurger",
      "html_url": "https://github.com/TomAugspurger",
      "followers_url": "https://api.github.com/users/TomAugspurger/followers",
      "following_url": "https://api.github.com/users/TomAugspurger/following{/other_user}",
      "gists_url": "https://api.github.com/users/TomAugspurger/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/TomAugspurger/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/TomAugspurger/subscriptions",
      "organizations_url": "https://api.github.com/users/TomAugspurger/orgs",
      "repos_url": "https://api.github.com/users/TomAugspurger/repos",
      "events_url": "https://api.github.com/users/TomAugspurger/events{/privacy}",
      "received_events_url": "https://api.github.com/users/TomAugspurger/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2017-09-05T12:06:11Z",
    "updated_at": "2017-09-05T12:06:11Z",
    "author_association": "CONTRIBUTOR",
    "body": "Looks like https://bitbucket.org/openpyxl/openpyxl/issues/886/using-scatter-charts-corrupts-the-excel#comment-39603120 has narrowed it down to pandas. @MattWoodhead can you narrow it down any further, and maybe make a simpler example that's appropriate for a unit test?"
  },
  {
    "url": "https://api.github.com/repos/pandas-dev/pandas/issues/comments/327266393",
    "html_url": "https://github.com/pandas-dev/pandas/issues/17426#issuecomment-327266393",
    "issue_url": "https://api.github.com/repos/pandas-dev/pandas/issues/17426",
    "id": 327266393,
    "node_id": "MDEyOklzc3VlQ29tbWVudDMyNzI2NjM5Mw==",
    "user": {
      "login": "MattWoodhead",
      "id": 26529943,
      "node_id": "MDQ6VXNlcjI2NTI5OTQz",
      "avatar_url": "https://avatars0.githubusercontent.com/u/26529943?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/MattWoodhead",
      "html_url": "https://github.com/MattWoodhead",
      "followers_url": "https://api.github.com/users/MattWoodhead/followers",
      "following_url": "https://api.github.com/users/MattWoodhead/following{/other_user}",
      "gists_url": "https://api.github.com/users/MattWoodhead/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/MattWoodhead/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/MattWoodhead/subscriptions",
      "organizations_url": "https://api.github.com/users/MattWoodhead/orgs",
      "repos_url": "https://api.github.com/users/MattWoodhead/repos",
      "events_url": "https://api.github.com/users/MattWoodhead/events{/privacy}",
      "received_events_url": "https://api.github.com/users/MattWoodhead/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2017-09-05T18:42:45Z",
    "updated_at": "2017-09-05T18:45:48Z",
    "author_association": "NONE",
    "body": "I think I have narrowed it down to the Pandas ExcelWriter.close() method. @gfyoung saving before creating the graph did not change the behaviour. I have written a more simplified test case, and included the four tests I used to focus on the .close method. @TomAugspurger I have never used a unit test before, but I hope the below is more suitable.\r\n\r\n```python\r\nimport os\r\nimport pandas as pd\r\nfrom openpyxl.chart import ScatterChart, Reference, Series\r\n\r\nFILE = \"out.xlsx\"\r\nwriter = pd.ExcelWriter(FILE, engine='openpyxl')\r\nwb = writer.book\r\n\r\ndef write_data_to_excel():\r\n    dataframe = pd.DataFrame()\r\n\r\n    # Small test data set - X^2\r\n    dataframe[\"X\"] = [0, 1, 2, 3, 4, 5]\r\n    dataframe[\"Y\"] = [0, 1, 4, 9, 16, 25]\r\n\r\n    # Send dataframe to excel using pandas method\r\n    dataframe.to_excel(writer, sheet_name=\"sheet1\")\r\n    return dataframe\r\n\r\ndef add_chart_to_excel(data_length):\r\n    ws = writer.sheets[\"sheet1\"]  # worksheet\r\n\r\n    #writer.save()\r\n\r\n    # Add Graph\r\n    chart_1 = ScatterChart()  # create scatter chart\r\n    x_values = Reference(ws, min_col=2, min_row=2, max_row=data_length)\r\n    y_values = Reference(ws, min_col=3, min_row=1, max_row=data_length)\r\n    chart_1.series.append(Series(y_values, x_values, title_from_data=True))\r\n\r\n    ws.add_chart(chart_1, \"E10\")  # insert a simple graph in cell E10\r\n\r\ndef pandas_writer_save():\r\n    writer.save()\r\n\r\ndef pandas_writer_close():\r\n    writer.close()\r\n\r\ndef openpyxl_save():\r\n    wb.save(FILE)\r\n\r\ndef openpyxl_close():\r\n    wb.close()\r\n\r\n#~~~~~~~~~~~~~~~~~~~~~~~~~~~~~Test 1 - both pandas save and close methods\r\ndf = write_data_to_excel()\r\nadd_chart_to_excel(len(df))\r\npandas_writer_save()\r\npandas_writer_close()\r\n# ~~~~~~~~~~~~~~~~~~~~~~~~~~~~Result - Corrupt sheet, graph has to be removed\r\n\r\n#~~~~~~~~~~~~~~~~~~~~~~~~~~~~~Test 2 - pandas save and openpyxl close\r\n#df = write_data_to_excel()\r\n#add_chart_to_excel(len(df))\r\n#pandas_writer_save()\r\n#openpyxl_close()\r\n# ~~~~~~~~~~~~~~~~~~~~~~~~~~~~Result - Workbook created correctly - no errors\r\n\r\n#~~~~~~~~~~~~~~~~~~~~~~~~~~~~~Test 3 - pandas save without close\r\n#df = write_data_to_excel()\r\n#add_chart_to_excel(len(df))\r\n#pandas_writer_save()\r\n# ~~~~~~~~~~~~~~~~~~~~~~~~~~~~Result - Workbook created correctly - no errors\r\n\r\n#~~~~~~~~~~~~~~~~~~~~~~~~~~~~~Test 2 - openpyxl save and pandas close\r\n#df = write_data_to_excel()\r\n#add_chart_to_excel(len(df))\r\n#openpyxl_save()\r\n#pandas_writer_close()\r\n# ~~~~~~~~~~~~~~~~~~~~~~~~~~~~Result - Corrupt sheet, graph has to be removed\r\n\r\nos.startfile(FILE)\r\n```"
  },
  {
    "url": "https://api.github.com/repos/pandas-dev/pandas/issues/comments/327267070",
    "html_url": "https://github.com/pandas-dev/pandas/issues/17426#issuecomment-327267070",
    "issue_url": "https://api.github.com/repos/pandas-dev/pandas/issues/17426",
    "id": 327267070,
    "node_id": "MDEyOklzc3VlQ29tbWVudDMyNzI2NzA3MA==",
    "user": {
      "login": "gfyoung",
      "id": 9273653,
      "node_id": "MDQ6VXNlcjkyNzM2NTM=",
      "avatar_url": "https://avatars0.githubusercontent.com/u/9273653?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/gfyoung",
      "html_url": "https://github.com/gfyoung",
      "followers_url": "https://api.github.com/users/gfyoung/followers",
      "following_url": "https://api.github.com/users/gfyoung/following{/other_user}",
      "gists_url": "https://api.github.com/users/gfyoung/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/gfyoung/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/gfyoung/subscriptions",
      "organizations_url": "https://api.github.com/users/gfyoung/orgs",
      "repos_url": "https://api.github.com/users/gfyoung/repos",
      "events_url": "https://api.github.com/users/gfyoung/events{/privacy}",
      "received_events_url": "https://api.github.com/users/gfyoung/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2017-09-05T18:45:16Z",
    "updated_at": "2017-09-05T18:45:16Z",
    "author_association": "MEMBER",
    "body": "@MattWoodhead : This is good!  Have a look at the `.close()` method and see what's going on there."
  },
  {
    "url": "https://api.github.com/repos/pandas-dev/pandas/issues/comments/327285249",
    "html_url": "https://github.com/pandas-dev/pandas/issues/17426#issuecomment-327285249",
    "issue_url": "https://api.github.com/repos/pandas-dev/pandas/issues/17426",
    "id": 327285249,
    "node_id": "MDEyOklzc3VlQ29tbWVudDMyNzI4NTI0OQ==",
    "user": {
      "login": "MattWoodhead",
      "id": 26529943,
      "node_id": "MDQ6VXNlcjI2NTI5OTQz",
      "avatar_url": "https://avatars0.githubusercontent.com/u/26529943?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/MattWoodhead",
      "html_url": "https://github.com/MattWoodhead",
      "followers_url": "https://api.github.com/users/MattWoodhead/followers",
      "following_url": "https://api.github.com/users/MattWoodhead/following{/other_user}",
      "gists_url": "https://api.github.com/users/MattWoodhead/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/MattWoodhead/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/MattWoodhead/subscriptions",
      "organizations_url": "https://api.github.com/users/MattWoodhead/orgs",
      "repos_url": "https://api.github.com/users/MattWoodhead/repos",
      "events_url": "https://api.github.com/users/MattWoodhead/events{/privacy}",
      "received_events_url": "https://api.github.com/users/MattWoodhead/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2017-09-05T19:55:48Z",
    "updated_at": "2017-09-05T19:55:48Z",
    "author_association": "NONE",
    "body": "I have had a look around, and it appears that .close() means different things in openpyxl and pandas: \r\n\r\nIn openpyxl the (optional) close method closes the ooxml package (it is also closed on save, so no need for an extra .close()). \r\nIn pandas, the close method is an alias for save(). I have performed further testing that indicates that it is the saving of the workbook twice that is causing the issue.\r\n\r\nI trawled through the openpyxl issues and found [this](https://bitbucket.org/openpyxl/openpyxl/issues/528/saving-workbook-with-charts-twice-makes), which seems to indicate that this issue should be resolved. \r\n\r\nObviously this means that the issue isnt directly with pandas, but is it appropriate that the behaviour of the openpyxl engine does not replicate that of the openpyxl module?"
  }
]
