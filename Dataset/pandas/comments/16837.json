[
  {
    "url": "https://api.github.com/repos/pandas-dev/pandas/issues/comments/313467834",
    "html_url": "https://github.com/pandas-dev/pandas/issues/16837#issuecomment-313467834",
    "issue_url": "https://api.github.com/repos/pandas-dev/pandas/issues/16837",
    "id": 313467834,
    "node_id": "MDEyOklzc3VlQ29tbWVudDMxMzQ2NzgzNA==",
    "user": {
      "login": "chris-b1",
      "id": 1924092,
      "node_id": "MDQ6VXNlcjE5MjQwOTI=",
      "avatar_url": "https://avatars1.githubusercontent.com/u/1924092?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/chris-b1",
      "html_url": "https://github.com/chris-b1",
      "followers_url": "https://api.github.com/users/chris-b1/followers",
      "following_url": "https://api.github.com/users/chris-b1/following{/other_user}",
      "gists_url": "https://api.github.com/users/chris-b1/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/chris-b1/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/chris-b1/subscriptions",
      "organizations_url": "https://api.github.com/users/chris-b1/orgs",
      "repos_url": "https://api.github.com/users/chris-b1/repos",
      "events_url": "https://api.github.com/users/chris-b1/events{/privacy}",
      "received_events_url": "https://api.github.com/users/chris-b1/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2017-07-06T17:41:38Z",
    "updated_at": "2017-07-06T17:41:38Z",
    "author_association": "CONTRIBUTOR",
    "body": "Thanks for the detailed example, seems very closed related to #3513 (possibly a duplicate)"
  },
  {
    "url": "https://api.github.com/repos/pandas-dev/pandas/issues/comments/313471160",
    "html_url": "https://github.com/pandas-dev/pandas/issues/16837#issuecomment-313471160",
    "issue_url": "https://api.github.com/repos/pandas-dev/pandas/issues/16837",
    "id": 313471160,
    "node_id": "MDEyOklzc3VlQ29tbWVudDMxMzQ3MTE2MA==",
    "user": {
      "login": "chris-b1",
      "id": 1924092,
      "node_id": "MDQ6VXNlcjE5MjQwOTI=",
      "avatar_url": "https://avatars1.githubusercontent.com/u/1924092?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/chris-b1",
      "html_url": "https://github.com/chris-b1",
      "followers_url": "https://api.github.com/users/chris-b1/followers",
      "following_url": "https://api.github.com/users/chris-b1/following{/other_user}",
      "gists_url": "https://api.github.com/users/chris-b1/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/chris-b1/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/chris-b1/subscriptions",
      "organizations_url": "https://api.github.com/users/chris-b1/orgs",
      "repos_url": "https://api.github.com/users/chris-b1/repos",
      "events_url": "https://api.github.com/users/chris-b1/events{/privacy}",
      "received_events_url": "https://api.github.com/users/chris-b1/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2017-07-06T17:53:34Z",
    "updated_at": "2017-07-06T17:53:34Z",
    "author_association": "CONTRIBUTOR",
    "body": "FWIW, `R` seems to take a similar approach\r\n```python\r\nnp.random.seed(42)\r\n<...>\r\nIn [58]: M\r\nOut[58]: \r\narray([[        nan, -0.1382643 ],\r\n       [ 0.64768854,         nan],\r\n       [-0.23415337, -0.23413696],\r\n       [ 1.57921282,  0.76743473],\r\n       [-0.46947439,  0.54256004],\r\n       [-0.46341769, -0.46572975],\r\n       [ 0.24196227, -1.91328024],\r\n       [-1.72491783, -0.56228753],\r\n       [-1.01283112,  0.31424733],\r\n       [-0.90802408, -1.4123037 ]])\r\n\r\n\r\nIn [59]: cov_pd\r\nOut[59]: 0.22724929787316234\r\n\r\n```\r\n\r\nR\r\n```R\r\na = c(NA,  0.64768854, -0.23415337,  1.57921282, -0.46947439, \r\n      -0.46341769,  0.24196227, -1.72491783, -1.01283112, -0.90802408)\r\nb = c(-0.1382643 ,   NA, -0.23413696,  0.76743473,  0.54256004,  -0.46572975,\r\n      -1.91328024, -0.56228753,  0.31424733, -1.4123037 )\r\ncov(a, b, use='pairwise')\r\n\r\n# [1] 0.2272493\r\n```\r\n\r\nhttps://stats.stackexchange.com/q/110719"
  },
  {
    "url": "https://api.github.com/repos/pandas-dev/pandas/issues/comments/313544046",
    "html_url": "https://github.com/pandas-dev/pandas/issues/16837#issuecomment-313544046",
    "issue_url": "https://api.github.com/repos/pandas-dev/pandas/issues/16837",
    "id": 313544046,
    "node_id": "MDEyOklzc3VlQ29tbWVudDMxMzU0NDA0Ng==",
    "user": {
      "login": "jreback",
      "id": 953992,
      "node_id": "MDQ6VXNlcjk1Mzk5Mg==",
      "avatar_url": "https://avatars2.githubusercontent.com/u/953992?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/jreback",
      "html_url": "https://github.com/jreback",
      "followers_url": "https://api.github.com/users/jreback/followers",
      "following_url": "https://api.github.com/users/jreback/following{/other_user}",
      "gists_url": "https://api.github.com/users/jreback/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/jreback/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/jreback/subscriptions",
      "organizations_url": "https://api.github.com/users/jreback/orgs",
      "repos_url": "https://api.github.com/users/jreback/repos",
      "events_url": "https://api.github.com/users/jreback/events{/privacy}",
      "received_events_url": "https://api.github.com/users/jreback/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2017-07-06T23:12:32Z",
    "updated_at": "2017-07-06T23:12:32Z",
    "author_association": "CONTRIBUTOR",
    "body": "since this has a concrete example, will close #3513 "
  },
  {
    "url": "https://api.github.com/repos/pandas-dev/pandas/issues/comments/313731514",
    "html_url": "https://github.com/pandas-dev/pandas/issues/16837#issuecomment-313731514",
    "issue_url": "https://api.github.com/repos/pandas-dev/pandas/issues/16837",
    "id": 313731514,
    "node_id": "MDEyOklzc3VlQ29tbWVudDMxMzczMTUxNA==",
    "user": {
      "login": "masdeseiscaracteres",
      "id": 1186798,
      "node_id": "MDQ6VXNlcjExODY3OTg=",
      "avatar_url": "https://avatars1.githubusercontent.com/u/1186798?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/masdeseiscaracteres",
      "html_url": "https://github.com/masdeseiscaracteres",
      "followers_url": "https://api.github.com/users/masdeseiscaracteres/followers",
      "following_url": "https://api.github.com/users/masdeseiscaracteres/following{/other_user}",
      "gists_url": "https://api.github.com/users/masdeseiscaracteres/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/masdeseiscaracteres/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/masdeseiscaracteres/subscriptions",
      "organizations_url": "https://api.github.com/users/masdeseiscaracteres/orgs",
      "repos_url": "https://api.github.com/users/masdeseiscaracteres/repos",
      "events_url": "https://api.github.com/users/masdeseiscaracteres/events{/privacy}",
      "received_events_url": "https://api.github.com/users/masdeseiscaracteres/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2017-07-07T16:36:02Z",
    "updated_at": "2017-07-07T16:55:49Z",
    "author_association": "NONE",
    "body": "I think there are two different (but closely related) issues in here:\r\n\r\n1. The one referred to by #3513. That is, the functions in both pandas and numpy use the so-called \"pairwise deletion\" strategy which could lead to non positive semi-definite covariance matrices. An even simpler example than the above demonstrates the problem:\r\n\r\n```\r\nimport pandas as pd\r\nA = pd.DataFrame([[1, 2],[None, 4],[5, None],[7, 8]])\r\ncov_pd = A.cov()\r\n\r\n           0          1\r\n0   9.333333  18.000000\r\n1  18.000000   9.333333\r\n```\r\nNote that `cov_pd` is not positive semi-definite:\r\n\r\n```\r\nimport numpy as np\r\nnp.linalg.eigvals(cov_pd)\r\n    array([ 27.33333333,  -8.66666667])\r\n```\r\n\r\nFor this very same example Numpy does this:\r\n\r\n```\r\nmasked_A = np.ma.MaskedArray(A.values, np.isnan(A))\r\ncov_np = np.ma.cov(masked_A, rowvar=0).data\r\n    array([[  9.33333333,  17.77777778],\r\n           [ 17.77777778,   9.33333333]])\r\n```\r\nwhich, again, is not positive semi-definite:\r\n```\r\nnp.linalg.eigvals(cov_np)\r\n    array([ 27.11111111,  -8.44444444])\r\n```\r\n\r\nBTW, Matlab function [cov](https://es.mathworks.com/help/matlab/ref/cov.html) handles three cases via the `nanflag` argument:\r\n\r\n- `nanflag = 'includenan'` \r\n- `nanflag = 'omitrows'`\r\n- `nanflag = 'partialrows'`\r\n\r\nand does, by far, the best job documenting the difference. Calculation matches Pandas':\r\n```\r\nnanflag = 'partialrows'\r\ncov_m = cov(A, 0, nanflag)\r\n    cov_m =\r\n\r\n        9.3333   18.0000\r\n       18.0000    9.3333\r\n```\r\n\r\n2. Another different story is the one in which numpy and others (Pandas, R, Matlab) differ, and that is the number of elements they use to estimate the mean of each column. This raises concerns about estimation error and biased estimations (we have seen above that it loses the positive semi-definiteness property as well).\r\n\r\nIt is not clear to me, at this moment, which implementation is more reasonable since Numpy's may be more precise."
  },
  {
    "url": "https://api.github.com/repos/pandas-dev/pandas/issues/comments/313740167",
    "html_url": "https://github.com/pandas-dev/pandas/issues/16837#issuecomment-313740167",
    "issue_url": "https://api.github.com/repos/pandas-dev/pandas/issues/16837",
    "id": 313740167,
    "node_id": "MDEyOklzc3VlQ29tbWVudDMxMzc0MDE2Nw==",
    "user": {
      "login": "chris-b1",
      "id": 1924092,
      "node_id": "MDQ6VXNlcjE5MjQwOTI=",
      "avatar_url": "https://avatars1.githubusercontent.com/u/1924092?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/chris-b1",
      "html_url": "https://github.com/chris-b1",
      "followers_url": "https://api.github.com/users/chris-b1/followers",
      "following_url": "https://api.github.com/users/chris-b1/following{/other_user}",
      "gists_url": "https://api.github.com/users/chris-b1/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/chris-b1/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/chris-b1/subscriptions",
      "organizations_url": "https://api.github.com/users/chris-b1/orgs",
      "repos_url": "https://api.github.com/users/chris-b1/repos",
      "events_url": "https://api.github.com/users/chris-b1/events{/privacy}",
      "received_events_url": "https://api.github.com/users/chris-b1/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2017-07-07T17:11:12Z",
    "updated_at": "2017-07-07T17:11:12Z",
    "author_association": "CONTRIBUTOR",
    "body": "Thanks - not something I'm deeply knowledgeable about, but at minimum would definitely take some expanded docs warning that `cov` in the presence of missing data should be interpreted carefully."
  }
]
