[
  {
    "url": "https://api.github.com/repos/pandas-dev/pandas/issues/comments/10900947",
    "html_url": "https://github.com/pandas-dev/pandas/issues/2397#issuecomment-10900947",
    "issue_url": "https://api.github.com/repos/pandas-dev/pandas/issues/2397",
    "id": 10900947,
    "node_id": "MDEyOklzc3VlQ29tbWVudDEwOTAwOTQ3",
    "user": {
      "login": "jreback",
      "id": 953992,
      "node_id": "MDQ6VXNlcjk1Mzk5Mg==",
      "avatar_url": "https://avatars2.githubusercontent.com/u/953992?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/jreback",
      "html_url": "https://github.com/jreback",
      "followers_url": "https://api.github.com/users/jreback/followers",
      "following_url": "https://api.github.com/users/jreback/following{/other_user}",
      "gists_url": "https://api.github.com/users/jreback/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/jreback/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/jreback/subscriptions",
      "organizations_url": "https://api.github.com/users/jreback/orgs",
      "repos_url": "https://api.github.com/users/jreback/repos",
      "events_url": "https://api.github.com/users/jreback/events{/privacy}",
      "received_events_url": "https://api.github.com/users/jreback/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2012-11-30T19:32:20Z",
    "updated_at": "2012-11-30T19:36:07Z",
    "author_association": "CONTRIBUTOR",
    "body": "The underlying storage mechanism, PyTables is inherently not threadsafe for WRITES. HDFStore opens the store file with mode 'a' (append), by default, so this is trying to open 2 writers. Try opening in read mode.\n\n```\nstore = pd.HDFStore('my_hdf_file.h5', mode = 'r')\n```\n\nI will add a note to the docs....as this is also a problem in multi-processing (concurrent reads ok, but writing and reading at the same time is a problem)\n\nhttp://pl.digipedia.org/usenet/thread/16072/93/\n"
  },
  {
    "url": "https://api.github.com/repos/pandas-dev/pandas/issues/comments/10901062",
    "html_url": "https://github.com/pandas-dev/pandas/issues/2397#issuecomment-10901062",
    "issue_url": "https://api.github.com/repos/pandas-dev/pandas/issues/2397",
    "id": 10901062,
    "node_id": "MDEyOklzc3VlQ29tbWVudDEwOTAxMDYy",
    "user": {
      "login": "pag",
      "id": 20008,
      "node_id": "MDQ6VXNlcjIwMDA4",
      "avatar_url": "https://avatars1.githubusercontent.com/u/20008?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/pag",
      "html_url": "https://github.com/pag",
      "followers_url": "https://api.github.com/users/pag/followers",
      "following_url": "https://api.github.com/users/pag/following{/other_user}",
      "gists_url": "https://api.github.com/users/pag/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/pag/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/pag/subscriptions",
      "organizations_url": "https://api.github.com/users/pag/orgs",
      "repos_url": "https://api.github.com/users/pag/repos",
      "events_url": "https://api.github.com/users/pag/events{/privacy}",
      "received_events_url": "https://api.github.com/users/pag/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2012-11-30T19:39:12Z",
    "updated_at": "2012-11-30T19:39:12Z",
    "author_association": "NONE",
    "body": "Sorry, my original example was a reader. The crash still happens with mode='r'.\n"
  },
  {
    "url": "https://api.github.com/repos/pandas-dev/pandas/issues/comments/10901677",
    "html_url": "https://github.com/pandas-dev/pandas/issues/2397#issuecomment-10901677",
    "issue_url": "https://api.github.com/repos/pandas-dev/pandas/issues/2397",
    "id": 10901677,
    "node_id": "MDEyOklzc3VlQ29tbWVudDEwOTAxNjc3",
    "user": {
      "login": "jreback",
      "id": 953992,
      "node_id": "MDQ6VXNlcjk1Mzk5Mg==",
      "avatar_url": "https://avatars2.githubusercontent.com/u/953992?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/jreback",
      "html_url": "https://github.com/jreback",
      "followers_url": "https://api.github.com/users/jreback/followers",
      "following_url": "https://api.github.com/users/jreback/following{/other_user}",
      "gists_url": "https://api.github.com/users/jreback/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/jreback/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/jreback/subscriptions",
      "organizations_url": "https://api.github.com/users/jreback/orgs",
      "repos_url": "https://api.github.com/users/jreback/repos",
      "events_url": "https://api.github.com/users/jreback/events{/privacy}",
      "received_events_url": "https://api.github.com/users/jreback/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2012-11-30T19:55:24Z",
    "updated_at": "2012-11-30T20:06:13Z",
    "author_association": "CONTRIBUTOR",
    "body": "I tried your example (after I created the h5 file), and with mode = 'r'\n\n```\nException in thread Thread-1:\nTraceback (most recent call last):\n  File \"/usr/local/lib/python2.7/threading.py\", line 551, in __bootstrap_inner\n    self.run()\n  File \"/usr/local/lib/python2.7/threading.py\", line 504, in run\n    self.__target(*self.__args, **self.__kwargs)\n  File \"/code/arb/test/pytables-threading.py\", line 8, in foo\n    store.close()\n  File \"/usr/local/lib/python2.7/site-packages/pandas-0.9.1-py2.7-linux-x86_64.egg/pandas/io/pytables.py\", line 263, in close\n    self.handle.close()\n  File \"/usr/local/lib/python2.7/site-packages/tables/file.py\", line 2162, in close\n    del _open_files[filename]\nKeyError: 'my_hdf_file.h5'\n```\n\nso in the PyTables layer it is trying to close a file which it thinks is open already. this is a bug in PyTables, see this thread. I guess its not thread-safe even for reads\n\nhttps://github.com/PyTables/PyTables/issues/130\n\nusing with doesn't help either\n\n```\nfrom pandas.io.pytables import get_store\ndef foo():\n    with get_store('my_hdf_file.h5', mode = 'r') as store:\n        store['foo']\n        store.close()\n```\n\nI would just say avoid opening/using the file in multi-threads. I have found no issues using read only in multiple processes however.\n"
  },
  {
    "url": "https://api.github.com/repos/pandas-dev/pandas/issues/comments/10911243",
    "html_url": "https://github.com/pandas-dev/pandas/issues/2397#issuecomment-10911243",
    "issue_url": "https://api.github.com/repos/pandas-dev/pandas/issues/2397",
    "id": 10911243,
    "node_id": "MDEyOklzc3VlQ29tbWVudDEwOTExMjQz",
    "user": {
      "login": "jreback",
      "id": 953992,
      "node_id": "MDQ6VXNlcjk1Mzk5Mg==",
      "avatar_url": "https://avatars2.githubusercontent.com/u/953992?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/jreback",
      "html_url": "https://github.com/jreback",
      "followers_url": "https://api.github.com/users/jreback/followers",
      "following_url": "https://api.github.com/users/jreback/following{/other_user}",
      "gists_url": "https://api.github.com/users/jreback/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/jreback/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/jreback/subscriptions",
      "organizations_url": "https://api.github.com/users/jreback/orgs",
      "repos_url": "https://api.github.com/users/jreback/repos",
      "events_url": "https://api.github.com/users/jreback/events{/privacy}",
      "received_events_url": "https://api.github.com/users/jreback/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2012-12-01T01:34:02Z",
    "updated_at": "2012-12-01T01:34:02Z",
    "author_association": "CONTRIBUTOR",
    "body": "the following example works correctly. I think if you open and close in the main thread, then you can concurrently read w/o a problem in other threads.(still avoid read/writing in more than 1 thread however)\n\n```\nimport threading\nimport pandas as pd\nimport time\n\nclass Thread(threading.Thread):\n\n    def __init__(self, store):\n        threading.Thread.__init__(self)\n        self.store = store\n\n    def run(self):\n        print self.store['foo']\n\ndef main():\n    store = pd.HDFStore('my_hdf_file.h5')        \n    t1 = Thread(store = store)\n    t2 = Thread(store = store)\n    t1.start()\n    t2.start()\n    time.sleep(2)\n    t1.join()\n    t2.join()\n    store.close()\n\nif __name__ == '__main__':\n    store = pd.HDFStore('my_hdf_file.h5')\n    store['foo'] = pd.Series(range(10))\n    store.close()\n    main()\n```\n"
  },
  {
    "url": "https://api.github.com/repos/pandas-dev/pandas/issues/comments/11094390",
    "html_url": "https://github.com/pandas-dev/pandas/issues/2397#issuecomment-11094390",
    "issue_url": "https://api.github.com/repos/pandas-dev/pandas/issues/2397",
    "id": 11094390,
    "node_id": "MDEyOklzc3VlQ29tbWVudDExMDk0Mzkw",
    "user": {
      "login": "jreback",
      "id": 953992,
      "node_id": "MDQ6VXNlcjk1Mzk5Mg==",
      "avatar_url": "https://avatars2.githubusercontent.com/u/953992?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/jreback",
      "html_url": "https://github.com/jreback",
      "followers_url": "https://api.github.com/users/jreback/followers",
      "following_url": "https://api.github.com/users/jreback/following{/other_user}",
      "gists_url": "https://api.github.com/users/jreback/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/jreback/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/jreback/subscriptions",
      "organizations_url": "https://api.github.com/users/jreback/orgs",
      "repos_url": "https://api.github.com/users/jreback/repos",
      "events_url": "https://api.github.com/users/jreback/events{/privacy}",
      "received_events_url": "https://api.github.com/users/jreback/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2012-12-06T17:11:30Z",
    "updated_at": "2012-12-06T17:11:30Z",
    "author_association": "CONTRIBUTOR",
    "body": "see also http://sourceforge.net/mailarchive/message.php?msg_id=30190886\n"
  },
  {
    "url": "https://api.github.com/repos/pandas-dev/pandas/issues/comments/11105751",
    "html_url": "https://github.com/pandas-dev/pandas/issues/2397#issuecomment-11105751",
    "issue_url": "https://api.github.com/repos/pandas-dev/pandas/issues/2397",
    "id": 11105751,
    "node_id": "MDEyOklzc3VlQ29tbWVudDExMTA1NzUx",
    "user": {
      "login": "wesm",
      "id": 329591,
      "node_id": "MDQ6VXNlcjMyOTU5MQ==",
      "avatar_url": "https://avatars2.githubusercontent.com/u/329591?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/wesm",
      "html_url": "https://github.com/wesm",
      "followers_url": "https://api.github.com/users/wesm/followers",
      "following_url": "https://api.github.com/users/wesm/following{/other_user}",
      "gists_url": "https://api.github.com/users/wesm/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/wesm/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/wesm/subscriptions",
      "organizations_url": "https://api.github.com/users/wesm/orgs",
      "repos_url": "https://api.github.com/users/wesm/repos",
      "events_url": "https://api.github.com/users/wesm/events{/privacy}",
      "received_events_url": "https://api.github.com/users/wesm/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2012-12-06T21:36:13Z",
    "updated_at": "2012-12-06T21:36:13Z",
    "author_association": "MEMBER",
    "body": "We could potentially add locks to HDFStore at some point to prevent multiple threads from accessing the file at once\n"
  }
]
