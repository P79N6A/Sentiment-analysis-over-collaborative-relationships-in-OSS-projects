[
  {
    "url": "https://api.github.com/repos/pandas-dev/pandas/issues/comments/347014108",
    "html_url": "https://github.com/pandas-dev/pandas/issues/18504#issuecomment-347014108",
    "issue_url": "https://api.github.com/repos/pandas-dev/pandas/issues/18504",
    "id": 347014108,
    "node_id": "MDEyOklzc3VlQ29tbWVudDM0NzAxNDEwOA==",
    "user": {
      "login": "jreback",
      "id": 953992,
      "node_id": "MDQ6VXNlcjk1Mzk5Mg==",
      "avatar_url": "https://avatars2.githubusercontent.com/u/953992?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/jreback",
      "html_url": "https://github.com/jreback",
      "followers_url": "https://api.github.com/users/jreback/followers",
      "following_url": "https://api.github.com/users/jreback/following{/other_user}",
      "gists_url": "https://api.github.com/users/jreback/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/jreback/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/jreback/subscriptions",
      "organizations_url": "https://api.github.com/users/jreback/orgs",
      "repos_url": "https://api.github.com/users/jreback/repos",
      "events_url": "https://api.github.com/users/jreback/events{/privacy}",
      "received_events_url": "https://api.github.com/users/jreback/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2017-11-26T14:57:55Z",
    "updated_at": "2017-11-26T14:57:55Z",
    "author_association": "CONTRIBUTOR",
    "body": "you need a copy-poastable example"
  },
  {
    "url": "https://api.github.com/repos/pandas-dev/pandas/issues/comments/347026279",
    "html_url": "https://github.com/pandas-dev/pandas/issues/18504#issuecomment-347026279",
    "issue_url": "https://api.github.com/repos/pandas-dev/pandas/issues/18504",
    "id": 347026279,
    "node_id": "MDEyOklzc3VlQ29tbWVudDM0NzAyNjI3OQ==",
    "user": {
      "login": "littlegreenbean33",
      "id": 18648417,
      "node_id": "MDQ6VXNlcjE4NjQ4NDE3",
      "avatar_url": "https://avatars2.githubusercontent.com/u/18648417?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/littlegreenbean33",
      "html_url": "https://github.com/littlegreenbean33",
      "followers_url": "https://api.github.com/users/littlegreenbean33/followers",
      "following_url": "https://api.github.com/users/littlegreenbean33/following{/other_user}",
      "gists_url": "https://api.github.com/users/littlegreenbean33/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/littlegreenbean33/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/littlegreenbean33/subscriptions",
      "organizations_url": "https://api.github.com/users/littlegreenbean33/orgs",
      "repos_url": "https://api.github.com/users/littlegreenbean33/repos",
      "events_url": "https://api.github.com/users/littlegreenbean33/events{/privacy}",
      "received_events_url": "https://api.github.com/users/littlegreenbean33/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2017-11-26T17:54:37Z",
    "updated_at": "2017-11-26T17:54:37Z",
    "author_association": "NONE",
    "body": "I am not very good  at this..... but the below reproduces the behavior I described\r\n\r\n    import pandas as pd\r\n    import numpy as np\r\n\r\n    idx=np.arange(50)\r\n    d1=pd.Series(pd.date_range(\"2017-01-01\",periods=50))\r\n    d2=pd.Series(pd.date_range(\"2017-01-03\",periods=50))\r\n\r\n    data1=np.random.randn(50)\r\n    data2=np.random.randn(50)\r\n    df=pd.DataFrame({\"data1\":data1,\"data2\":data2,\"idx\":idx,\"d1\":d1,\"d2\":d2})\r\n    df.set_index([\"idx\",\"d1\",\"d2\"],inplace=True,drop=False)\r\n    df.head()\r\n    \r\n                                   d1 \t       d2 \t      data1 \t  data2 \tidx\r\n    idx \td1 \t        d2 \t\t\t\t\t\r\n    0 \t2017-01-01 \t2017-01-03 \t2017-01-01 \t2017-01-03 \t-0.044711 \t0.082410 \t0\r\n    1 \t2017-01-02 \t2017-01-04 \t2017-01-02 \t2017-01-04 \t-0.346293 \t-1.922916 \t1\r\n    2 \t2017-01-03 \t2017-01-05 \t2017-01-03 \t2017-01-05 \t1.481638 \t-2.369816 \t2\r\n    3 \t2017-01-04 \t2017-01-06 \t2017-01-04 \t2017-01-06 \t-1.980486 \t0.496076 \t3\r\n    4 \t2017-01-05 \t2017-01-07 \t2017-01-05 \t2017-01-07 \t-0.613333 \t0.442724 \t4\r\n\r\n    print(df.loc[(4,slice(None),\"2017-01-07\")].d2==\"2017-01-07\")\r\n    print(df.loc[(4,slice(None),\"2017-01-07\")].d2==pd.Timestamp(\"2017-01-07\"))\r\n\r\n        idx  d1          d2        \r\n        4    2017-01-05  2017-01-07    True\r\n        Name: d2, dtype: bool\r\n        idx  d1          d2        \r\n        4    2017-01-05  2017-01-07    True\r\n        Name: d2, dtype: bool\r\n    #\r\n    print(df.groupby(level=\"idx\").apply(\r\n        lambda x:x.iloc[-1].d2==\"2017-01-07\").iloc[4])\r\n    # the above is what I see as not as expected why is the comparison unequal ?\r\n\r\n\r\n    print(df.groupby(level=\"idx\").apply(\r\n        lambda x:x.iloc[-1].d2==pd.Timestamp(\"2017-01-07\")).iloc[4])\r\n\r\n        False\r\n        True \r\n\r\nHope this helps.\r\n\r\nCheers.\r\n\r\nJC"
  },
  {
    "url": "https://api.github.com/repos/pandas-dev/pandas/issues/comments/347026922",
    "html_url": "https://github.com/pandas-dev/pandas/issues/18504#issuecomment-347026922",
    "issue_url": "https://api.github.com/repos/pandas-dev/pandas/issues/18504",
    "id": 347026922,
    "node_id": "MDEyOklzc3VlQ29tbWVudDM0NzAyNjkyMg==",
    "user": {
      "login": "jreback",
      "id": 953992,
      "node_id": "MDQ6VXNlcjk1Mzk5Mg==",
      "avatar_url": "https://avatars2.githubusercontent.com/u/953992?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/jreback",
      "html_url": "https://github.com/jreback",
      "followers_url": "https://api.github.com/users/jreback/followers",
      "following_url": "https://api.github.com/users/jreback/following{/other_user}",
      "gists_url": "https://api.github.com/users/jreback/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/jreback/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/jreback/subscriptions",
      "organizations_url": "https://api.github.com/users/jreback/orgs",
      "repos_url": "https://api.github.com/users/jreback/repos",
      "events_url": "https://api.github.com/users/jreback/events{/privacy}",
      "received_events_url": "https://api.github.com/users/jreback/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2017-11-26T18:05:08Z",
    "updated_at": "2017-11-26T18:05:08Z",
    "author_association": "CONTRIBUTOR",
    "body": "Some tips:\r\n\r\n- using named indices the *same* as columns is plain confusing.\r\n- using opaque UDFs (IOW inside the ``.apply`` is non-performant and just hard to manage), so use pandas builtins\r\n\r\ne.g. you prob want\r\n```\r\nIn [34]: df.groupby(level='idx').last().head()\r\nOut[34]: \r\n            d1         d2     data1     data2  idx\r\nidx                                               \r\n0   2017-01-01 2017-01-03 -0.065398  0.554164    0\r\n1   2017-01-02 2017-01-04  0.157238  0.223270    1\r\n2   2017-01-03 2017-01-05  0.471431 -0.332721    2\r\n3   2017-01-04 2017-01-06 -1.258124  0.618444    3\r\n4   2017-01-05 2017-01-07 -0.298601  0.015549    4\r\n\r\n```\r\n\r\nyou are selecting a series rather than a dataframe and that coerces all types to ``object`` when types are mixed (the case here).\r\n```\r\nIn [25]: g = df.groupby(level=\"idx\")\r\n\r\n# get the first group\r\nIn [26]: g.get_group(0)\r\nOut[26]: \r\n                                  d1         d2     data1     data2  idx\r\nidx d1         d2                                                       \r\n0   2017-01-01 2017-01-03 2017-01-01 2017-01-03 -0.065398  0.554164    0\r\n\r\nIn [27]: g.get_group(0).iloc[-1].d2==\"2017-01-07\"\r\nOut[27]: False\r\n\r\n# you are actually selecting a series, so all of the dtypes are pushed to object\r\nIn [28]: g.get_group(0).iloc[-1]\r\nOut[28]: \r\nd1       2017-01-01 00:00:00\r\nd2       2017-01-03 00:00:00\r\ndata1             -0.0653979\r\ndata2               0.554164\r\nidx                        0\r\nName: (0, 2017-01-01 00:00:00, 2017-01-03 00:00:00), dtype: object\r\n\r\n\r\n# you can select as a dataframe like this\r\n# its still false, though because 2017-01-3 != 2017-01-07\r\nIn [30]: g.get_group(0).iloc[[-1]].d2=='2017-01-07'\r\nOut[30]: \r\nidx  d1          d2        \r\n0    2017-01-01  2017-01-03    False\r\nName: d2, dtype: bool\r\n```\r\n"
  },
  {
    "url": "https://api.github.com/repos/pandas-dev/pandas/issues/comments/347034477",
    "html_url": "https://github.com/pandas-dev/pandas/issues/18504#issuecomment-347034477",
    "issue_url": "https://api.github.com/repos/pandas-dev/pandas/issues/18504",
    "id": 347034477,
    "node_id": "MDEyOklzc3VlQ29tbWVudDM0NzAzNDQ3Nw==",
    "user": {
      "login": "littlegreenbean33",
      "id": 18648417,
      "node_id": "MDQ6VXNlcjE4NjQ4NDE3",
      "avatar_url": "https://avatars2.githubusercontent.com/u/18648417?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/littlegreenbean33",
      "html_url": "https://github.com/littlegreenbean33",
      "followers_url": "https://api.github.com/users/littlegreenbean33/followers",
      "following_url": "https://api.github.com/users/littlegreenbean33/following{/other_user}",
      "gists_url": "https://api.github.com/users/littlegreenbean33/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/littlegreenbean33/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/littlegreenbean33/subscriptions",
      "organizations_url": "https://api.github.com/users/littlegreenbean33/orgs",
      "repos_url": "https://api.github.com/users/littlegreenbean33/repos",
      "events_url": "https://api.github.com/users/littlegreenbean33/events{/privacy}",
      "received_events_url": "https://api.github.com/users/littlegreenbean33/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2017-11-26T20:06:46Z",
    "updated_at": "2017-11-26T20:06:46Z",
    "author_association": "NONE",
    "body": "Thanks ! All clear\r\n\r\n"
  }
]
