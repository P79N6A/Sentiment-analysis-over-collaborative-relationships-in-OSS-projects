[
  {
    "url": "https://api.github.com/repos/pandas-dev/pandas/issues/comments/376285084",
    "html_url": "https://github.com/pandas-dev/pandas/issues/20492#issuecomment-376285084",
    "issue_url": "https://api.github.com/repos/pandas-dev/pandas/issues/20492",
    "id": 376285084,
    "node_id": "MDEyOklzc3VlQ29tbWVudDM3NjI4NTA4NA==",
    "user": {
      "login": "chris-b1",
      "id": 1924092,
      "node_id": "MDQ6VXNlcjE5MjQwOTI=",
      "avatar_url": "https://avatars1.githubusercontent.com/u/1924092?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/chris-b1",
      "html_url": "https://github.com/chris-b1",
      "followers_url": "https://api.github.com/users/chris-b1/followers",
      "following_url": "https://api.github.com/users/chris-b1/following{/other_user}",
      "gists_url": "https://api.github.com/users/chris-b1/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/chris-b1/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/chris-b1/subscriptions",
      "organizations_url": "https://api.github.com/users/chris-b1/orgs",
      "repos_url": "https://api.github.com/users/chris-b1/repos",
      "events_url": "https://api.github.com/users/chris-b1/events{/privacy}",
      "received_events_url": "https://api.github.com/users/chris-b1/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2018-03-26T19:34:09Z",
    "updated_at": "2018-03-26T19:34:09Z",
    "author_association": "CONTRIBUTOR",
    "body": "I think `apply` works here?\r\n```\r\nIn [14]: data.groupby('group').myvalue.apply(lambda x: x - x.shift(1, pd.Timedelta('1 days')))\r\nOut[14]: \r\ngroup  mydate    \r\nA      2016-06-06    NaN\r\n       2016-06-07    NaN\r\n       2016-06-08    NaN\r\n       2016-06-09    1.0\r\n       2016-06-10    NaN\r\nB      2016-06-10    NaN\r\n       2016-06-11    NaN\r\n       2016-06-12    NaN\r\n       2016-06-13    1.0\r\n       2016-06-14    NaN\r\nName: myvalue, dtype: float64\r\n```\r\n\r\n"
  },
  {
    "url": "https://api.github.com/repos/pandas-dev/pandas/issues/comments/376290520",
    "html_url": "https://github.com/pandas-dev/pandas/issues/20492#issuecomment-376290520",
    "issue_url": "https://api.github.com/repos/pandas-dev/pandas/issues/20492",
    "id": 376290520,
    "node_id": "MDEyOklzc3VlQ29tbWVudDM3NjI5MDUyMA==",
    "user": {
      "login": "randomgambit",
      "id": 8282510,
      "node_id": "MDQ6VXNlcjgyODI1MTA=",
      "avatar_url": "https://avatars0.githubusercontent.com/u/8282510?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/randomgambit",
      "html_url": "https://github.com/randomgambit",
      "followers_url": "https://api.github.com/users/randomgambit/followers",
      "following_url": "https://api.github.com/users/randomgambit/following{/other_user}",
      "gists_url": "https://api.github.com/users/randomgambit/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/randomgambit/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/randomgambit/subscriptions",
      "organizations_url": "https://api.github.com/users/randomgambit/orgs",
      "repos_url": "https://api.github.com/users/randomgambit/repos",
      "events_url": "https://api.github.com/users/randomgambit/events{/privacy}",
      "received_events_url": "https://api.github.com/users/randomgambit/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2018-03-26T19:52:53Z",
    "updated_at": "2018-03-26T19:52:53Z",
    "author_association": "NONE",
    "body": "@chris-b1 thanks yes, I saw that but you cannot directly assign this data to the dataframe\r\n\r\n```\r\ndata['delta_two'] = data.groupby('group').myvalue.apply(lambda x: x - x.shift(1, pd.Timedelta('1 days')))\r\n\r\n  File \"C:\\Users\\john\\AppData\\Local\\Continuum\\anaconda3\\lib\\site-packages\\pandas\\core\\frame.py\", line 2734, in reindexer\r\n    raise TypeError('incompatible index of inserted column '\r\n\r\nTypeError: incompatible index of inserted column with frame index\r\n```\r\n"
  },
  {
    "url": "https://api.github.com/repos/pandas-dev/pandas/issues/comments/376343447",
    "html_url": "https://github.com/pandas-dev/pandas/issues/20492#issuecomment-376343447",
    "issue_url": "https://api.github.com/repos/pandas-dev/pandas/issues/20492",
    "id": 376343447,
    "node_id": "MDEyOklzc3VlQ29tbWVudDM3NjM0MzQ0Nw==",
    "user": {
      "login": "mroeschke",
      "id": 10647082,
      "node_id": "MDQ6VXNlcjEwNjQ3MDgy",
      "avatar_url": "https://avatars0.githubusercontent.com/u/10647082?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/mroeschke",
      "html_url": "https://github.com/mroeschke",
      "followers_url": "https://api.github.com/users/mroeschke/followers",
      "following_url": "https://api.github.com/users/mroeschke/following{/other_user}",
      "gists_url": "https://api.github.com/users/mroeschke/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/mroeschke/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/mroeschke/subscriptions",
      "organizations_url": "https://api.github.com/users/mroeschke/orgs",
      "repos_url": "https://api.github.com/users/mroeschke/repos",
      "events_url": "https://api.github.com/users/mroeschke/events{/privacy}",
      "received_events_url": "https://api.github.com/users/mroeschke/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2018-03-26T23:21:23Z",
    "updated_at": "2018-03-26T23:21:23Z",
    "author_association": "MEMBER",
    "body": "You can do some reshaping and remerge the result of the `groupby.apply` to your original `data`\r\n\r\n```\r\nIn [5]: res = data.groupby('group').myvalue.apply(lambda x: x - x.shift(1, pd.Timedelta('1 days')))\r\n\r\nIn [6]: res.name = 'delta_one'\r\n\r\nIn [7]: data.reset_index().merge(res.reset_index(), how='left', on=['mydate', 'group']).set_index('mydate')\r\nOut[7]:\r\n           group  myvalue  delta_one\r\nmydate\r\n2016-06-06     A        1        NaN\r\n2016-06-08     A        2        NaN\r\n2016-06-09     A        3        1.0\r\n2016-06-10     B        4        NaN\r\n2016-06-12     B        5        NaN\r\n2016-06-13     B        6        1.0\r\n```"
  },
  {
    "url": "https://api.github.com/repos/pandas-dev/pandas/issues/comments/376369770",
    "html_url": "https://github.com/pandas-dev/pandas/issues/20492#issuecomment-376369770",
    "issue_url": "https://api.github.com/repos/pandas-dev/pandas/issues/20492",
    "id": 376369770,
    "node_id": "MDEyOklzc3VlQ29tbWVudDM3NjM2OTc3MA==",
    "user": {
      "login": "randomgambit",
      "id": 8282510,
      "node_id": "MDQ6VXNlcjgyODI1MTA=",
      "avatar_url": "https://avatars0.githubusercontent.com/u/8282510?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/randomgambit",
      "html_url": "https://github.com/randomgambit",
      "followers_url": "https://api.github.com/users/randomgambit/followers",
      "following_url": "https://api.github.com/users/randomgambit/following{/other_user}",
      "gists_url": "https://api.github.com/users/randomgambit/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/randomgambit/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/randomgambit/subscriptions",
      "organizations_url": "https://api.github.com/users/randomgambit/orgs",
      "repos_url": "https://api.github.com/users/randomgambit/repos",
      "events_url": "https://api.github.com/users/randomgambit/events{/privacy}",
      "received_events_url": "https://api.github.com/users/randomgambit/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2018-03-27T01:55:16Z",
    "updated_at": "2018-03-27T01:55:16Z",
    "author_association": "NONE",
    "body": "@mroeschke thanks buddy, yes I ended up doing something very much like that :) I wonder if this behavior is expected or not"
  },
  {
    "url": "https://api.github.com/repos/pandas-dev/pandas/issues/comments/376371550",
    "html_url": "https://github.com/pandas-dev/pandas/issues/20492#issuecomment-376371550",
    "issue_url": "https://api.github.com/repos/pandas-dev/pandas/issues/20492",
    "id": 376371550,
    "node_id": "MDEyOklzc3VlQ29tbWVudDM3NjM3MTU1MA==",
    "user": {
      "login": "WillAyd",
      "id": 609873,
      "node_id": "MDQ6VXNlcjYwOTg3Mw==",
      "avatar_url": "https://avatars0.githubusercontent.com/u/609873?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/WillAyd",
      "html_url": "https://github.com/WillAyd",
      "followers_url": "https://api.github.com/users/WillAyd/followers",
      "following_url": "https://api.github.com/users/WillAyd/following{/other_user}",
      "gists_url": "https://api.github.com/users/WillAyd/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/WillAyd/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/WillAyd/subscriptions",
      "organizations_url": "https://api.github.com/users/WillAyd/orgs",
      "repos_url": "https://api.github.com/users/WillAyd/repos",
      "events_url": "https://api.github.com/users/WillAyd/events{/privacy}",
      "received_events_url": "https://api.github.com/users/WillAyd/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2018-03-27T02:05:20Z",
    "updated_at": "2018-03-27T02:05:20Z",
    "author_association": "MEMBER",
    "body": "My $.02 is that if you wanted dates to be sequential by day then you should be reindexing and filling the group before any groupby. So something along the lines of:\r\n\r\n```python\r\n>>> dt_rng = pd.date_range(data.index.min(), data.index.max())\r\n>>> data = data.reindex(rng)\r\n>>> data['group'] = data['group'].ffill()\r\n>>> data.groupby('group')['myvalue'].transform(lambda x: x-x.shift())\r\n2016-06-06    NaN\r\n2016-06-07    NaN\r\n2016-06-08    NaN\r\n2016-06-09    1.0\r\n2016-06-10    NaN\r\n2016-06-11    NaN\r\n2016-06-12    NaN\r\n2016-06-13    1.0\r\nFreq: D, Name: myvalue, dtype: float64\r\n```\r\n\r\nProbably a little more verbose than you want to be and gives a different result than what you have, but seems the most \"pandonic\" to me"
  },
  {
    "url": "https://api.github.com/repos/pandas-dev/pandas/issues/comments/376471763",
    "html_url": "https://github.com/pandas-dev/pandas/issues/20492#issuecomment-376471763",
    "issue_url": "https://api.github.com/repos/pandas-dev/pandas/issues/20492",
    "id": 376471763,
    "node_id": "MDEyOklzc3VlQ29tbWVudDM3NjQ3MTc2Mw==",
    "user": {
      "login": "jreback",
      "id": 953992,
      "node_id": "MDQ6VXNlcjk1Mzk5Mg==",
      "avatar_url": "https://avatars2.githubusercontent.com/u/953992?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/jreback",
      "html_url": "https://github.com/jreback",
      "followers_url": "https://api.github.com/users/jreback/followers",
      "following_url": "https://api.github.com/users/jreback/following{/other_user}",
      "gists_url": "https://api.github.com/users/jreback/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/jreback/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/jreback/subscriptions",
      "organizations_url": "https://api.github.com/users/jreback/orgs",
      "repos_url": "https://api.github.com/users/jreback/repos",
      "events_url": "https://api.github.com/users/jreback/events{/privacy}",
      "received_events_url": "https://api.github.com/users/jreback/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2018-03-27T10:12:55Z",
    "updated_at": "2018-03-27T10:13:11Z",
    "author_association": "CONTRIBUTOR",
    "body": "lots of good answers here. ``.shift()`` does care whether an index is complete or not, just that it is ordered. You must resample / reindex-fill yourself. \r\n\r\nI suppose adding this example to the doc-string (or maybe in the docs might be easier) could be informative. Going to repurpose this issue for that enhancement."
  },
  {
    "url": "https://api.github.com/repos/pandas-dev/pandas/issues/comments/376481613",
    "html_url": "https://github.com/pandas-dev/pandas/issues/20492#issuecomment-376481613",
    "issue_url": "https://api.github.com/repos/pandas-dev/pandas/issues/20492",
    "id": 376481613,
    "node_id": "MDEyOklzc3VlQ29tbWVudDM3NjQ4MTYxMw==",
    "user": {
      "login": "randomgambit",
      "id": 8282510,
      "node_id": "MDQ6VXNlcjgyODI1MTA=",
      "avatar_url": "https://avatars0.githubusercontent.com/u/8282510?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/randomgambit",
      "html_url": "https://github.com/randomgambit",
      "followers_url": "https://api.github.com/users/randomgambit/followers",
      "following_url": "https://api.github.com/users/randomgambit/following{/other_user}",
      "gists_url": "https://api.github.com/users/randomgambit/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/randomgambit/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/randomgambit/subscriptions",
      "organizations_url": "https://api.github.com/users/randomgambit/orgs",
      "repos_url": "https://api.github.com/users/randomgambit/repos",
      "events_url": "https://api.github.com/users/randomgambit/events{/privacy}",
      "received_events_url": "https://api.github.com/users/randomgambit/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2018-03-27T10:50:54Z",
    "updated_at": "2018-03-27T10:50:54Z",
    "author_association": "NONE",
    "body": "Hi @jeffreback thanks! \r\n\r\nbut what do you mean by shift does not care whether and index is ordered or not? Using timedelta works with shift if I am not mistaken.\r\n\r\nessentially, I ended up writing a function that is very similar to what @chris-b1 is doing. I hope all is good"
  },
  {
    "url": "https://api.github.com/repos/pandas-dev/pandas/issues/comments/377608680",
    "html_url": "https://github.com/pandas-dev/pandas/issues/20492#issuecomment-377608680",
    "issue_url": "https://api.github.com/repos/pandas-dev/pandas/issues/20492",
    "id": 377608680,
    "node_id": "MDEyOklzc3VlQ29tbWVudDM3NzYwODY4MA==",
    "user": {
      "login": "jreback",
      "id": 953992,
      "node_id": "MDQ6VXNlcjk1Mzk5Mg==",
      "avatar_url": "https://avatars2.githubusercontent.com/u/953992?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/jreback",
      "html_url": "https://github.com/jreback",
      "followers_url": "https://api.github.com/users/jreback/followers",
      "following_url": "https://api.github.com/users/jreback/following{/other_user}",
      "gists_url": "https://api.github.com/users/jreback/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/jreback/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/jreback/subscriptions",
      "organizations_url": "https://api.github.com/users/jreback/orgs",
      "repos_url": "https://api.github.com/users/jreback/repos",
      "events_url": "https://api.github.com/users/jreback/events{/privacy}",
      "received_events_url": "https://api.github.com/users/jreback/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2018-03-30T19:56:52Z",
    "updated_at": "2018-03-30T19:56:52Z",
    "author_association": "CONTRIBUTOR",
    "body": "@randomgambit \r\n\r\nI said \r\n> does care whether an index is complete or not, just that it is ordered. You must resample / reindex-fill yourself.\r\n\r\nit doesn't care whether its complete, just ordered."
  },
  {
    "url": "https://api.github.com/repos/pandas-dev/pandas/issues/comments/388919182",
    "html_url": "https://github.com/pandas-dev/pandas/issues/20492#issuecomment-388919182",
    "issue_url": "https://api.github.com/repos/pandas-dev/pandas/issues/20492",
    "id": 388919182,
    "node_id": "MDEyOklzc3VlQ29tbWVudDM4ODkxOTE4Mg==",
    "user": {
      "login": "PyJay",
      "id": 8122854,
      "node_id": "MDQ6VXNlcjgxMjI4NTQ=",
      "avatar_url": "https://avatars3.githubusercontent.com/u/8122854?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/PyJay",
      "html_url": "https://github.com/PyJay",
      "followers_url": "https://api.github.com/users/PyJay/followers",
      "following_url": "https://api.github.com/users/PyJay/following{/other_user}",
      "gists_url": "https://api.github.com/users/PyJay/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/PyJay/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/PyJay/subscriptions",
      "organizations_url": "https://api.github.com/users/PyJay/orgs",
      "repos_url": "https://api.github.com/users/PyJay/repos",
      "events_url": "https://api.github.com/users/PyJay/events{/privacy}",
      "received_events_url": "https://api.github.com/users/PyJay/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2018-05-14T18:36:48Z",
    "updated_at": "2018-05-14T18:36:48Z",
    "author_association": "NONE",
    "body": "I will add this example to the documentation"
  },
  {
    "url": "https://api.github.com/repos/pandas-dev/pandas/issues/comments/388970884",
    "html_url": "https://github.com/pandas-dev/pandas/issues/20492#issuecomment-388970884",
    "issue_url": "https://api.github.com/repos/pandas-dev/pandas/issues/20492",
    "id": 388970884,
    "node_id": "MDEyOklzc3VlQ29tbWVudDM4ODk3MDg4NA==",
    "user": {
      "login": "PyJay",
      "id": 8122854,
      "node_id": "MDQ6VXNlcjgxMjI4NTQ=",
      "avatar_url": "https://avatars3.githubusercontent.com/u/8122854?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/PyJay",
      "html_url": "https://github.com/PyJay",
      "followers_url": "https://api.github.com/users/PyJay/followers",
      "following_url": "https://api.github.com/users/PyJay/following{/other_user}",
      "gists_url": "https://api.github.com/users/PyJay/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/PyJay/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/PyJay/subscriptions",
      "organizations_url": "https://api.github.com/users/PyJay/orgs",
      "repos_url": "https://api.github.com/users/PyJay/repos",
      "events_url": "https://api.github.com/users/PyJay/events{/privacy}",
      "received_events_url": "https://api.github.com/users/PyJay/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2018-05-14T21:36:07Z",
    "updated_at": "2018-05-14T21:36:07Z",
    "author_association": "NONE",
    "body": "PR here - https://github.com/pandas-dev/pandas/pull/21039\r\n\r\n"
  },
  {
    "url": "https://api.github.com/repos/pandas-dev/pandas/issues/comments/428946996",
    "html_url": "https://github.com/pandas-dev/pandas/issues/20492#issuecomment-428946996",
    "issue_url": "https://api.github.com/repos/pandas-dev/pandas/issues/20492",
    "id": 428946996,
    "node_id": "MDEyOklzc3VlQ29tbWVudDQyODk0Njk5Ng==",
    "user": {
      "login": "randomgambit",
      "id": 8282510,
      "node_id": "MDQ6VXNlcjgyODI1MTA=",
      "avatar_url": "https://avatars0.githubusercontent.com/u/8282510?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/randomgambit",
      "html_url": "https://github.com/randomgambit",
      "followers_url": "https://api.github.com/users/randomgambit/followers",
      "following_url": "https://api.github.com/users/randomgambit/following{/other_user}",
      "gists_url": "https://api.github.com/users/randomgambit/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/randomgambit/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/randomgambit/subscriptions",
      "organizations_url": "https://api.github.com/users/randomgambit/orgs",
      "repos_url": "https://api.github.com/users/randomgambit/repos",
      "events_url": "https://api.github.com/users/randomgambit/events{/privacy}",
      "received_events_url": "https://api.github.com/users/randomgambit/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2018-10-11T13:04:05Z",
    "updated_at": "2018-10-11T13:04:21Z",
    "author_association": "NONE",
    "body": "Hello guys, as the original OP I would be happy to contribute here!\r\n\r\nFrom what I see above, you want to get rid of the pd.Timedelta shift? But that is the essence of the question! and the solution proposed by @mroeschke in #20492 works like a charm!\r\n\r\nHere is a variant\r\n\r\n```\r\ndf = pd.DataFrame({'mytime' : [pd.to_datetime('2018-01-01 14:34:12'),\r\n                             pd.to_datetime('2018-01-01 14:34:13'),\r\n                             pd.to_datetime('2018-01-01 14:34:15'),\r\n                             pd.to_datetime('2018-01-01 14:34:16'),\r\n                             pd.to_datetime('2018-01-01 14:34:28')],\r\n                    'myvalue' : [1,2,np.NaN,3,1],\r\n                    'mygroup' : ['a','a','a','b','b']})\r\n\r\ndf.set_index('mytime', inplace = True)\r\n\r\nshifted_df =  df.groupby('mygroup').myvalue.apply(lambda x: x - x.shift(1, pd.Timedelta('1 sec')))\r\nshifted_df.name = 'shifted'\r\ndf = df.reset_index().merge(shifted_df.reset_index(), on = ['mytime','mygroup'], how = 'left')\r\n \r\ndf\r\nOut[108]: \r\n               mytime mygroup  myvalue  shifted\r\n0 2018-01-01 14:34:12       a  1.00000      nan\r\n1 2018-01-01 14:34:13       a  2.00000  1.00000\r\n2 2018-01-01 14:34:15       a      nan      nan\r\n3 2018-01-01 14:34:16       b  3.00000      nan\r\n4 2018-01-01 14:34:28       b  1.00000      nan\r\n\r\n\r\n```\r\nWhy dont you just use that in the docs? Pretty nice IMHO"
  }
]
