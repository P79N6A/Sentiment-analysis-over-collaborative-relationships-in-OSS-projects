[
  {
    "url": "https://api.github.com/repos/pandas-dev/pandas/issues/comments/74156070",
    "html_url": "https://github.com/pandas-dev/pandas/issues/9478#issuecomment-74156070",
    "issue_url": "https://api.github.com/repos/pandas-dev/pandas/issues/9478",
    "id": 74156070,
    "node_id": "MDEyOklzc3VlQ29tbWVudDc0MTU2MDcw",
    "user": {
      "login": "jreback",
      "id": 953992,
      "node_id": "MDQ6VXNlcjk1Mzk5Mg==",
      "avatar_url": "https://avatars2.githubusercontent.com/u/953992?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/jreback",
      "html_url": "https://github.com/jreback",
      "followers_url": "https://api.github.com/users/jreback/followers",
      "following_url": "https://api.github.com/users/jreback/following{/other_user}",
      "gists_url": "https://api.github.com/users/jreback/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/jreback/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/jreback/subscriptions",
      "organizations_url": "https://api.github.com/users/jreback/orgs",
      "repos_url": "https://api.github.com/users/jreback/repos",
      "events_url": "https://api.github.com/users/jreback/events{/privacy}",
      "received_events_url": "https://api.github.com/users/jreback/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2015-02-12T21:26:25Z",
    "updated_at": "2015-02-12T21:26:25Z",
    "author_association": "CONTRIBUTOR",
    "body": "This is kind of tricky. You are assigning possibly a single value (or maybe a list, depends on what A is). with a list-like, IOW, and index (regardless of the value of A, it may have 0 or more elements).\nIf its a list on the rhs, then it will try to broadcast it, that's why you get values in every column.\n\nSo I would say this is not really safe to do\n\n```\nIn [57]: df = pd.DataFrame(np.random.randn(rows,2), columns=list('AB'), index=pd.date_range('1/1/2000', periods=rows, freq='1H'))\n\nIn [58]: df\nOut[58]: \n                            A         B\n2000-01-01 00:00:00  0.117055  0.554529\n2000-01-01 01:00:00 -1.587738 -0.913139\n2000-01-01 02:00:00  1.439404 -0.521966\n\nIn [59]: df.loc[df.A>0.5].index[0]\nOut[59]: Timestamp('2000-01-01 02:00:00', offset='H')\n\nIn [60]: df.loc[df.A>0.5,'new'] = (df.loc[df.A>0.5].index)[0]\n\nIn [61]: df\nOut[61]: \n                            A         B                 new\n2000-01-01 00:00:00  0.117055  0.554529                 NaT\n2000-01-01 01:00:00 -1.587738 -0.913139                 NaT\n2000-01-01 02:00:00  1.439404 -0.521966 2000-01-01 02:00:00\n```\n\nHere is a better/safe way to do this.\n\n```\nIn [91]: df['new'] = df.index.to_series().where(df.A>0.5)\n\nIn [92]: df\nOut[92]: \n                            A         B        new\n2000-01-01 00:00:00  0.559047 -0.366489 2000-01-01\n2000-01-01 01:00:00  0.249399 -0.780957        NaT\n2000-01-01 02:00:00 -1.244441  1.364961        NaT\n```\n"
  },
  {
    "url": "https://api.github.com/repos/pandas-dev/pandas/issues/comments/74157104",
    "html_url": "https://github.com/pandas-dev/pandas/issues/9478#issuecomment-74157104",
    "issue_url": "https://api.github.com/repos/pandas-dev/pandas/issues/9478",
    "id": 74157104,
    "node_id": "MDEyOklzc3VlQ29tbWVudDc0MTU3MTA0",
    "user": {
      "login": "alan-wong",
      "id": 2933165,
      "node_id": "MDQ6VXNlcjI5MzMxNjU=",
      "avatar_url": "https://avatars3.githubusercontent.com/u/2933165?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/alan-wong",
      "html_url": "https://github.com/alan-wong",
      "followers_url": "https://api.github.com/users/alan-wong/followers",
      "following_url": "https://api.github.com/users/alan-wong/following{/other_user}",
      "gists_url": "https://api.github.com/users/alan-wong/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/alan-wong/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/alan-wong/subscriptions",
      "organizations_url": "https://api.github.com/users/alan-wong/orgs",
      "repos_url": "https://api.github.com/users/alan-wong/repos",
      "events_url": "https://api.github.com/users/alan-wong/events{/privacy}",
      "received_events_url": "https://api.github.com/users/alan-wong/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2015-02-12T21:31:42Z",
    "updated_at": "2015-02-12T21:31:42Z",
    "author_association": "NONE",
    "body": "OK but is there a reason why the datetimeindex behaves differently to when it's just an ordinary column of datetime64 dtype? For instance after df creation you then did `df.reset_index(inplace=True)\ntemp = df.loc[df.A > 0.5,'index']\ndf.loc[df.A > 0.5, 'LAST_TIME_A_ABOVE_X'] = temp` then this works as expected\n"
  },
  {
    "url": "https://api.github.com/repos/pandas-dev/pandas/issues/comments/74159263",
    "html_url": "https://github.com/pandas-dev/pandas/issues/9478#issuecomment-74159263",
    "issue_url": "https://api.github.com/repos/pandas-dev/pandas/issues/9478",
    "id": 74159263,
    "node_id": "MDEyOklzc3VlQ29tbWVudDc0MTU5MjYz",
    "user": {
      "login": "jreback",
      "id": 953992,
      "node_id": "MDQ6VXNlcjk1Mzk5Mg==",
      "avatar_url": "https://avatars2.githubusercontent.com/u/953992?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/jreback",
      "html_url": "https://github.com/jreback",
      "followers_url": "https://api.github.com/users/jreback/followers",
      "following_url": "https://api.github.com/users/jreback/following{/other_user}",
      "gists_url": "https://api.github.com/users/jreback/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/jreback/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/jreback/subscriptions",
      "organizations_url": "https://api.github.com/users/jreback/orgs",
      "repos_url": "https://api.github.com/users/jreback/repos",
      "events_url": "https://api.github.com/users/jreback/events{/privacy}",
      "received_events_url": "https://api.github.com/users/jreback/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2015-02-12T21:43:51Z",
    "updated_at": "2015-02-12T21:43:51Z",
    "author_association": "CONTRIBUTOR",
    "body": "@alan-wong what you are posting is not the same thing. you are assigning with an aligned series. this makes all the difference. The purpose of the index is to _align_ things. When you use `df.loc[df.A>0.5].index` you get a `DatetimeIndex`, which is not aligned to anything, its just like a list of values. \n\n```\nIn [131]: mask=df.A>0.5\n\nIn [132]: mask\nOut[132]: \n2000-01-01 00:00:00     True\n2000-01-01 01:00:00    False\n2000-01-01 02:00:00    False\nFreq: H, Name: A, dtype: bool\n\nIn [133]: df.loc[mask,'new'] = df.loc[mask].index.tolist()\n\nIn [134]: df\nOut[134]: \n                            A         B        new\n2000-01-01 00:00:00  1.321158 -1.546906 2000-01-01\n2000-01-01 01:00:00 -0.202646 -0.655969        NaT\n2000-01-01 02:00:00  0.193421  0.553439        NaT\n```\n\nI'll mark this as a bug, it seems the index (on the rhs) is not being treated as list-like, and instead maybe its trying to align.\n"
  },
  {
    "url": "https://api.github.com/repos/pandas-dev/pandas/issues/comments/74160171",
    "html_url": "https://github.com/pandas-dev/pandas/issues/9478#issuecomment-74160171",
    "issue_url": "https://api.github.com/repos/pandas-dev/pandas/issues/9478",
    "id": 74160171,
    "node_id": "MDEyOklzc3VlQ29tbWVudDc0MTYwMTcx",
    "user": {
      "login": "alan-wong",
      "id": 2933165,
      "node_id": "MDQ6VXNlcjI5MzMxNjU=",
      "avatar_url": "https://avatars3.githubusercontent.com/u/2933165?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/alan-wong",
      "html_url": "https://github.com/alan-wong",
      "followers_url": "https://api.github.com/users/alan-wong/followers",
      "following_url": "https://api.github.com/users/alan-wong/following{/other_user}",
      "gists_url": "https://api.github.com/users/alan-wong/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/alan-wong/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/alan-wong/subscriptions",
      "organizations_url": "https://api.github.com/users/alan-wong/orgs",
      "repos_url": "https://api.github.com/users/alan-wong/repos",
      "events_url": "https://api.github.com/users/alan-wong/events{/privacy}",
      "received_events_url": "https://api.github.com/users/alan-wong/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2015-02-12T21:48:42Z",
    "updated_at": "2015-02-12T21:48:42Z",
    "author_association": "NONE",
    "body": "OK I see the semantic difference but just to point out that you don't observe this behaviour if the index is int64 : `rows=3 df = pd.DataFrame(np.random.randn(rows,2), columns=list('AB'), index=np.arange(rows))\ndf.loc[df.A > 0.5, 'LAST_TIME_A_ABOVE_X'] = df.loc[df.A > 0.5].index` works as expected which is why I think this is something specific with datetimeindex\n"
  },
  {
    "url": "https://api.github.com/repos/pandas-dev/pandas/issues/comments/74320422",
    "html_url": "https://github.com/pandas-dev/pandas/issues/9478#issuecomment-74320422",
    "issue_url": "https://api.github.com/repos/pandas-dev/pandas/issues/9478",
    "id": 74320422,
    "node_id": "MDEyOklzc3VlQ29tbWVudDc0MzIwNDIy",
    "user": {
      "login": "jreback",
      "id": 953992,
      "node_id": "MDQ6VXNlcjk1Mzk5Mg==",
      "avatar_url": "https://avatars2.githubusercontent.com/u/953992?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/jreback",
      "html_url": "https://github.com/jreback",
      "followers_url": "https://api.github.com/users/jreback/followers",
      "following_url": "https://api.github.com/users/jreback/following{/other_user}",
      "gists_url": "https://api.github.com/users/jreback/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/jreback/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/jreback/subscriptions",
      "organizations_url": "https://api.github.com/users/jreback/orgs",
      "repos_url": "https://api.github.com/users/jreback/repos",
      "events_url": "https://api.github.com/users/jreback/events{/privacy}",
      "received_events_url": "https://api.github.com/users/jreback/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2015-02-13T20:22:39Z",
    "updated_at": "2015-02-13T20:22:39Z",
    "author_association": "CONTRIBUTOR",
    "body": "@alan-wong ok, fixed up in master.\n"
  },
  {
    "url": "https://api.github.com/repos/pandas-dev/pandas/issues/comments/74326229",
    "html_url": "https://github.com/pandas-dev/pandas/issues/9478#issuecomment-74326229",
    "issue_url": "https://api.github.com/repos/pandas-dev/pandas/issues/9478",
    "id": 74326229,
    "node_id": "MDEyOklzc3VlQ29tbWVudDc0MzI2MjI5",
    "user": {
      "login": "alan-wong",
      "id": 2933165,
      "node_id": "MDQ6VXNlcjI5MzMxNjU=",
      "avatar_url": "https://avatars3.githubusercontent.com/u/2933165?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/alan-wong",
      "html_url": "https://github.com/alan-wong",
      "followers_url": "https://api.github.com/users/alan-wong/followers",
      "following_url": "https://api.github.com/users/alan-wong/following{/other_user}",
      "gists_url": "https://api.github.com/users/alan-wong/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/alan-wong/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/alan-wong/subscriptions",
      "organizations_url": "https://api.github.com/users/alan-wong/orgs",
      "repos_url": "https://api.github.com/users/alan-wong/repos",
      "events_url": "https://api.github.com/users/alan-wong/events{/privacy}",
      "received_events_url": "https://api.github.com/users/alan-wong/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2015-02-13T21:02:07Z",
    "updated_at": "2015-02-13T21:02:07Z",
    "author_association": "NONE",
    "body": "Cheers Jeff, sterling work as always\n"
  }
]
