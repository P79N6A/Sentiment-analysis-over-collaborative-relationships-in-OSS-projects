[
  {
    "url": "https://api.github.com/repos/pandas-dev/pandas/issues/comments/399198068",
    "html_url": "https://github.com/pandas-dev/pandas/issues/21577#issuecomment-399198068",
    "issue_url": "https://api.github.com/repos/pandas-dev/pandas/issues/21577",
    "id": 399198068,
    "node_id": "MDEyOklzc3VlQ29tbWVudDM5OTE5ODA2OA==",
    "user": {
      "login": "WillAyd",
      "id": 609873,
      "node_id": "MDQ6VXNlcjYwOTg3Mw==",
      "avatar_url": "https://avatars0.githubusercontent.com/u/609873?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/WillAyd",
      "html_url": "https://github.com/WillAyd",
      "followers_url": "https://api.github.com/users/WillAyd/followers",
      "following_url": "https://api.github.com/users/WillAyd/following{/other_user}",
      "gists_url": "https://api.github.com/users/WillAyd/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/WillAyd/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/WillAyd/subscriptions",
      "organizations_url": "https://api.github.com/users/WillAyd/orgs",
      "repos_url": "https://api.github.com/users/WillAyd/repos",
      "events_url": "https://api.github.com/users/WillAyd/events{/privacy}",
      "received_events_url": "https://api.github.com/users/WillAyd/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2018-06-21T18:21:36Z",
    "updated_at": "2018-06-21T18:21:36Z",
    "author_association": "MEMBER",
    "body": "Not sure I'd consider this a bug - why wouldn't you either close the file you are writing before re-opening in a different mode or alternately just keeping a reference to the same handle across all of the writing operations?"
  },
  {
    "url": "https://api.github.com/repos/pandas-dev/pandas/issues/comments/399235164",
    "html_url": "https://github.com/pandas-dev/pandas/issues/21577#issuecomment-399235164",
    "issue_url": "https://api.github.com/repos/pandas-dev/pandas/issues/21577",
    "id": 399235164,
    "node_id": "MDEyOklzc3VlQ29tbWVudDM5OTIzNTE2NA==",
    "user": {
      "login": "jeremymatt",
      "id": 32210294,
      "node_id": "MDQ6VXNlcjMyMjEwMjk0",
      "avatar_url": "https://avatars2.githubusercontent.com/u/32210294?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/jeremymatt",
      "html_url": "https://github.com/jeremymatt",
      "followers_url": "https://api.github.com/users/jeremymatt/followers",
      "following_url": "https://api.github.com/users/jeremymatt/following{/other_user}",
      "gists_url": "https://api.github.com/users/jeremymatt/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/jeremymatt/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/jeremymatt/subscriptions",
      "organizations_url": "https://api.github.com/users/jeremymatt/orgs",
      "repos_url": "https://api.github.com/users/jeremymatt/repos",
      "events_url": "https://api.github.com/users/jeremymatt/events{/privacy}",
      "received_events_url": "https://api.github.com/users/jeremymatt/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2018-06-21T20:36:57Z",
    "updated_at": "2018-06-21T20:36:57Z",
    "author_association": "NONE",
    "body": "I'm not sure why I'd want to close&re-open the file before I'm done writing to it - I'd like to write the metadata and the data block in one shot and then close the file and move on to writing the data for the next station.  Closing and then re-opening is just two extra lines of code that I don't think I should have to include.\r\n\r\nRegardless, the bug (from my point of view) is that to_csv() is ignoring the actual headers in the dataframe and instead is treating the first row of data as the header.  I'd be VERY surprised if this is the intended operation.  But, I'm a newbie, so I could be wrong :)"
  },
  {
    "url": "https://api.github.com/repos/pandas-dev/pandas/issues/comments/399239107",
    "html_url": "https://github.com/pandas-dev/pandas/issues/21577#issuecomment-399239107",
    "issue_url": "https://api.github.com/repos/pandas-dev/pandas/issues/21577",
    "id": 399239107,
    "node_id": "MDEyOklzc3VlQ29tbWVudDM5OTIzOTEwNw==",
    "user": {
      "login": "WillAyd",
      "id": 609873,
      "node_id": "MDQ6VXNlcjYwOTg3Mw==",
      "avatar_url": "https://avatars0.githubusercontent.com/u/609873?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/WillAyd",
      "html_url": "https://github.com/WillAyd",
      "followers_url": "https://api.github.com/users/WillAyd/followers",
      "following_url": "https://api.github.com/users/WillAyd/following{/other_user}",
      "gists_url": "https://api.github.com/users/WillAyd/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/WillAyd/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/WillAyd/subscriptions",
      "organizations_url": "https://api.github.com/users/WillAyd/orgs",
      "repos_url": "https://api.github.com/users/WillAyd/repos",
      "events_url": "https://api.github.com/users/WillAyd/events{/privacy}",
      "received_events_url": "https://api.github.com/users/WillAyd/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2018-06-21T20:49:53Z",
    "updated_at": "2018-06-21T20:49:53Z",
    "author_association": "MEMBER",
    "body": "I think it is strange to open your file multiple times especially in different modes, which is why I suggested one option to keep writing to the same file handle.\r\n\r\nIf you remove pandas from the equation altogether and just write arbitrary content does your code behave the way you expect? The fact that you are getting different behavior on different platforms makes me believe this has more to do with the OS' underlying IO operations w.r.t Python and not so much with pandas"
  },
  {
    "url": "https://api.github.com/repos/pandas-dev/pandas/issues/comments/399255016",
    "html_url": "https://github.com/pandas-dev/pandas/issues/21577#issuecomment-399255016",
    "issue_url": "https://api.github.com/repos/pandas-dev/pandas/issues/21577",
    "id": 399255016,
    "node_id": "MDEyOklzc3VlQ29tbWVudDM5OTI1NTAxNg==",
    "user": {
      "login": "jeremymatt",
      "id": 32210294,
      "node_id": "MDQ6VXNlcjMyMjEwMjk0",
      "avatar_url": "https://avatars2.githubusercontent.com/u/32210294?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/jeremymatt",
      "html_url": "https://github.com/jeremymatt",
      "followers_url": "https://api.github.com/users/jeremymatt/followers",
      "following_url": "https://api.github.com/users/jeremymatt/following{/other_user}",
      "gists_url": "https://api.github.com/users/jeremymatt/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/jeremymatt/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/jeremymatt/subscriptions",
      "organizations_url": "https://api.github.com/users/jeremymatt/orgs",
      "repos_url": "https://api.github.com/users/jeremymatt/repos",
      "events_url": "https://api.github.com/users/jeremymatt/events{/privacy}",
      "received_events_url": "https://api.github.com/users/jeremymatt/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2018-06-21T21:51:37Z",
    "updated_at": "2018-06-21T21:51:37Z",
    "author_association": "NONE",
    "body": "Will:\r\nThanks for getting back to me.  I apologize if I don't have the vocabulary to answer your questions well - as I said I'm a newbie to python and am not a computer science person.  I've also edited the main post to more clearly describe what I see as the problem and to provide additional information.  \r\n\r\nRegarding the OS dependency, I may have been wrong about that.  On my windows 10 machine, older versions *do not* have this problem, but the updated set of packages *does* have this problem.  Specifically, when tried it on my Windows 10 machine with pandas v0.22.0 and the problem *did not* appear.  I then updated everything (using conda update --all).  pandas was updated to v.0.23.1 and the problem *did* appear.  When I get a chance, I'll update all on my Mint VM and will let you know what I find. \r\n\r\nRegarding opening and closing, I think it's odd as well.  I just want to open the file once, do all of the write operations, and then close the file.  However, I have to close and then re-open to get the pandas output to work.  When I re-open the file I have to use the append mode to avoid over-writing the header information.  \r\n\r\nBy file handle I assume that the *file* in *file = open(filename,'w')* is the handle, correct?  If so, then I am using the same handle for all write operations (or am trying to anyway).\r\n\r\nRegarding removing pandas from the equation, I'm not sure how I'd go about that honestly.  My data are all stored in dataframes and I would like to keep it in dataframes so I can take advantage of the wide variety of pandas tools.  \r\n\r\nAs for arbitrary writes, the write operations to make the first three lines of the output file work as expected, its just when I get to outputting the dataframe that I have problems.  I suppose I could concatenate each row of the dataframe into a csv text string and then use a for loop to export each line individually to the file - is this what you had in mind?  If so, I suspect that it would work fine because the *file.write(string)* operations worked just fine."
  },
  {
    "url": "https://api.github.com/repos/pandas-dev/pandas/issues/comments/399691788",
    "html_url": "https://github.com/pandas-dev/pandas/issues/21577#issuecomment-399691788",
    "issue_url": "https://api.github.com/repos/pandas-dev/pandas/issues/21577",
    "id": 399691788,
    "node_id": "MDEyOklzc3VlQ29tbWVudDM5OTY5MTc4OA==",
    "user": {
      "login": "chris-b1",
      "id": 1924092,
      "node_id": "MDQ6VXNlcjE5MjQwOTI=",
      "avatar_url": "https://avatars1.githubusercontent.com/u/1924092?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/chris-b1",
      "html_url": "https://github.com/chris-b1",
      "followers_url": "https://api.github.com/users/chris-b1/followers",
      "following_url": "https://api.github.com/users/chris-b1/following{/other_user}",
      "gists_url": "https://api.github.com/users/chris-b1/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/chris-b1/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/chris-b1/subscriptions",
      "organizations_url": "https://api.github.com/users/chris-b1/orgs",
      "repos_url": "https://api.github.com/users/chris-b1/repos",
      "events_url": "https://api.github.com/users/chris-b1/events{/privacy}",
      "received_events_url": "https://api.github.com/users/chris-b1/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2018-06-23T16:40:22Z",
    "updated_at": "2018-06-23T16:40:22Z",
    "author_association": "CONTRIBUTOR",
    "body": "It is strange that this changed between pandas versions - indicates we might be something off with the file handle in `to_csv` - in any case, adding a flush to your file fixes the issue, maybe something we should doing?\r\n\r\n```python\r\nfilename = 'sample_output1.txt'\r\nfile = open(filename,'w')\r\nfile.write('StationName:station1'+chr(10))\r\nfile.write('version:3'+chr(10))\r\nfile.write('height:10'+chr(10)+chr(10))\r\nfile.flush()\r\n\r\ndf.to_csv(file,mode='a',header=True,index=True,index_label='index')\r\nfile = open(filename,'r')\r\nprint(file.read())\r\nfile.close()\r\n# `stdout`\r\n# StationName:station1\r\n# version:3\r\n# height:10\r\n#\r\n#\r\n# index,timestamp,temp,wind\r\n# 0,2018-01-01 00:00:00,20.1,10\r\n# 1,2018-01-01 00:03:00,20.2,20\r\n# 2,2018-01-01 00:06:00,20.3,30\r\n```"
  },
  {
    "url": "https://api.github.com/repos/pandas-dev/pandas/issues/comments/399725646",
    "html_url": "https://github.com/pandas-dev/pandas/issues/21577#issuecomment-399725646",
    "issue_url": "https://api.github.com/repos/pandas-dev/pandas/issues/21577",
    "id": 399725646,
    "node_id": "MDEyOklzc3VlQ29tbWVudDM5OTcyNTY0Ng==",
    "user": {
      "login": "WillAyd",
      "id": 609873,
      "node_id": "MDQ6VXNlcjYwOTg3Mw==",
      "avatar_url": "https://avatars0.githubusercontent.com/u/609873?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/WillAyd",
      "html_url": "https://github.com/WillAyd",
      "followers_url": "https://api.github.com/users/WillAyd/followers",
      "following_url": "https://api.github.com/users/WillAyd/following{/other_user}",
      "gists_url": "https://api.github.com/users/WillAyd/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/WillAyd/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/WillAyd/subscriptions",
      "organizations_url": "https://api.github.com/users/WillAyd/orgs",
      "repos_url": "https://api.github.com/users/WillAyd/repos",
      "events_url": "https://api.github.com/users/WillAyd/events{/privacy}",
      "received_events_url": "https://api.github.com/users/WillAyd/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2018-06-24T03:19:21Z",
    "updated_at": "2018-06-24T03:19:21Z",
    "author_association": "MEMBER",
    "body": "Easiest would still be to again do this all with one file handle:\r\n\r\n```python\r\nIn [6]: with open('sample_output1.txt', 'w') as outfile:\r\n   ...:     outfile.write('StationName:station1'+chr(10))\r\n   ...:     outfile.write('version:3'+chr(10))\r\n   ...:     outfile.write('height:10'+chr(10)+chr(10))\r\n   ...:     df.to_csv(outfile,header=True,index=True,index_label='index')\r\n```\r\n\r\nI don't have a platform setup like yours to test but I'd still question if this really is a pandas issue at all or again just goes back to opening multiple file handles in different modes without properly closing any files. "
  },
  {
    "url": "https://api.github.com/repos/pandas-dev/pandas/issues/comments/399780984",
    "html_url": "https://github.com/pandas-dev/pandas/issues/21577#issuecomment-399780984",
    "issue_url": "https://api.github.com/repos/pandas-dev/pandas/issues/21577",
    "id": 399780984,
    "node_id": "MDEyOklzc3VlQ29tbWVudDM5OTc4MDk4NA==",
    "user": {
      "login": "jeremymatt",
      "id": 32210294,
      "node_id": "MDQ6VXNlcjMyMjEwMjk0",
      "avatar_url": "https://avatars2.githubusercontent.com/u/32210294?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/jeremymatt",
      "html_url": "https://github.com/jeremymatt",
      "followers_url": "https://api.github.com/users/jeremymatt/followers",
      "following_url": "https://api.github.com/users/jeremymatt/following{/other_user}",
      "gists_url": "https://api.github.com/users/jeremymatt/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/jeremymatt/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/jeremymatt/subscriptions",
      "organizations_url": "https://api.github.com/users/jeremymatt/orgs",
      "repos_url": "https://api.github.com/users/jeremymatt/repos",
      "events_url": "https://api.github.com/users/jeremymatt/events{/privacy}",
      "received_events_url": "https://api.github.com/users/jeremymatt/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2018-06-24T19:25:46Z",
    "updated_at": "2018-06-24T19:25:46Z",
    "author_association": "NONE",
    "body": "Will:\r\nWoops, good point - I forgot file.close() after df.to_csv().  It doesn't change the operation though - the header values are still ignored by to_csv()\r\n\r\nI also tried removing *mode='a'* from the the to_csv() call and it made no difference - I still get the incorrect operation.  The mode statement in the to_csv() call doesn't seem to have any effect on the output.  It seems as if the mode of the file object takes precedence over the to_csv() write mode.  I'd guess that this is intended operation\r\n\r\nRegarding your with statement, I couldn't get it to work.  I got an error *AttributeError: '_io.TextIOWrapper' object has no attribute 'open'* and I'm not sure how to modify the with statement to get it to run.\r\n\r\nI'm also not entirely clear on what you mean by \"opening multiple file handles in different modes\".  The following code only has one open statement and the problem can be seen if you open the file in a text editor.  I don't see how it's functionally any different from the intent of yours - yours intends to make a file object (outfile) and then use it to perform four write functions.  The only reason I re-open the file with the 'r' mode is so I can read it and print the result.\r\n\r\n```python\r\nfile = open(filename,'w')\r\nfile.write('StationName:station1'+chr(10))\r\nfile.write('version:3'+chr(10))\r\nfile.write('height:10'+chr(10)+chr(10))\r\ndf.to_csv(file,header=True,index=True,index_label='index')\r\n```\r\n\r\nThanks,\r\n-J"
  },
  {
    "url": "https://api.github.com/repos/pandas-dev/pandas/issues/comments/399781057",
    "html_url": "https://github.com/pandas-dev/pandas/issues/21577#issuecomment-399781057",
    "issue_url": "https://api.github.com/repos/pandas-dev/pandas/issues/21577",
    "id": 399781057,
    "node_id": "MDEyOklzc3VlQ29tbWVudDM5OTc4MTA1Nw==",
    "user": {
      "login": "jeremymatt",
      "id": 32210294,
      "node_id": "MDQ6VXNlcjMyMjEwMjk0",
      "avatar_url": "https://avatars2.githubusercontent.com/u/32210294?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/jeremymatt",
      "html_url": "https://github.com/jeremymatt",
      "followers_url": "https://api.github.com/users/jeremymatt/followers",
      "following_url": "https://api.github.com/users/jeremymatt/following{/other_user}",
      "gists_url": "https://api.github.com/users/jeremymatt/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/jeremymatt/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/jeremymatt/subscriptions",
      "organizations_url": "https://api.github.com/users/jeremymatt/orgs",
      "repos_url": "https://api.github.com/users/jeremymatt/repos",
      "events_url": "https://api.github.com/users/jeremymatt/events{/privacy}",
      "received_events_url": "https://api.github.com/users/jeremymatt/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2018-06-24T19:26:52Z",
    "updated_at": "2018-06-24T19:26:52Z",
    "author_association": "NONE",
    "body": "Chris:\r\nThanks for the flush() suggestion - that worked and is a bit more elegant than close/open."
  },
  {
    "url": "https://api.github.com/repos/pandas-dev/pandas/issues/comments/401598383",
    "html_url": "https://github.com/pandas-dev/pandas/issues/21577#issuecomment-401598383",
    "issue_url": "https://api.github.com/repos/pandas-dev/pandas/issues/21577",
    "id": 401598383,
    "node_id": "MDEyOklzc3VlQ29tbWVudDQwMTU5ODM4Mw==",
    "user": {
      "login": "jdrudolph",
      "id": 2606663,
      "node_id": "MDQ6VXNlcjI2MDY2NjM=",
      "avatar_url": "https://avatars1.githubusercontent.com/u/2606663?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/jdrudolph",
      "html_url": "https://github.com/jdrudolph",
      "followers_url": "https://api.github.com/users/jdrudolph/followers",
      "following_url": "https://api.github.com/users/jdrudolph/following{/other_user}",
      "gists_url": "https://api.github.com/users/jdrudolph/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/jdrudolph/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/jdrudolph/subscriptions",
      "organizations_url": "https://api.github.com/users/jdrudolph/orgs",
      "repos_url": "https://api.github.com/users/jdrudolph/repos",
      "events_url": "https://api.github.com/users/jdrudolph/events{/privacy}",
      "received_events_url": "https://api.github.com/users/jdrudolph/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2018-07-01T10:38:10Z",
    "updated_at": "2018-07-01T10:38:10Z",
    "author_association": "CONTRIBUTOR",
    "body": "I think I was running into a related issue with writing to an already opened file.\r\nEverything works in `0.23.0`, is broken in `0.23.1` and works again in `master`.\r\n\r\nI made a pull request with a unit test to prevent a future regression."
  },
  {
    "url": "https://api.github.com/repos/pandas-dev/pandas/issues/comments/464169582",
    "html_url": "https://github.com/pandas-dev/pandas/issues/21577#issuecomment-464169582",
    "issue_url": "https://api.github.com/repos/pandas-dev/pandas/issues/21577",
    "id": 464169582,
    "node_id": "MDEyOklzc3VlQ29tbWVudDQ2NDE2OTU4Mg==",
    "user": {
      "login": "brettbrocato",
      "id": 45630928,
      "node_id": "MDQ6VXNlcjQ1NjMwOTI4",
      "avatar_url": "https://avatars2.githubusercontent.com/u/45630928?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/brettbrocato",
      "html_url": "https://github.com/brettbrocato",
      "followers_url": "https://api.github.com/users/brettbrocato/followers",
      "following_url": "https://api.github.com/users/brettbrocato/following{/other_user}",
      "gists_url": "https://api.github.com/users/brettbrocato/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/brettbrocato/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/brettbrocato/subscriptions",
      "organizations_url": "https://api.github.com/users/brettbrocato/orgs",
      "repos_url": "https://api.github.com/users/brettbrocato/repos",
      "events_url": "https://api.github.com/users/brettbrocato/events{/privacy}",
      "received_events_url": "https://api.github.com/users/brettbrocato/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2019-02-15T19:25:49Z",
    "updated_at": "2019-02-15T19:36:53Z",
    "author_association": "NONE",
    "body": "For me in Win10, WinPython 3.6, Pandas 0.23.4 the file.flush() is necessary and works like a charm.  I'll try to remember to come back and offer non-proprietary sample data.\r\n\r\nscrubbed code:\r\n\r\n> def writepathsfile(pathsdf=pathsdf,writepath=outputpath,writefile=outputfilename):\r\n>     headerlist=['header0','header1','header2']\r\n>     wholepath=writepath + writefile + \".path\"\r\n>     if os.path.exists(wholepath):\r\n>       os.remove(wholepath)\r\n>     else:\r\n>       print(\"writepathsfile: The file does not exist\")\r\n>     with open(wholepath, 'w', newline='',encoding='utf-8') as file: \r\n>         file.writelines(\"%s\\r\\n\" % item for item in headerlist)\r\n>         file.flush() #without this the first row of the df is treated as header\r\n>         pathsdf.loc[:,['col1','col2','col3']].to_csv(\r\n>             wholepath, mode='a', index=False,header=False)\r\n> "
  }
]
