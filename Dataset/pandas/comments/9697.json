[
  {
    "url": "https://api.github.com/repos/pandas-dev/pandas/issues/comments/84493048",
    "html_url": "https://github.com/pandas-dev/pandas/issues/9697#issuecomment-84493048",
    "issue_url": "https://api.github.com/repos/pandas-dev/pandas/issues/9697",
    "id": 84493048,
    "node_id": "MDEyOklzc3VlQ29tbWVudDg0NDkzMDQ4",
    "user": {
      "login": "dsm054",
      "id": 980054,
      "node_id": "MDQ6VXNlcjk4MDA1NA==",
      "avatar_url": "https://avatars2.githubusercontent.com/u/980054?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/dsm054",
      "html_url": "https://github.com/dsm054",
      "followers_url": "https://api.github.com/users/dsm054/followers",
      "following_url": "https://api.github.com/users/dsm054/following{/other_user}",
      "gists_url": "https://api.github.com/users/dsm054/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/dsm054/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/dsm054/subscriptions",
      "organizations_url": "https://api.github.com/users/dsm054/orgs",
      "repos_url": "https://api.github.com/users/dsm054/repos",
      "events_url": "https://api.github.com/users/dsm054/events{/privacy}",
      "received_events_url": "https://api.github.com/users/dsm054/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2015-03-22T02:00:31Z",
    "updated_at": "2015-03-22T02:00:31Z",
    "author_association": "CONTRIBUTOR",
    "body": "Note that \n\n```\n>>> df.groupby(\"col1\")[\"col2\"].transform(lambda x: np.nansum(x))\n0    3\n1    3\n2    3\n3    3\nName: col2, dtype: float64\n```\n\nworks, so the bug must be in the fastpath.\n"
  },
  {
    "url": "https://api.github.com/repos/pandas-dev/pandas/issues/comments/84495232",
    "html_url": "https://github.com/pandas-dev/pandas/issues/9697#issuecomment-84495232",
    "issue_url": "https://api.github.com/repos/pandas-dev/pandas/issues/9697",
    "id": 84495232,
    "node_id": "MDEyOklzc3VlQ29tbWVudDg0NDk1MjMy",
    "user": {
      "login": "dsm054",
      "id": 980054,
      "node_id": "MDQ6VXNlcjk4MDA1NA==",
      "avatar_url": "https://avatars2.githubusercontent.com/u/980054?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/dsm054",
      "html_url": "https://github.com/dsm054",
      "followers_url": "https://api.github.com/users/dsm054/followers",
      "following_url": "https://api.github.com/users/dsm054/following{/other_user}",
      "gists_url": "https://api.github.com/users/dsm054/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/dsm054/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/dsm054/subscriptions",
      "organizations_url": "https://api.github.com/users/dsm054/orgs",
      "repos_url": "https://api.github.com/users/dsm054/repos",
      "events_url": "https://api.github.com/users/dsm054/events{/privacy}",
      "received_events_url": "https://api.github.com/users/dsm054/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2015-03-22T02:22:15Z",
    "updated_at": "2015-03-22T02:24:48Z",
    "author_association": "CONTRIBUTOR",
    "body": "More information: the use of `count` in `_transform_fast` doesn't seem right to me (that'll pick up the number of non-nan values in the grouped series, IIUC, whereas we want the size of the groups.)\n\nWe're also seeing things like\n\n```\n>>> df = pd.DataFrame({\"c1\": [1], \"c2\": [2]})\n>>> df\n   c1  c2\n0   1   2\n>>> df.groupby(\"c1\").transform(sum)\n   c2\n0 NaN\n1   2\n```\n\nwhich makes me think there's definitely been a confusion about the index.\n"
  },
  {
    "url": "https://api.github.com/repos/pandas-dev/pandas/issues/comments/84622356",
    "html_url": "https://github.com/pandas-dev/pandas/issues/9697#issuecomment-84622356",
    "issue_url": "https://api.github.com/repos/pandas-dev/pandas/issues/9697",
    "id": 84622356,
    "node_id": "MDEyOklzc3VlQ29tbWVudDg0NjIyMzU2",
    "user": {
      "login": "jreback",
      "id": 953992,
      "node_id": "MDQ6VXNlcjk1Mzk5Mg==",
      "avatar_url": "https://avatars2.githubusercontent.com/u/953992?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/jreback",
      "html_url": "https://github.com/jreback",
      "followers_url": "https://api.github.com/users/jreback/followers",
      "following_url": "https://api.github.com/users/jreback/following{/other_user}",
      "gists_url": "https://api.github.com/users/jreback/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/jreback/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/jreback/subscriptions",
      "organizations_url": "https://api.github.com/users/jreback/orgs",
      "repos_url": "https://api.github.com/users/jreback/repos",
      "events_url": "https://api.github.com/users/jreback/events{/privacy}",
      "received_events_url": "https://api.github.com/users/jreback/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2015-03-22T14:42:40Z",
    "updated_at": "2015-03-22T14:42:40Z",
    "author_association": "CONTRIBUTOR",
    "body": "yep, this https://github.com/pydata/pandas/blob/master/pandas/core/groupby.py#L2456\nshould be `self.size().values`. Its the group size here that matters.\n"
  },
  {
    "url": "https://api.github.com/repos/pandas-dev/pandas/issues/comments/84630113",
    "html_url": "https://github.com/pandas-dev/pandas/issues/9697#issuecomment-84630113",
    "issue_url": "https://api.github.com/repos/pandas-dev/pandas/issues/9697",
    "id": 84630113,
    "node_id": "MDEyOklzc3VlQ29tbWVudDg0NjMwMTEz",
    "user": {
      "login": "dsm054",
      "id": 980054,
      "node_id": "MDQ6VXNlcjk4MDA1NA==",
      "avatar_url": "https://avatars2.githubusercontent.com/u/980054?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/dsm054",
      "html_url": "https://github.com/dsm054",
      "followers_url": "https://api.github.com/users/dsm054/followers",
      "following_url": "https://api.github.com/users/dsm054/following{/other_user}",
      "gists_url": "https://api.github.com/users/dsm054/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/dsm054/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/dsm054/subscriptions",
      "organizations_url": "https://api.github.com/users/dsm054/orgs",
      "repos_url": "https://api.github.com/users/dsm054/repos",
      "events_url": "https://api.github.com/users/dsm054/events{/privacy}",
      "received_events_url": "https://api.github.com/users/dsm054/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2015-03-22T15:22:12Z",
    "updated_at": "2015-03-22T15:22:12Z",
    "author_association": "CONTRIBUTOR",
    "body": "Switching count -> size seems to fix the original problem.  Doesn't pass the tests I made which revealed the index problem above.  Shall I submit a PR with the count/size switch here and open a new issue for that one?\n"
  },
  {
    "url": "https://api.github.com/repos/pandas-dev/pandas/issues/comments/84646228",
    "html_url": "https://github.com/pandas-dev/pandas/issues/9697#issuecomment-84646228",
    "issue_url": "https://api.github.com/repos/pandas-dev/pandas/issues/9697",
    "id": 84646228,
    "node_id": "MDEyOklzc3VlQ29tbWVudDg0NjQ2MjI4",
    "user": {
      "login": "jreback",
      "id": 953992,
      "node_id": "MDQ6VXNlcjk1Mzk5Mg==",
      "avatar_url": "https://avatars2.githubusercontent.com/u/953992?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/jreback",
      "html_url": "https://github.com/jreback",
      "followers_url": "https://api.github.com/users/jreback/followers",
      "following_url": "https://api.github.com/users/jreback/following{/other_user}",
      "gists_url": "https://api.github.com/users/jreback/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/jreback/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/jreback/subscriptions",
      "organizations_url": "https://api.github.com/users/jreback/orgs",
      "repos_url": "https://api.github.com/users/jreback/repos",
      "events_url": "https://api.github.com/users/jreback/events{/privacy}",
      "received_events_url": "https://api.github.com/users/jreback/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2015-03-22T16:25:02Z",
    "updated_at": "2015-03-22T16:25:02Z",
    "author_association": "CONTRIBUTOR",
    "body": "@dsm054 that would be gr8 thxs\n"
  },
  {
    "url": "https://api.github.com/repos/pandas-dev/pandas/issues/comments/102869774",
    "html_url": "https://github.com/pandas-dev/pandas/issues/9697#issuecomment-102869774",
    "issue_url": "https://api.github.com/repos/pandas-dev/pandas/issues/9697",
    "id": 102869774,
    "node_id": "MDEyOklzc3VlQ29tbWVudDEwMjg2OTc3NA==",
    "user": {
      "login": "dylkot",
      "id": 3519178,
      "node_id": "MDQ6VXNlcjM1MTkxNzg=",
      "avatar_url": "https://avatars3.githubusercontent.com/u/3519178?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/dylkot",
      "html_url": "https://github.com/dylkot",
      "followers_url": "https://api.github.com/users/dylkot/followers",
      "following_url": "https://api.github.com/users/dylkot/following{/other_user}",
      "gists_url": "https://api.github.com/users/dylkot/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/dylkot/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/dylkot/subscriptions",
      "organizations_url": "https://api.github.com/users/dylkot/orgs",
      "repos_url": "https://api.github.com/users/dylkot/repos",
      "events_url": "https://api.github.com/users/dylkot/events{/privacy}",
      "received_events_url": "https://api.github.com/users/dylkot/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2015-05-17T23:19:19Z",
    "updated_at": "2015-05-17T23:19:19Z",
    "author_association": "NONE",
    "body": "I may be having the same problem in Pandas 0.16.1. I describe it here: \n\nhttp://stackoverflow.com/questions/30290482/normalizing-columns-of-multiindex-dataframe-in-pandas-maybe-a-bug\n\nI have a Pandas Dataframe with hierarchically indexed columns. Eg:\n\n```\ncols = pd.MultiIndex.from_tuples([('syn', 'A'), ('mis', 'A'), ('non', 'A'),     ('syn', 'C'), ('mis', 'C'), ('non', 'C'),\n                              ('syn', 'T'), ('mis', 'T'), ('non', 'T'), ('syn', 'G'), ('mis', 'G'), ('non', 'G')])\nsample = pd.DataFrame(np.random.randint(1, 10, (4,12)), columns=cols, index=['A', 'C', 'G', 'T'])\nsample.head()\n```\n\nGiving:\n\n```\n    syn mis non syn mis non syn mis non syn mis non\n    A   A   A   C   C   C   T   T   T   G   G   G\nA   7   3   9   5   4   8   6   4   3   6   4   2\nC   5   2   2   4   9   6   3   3   9   6   2   1\nG   2   4   5   2   8   3   8   3   6   1   2   4\nT   9   4   8   9   8   5   8   8   2   2   6   5\n```\n\nHowever, when I attempt to normalize on level 1 of the columns as follows:\n\n```\nsample.groupby(axis=1, level=1).transform(lambda z: z.div(z.sum(axis=1), axis=0))\n```\n\nI get an error:\n\n```\nValueError: Length mismatch: Expected axis has 4 elements, new values have 12 elements\n```\n\nWeirdly, it works fine if I use up to 3 of the values of level 1 of axis 1, for example:\n\n```\nind = sample.columns.get_level_values(1).isin(['A', 'C', 'G'])\nsubsample = sample.loc[:, ind]\nsubsample.head()\n```\n\nwhich just takes the first 3 sets of values from the sample:\n\n```\n    syn mis non syn mis non syn mis non\n    A   A   A   C   C   C   G   G   G\nA   7   3   9   5   4   8   6   4   2\nC   5   2   2   4   9   6   6   2   1\nG   2   4   5   2   8   3   1   2   4\nT   9   4   8   9   8   5   2   6   5\n```\n\nThen:\n\n```\nsubsample.groupby(axis=1, level=1).transform(lambda z: z.div(z.sum(axis=1), axis=0))\n```\n\ncorrectly returns:\n\n```\n    syn mis non syn mis non syn mis non\n    A       A       A       C       C       C       G       G       G\nA   0.37    0.16    0.47    0.29    0.24    0.47    0.50    0.33    0.17\nC   0.56    0.22    0.22    0.21    0.47    0.32    0.67    0.22    0.11\nG   0.18    0.36    0.45    0.15    0.62    0.23    0.14    0.29    0.57\nT   0.43    0.19    0.38    0.41    0.36    0.23    0.15    0.46    0.38\n```\n\nAny idea why the latter works and the former doesn't? I'm using Pandas version 0.16.1\n"
  },
  {
    "url": "https://api.github.com/repos/pandas-dev/pandas/issues/comments/103032513",
    "html_url": "https://github.com/pandas-dev/pandas/issues/9697#issuecomment-103032513",
    "issue_url": "https://api.github.com/repos/pandas-dev/pandas/issues/9697",
    "id": 103032513,
    "node_id": "MDEyOklzc3VlQ29tbWVudDEwMzAzMjUxMw==",
    "user": {
      "login": "jreback",
      "id": 953992,
      "node_id": "MDQ6VXNlcjk1Mzk5Mg==",
      "avatar_url": "https://avatars2.githubusercontent.com/u/953992?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/jreback",
      "html_url": "https://github.com/jreback",
      "followers_url": "https://api.github.com/users/jreback/followers",
      "following_url": "https://api.github.com/users/jreback/following{/other_user}",
      "gists_url": "https://api.github.com/users/jreback/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/jreback/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/jreback/subscriptions",
      "organizations_url": "https://api.github.com/users/jreback/orgs",
      "repos_url": "https://api.github.com/users/jreback/repos",
      "events_url": "https://api.github.com/users/jreback/events{/privacy}",
      "received_events_url": "https://api.github.com/users/jreback/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2015-05-18T11:50:54Z",
    "updated_at": "2015-05-18T11:50:54Z",
    "author_association": "CONTRIBUTOR",
    "body": "`.transform` must return a scalar value for each group. You are returning a frame. Try this.\n\n```\nIn [44]: sample.groupby(axis=1, level=0).apply(lambda z: z.div(z.sum(axis=1), axis=0))\nOut[44]: \n        syn       mis       non       syn       mis       non       syn       mis       non       syn       mis       non\n          A         A         A         C         C         C         T         T         T         G         G         G\nA  0.125000  0.090909  0.333333  0.375000  0.181818  0.133333  0.250000  0.090909  0.200000  0.250000  0.636364  0.333333\nC  0.200000  0.240000  0.230769  0.133333  0.320000  0.307692  0.133333  0.320000  0.115385  0.533333  0.120000  0.346154\nG  0.350000  0.318182  0.461538  0.300000  0.136364  0.230769  0.100000  0.136364  0.230769  0.250000  0.409091  0.076923\nT  0.052632  0.200000  0.071429  0.368421  0.150000  0.285714  0.368421  0.350000  0.142857  0.210526  0.300000  0.500000\n```\n"
  },
  {
    "url": "https://api.github.com/repos/pandas-dev/pandas/issues/comments/103060156",
    "html_url": "https://github.com/pandas-dev/pandas/issues/9697#issuecomment-103060156",
    "issue_url": "https://api.github.com/repos/pandas-dev/pandas/issues/9697",
    "id": 103060156,
    "node_id": "MDEyOklzc3VlQ29tbWVudDEwMzA2MDE1Ng==",
    "user": {
      "login": "dylkot",
      "id": 3519178,
      "node_id": "MDQ6VXNlcjM1MTkxNzg=",
      "avatar_url": "https://avatars3.githubusercontent.com/u/3519178?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/dylkot",
      "html_url": "https://github.com/dylkot",
      "followers_url": "https://api.github.com/users/dylkot/followers",
      "following_url": "https://api.github.com/users/dylkot/following{/other_user}",
      "gists_url": "https://api.github.com/users/dylkot/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/dylkot/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/dylkot/subscriptions",
      "organizations_url": "https://api.github.com/users/dylkot/orgs",
      "repos_url": "https://api.github.com/users/dylkot/repos",
      "events_url": "https://api.github.com/users/dylkot/events{/privacy}",
      "received_events_url": "https://api.github.com/users/dylkot/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2015-05-18T13:29:00Z",
    "updated_at": "2015-05-18T13:29:00Z",
    "author_association": "NONE",
    "body": "I see, that does indeed work, thanks so much for the help. I am a bit confused by the documentation then. The docstring for transform says:\n\nCall function producing a like-indexed DataFrame on each group and\nreturn a DataFrame having the same indexes as the original object\nfilled with the transformed values\n\nSo I assumed that transform would return a \"transformed\" dataframe for each group. In any case, now I think I have a better understanding of apply. Thanks again!\n"
  },
  {
    "url": "https://api.github.com/repos/pandas-dev/pandas/issues/comments/103094389",
    "html_url": "https://github.com/pandas-dev/pandas/issues/9697#issuecomment-103094389",
    "issue_url": "https://api.github.com/repos/pandas-dev/pandas/issues/9697",
    "id": 103094389,
    "node_id": "MDEyOklzc3VlQ29tbWVudDEwMzA5NDM4OQ==",
    "user": {
      "login": "jreback",
      "id": 953992,
      "node_id": "MDQ6VXNlcjk1Mzk5Mg==",
      "avatar_url": "https://avatars2.githubusercontent.com/u/953992?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/jreback",
      "html_url": "https://github.com/jreback",
      "followers_url": "https://api.github.com/users/jreback/followers",
      "following_url": "https://api.github.com/users/jreback/following{/other_user}",
      "gists_url": "https://api.github.com/users/jreback/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/jreback/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/jreback/subscriptions",
      "organizations_url": "https://api.github.com/users/jreback/orgs",
      "repos_url": "https://api.github.com/users/jreback/repos",
      "events_url": "https://api.github.com/users/jreback/events{/privacy}",
      "received_events_url": "https://api.github.com/users/jreback/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2015-05-18T15:17:21Z",
    "updated_at": "2015-05-18T15:17:21Z",
    "author_association": "CONTRIBUTOR",
    "body": "yes, that the _result_ of a transform. a user-defined function needs to return a single (scalar) value. hmm, maybe be better to have a nicer error message / doc. going to make an issue.\n"
  },
  {
    "url": "https://api.github.com/repos/pandas-dev/pandas/issues/comments/103096794",
    "html_url": "https://github.com/pandas-dev/pandas/issues/9697#issuecomment-103096794",
    "issue_url": "https://api.github.com/repos/pandas-dev/pandas/issues/9697",
    "id": 103096794,
    "node_id": "MDEyOklzc3VlQ29tbWVudDEwMzA5Njc5NA==",
    "user": {
      "login": "jreback",
      "id": 953992,
      "node_id": "MDQ6VXNlcjk1Mzk5Mg==",
      "avatar_url": "https://avatars2.githubusercontent.com/u/953992?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/jreback",
      "html_url": "https://github.com/jreback",
      "followers_url": "https://api.github.com/users/jreback/followers",
      "following_url": "https://api.github.com/users/jreback/following{/other_user}",
      "gists_url": "https://api.github.com/users/jreback/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/jreback/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/jreback/subscriptions",
      "organizations_url": "https://api.github.com/users/jreback/orgs",
      "repos_url": "https://api.github.com/users/jreback/repos",
      "events_url": "https://api.github.com/users/jreback/events{/privacy}",
      "received_events_url": "https://api.github.com/users/jreback/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2015-05-18T15:20:38Z",
    "updated_at": "2015-05-18T15:20:38Z",
    "author_association": "CONTRIBUTOR",
    "body": "@dylkot see #10165 \nif you want to have a go would be gr8!\n"
  }
]
