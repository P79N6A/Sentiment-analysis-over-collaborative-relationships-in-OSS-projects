[
  {
    "url": "https://api.github.com/repos/pandas-dev/pandas/issues/comments/369226672",
    "html_url": "https://github.com/pandas-dev/pandas/issues/19720#issuecomment-369226672",
    "issue_url": "https://api.github.com/repos/pandas-dev/pandas/issues/19720",
    "id": 369226672,
    "node_id": "MDEyOklzc3VlQ29tbWVudDM2OTIyNjY3Mg==",
    "user": {
      "login": "shangyian",
      "id": 9524628,
      "node_id": "MDQ6VXNlcjk1MjQ2Mjg=",
      "avatar_url": "https://avatars2.githubusercontent.com/u/9524628?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/shangyian",
      "html_url": "https://github.com/shangyian",
      "followers_url": "https://api.github.com/users/shangyian/followers",
      "following_url": "https://api.github.com/users/shangyian/following{/other_user}",
      "gists_url": "https://api.github.com/users/shangyian/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/shangyian/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/shangyian/subscriptions",
      "organizations_url": "https://api.github.com/users/shangyian/orgs",
      "repos_url": "https://api.github.com/users/shangyian/repos",
      "events_url": "https://api.github.com/users/shangyian/events{/privacy}",
      "received_events_url": "https://api.github.com/users/shangyian/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2018-02-28T12:37:50Z",
    "updated_at": "2018-02-28T12:38:15Z",
    "author_association": "CONTRIBUTOR",
    "body": "I was able to reproduce this discrepancy between Python 2.7 and 3.6 as well. \r\n\r\nTried to dig into the code, and the main differences I noticed between the two were that in `_python_agg_general`, it calls `_iterate_slices`, which only has a single slice in Python 3.6, but has 2 in 2.7: https://github.com/pandas-dev/pandas/blob/15bbb28865fa1a259e4d61b85604dea1c5f2f249/pandas/core/groupby.py#L1043-L1049 Somehow `self._selection` isn't being populated correctly."
  },
  {
    "url": "https://api.github.com/repos/pandas-dev/pandas/issues/comments/369237692",
    "html_url": "https://github.com/pandas-dev/pandas/issues/19720#issuecomment-369237692",
    "issue_url": "https://api.github.com/repos/pandas-dev/pandas/issues/19720",
    "id": 369237692,
    "node_id": "MDEyOklzc3VlQ29tbWVudDM2OTIzNzY5Mg==",
    "user": {
      "login": "TomAugspurger",
      "id": 1312546,
      "node_id": "MDQ6VXNlcjEzMTI1NDY=",
      "avatar_url": "https://avatars3.githubusercontent.com/u/1312546?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/TomAugspurger",
      "html_url": "https://github.com/TomAugspurger",
      "followers_url": "https://api.github.com/users/TomAugspurger/followers",
      "following_url": "https://api.github.com/users/TomAugspurger/following{/other_user}",
      "gists_url": "https://api.github.com/users/TomAugspurger/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/TomAugspurger/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/TomAugspurger/subscriptions",
      "organizations_url": "https://api.github.com/users/TomAugspurger/orgs",
      "repos_url": "https://api.github.com/users/TomAugspurger/repos",
      "events_url": "https://api.github.com/users/TomAugspurger/events{/privacy}",
      "received_events_url": "https://api.github.com/users/TomAugspurger/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2018-02-28T13:23:40Z",
    "updated_at": "2018-02-28T13:23:40Z",
    "author_association": "CONTRIBUTOR",
    "body": "Thanks for looking @shangyian. Are you interested in digging further? Do you need any pointers on where to look next?"
  },
  {
    "url": "https://api.github.com/repos/pandas-dev/pandas/issues/comments/369240147",
    "html_url": "https://github.com/pandas-dev/pandas/issues/19720#issuecomment-369240147",
    "issue_url": "https://api.github.com/repos/pandas-dev/pandas/issues/19720",
    "id": 369240147,
    "node_id": "MDEyOklzc3VlQ29tbWVudDM2OTI0MDE0Nw==",
    "user": {
      "login": "shangyian",
      "id": 9524628,
      "node_id": "MDQ6VXNlcjk1MjQ2Mjg=",
      "avatar_url": "https://avatars2.githubusercontent.com/u/9524628?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/shangyian",
      "html_url": "https://github.com/shangyian",
      "followers_url": "https://api.github.com/users/shangyian/followers",
      "following_url": "https://api.github.com/users/shangyian/following{/other_user}",
      "gists_url": "https://api.github.com/users/shangyian/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/shangyian/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/shangyian/subscriptions",
      "organizations_url": "https://api.github.com/users/shangyian/orgs",
      "repos_url": "https://api.github.com/users/shangyian/repos",
      "events_url": "https://api.github.com/users/shangyian/events{/privacy}",
      "received_events_url": "https://api.github.com/users/shangyian/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2018-02-28T13:33:33Z",
    "updated_at": "2018-02-28T13:33:33Z",
    "author_association": "CONTRIBUTOR",
    "body": "Sure, I can try to dig further.\r\n\r\nMy main issue right now is that I don't quite understand where `_selection` in `_iterate_slices()` is being populated. Any help with pinning that down would be much appreciated."
  },
  {
    "url": "https://api.github.com/repos/pandas-dev/pandas/issues/comments/369285104",
    "html_url": "https://github.com/pandas-dev/pandas/issues/19720#issuecomment-369285104",
    "issue_url": "https://api.github.com/repos/pandas-dev/pandas/issues/19720",
    "id": 369285104,
    "node_id": "MDEyOklzc3VlQ29tbWVudDM2OTI4NTEwNA==",
    "user": {
      "login": "TomAugspurger",
      "id": 1312546,
      "node_id": "MDQ6VXNlcjEzMTI1NDY=",
      "avatar_url": "https://avatars3.githubusercontent.com/u/1312546?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/TomAugspurger",
      "html_url": "https://github.com/TomAugspurger",
      "followers_url": "https://api.github.com/users/TomAugspurger/followers",
      "following_url": "https://api.github.com/users/TomAugspurger/following{/other_user}",
      "gists_url": "https://api.github.com/users/TomAugspurger/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/TomAugspurger/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/TomAugspurger/subscriptions",
      "organizations_url": "https://api.github.com/users/TomAugspurger/orgs",
      "repos_url": "https://api.github.com/users/TomAugspurger/repos",
      "events_url": "https://api.github.com/users/TomAugspurger/events{/privacy}",
      "received_events_url": "https://api.github.com/users/TomAugspurger/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2018-02-28T15:56:24Z",
    "updated_at": "2018-02-28T15:56:24Z",
    "author_association": "CONTRIBUTOR",
    "body": "I'm not sure if this is the root cause, but in https://github.com/pandas-dev/pandas/blob/6ef4be3f8f269f147b5abedecf7da6f19af305d3/pandas/core/groupby.py#L1051\r\n\r\nFor Py2 that throws a TypeError, which is caught\r\n\r\n```python\r\n(Pdb) self.grouper.agg_series(obj, f)\r\n*** TypeError: unbound method sum() must be called with DataFrame instance as first argument (got Series instance instead)\r\n```\r\n\r\nFor Py3, that throws a ValueError, which is not\r\n\r\n```python\r\nipdb> self.grouper.agg_series(obj, f)\r\n*** ValueError: No axis named 1 for object type <class 'pandas.core.series.Series'>\r\n```\r\n\r\nI'm not sure what the correct behavior is here, but maybe that helps :)"
  },
  {
    "url": "https://api.github.com/repos/pandas-dev/pandas/issues/comments/369308608",
    "html_url": "https://github.com/pandas-dev/pandas/issues/19720#issuecomment-369308608",
    "issue_url": "https://api.github.com/repos/pandas-dev/pandas/issues/19720",
    "id": 369308608,
    "node_id": "MDEyOklzc3VlQ29tbWVudDM2OTMwODYwOA==",
    "user": {
      "login": "shangyian",
      "id": 9524628,
      "node_id": "MDQ6VXNlcjk1MjQ2Mjg=",
      "avatar_url": "https://avatars2.githubusercontent.com/u/9524628?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/shangyian",
      "html_url": "https://github.com/shangyian",
      "followers_url": "https://api.github.com/users/shangyian/followers",
      "following_url": "https://api.github.com/users/shangyian/following{/other_user}",
      "gists_url": "https://api.github.com/users/shangyian/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/shangyian/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/shangyian/subscriptions",
      "organizations_url": "https://api.github.com/users/shangyian/orgs",
      "repos_url": "https://api.github.com/users/shangyian/repos",
      "events_url": "https://api.github.com/users/shangyian/events{/privacy}",
      "received_events_url": "https://api.github.com/users/shangyian/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2018-02-28T17:04:50Z",
    "updated_at": "2018-02-28T17:04:50Z",
    "author_association": "CONTRIBUTOR",
    "body": "Ah, there it is - thanks! üëç \r\n\r\nIf we just have the resulting function catch both `TypeError` and `ValueError`, it'll produce the same result as Py2. It seems that the crux of the issue is that it tries to do series-level aggregation, which doesn't work, and it's supposed to move onto the `_python_apply_general` method after catching the errors.\r\n\r\nI'll add a PR for this."
  }
]
