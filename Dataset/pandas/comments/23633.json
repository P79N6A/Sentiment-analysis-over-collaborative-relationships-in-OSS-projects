[
  {
    "url": "https://api.github.com/repos/pandas-dev/pandas/issues/comments/437935921",
    "html_url": "https://github.com/pandas-dev/pandas/issues/23633#issuecomment-437935921",
    "issue_url": "https://api.github.com/repos/pandas-dev/pandas/issues/23633",
    "id": 437935921,
    "node_id": "MDEyOklzc3VlQ29tbWVudDQzNzkzNTkyMQ==",
    "user": {
      "login": "kylebarron",
      "id": 15164633,
      "node_id": "MDQ6VXNlcjE1MTY0NjMz",
      "avatar_url": "https://avatars3.githubusercontent.com/u/15164633?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/kylebarron",
      "html_url": "https://github.com/kylebarron",
      "followers_url": "https://api.github.com/users/kylebarron/followers",
      "following_url": "https://api.github.com/users/kylebarron/following{/other_user}",
      "gists_url": "https://api.github.com/users/kylebarron/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/kylebarron/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/kylebarron/subscriptions",
      "organizations_url": "https://api.github.com/users/kylebarron/orgs",
      "repos_url": "https://api.github.com/users/kylebarron/repos",
      "events_url": "https://api.github.com/users/kylebarron/events{/privacy}",
      "received_events_url": "https://api.github.com/users/kylebarron/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2018-11-12T16:05:48Z",
    "updated_at": "2018-11-12T16:06:02Z",
    "author_association": "CONTRIBUTOR",
    "body": "@jtkiley \t\r\nThe error is in a different place, but functionally this is a duplicate of https://github.com/pandas-dev/pandas/issues/23572. The reason for your error is not the string length, but the fact that the object in your second row is `None`, and not a string. Your thoughts would definitely be appreciated on #23572.\r\n\r\nSee the difference in this code:\r\n```py \r\nimport pandas as pd\r\ndf1 = pd.DataFrame({'str1': ['string' * 500, '']})\r\ndf2 = pd.DataFrame({'str1': ['string' * 500, None]})\r\n\r\ndf1.to_stata('df1_117.dta', version=117)\r\n# Works\r\ndf2.to_stata('df2_117.dta', version=117)\r\n# Attribute error (can't encode None to a string)\r\n```\r\n"
  },
  {
    "url": "https://api.github.com/repos/pandas-dev/pandas/issues/comments/437942322",
    "html_url": "https://github.com/pandas-dev/pandas/issues/23633#issuecomment-437942322",
    "issue_url": "https://api.github.com/repos/pandas-dev/pandas/issues/23633",
    "id": 437942322,
    "node_id": "MDEyOklzc3VlQ29tbWVudDQzNzk0MjMyMg==",
    "user": {
      "login": "jtkiley",
      "id": 3935135,
      "node_id": "MDQ6VXNlcjM5MzUxMzU=",
      "avatar_url": "https://avatars3.githubusercontent.com/u/3935135?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/jtkiley",
      "html_url": "https://github.com/jtkiley",
      "followers_url": "https://api.github.com/users/jtkiley/followers",
      "following_url": "https://api.github.com/users/jtkiley/following{/other_user}",
      "gists_url": "https://api.github.com/users/jtkiley/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/jtkiley/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/jtkiley/subscriptions",
      "organizations_url": "https://api.github.com/users/jtkiley/orgs",
      "repos_url": "https://api.github.com/users/jtkiley/repos",
      "events_url": "https://api.github.com/users/jtkiley/events{/privacy}",
      "received_events_url": "https://api.github.com/users/jtkiley/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2018-11-12T16:23:44Z",
    "updated_at": "2018-11-12T16:23:44Z",
    "author_association": "CONTRIBUTOR",
    "body": "@kylebarron I may be missing it (a cue for more coffee either way), but I think this is similar yet not quite the same.\r\n\r\nIn #23572, you seem to suggest that it fails because it's all `None` and that one string in that column will produce the coercing behavior.\r\n\r\nHere, I have one string and one `None` in that column, so the coercing behavior works when the string is short. However, when it's long, the column is handed differently as a srtL by the 117 writer (a long string produces `ValueError` with the default 114 writer), and that same coercion behavior is not applied. So, the main issue is that it's inconsistent, and I'm suggesting that I like the coercing behavior.\r\n\r\nThanks for the pointer to #23572. I'll think about it a bit more and comment there, too."
  },
  {
    "url": "https://api.github.com/repos/pandas-dev/pandas/issues/comments/437946062",
    "html_url": "https://github.com/pandas-dev/pandas/issues/23633#issuecomment-437946062",
    "issue_url": "https://api.github.com/repos/pandas-dev/pandas/issues/23633",
    "id": 437946062,
    "node_id": "MDEyOklzc3VlQ29tbWVudDQzNzk0NjA2Mg==",
    "user": {
      "login": "kylebarron",
      "id": 15164633,
      "node_id": "MDQ6VXNlcjE1MTY0NjMz",
      "avatar_url": "https://avatars3.githubusercontent.com/u/15164633?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/kylebarron",
      "html_url": "https://github.com/kylebarron",
      "followers_url": "https://api.github.com/users/kylebarron/followers",
      "following_url": "https://api.github.com/users/kylebarron/following{/other_user}",
      "gists_url": "https://api.github.com/users/kylebarron/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/kylebarron/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/kylebarron/subscriptions",
      "organizations_url": "https://api.github.com/users/kylebarron/orgs",
      "repos_url": "https://api.github.com/users/kylebarron/repos",
      "events_url": "https://api.github.com/users/kylebarron/events{/privacy}",
      "received_events_url": "https://api.github.com/users/kylebarron/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2018-11-12T16:34:14Z",
    "updated_at": "2018-11-12T16:34:14Z",
    "author_association": "CONTRIBUTOR",
    "body": "Yes, on second thought you're right that this isn't functionally the same. \r\n\r\nI did want to point you to that issue anyways to get your thoughts on when `None` should be coerced to an empty string."
  },
  {
    "url": "https://api.github.com/repos/pandas-dev/pandas/issues/comments/438029366",
    "html_url": "https://github.com/pandas-dev/pandas/issues/23633#issuecomment-438029366",
    "issue_url": "https://api.github.com/repos/pandas-dev/pandas/issues/23633",
    "id": 438029366,
    "node_id": "MDEyOklzc3VlQ29tbWVudDQzODAyOTM2Ng==",
    "user": {
      "login": "jtkiley",
      "id": 3935135,
      "node_id": "MDQ6VXNlcjM5MzUxMzU=",
      "avatar_url": "https://avatars3.githubusercontent.com/u/3935135?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/jtkiley",
      "html_url": "https://github.com/jtkiley",
      "followers_url": "https://api.github.com/users/jtkiley/followers",
      "following_url": "https://api.github.com/users/jtkiley/following{/other_user}",
      "gists_url": "https://api.github.com/users/jtkiley/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/jtkiley/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/jtkiley/subscriptions",
      "organizations_url": "https://api.github.com/users/jtkiley/orgs",
      "repos_url": "https://api.github.com/users/jtkiley/repos",
      "events_url": "https://api.github.com/users/jtkiley/events{/privacy}",
      "received_events_url": "https://api.github.com/users/jtkiley/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2018-11-12T21:09:16Z",
    "updated_at": "2018-11-12T21:09:16Z",
    "author_association": "CONTRIBUTOR",
    "body": "Just a note for anyone happening to end up here: there's some extended conversation on when/where to coerce over on #23572."
  },
  {
    "url": "https://api.github.com/repos/pandas-dev/pandas/issues/comments/438061585",
    "html_url": "https://github.com/pandas-dev/pandas/issues/23633#issuecomment-438061585",
    "issue_url": "https://api.github.com/repos/pandas-dev/pandas/issues/23633",
    "id": 438061585,
    "node_id": "MDEyOklzc3VlQ29tbWVudDQzODA2MTU4NQ==",
    "user": {
      "login": "jtkiley",
      "id": 3935135,
      "node_id": "MDQ6VXNlcjM5MzUxMzU=",
      "avatar_url": "https://avatars3.githubusercontent.com/u/3935135?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/jtkiley",
      "html_url": "https://github.com/jtkiley",
      "followers_url": "https://api.github.com/users/jtkiley/followers",
      "following_url": "https://api.github.com/users/jtkiley/following{/other_user}",
      "gists_url": "https://api.github.com/users/jtkiley/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/jtkiley/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/jtkiley/subscriptions",
      "organizations_url": "https://api.github.com/users/jtkiley/orgs",
      "repos_url": "https://api.github.com/users/jtkiley/repos",
      "events_url": "https://api.github.com/users/jtkiley/events{/privacy}",
      "received_events_url": "https://api.github.com/users/jtkiley/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2018-11-12T23:06:09Z",
    "updated_at": "2018-11-12T23:06:09Z",
    "author_association": "CONTRIBUTOR",
    "body": "@bashtage I've been looking through stata.py, and I think I see what the issue is, but I'm not sure I understand all of the moving parts (and the consequences of changes) well enough to make a PR.\r\n\r\nhttps://github.com/pandas-dev/pandas/blob/a08bf3de02bb1e53fb95df24ae060b63c2a44c96/pandas/io/stata.py#L2359-L2383\r\n\r\nIn the 114 writer, line 2360 doesn't do anything, so we keep going and strings get filled by line 2371. In the 117 writer, `strl` columns are dealt with before filling (and, if I'm reading it right, their `typ` value wouldn't be true at line 2369 anyway), so they fail if they're `None`, but the ones `<=2045` pass through and get fixed at 2371. \r\n\r\nSo, it seems like the fix is something like one of these two:\r\n\r\n1. Moving all of the filling before 2360, though that would require checking every column to see if it's a string (so, either `<= _max_string_length` or `== 36768`).\r\n2. Adding a similar filling operation for `strl`s somewhere. It looks like `StataStrLWriter` gets the whole dataframe and a list of `strl` columns, so it might be as easy as adding `for col in self.columns: self.df[col] = self.df[col].fillna('')` to the constructor.\r\n\r\nThoughts? If option 2 is viable, I can make a PR for that, as I don't see as much concern for breaking things that I don't understand."
  },
  {
    "url": "https://api.github.com/repos/pandas-dev/pandas/issues/comments/438644993",
    "html_url": "https://github.com/pandas-dev/pandas/issues/23633#issuecomment-438644993",
    "issue_url": "https://api.github.com/repos/pandas-dev/pandas/issues/23633",
    "id": 438644993,
    "node_id": "MDEyOklzc3VlQ29tbWVudDQzODY0NDk5Mw==",
    "user": {
      "login": "bashtage",
      "id": 5585221,
      "node_id": "MDQ6VXNlcjU1ODUyMjE=",
      "avatar_url": "https://avatars3.githubusercontent.com/u/5585221?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/bashtage",
      "html_url": "https://github.com/bashtage",
      "followers_url": "https://api.github.com/users/bashtage/followers",
      "following_url": "https://api.github.com/users/bashtage/following{/other_user}",
      "gists_url": "https://api.github.com/users/bashtage/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/bashtage/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/bashtage/subscriptions",
      "organizations_url": "https://api.github.com/users/bashtage/orgs",
      "repos_url": "https://api.github.com/users/bashtage/repos",
      "events_url": "https://api.github.com/users/bashtage/events{/privacy}",
      "received_events_url": "https://api.github.com/users/bashtage/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2018-11-14T12:27:06Z",
    "updated_at": "2018-11-14T12:27:06Z",
    "author_association": "CONTRIBUTOR",
    "body": "Simple fix in #23692"
  },
  {
    "url": "https://api.github.com/repos/pandas-dev/pandas/issues/comments/438667718",
    "html_url": "https://github.com/pandas-dev/pandas/issues/23633#issuecomment-438667718",
    "issue_url": "https://api.github.com/repos/pandas-dev/pandas/issues/23633",
    "id": 438667718,
    "node_id": "MDEyOklzc3VlQ29tbWVudDQzODY2NzcxOA==",
    "user": {
      "login": "jtkiley",
      "id": 3935135,
      "node_id": "MDQ6VXNlcjM5MzUxMzU=",
      "avatar_url": "https://avatars3.githubusercontent.com/u/3935135?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/jtkiley",
      "html_url": "https://github.com/jtkiley",
      "followers_url": "https://api.github.com/users/jtkiley/followers",
      "following_url": "https://api.github.com/users/jtkiley/following{/other_user}",
      "gists_url": "https://api.github.com/users/jtkiley/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/jtkiley/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/jtkiley/subscriptions",
      "organizations_url": "https://api.github.com/users/jtkiley/orgs",
      "repos_url": "https://api.github.com/users/jtkiley/repos",
      "events_url": "https://api.github.com/users/jtkiley/events{/privacy}",
      "received_events_url": "https://api.github.com/users/jtkiley/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2018-11-14T13:49:19Z",
    "updated_at": "2018-11-14T13:49:19Z",
    "author_association": "CONTRIBUTOR",
    "body": "@bashtage Great, thanks. I figured there would be a better place, but I haven't read enough to the 117 docs to quite grasp what you were doing in that part of `StataStrLWriter`."
  }
]
