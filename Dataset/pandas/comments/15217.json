[
  {
    "url": "https://api.github.com/repos/pandas-dev/pandas/issues/comments/274995121",
    "html_url": "https://github.com/pandas-dev/pandas/issues/15217#issuecomment-274995121",
    "issue_url": "https://api.github.com/repos/pandas-dev/pandas/issues/15217",
    "id": 274995121,
    "node_id": "MDEyOklzc3VlQ29tbWVudDI3NDk5NTEyMQ==",
    "user": {
      "login": "dragoljub",
      "id": 2701562,
      "node_id": "MDQ6VXNlcjI3MDE1NjI=",
      "avatar_url": "https://avatars3.githubusercontent.com/u/2701562?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/dragoljub",
      "html_url": "https://github.com/dragoljub",
      "followers_url": "https://api.github.com/users/dragoljub/followers",
      "following_url": "https://api.github.com/users/dragoljub/following{/other_user}",
      "gists_url": "https://api.github.com/users/dragoljub/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/dragoljub/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/dragoljub/subscriptions",
      "organizations_url": "https://api.github.com/users/dragoljub/orgs",
      "repos_url": "https://api.github.com/users/dragoljub/repos",
      "events_url": "https://api.github.com/users/dragoljub/events{/privacy}",
      "received_events_url": "https://api.github.com/users/dragoljub/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2017-01-25T01:40:00Z",
    "updated_at": "2017-01-25T01:40:00Z",
    "author_association": "NONE",
    "body": "Probably related to the above issue.\r\n\r\nIf I perform a combined .max() aggregation on a three column selection from the categorical groupby  I get lots of NaN results that do not appear when not using categorical types. \r\n\r\n```python\r\nimport numpy as np\r\nimport pandas as pd\r\n\r\ndf = pd.DataFrame(np.random.randint(10,100, size=(200,6)), columns=['C'+str(i) for i in range(6)])\r\ndf['C0'] = ['A','B','C','D']*50\r\ndf['C1'] = ['E','F']*100\r\ndf['C2'] = ['H','I','J','K', 'L']*40\r\n\r\nfor col in df.columns[:3]:\r\n    df[col] = df[col].astype('category')\r\n\r\ndf.groupby(['C0', 'C1', 'C2'])[['C3', 'C4', 'C5']].max()\r\n\r\n            C3    C4    C5\r\nC0 C1 C2                  \r\nA  E  H   90.0  94.0  99.0\r\n      I   97.0  87.0  94.0\r\n      J   88.0  98.0  85.0\r\n      K   80.0  91.0  97.0\r\n      L   96.0  95.0  98.0\r\n   F  H    NaN   NaN   NaN\r\n      I    NaN   NaN   NaN\r\n      J    NaN   NaN   NaN\r\n      K    NaN   NaN   NaN\r\n      L    NaN   NaN   NaN\r\nB  E  H    NaN   NaN   NaN\r\n      I    NaN   NaN   NaN\r\n      J    NaN   NaN   NaN\r\n      K    NaN   NaN   NaN\r\n      L    NaN   NaN   NaN\r\n   F  H   99.0  97.0  89.0\r\n      I   80.0  97.0  94.0\r\n      J   97.0  90.0  98.0\r\n      K   89.0  85.0  98.0\r\n      L   87.0  94.0  99.0\r\nC  E  H   99.0  98.0  93.0\r\n      I   94.0  88.0  92.0\r\n      J   89.0  86.0  79.0\r\n      K   99.0  98.0  98.0\r\n      L   98.0  94.0  96.0\r\n   F  H    NaN   NaN   NaN\r\n      I    NaN   NaN   NaN\r\n      J    NaN   NaN   NaN\r\n      K    NaN   NaN   NaN\r\n      L    NaN   NaN   NaN\r\nD  E  H    NaN   NaN   NaN\r\n      I    NaN   NaN   NaN\r\n      J    NaN   NaN   NaN\r\n      K    NaN   NaN   NaN\r\n      L    NaN   NaN   NaN\r\n   F  H   95.0  92.0  88.0\r\n      I   98.0  90.0  87.0\r\n      J   91.0  93.0  82.0\r\n      K   93.0  99.0  99.0\r\n      L   93.0  84.0  80.0\r\n```"
  },
  {
    "url": "https://api.github.com/repos/pandas-dev/pandas/issues/comments/274996529",
    "html_url": "https://github.com/pandas-dev/pandas/issues/15217#issuecomment-274996529",
    "issue_url": "https://api.github.com/repos/pandas-dev/pandas/issues/15217",
    "id": 274996529,
    "node_id": "MDEyOklzc3VlQ29tbWVudDI3NDk5NjUyOQ==",
    "user": {
      "login": "jreback",
      "id": 953992,
      "node_id": "MDQ6VXNlcjk1Mzk5Mg==",
      "avatar_url": "https://avatars2.githubusercontent.com/u/953992?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/jreback",
      "html_url": "https://github.com/jreback",
      "followers_url": "https://api.github.com/users/jreback/followers",
      "following_url": "https://api.github.com/users/jreback/following{/other_user}",
      "gists_url": "https://api.github.com/users/jreback/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/jreback/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/jreback/subscriptions",
      "organizations_url": "https://api.github.com/users/jreback/orgs",
      "repos_url": "https://api.github.com/users/jreback/repos",
      "events_url": "https://api.github.com/users/jreback/events{/privacy}",
      "received_events_url": "https://api.github.com/users/jreback/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2017-01-25T01:49:03Z",
    "updated_at": "2017-01-25T01:49:03Z",
    "author_association": "CONTRIBUTOR",
    "body": "I think this is the same code path as this one: https://github.com/pandas-dev/pandas/issues/14942\r\n\r\nessentially we should be reindexing each level of the output rather than the cartesian product of them (which is why the nans happen).\r\n\r\npull-requests to fix are welcome! (its a straightforward fix)"
  },
  {
    "url": "https://api.github.com/repos/pandas-dev/pandas/issues/comments/275013695",
    "html_url": "https://github.com/pandas-dev/pandas/issues/15217#issuecomment-275013695",
    "issue_url": "https://api.github.com/repos/pandas-dev/pandas/issues/15217",
    "id": 275013695,
    "node_id": "MDEyOklzc3VlQ29tbWVudDI3NTAxMzY5NQ==",
    "user": {
      "login": "dragoljub",
      "id": 2701562,
      "node_id": "MDQ6VXNlcjI3MDE1NjI=",
      "avatar_url": "https://avatars3.githubusercontent.com/u/2701562?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/dragoljub",
      "html_url": "https://github.com/dragoljub",
      "followers_url": "https://api.github.com/users/dragoljub/followers",
      "following_url": "https://api.github.com/users/dragoljub/following{/other_user}",
      "gists_url": "https://api.github.com/users/dragoljub/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/dragoljub/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/dragoljub/subscriptions",
      "organizations_url": "https://api.github.com/users/dragoljub/orgs",
      "repos_url": "https://api.github.com/users/dragoljub/repos",
      "events_url": "https://api.github.com/users/dragoljub/events{/privacy}",
      "received_events_url": "https://api.github.com/users/dragoljub/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2017-01-25T04:05:00Z",
    "updated_at": "2017-01-25T04:05:00Z",
    "author_association": "NONE",
    "body": "@jreback looks like #13204 attempted to fix this.\r\n\r\nOn this line of groupby.py: \r\nhttps://github.com/pandas-dev/pandas/blob/master/pandas/core/groupby.py#L3934\r\n \r\nWe are using ```MultiIndex.from_product()```. Should we instead be using ```MultiIndex.from_arrays()```?\r\n\r\nPerhaps its just a typo or do not understanding why we would want a Cartesian product."
  },
  {
    "url": "https://api.github.com/repos/pandas-dev/pandas/issues/comments/275100032",
    "html_url": "https://github.com/pandas-dev/pandas/issues/15217#issuecomment-275100032",
    "issue_url": "https://api.github.com/repos/pandas-dev/pandas/issues/15217",
    "id": 275100032,
    "node_id": "MDEyOklzc3VlQ29tbWVudDI3NTEwMDAzMg==",
    "user": {
      "login": "jreback",
      "id": 953992,
      "node_id": "MDQ6VXNlcjk1Mzk5Mg==",
      "avatar_url": "https://avatars2.githubusercontent.com/u/953992?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/jreback",
      "html_url": "https://github.com/jreback",
      "followers_url": "https://api.github.com/users/jreback/followers",
      "following_url": "https://api.github.com/users/jreback/following{/other_user}",
      "gists_url": "https://api.github.com/users/jreback/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/jreback/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/jreback/subscriptions",
      "organizations_url": "https://api.github.com/users/jreback/orgs",
      "repos_url": "https://api.github.com/users/jreback/repos",
      "events_url": "https://api.github.com/users/jreback/events{/privacy}",
      "received_events_url": "https://api.github.com/users/jreback/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2017-01-25T12:49:38Z",
    "updated_at": "2017-01-25T12:49:38Z",
    "author_association": "CONTRIBUTOR",
    "body": "it's not a typo\r\n\r\nthe idea is that you should be getting back all categories that were there orginalky for a categorical grouper - that is the contract"
  },
  {
    "url": "https://api.github.com/repos/pandas-dev/pandas/issues/comments/275224088",
    "html_url": "https://github.com/pandas-dev/pandas/issues/15217#issuecomment-275224088",
    "issue_url": "https://api.github.com/repos/pandas-dev/pandas/issues/15217",
    "id": 275224088,
    "node_id": "MDEyOklzc3VlQ29tbWVudDI3NTIyNDA4OA==",
    "user": {
      "login": "dragoljub",
      "id": 2701562,
      "node_id": "MDQ6VXNlcjI3MDE1NjI=",
      "avatar_url": "https://avatars3.githubusercontent.com/u/2701562?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/dragoljub",
      "html_url": "https://github.com/dragoljub",
      "followers_url": "https://api.github.com/users/dragoljub/followers",
      "following_url": "https://api.github.com/users/dragoljub/following{/other_user}",
      "gists_url": "https://api.github.com/users/dragoljub/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/dragoljub/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/dragoljub/subscriptions",
      "organizations_url": "https://api.github.com/users/dragoljub/orgs",
      "repos_url": "https://api.github.com/users/dragoljub/repos",
      "events_url": "https://api.github.com/users/dragoljub/events{/privacy}",
      "received_events_url": "https://api.github.com/users/dragoljub/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2017-01-25T20:30:39Z",
    "updated_at": "2017-01-25T20:30:39Z",
    "author_association": "NONE",
    "body": "I thought the goal of re-indexing was to return the reduced carnality CategoricalIndex but with all before group by category levels still present?\r\n\r\nFrom what I see the CatagoricalIndex levels do have all catagory levels populated, but we still have the extra NaN rows.\r\n\r\nNot sure which is causing which. Do we have extra NaN rows & all category levels due to the MultiIndex.from_product() or from some other line of code.\r\n\r\n```python\r\ndf.groupby(['C0', 'C1', 'C2']).sum().index\r\n\r\nMultiIndex(levels=[['A', 'B', 'C', 'D'], ['E', 'F'], ['H', 'I', 'J', 'K', 'L']],\r\n           labels=[[0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3], [0, 0, 0, 0, 0, 1, 1, 1, 1, 1, 0, 0, 0, 0, 0, 1, 1, 1, 1, 1, 0, 0, 0, 0, 0, 1, 1, 1, 1, 1, 0, 0, 0, 0, 0, 1, 1, 1, 1, 1], [0, 1, 2, 3, 4, 0, 1, 2, 3, 4, 0, 1, 2, 3, 4, 0, 1, 2, 3, 4, 0, 1, 2, 3, 4, 0, 1, 2, 3, 4, 0, 1, 2, 3, 4, 0, 1, 2, 3, 4]],\r\n           names=['C0', 'C1', 'C2'])\r\n```"
  },
  {
    "url": "https://api.github.com/repos/pandas-dev/pandas/issues/comments/275252544",
    "html_url": "https://github.com/pandas-dev/pandas/issues/15217#issuecomment-275252544",
    "issue_url": "https://api.github.com/repos/pandas-dev/pandas/issues/15217",
    "id": 275252544,
    "node_id": "MDEyOklzc3VlQ29tbWVudDI3NTI1MjU0NA==",
    "user": {
      "login": "jreback",
      "id": 953992,
      "node_id": "MDQ6VXNlcjk1Mzk5Mg==",
      "avatar_url": "https://avatars2.githubusercontent.com/u/953992?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/jreback",
      "html_url": "https://github.com/jreback",
      "followers_url": "https://api.github.com/users/jreback/followers",
      "following_url": "https://api.github.com/users/jreback/following{/other_user}",
      "gists_url": "https://api.github.com/users/jreback/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/jreback/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/jreback/subscriptions",
      "organizations_url": "https://api.github.com/users/jreback/orgs",
      "repos_url": "https://api.github.com/users/jreback/repos",
      "events_url": "https://api.github.com/users/jreback/events{/privacy}",
      "received_events_url": "https://api.github.com/users/jreback/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2017-01-25T22:25:33Z",
    "updated_at": "2017-01-25T22:25:33Z",
    "author_association": "CONTRIBUTOR",
    "body": "yes the MultiIndex.from_product is not what we want here. I think we can maybe skip the reindexing entirely as the categories are already preserved. "
  }
]
