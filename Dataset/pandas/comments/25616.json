[
  {
    "url": "https://api.github.com/repos/pandas-dev/pandas/issues/comments/471211890",
    "html_url": "https://github.com/pandas-dev/pandas/issues/25616#issuecomment-471211890",
    "issue_url": "https://api.github.com/repos/pandas-dev/pandas/issues/25616",
    "id": 471211890,
    "node_id": "MDEyOklzc3VlQ29tbWVudDQ3MTIxMTg5MA==",
    "user": {
      "login": "WillAyd",
      "id": 609873,
      "node_id": "MDQ6VXNlcjYwOTg3Mw==",
      "avatar_url": "https://avatars0.githubusercontent.com/u/609873?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/WillAyd",
      "html_url": "https://github.com/WillAyd",
      "followers_url": "https://api.github.com/users/WillAyd/followers",
      "following_url": "https://api.github.com/users/WillAyd/following{/other_user}",
      "gists_url": "https://api.github.com/users/WillAyd/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/WillAyd/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/WillAyd/subscriptions",
      "organizations_url": "https://api.github.com/users/WillAyd/orgs",
      "repos_url": "https://api.github.com/users/WillAyd/repos",
      "events_url": "https://api.github.com/users/WillAyd/events{/privacy}",
      "received_events_url": "https://api.github.com/users/WillAyd/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2019-03-09T19:00:06Z",
    "updated_at": "2019-03-09T19:00:06Z",
    "author_association": "MEMBER",
    "body": "Hmm ok that is strange - investigation and PRs would certainly be welcome"
  },
  {
    "url": "https://api.github.com/repos/pandas-dev/pandas/issues/comments/471334838",
    "html_url": "https://github.com/pandas-dev/pandas/issues/25616#issuecomment-471334838",
    "issue_url": "https://api.github.com/repos/pandas-dev/pandas/issues/25616",
    "id": 471334838,
    "node_id": "MDEyOklzc3VlQ29tbWVudDQ3MTMzNDgzOA==",
    "user": {
      "login": "ArtificialQualia",
      "id": 25773476,
      "node_id": "MDQ6VXNlcjI1NzczNDc2",
      "avatar_url": "https://avatars1.githubusercontent.com/u/25773476?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/ArtificialQualia",
      "html_url": "https://github.com/ArtificialQualia",
      "followers_url": "https://api.github.com/users/ArtificialQualia/followers",
      "following_url": "https://api.github.com/users/ArtificialQualia/following{/other_user}",
      "gists_url": "https://api.github.com/users/ArtificialQualia/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/ArtificialQualia/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/ArtificialQualia/subscriptions",
      "organizations_url": "https://api.github.com/users/ArtificialQualia/orgs",
      "repos_url": "https://api.github.com/users/ArtificialQualia/repos",
      "events_url": "https://api.github.com/users/ArtificialQualia/events{/privacy}",
      "received_events_url": "https://api.github.com/users/ArtificialQualia/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2019-03-10T19:13:55Z",
    "updated_at": "2019-03-10T19:17:45Z",
    "author_association": "CONTRIBUTOR",
    "body": "I'm new to working on pandas, so please note that some of the below may be incorrect.\r\n\r\nI've looked into this a bit, and it looks like the cause is code added in #21477 in `Block._replace_coerce`, specifically the `coerce_to_target_dtype` function.\r\n\r\nThis didn't exist in the older version of pandas that the above code works on, and conversion was handled totally by the `ObjectBlock.convert` function.  At some point, it seems that function no longer met all the needs of converting, and `coerce_to_target_dtype` was introduced into the replace process to meet some of those needs.  However, that function tries too forcefully to convert the original Block (and it does so before it even finishes replacing values!), and thus we get an OverflowError in this case.\r\n\r\nAn easy fix to this is to just add `OverflowError ` to the list of errors `coerce_to_target_dtype` can catch ([here](https://github.com/pandas-dev/pandas/blob/master/pandas/core/internals/blocks.py#L1082)), which would fix this and retain other existing functionality.  However, I'm not sure if `coerce_to_target_dtype` is *meant* to fail in the case of an int that is too large.\r\n\r\nIf we can't change that, a much more narrow fix would be to only call `coerce_to_target_dtype` after the last replacement is done, but that doesn't some other cases that the old code could handle (for instance: replacing one of those values in the example instead of both of them).\r\n\r\nI couldn't see a fix we could make to `ObjectBlock.convert` to handle all conversions without needing to call `coerce_to_target_dtype`.  I'm guessing this has to do with numpy changes, or perhaps changes to `maybe_convert_objects`, but I'm not sure."
  },
  {
    "url": "https://api.github.com/repos/pandas-dev/pandas/issues/comments/471339338",
    "html_url": "https://github.com/pandas-dev/pandas/issues/25616#issuecomment-471339338",
    "issue_url": "https://api.github.com/repos/pandas-dev/pandas/issues/25616",
    "id": 471339338,
    "node_id": "MDEyOklzc3VlQ29tbWVudDQ3MTMzOTMzOA==",
    "user": {
      "login": "WillAyd",
      "id": 609873,
      "node_id": "MDQ6VXNlcjYwOTg3Mw==",
      "avatar_url": "https://avatars0.githubusercontent.com/u/609873?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/WillAyd",
      "html_url": "https://github.com/WillAyd",
      "followers_url": "https://api.github.com/users/WillAyd/followers",
      "following_url": "https://api.github.com/users/WillAyd/following{/other_user}",
      "gists_url": "https://api.github.com/users/WillAyd/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/WillAyd/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/WillAyd/subscriptions",
      "organizations_url": "https://api.github.com/users/WillAyd/orgs",
      "repos_url": "https://api.github.com/users/WillAyd/repos",
      "events_url": "https://api.github.com/users/WillAyd/events{/privacy}",
      "received_events_url": "https://api.github.com/users/WillAyd/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2019-03-10T20:06:50Z",
    "updated_at": "2019-03-10T20:06:50Z",
    "author_association": "MEMBER",
    "body": "@ArtificialQualia thanks a lot for your input!\r\n\r\n> However, that function tries too forcefully to convert the original Block (and it does so before it even finishes replacing values!\r\n\r\nI haven't stepped through the code myself but this seems to be the actual root issue - have you tried debugging this behavior to see if a fix can be applied to prevent this?"
  },
  {
    "url": "https://api.github.com/repos/pandas-dev/pandas/issues/comments/471341403",
    "html_url": "https://github.com/pandas-dev/pandas/issues/25616#issuecomment-471341403",
    "issue_url": "https://api.github.com/repos/pandas-dev/pandas/issues/25616",
    "id": 471341403,
    "node_id": "MDEyOklzc3VlQ29tbWVudDQ3MTM0MTQwMw==",
    "user": {
      "login": "ArtificialQualia",
      "id": 25773476,
      "node_id": "MDQ6VXNlcjI1NzczNDc2",
      "avatar_url": "https://avatars1.githubusercontent.com/u/25773476?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/ArtificialQualia",
      "html_url": "https://github.com/ArtificialQualia",
      "followers_url": "https://api.github.com/users/ArtificialQualia/followers",
      "following_url": "https://api.github.com/users/ArtificialQualia/following{/other_user}",
      "gists_url": "https://api.github.com/users/ArtificialQualia/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/ArtificialQualia/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/ArtificialQualia/subscriptions",
      "organizations_url": "https://api.github.com/users/ArtificialQualia/orgs",
      "repos_url": "https://api.github.com/users/ArtificialQualia/repos",
      "events_url": "https://api.github.com/users/ArtificialQualia/events{/privacy}",
      "received_events_url": "https://api.github.com/users/ArtificialQualia/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2019-03-10T20:32:29Z",
    "updated_at": "2019-03-10T20:32:29Z",
    "author_association": "CONTRIBUTOR",
    "body": "@WillAyd \r\n\r\nI did try both the fixes I mentioned in my comment.  They fix the issue mentioned in this issue, as well as passing all the tests in `tests\\series\\test_replace.py`.\r\n\r\nIf you want my recommendation, I would add `OverflowError` to `coerce_to_target_dtype` @ [line 1082](https://github.com/pandas-dev/pandas/blob/master/pandas/core/internals/blocks.py#L1082) and also move the call to `coerce_to_target_dtype` in `_replace_coerce` to after `putmask` so the coercion happens after the replacement.  Possibly also add in a `if convert:` around the `coerce_to_target_dtype` call so it only happens on the last entry, which is similar to how `ObjectBlock.convert` works which I'm assuming is for performance reasons."
  },
  {
    "url": "https://api.github.com/repos/pandas-dev/pandas/issues/comments/471342149",
    "html_url": "https://github.com/pandas-dev/pandas/issues/25616#issuecomment-471342149",
    "issue_url": "https://api.github.com/repos/pandas-dev/pandas/issues/25616",
    "id": 471342149,
    "node_id": "MDEyOklzc3VlQ29tbWVudDQ3MTM0MjE0OQ==",
    "user": {
      "login": "WillAyd",
      "id": 609873,
      "node_id": "MDQ6VXNlcjYwOTg3Mw==",
      "avatar_url": "https://avatars0.githubusercontent.com/u/609873?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/WillAyd",
      "html_url": "https://github.com/WillAyd",
      "followers_url": "https://api.github.com/users/WillAyd/followers",
      "following_url": "https://api.github.com/users/WillAyd/following{/other_user}",
      "gists_url": "https://api.github.com/users/WillAyd/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/WillAyd/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/WillAyd/subscriptions",
      "organizations_url": "https://api.github.com/users/WillAyd/orgs",
      "repos_url": "https://api.github.com/users/WillAyd/repos",
      "events_url": "https://api.github.com/users/WillAyd/events{/privacy}",
      "received_events_url": "https://api.github.com/users/WillAyd/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2019-03-10T20:40:25Z",
    "updated_at": "2019-03-10T20:40:25Z",
    "author_association": "MEMBER",
    "body": "@ArtificialQualia if you'd like to submit a PR would probably be easier to review and give you feedback with that. Thanks again!"
  },
  {
    "url": "https://api.github.com/repos/pandas-dev/pandas/issues/comments/471343064",
    "html_url": "https://github.com/pandas-dev/pandas/issues/25616#issuecomment-471343064",
    "issue_url": "https://api.github.com/repos/pandas-dev/pandas/issues/25616",
    "id": 471343064,
    "node_id": "MDEyOklzc3VlQ29tbWVudDQ3MTM0MzA2NA==",
    "user": {
      "login": "ArtificialQualia",
      "id": 25773476,
      "node_id": "MDQ6VXNlcjI1NzczNDc2",
      "avatar_url": "https://avatars1.githubusercontent.com/u/25773476?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/ArtificialQualia",
      "html_url": "https://github.com/ArtificialQualia",
      "followers_url": "https://api.github.com/users/ArtificialQualia/followers",
      "following_url": "https://api.github.com/users/ArtificialQualia/following{/other_user}",
      "gists_url": "https://api.github.com/users/ArtificialQualia/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/ArtificialQualia/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/ArtificialQualia/subscriptions",
      "organizations_url": "https://api.github.com/users/ArtificialQualia/orgs",
      "repos_url": "https://api.github.com/users/ArtificialQualia/repos",
      "events_url": "https://api.github.com/users/ArtificialQualia/events{/privacy}",
      "received_events_url": "https://api.github.com/users/ArtificialQualia/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2019-03-10T20:49:50Z",
    "updated_at": "2019-03-10T20:49:50Z",
    "author_association": "CONTRIBUTOR",
    "body": "No problem, I'll submit a PR."
  }
]
