[
  {
    "url": "https://api.github.com/repos/pandas-dev/pandas/issues/comments/314608151",
    "html_url": "https://github.com/pandas-dev/pandas/issues/16889#issuecomment-314608151",
    "issue_url": "https://api.github.com/repos/pandas-dev/pandas/issues/16889",
    "id": 314608151,
    "node_id": "MDEyOklzc3VlQ29tbWVudDMxNDYwODE1MQ==",
    "user": {
      "login": "hhuuggoo",
      "id": 249407,
      "node_id": "MDQ6VXNlcjI0OTQwNw==",
      "avatar_url": "https://avatars2.githubusercontent.com/u/249407?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/hhuuggoo",
      "html_url": "https://github.com/hhuuggoo",
      "followers_url": "https://api.github.com/users/hhuuggoo/followers",
      "following_url": "https://api.github.com/users/hhuuggoo/following{/other_user}",
      "gists_url": "https://api.github.com/users/hhuuggoo/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/hhuuggoo/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/hhuuggoo/subscriptions",
      "organizations_url": "https://api.github.com/users/hhuuggoo/orgs",
      "repos_url": "https://api.github.com/users/hhuuggoo/repos",
      "events_url": "https://api.github.com/users/hhuuggoo/events{/privacy}",
      "received_events_url": "https://api.github.com/users/hhuuggoo/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2017-07-12T00:18:52Z",
    "updated_at": "2017-07-12T00:18:52Z",
    "author_association": "CONTRIBUTOR",
    "body": "The problem seems to be related to how `.loc` is being used.  The following code fixes the issue\r\n\r\n```\r\ndf.loc[mask] = fill.loc[mask]\r\n```"
  },
  {
    "url": "https://api.github.com/repos/pandas-dev/pandas/issues/comments/314790351",
    "html_url": "https://github.com/pandas-dev/pandas/issues/16889#issuecomment-314790351",
    "issue_url": "https://api.github.com/repos/pandas-dev/pandas/issues/16889",
    "id": 314790351,
    "node_id": "MDEyOklzc3VlQ29tbWVudDMxNDc5MDM1MQ==",
    "user": {
      "login": "hhuuggoo",
      "id": 249407,
      "node_id": "MDQ6VXNlcjI0OTQwNw==",
      "avatar_url": "https://avatars2.githubusercontent.com/u/249407?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/hhuuggoo",
      "html_url": "https://github.com/hhuuggoo",
      "followers_url": "https://api.github.com/users/hhuuggoo/followers",
      "following_url": "https://api.github.com/users/hhuuggoo/following{/other_user}",
      "gists_url": "https://api.github.com/users/hhuuggoo/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/hhuuggoo/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/hhuuggoo/subscriptions",
      "organizations_url": "https://api.github.com/users/hhuuggoo/orgs",
      "repos_url": "https://api.github.com/users/hhuuggoo/repos",
      "events_url": "https://api.github.com/users/hhuuggoo/events{/privacy}",
      "received_events_url": "https://api.github.com/users/hhuuggoo/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2017-07-12T14:39:37Z",
    "updated_at": "2017-07-12T14:43:54Z",
    "author_association": "CONTRIBUTOR",
    "body": "So i've dug a bit further.  This line, \r\n\r\nhttps://github.com/pandas-dev/pandas/blob/master/pandas/core/indexing.py#L764\r\n\r\nconverts the DatetimeIndex into a datetime64[ns] NumPy array.\r\n\r\nreindexing a tz-aware DatetimeIndex  with a datetime64[ns] NumPy array does not work, whereas reindexing a non tz-aware DatetimeIndex with a datetime64[ns] NumPy array does work.  It's unclear to me whether the initial conversion to the NumPy array is the problem, or if it's the re-indexing operation which should work.\r\n\r\nThis little snippet illustrates the reindexing behavior:\r\n\r\n```\r\nidx = pd.date_range('20010101', '20020101')[:4].tz_localize('UTC')\r\ndf = pd.DataFrame({'a' : np.arange(4)}, index=idx).astype('float64')\r\nprint df.reindex(index=df.index[[0, 1]])\r\nprint df.reindex(index=df.index[[0, 1]].values)\r\n\r\nidx = pd.date_range('20010101', '20020101')[:4]\r\ndf2 = pd.DataFrame({'a' : np.arange(4)}, index=idx).astype('float64')\r\nprint df2.reindex(index=df2.index[[0, 1]])\r\nprint df2.reindex(index=df2.index[[0, 1]].values)\r\n```\r\nThe output I get is:\r\n\r\n```\r\n                             a\r\n2001-01-01 00:00:00+00:00  0.0\r\n2001-01-02 00:00:00+00:00  1.0\r\n             a\r\n2001-01-01 NaN\r\n2001-01-02 NaN\r\n              a\r\n2001-01-01  0.0\r\n2001-01-02  1.0\r\n              a\r\n2001-01-01  0.0\r\n2001-01-02  1.0\r\n```\r\nI'm concerned by this - This is pretty core functionality, and it seems to have been broken from 0.17-0.20.  Should we stop using tz-aware DatetimeIndexes?\r\n\r\nThanks for any guidance\r\n\r\n"
  },
  {
    "url": "https://api.github.com/repos/pandas-dev/pandas/issues/comments/314793492",
    "html_url": "https://github.com/pandas-dev/pandas/issues/16889#issuecomment-314793492",
    "issue_url": "https://api.github.com/repos/pandas-dev/pandas/issues/16889",
    "id": 314793492,
    "node_id": "MDEyOklzc3VlQ29tbWVudDMxNDc5MzQ5Mg==",
    "user": {
      "login": "jreback",
      "id": 953992,
      "node_id": "MDQ6VXNlcjk1Mzk5Mg==",
      "avatar_url": "https://avatars2.githubusercontent.com/u/953992?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/jreback",
      "html_url": "https://github.com/jreback",
      "followers_url": "https://api.github.com/users/jreback/followers",
      "following_url": "https://api.github.com/users/jreback/following{/other_user}",
      "gists_url": "https://api.github.com/users/jreback/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/jreback/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/jreback/subscriptions",
      "organizations_url": "https://api.github.com/users/jreback/orgs",
      "repos_url": "https://api.github.com/users/jreback/repos",
      "events_url": "https://api.github.com/users/jreback/events{/privacy}",
      "received_events_url": "https://api.github.com/users/jreback/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2017-07-12T14:49:04Z",
    "updated_at": "2017-07-12T14:49:04Z",
    "author_association": "CONTRIBUTOR",
    "body": "> I'm concerned by this - This is pretty core functionality, and it seems to have been broken from 0.17-0.20. Should we stop using tz-aware DatetimeIndexes?\r\n\r\nwell DTI tz-aware were refactored in 0.17 to make them way more performant. Sure there may be some bugs out there. PR's to fix are welcome.\r\n\r\n```\r\n(pandas) bash-3.2$ git diff\r\ndiff --git a/pandas/core/indexing.py b/pandas/core/indexing.py\r\nindex ae0aaf9..4fe8942 100755\r\n--- a/pandas/core/indexing.py\r\n+++ b/pandas/core/indexing.py\r\n@@ -761,9 +761,9 @@ class _NDFrameIndexer(object):\r\n                 ax = self.obj.axes[i]\r\n                 if is_sequence(ix) or isinstance(ix, slice):\r\n                     if idx is None:\r\n-                        idx = ax[ix].ravel()\r\n+                        idx = ax[ix]\r\n                     elif cols is None:\r\n-                        cols = ax[ix].ravel()\r\n+                        cols = ax[ix]\r\n                     else:\r\n                         break\r\n                 else:\r\n```\r\nfixes this case (though need to check whether other things are break).\r\n\r\n"
  },
  {
    "url": "https://api.github.com/repos/pandas-dev/pandas/issues/comments/314796851",
    "html_url": "https://github.com/pandas-dev/pandas/issues/16889#issuecomment-314796851",
    "issue_url": "https://api.github.com/repos/pandas-dev/pandas/issues/16889",
    "id": 314796851,
    "node_id": "MDEyOklzc3VlQ29tbWVudDMxNDc5Njg1MQ==",
    "user": {
      "login": "hhuuggoo",
      "id": 249407,
      "node_id": "MDQ6VXNlcjI0OTQwNw==",
      "avatar_url": "https://avatars2.githubusercontent.com/u/249407?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/hhuuggoo",
      "html_url": "https://github.com/hhuuggoo",
      "followers_url": "https://api.github.com/users/hhuuggoo/followers",
      "following_url": "https://api.github.com/users/hhuuggoo/following{/other_user}",
      "gists_url": "https://api.github.com/users/hhuuggoo/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/hhuuggoo/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/hhuuggoo/subscriptions",
      "organizations_url": "https://api.github.com/users/hhuuggoo/orgs",
      "repos_url": "https://api.github.com/users/hhuuggoo/repos",
      "events_url": "https://api.github.com/users/hhuuggoo/events{/privacy}",
      "received_events_url": "https://api.github.com/users/hhuuggoo/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2017-07-12T14:59:02Z",
    "updated_at": "2017-07-12T14:59:02Z",
    "author_association": "CONTRIBUTOR",
    "body": "Thanks, I'll give it a shot"
  },
  {
    "url": "https://api.github.com/repos/pandas-dev/pandas/issues/comments/314824769",
    "html_url": "https://github.com/pandas-dev/pandas/issues/16889#issuecomment-314824769",
    "issue_url": "https://api.github.com/repos/pandas-dev/pandas/issues/16889",
    "id": 314824769,
    "node_id": "MDEyOklzc3VlQ29tbWVudDMxNDgyNDc2OQ==",
    "user": {
      "login": "hhuuggoo",
      "id": 249407,
      "node_id": "MDQ6VXNlcjI0OTQwNw==",
      "avatar_url": "https://avatars2.githubusercontent.com/u/249407?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/hhuuggoo",
      "html_url": "https://github.com/hhuuggoo",
      "followers_url": "https://api.github.com/users/hhuuggoo/followers",
      "following_url": "https://api.github.com/users/hhuuggoo/following{/other_user}",
      "gists_url": "https://api.github.com/users/hhuuggoo/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/hhuuggoo/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/hhuuggoo/subscriptions",
      "organizations_url": "https://api.github.com/users/hhuuggoo/orgs",
      "repos_url": "https://api.github.com/users/hhuuggoo/repos",
      "events_url": "https://api.github.com/users/hhuuggoo/events{/privacy}",
      "received_events_url": "https://api.github.com/users/hhuuggoo/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2017-07-12T16:33:06Z",
    "updated_at": "2017-07-12T16:33:06Z",
    "author_association": "CONTRIBUTOR",
    "body": "taking out the ravel breaks some of the iloc test cases - it seems that data comes in sometimes looking like the output of np.ix_\r\n\r\n```\r\n(array([[0],\r\n       [1]]), array([[1, 2]]))\r\n```\r\n\r\nHowever if I do this, all the indexing tests pass (as well as my broken example)\r\n\r\n```\r\n            for i, ix in enumerate(indexer):\r\n                ax = self.obj.axes[i]\r\n                if is_sequence(ix) or isinstance(ix, slice):\r\n                    if isinstance(ix, np.ndarray):\r\n                        ix = ix.ravel()\r\n                    if idx is None:\r\n                        idx = ax[ix]\r\n                    elif cols is None:\r\n                        cols = ax[ix]\r\n                    else:\r\n                        break\r\n                else:\r\n                    sindexers.append(i)\r\n```\r\n\r\nThis seems more correct to me, but I'm not to familiar with how pandas indexing is implemented"
  }
]
