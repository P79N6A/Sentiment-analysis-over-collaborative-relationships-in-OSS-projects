[
  {
    "url": "https://api.github.com/repos/pandas-dev/pandas/issues/comments/52566989",
    "html_url": "https://github.com/pandas-dev/pandas/issues/8065#issuecomment-52566989",
    "issue_url": "https://api.github.com/repos/pandas-dev/pandas/issues/8065",
    "id": 52566989,
    "node_id": "MDEyOklzc3VlQ29tbWVudDUyNTY2OTg5",
    "user": {
      "login": "jreback",
      "id": 953992,
      "node_id": "MDQ6VXNlcjk1Mzk5Mg==",
      "avatar_url": "https://avatars2.githubusercontent.com/u/953992?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/jreback",
      "html_url": "https://github.com/jreback",
      "followers_url": "https://api.github.com/users/jreback/followers",
      "following_url": "https://api.github.com/users/jreback/following{/other_user}",
      "gists_url": "https://api.github.com/users/jreback/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/jreback/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/jreback/subscriptions",
      "organizations_url": "https://api.github.com/users/jreback/orgs",
      "repos_url": "https://api.github.com/users/jreback/repos",
      "events_url": "https://api.github.com/users/jreback/events{/privacy}",
      "received_events_url": "https://api.github.com/users/jreback/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2014-08-18T22:56:02Z",
    "updated_at": "2014-08-18T22:56:02Z",
    "author_association": "CONTRIBUTOR",
    "body": "cc @JanSchulz maybe need some inference on the returned categoricals\n"
  },
  {
    "url": "https://api.github.com/repos/pandas-dev/pandas/issues/comments/52637294",
    "html_url": "https://github.com/pandas-dev/pandas/issues/8065#issuecomment-52637294",
    "issue_url": "https://api.github.com/repos/pandas-dev/pandas/issues/8065",
    "id": 52637294,
    "node_id": "MDEyOklzc3VlQ29tbWVudDUyNjM3Mjk0",
    "user": {
      "login": "jankatins",
      "id": 890156,
      "node_id": "MDQ6VXNlcjg5MDE1Ng==",
      "avatar_url": "https://avatars3.githubusercontent.com/u/890156?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/jankatins",
      "html_url": "https://github.com/jankatins",
      "followers_url": "https://api.github.com/users/jankatins/followers",
      "following_url": "https://api.github.com/users/jankatins/following{/other_user}",
      "gists_url": "https://api.github.com/users/jankatins/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/jankatins/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/jankatins/subscriptions",
      "organizations_url": "https://api.github.com/users/jankatins/orgs",
      "repos_url": "https://api.github.com/users/jankatins/repos",
      "events_url": "https://api.github.com/users/jankatins/events{/privacy}",
      "received_events_url": "https://api.github.com/users/jankatins/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2014-08-19T13:56:59Z",
    "updated_at": "2014-08-19T14:04:08Z",
    "author_association": "CONTRIBUTOR",
    "body": "Ok, here are multiple issues:\n- qcut should return a ordered categorical\n- `df.groupby('grp')['x'].transform(pd.qcut, 3)` should (almost) never work, as the returned categoricals have different levels and so can't be concat'ed into one Series\n- The error message is wrong: It should be about \"Categoricals with different levels can't be merged into one Series\" and not that something can't be converted to float. \n\nOne problem is that in case of categorical the `as_type(common_type)` doesn't work, as it never sees a categorical because the common_type is constructed from `np.asarray(res)` and is therefore not a cat anymore. On the other hand this is wrong a lot earlier: `result = self._selected_obj.values.copy()` -> this is leading to trouble, as the result type has nothing to do with the inputs  -> categorical must be special cased here :-(\n\nIMO the best way would be to construct a Series when we have the first `res` but with the `index` of the input. Not sure if that actually works (different length: index has all, res only for one group).\n\n@jreback: can you merge the fixup PR, then I can submit a new PR for this one without the need to rebase constantly the whole PR.\n"
  },
  {
    "url": "https://api.github.com/repos/pandas-dev/pandas/issues/comments/52637676",
    "html_url": "https://github.com/pandas-dev/pandas/issues/8065#issuecomment-52637676",
    "issue_url": "https://api.github.com/repos/pandas-dev/pandas/issues/8065",
    "id": 52637676,
    "node_id": "MDEyOklzc3VlQ29tbWVudDUyNjM3Njc2",
    "user": {
      "login": "jreback",
      "id": 953992,
      "node_id": "MDQ6VXNlcjk1Mzk5Mg==",
      "avatar_url": "https://avatars2.githubusercontent.com/u/953992?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/jreback",
      "html_url": "https://github.com/jreback",
      "followers_url": "https://api.github.com/users/jreback/followers",
      "following_url": "https://api.github.com/users/jreback/following{/other_user}",
      "gists_url": "https://api.github.com/users/jreback/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/jreback/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/jreback/subscriptions",
      "organizations_url": "https://api.github.com/users/jreback/orgs",
      "repos_url": "https://api.github.com/users/jreback/repos",
      "events_url": "https://api.github.com/users/jreback/events{/privacy}",
      "received_events_url": "https://api.github.com/users/jreback/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2014-08-19T13:59:12Z",
    "updated_at": "2014-08-19T13:59:12Z",
    "author_association": "CONTRIBUTOR",
    "body": "@JanSchulz ok, fixups merged.\n\nyeh the `transform(pd.qcut,3)` is a little bogus , not saying it _should_ work, just better error message\n"
  },
  {
    "url": "https://api.github.com/repos/pandas-dev/pandas/issues/comments/57033162",
    "html_url": "https://github.com/pandas-dev/pandas/issues/8065#issuecomment-57033162",
    "issue_url": "https://api.github.com/repos/pandas-dev/pandas/issues/8065",
    "id": 57033162,
    "node_id": "MDEyOklzc3VlQ29tbWVudDU3MDMzMTYy",
    "user": {
      "login": "jreback",
      "id": 953992,
      "node_id": "MDQ6VXNlcjk1Mzk5Mg==",
      "avatar_url": "https://avatars2.githubusercontent.com/u/953992?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/jreback",
      "html_url": "https://github.com/jreback",
      "followers_url": "https://api.github.com/users/jreback/followers",
      "following_url": "https://api.github.com/users/jreback/following{/other_user}",
      "gists_url": "https://api.github.com/users/jreback/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/jreback/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/jreback/subscriptions",
      "organizations_url": "https://api.github.com/users/jreback/orgs",
      "repos_url": "https://api.github.com/users/jreback/repos",
      "events_url": "https://api.github.com/users/jreback/events{/privacy}",
      "received_events_url": "https://api.github.com/users/jreback/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2014-09-26T23:31:42Z",
    "updated_at": "2014-09-26T23:31:42Z",
    "author_association": "CONTRIBUTOR",
    "body": "@JanSchulz if you get to this before 0.15 ok, otherwise will push it (I may take a look as well).\n"
  },
  {
    "url": "https://api.github.com/repos/pandas-dev/pandas/issues/comments/57062748",
    "html_url": "https://github.com/pandas-dev/pandas/issues/8065#issuecomment-57062748",
    "issue_url": "https://api.github.com/repos/pandas-dev/pandas/issues/8065",
    "id": 57062748,
    "node_id": "MDEyOklzc3VlQ29tbWVudDU3MDYyNzQ4",
    "user": {
      "login": "jankatins",
      "id": 890156,
      "node_id": "MDQ6VXNlcjg5MDE1Ng==",
      "avatar_url": "https://avatars3.githubusercontent.com/u/890156?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/jankatins",
      "html_url": "https://github.com/jankatins",
      "followers_url": "https://api.github.com/users/jankatins/followers",
      "following_url": "https://api.github.com/users/jankatins/following{/other_user}",
      "gists_url": "https://api.github.com/users/jankatins/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/jankatins/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/jankatins/subscriptions",
      "organizations_url": "https://api.github.com/users/jankatins/orgs",
      "repos_url": "https://api.github.com/users/jankatins/repos",
      "events_url": "https://api.github.com/users/jankatins/events{/privacy}",
      "received_events_url": "https://api.github.com/users/jankatins/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2014-09-27T19:18:02Z",
    "updated_at": "2014-09-27T19:18:02Z",
    "author_association": "CONTRIBUTOR",
    "body": "Let's see if I find time tomorrow and if not it will have to wait until after my holidays :-/ The first point is addressed (qcut returns a ordered categorical).\n"
  },
  {
    "url": "https://api.github.com/repos/pandas-dev/pandas/issues/comments/57124750",
    "html_url": "https://github.com/pandas-dev/pandas/issues/8065#issuecomment-57124750",
    "issue_url": "https://api.github.com/repos/pandas-dev/pandas/issues/8065",
    "id": 57124750,
    "node_id": "MDEyOklzc3VlQ29tbWVudDU3MTI0NzUw",
    "user": {
      "login": "jankatins",
      "id": 890156,
      "node_id": "MDQ6VXNlcjg5MDE1Ng==",
      "avatar_url": "https://avatars3.githubusercontent.com/u/890156?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/jankatins",
      "html_url": "https://github.com/jankatins",
      "followers_url": "https://api.github.com/users/jankatins/followers",
      "following_url": "https://api.github.com/users/jankatins/following{/other_user}",
      "gists_url": "https://api.github.com/users/jankatins/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/jankatins/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/jankatins/subscriptions",
      "organizations_url": "https://api.github.com/users/jankatins/orgs",
      "repos_url": "https://api.github.com/users/jankatins/repos",
      "events_url": "https://api.github.com/users/jankatins/events{/privacy}",
      "received_events_url": "https://api.github.com/users/jankatins/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2014-09-29T07:20:17Z",
    "updated_at": "2014-09-29T12:36:45Z",
    "author_association": "CONTRIBUTOR",
    "body": "This is not easy, this is the current code:\n\n```\n       dtype = self._selected_obj.dtype\n        result = self._selected_obj.values.copy()\n\n        wrapper = lambda x: func(x, *args, **kwargs)\n        for i, (name, group) in enumerate(self):\n\n            object.__setattr__(group, 'name', name)\n            res = wrapper(group)\n\n            if hasattr(res, 'values'):\n                res = res.values\n\n            # may need to astype\n            try:\n                common_type = np.common_type(np.array(res), result)\n                if common_type != result.dtype:\n                    result = result.astype(common_type)\n            except:\n                pass\n\n            indexer = self._get_index(name)\n            result[indexer] = res\n\n        result = _possibly_downcast_to_dtype(result, dtype)\n```\n\nBut this is not going to work with categoricals, because it stuffs the new values together with the old ones which will always convert the categoricals to a numpy type. There are three possible ways:\n- Rewrite the the function to use concat if res is Categorical (which will probably not be performant...)\n- simple throw a warning (categorical converted to string/number) or an error (categoricals can't be used in transform/....)\n- document that using transforms and returned categorical data is \"undefined behaviour\" and probbly not going to work\n\nThe \"throw an error\" variant is not always \"correct\", because one could return a categorical with the same categories for all groups and this should actually succeed.\n"
  },
  {
    "url": "https://api.github.com/repos/pandas-dev/pandas/issues/comments/57153990",
    "html_url": "https://github.com/pandas-dev/pandas/issues/8065#issuecomment-57153990",
    "issue_url": "https://api.github.com/repos/pandas-dev/pandas/issues/8065",
    "id": 57153990,
    "node_id": "MDEyOklzc3VlQ29tbWVudDU3MTUzOTkw",
    "user": {
      "login": "jankatins",
      "id": 890156,
      "node_id": "MDQ6VXNlcjg5MDE1Ng==",
      "avatar_url": "https://avatars3.githubusercontent.com/u/890156?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/jankatins",
      "html_url": "https://github.com/jankatins",
      "followers_url": "https://api.github.com/users/jankatins/followers",
      "following_url": "https://api.github.com/users/jankatins/following{/other_user}",
      "gists_url": "https://api.github.com/users/jankatins/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/jankatins/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/jankatins/subscriptions",
      "organizations_url": "https://api.github.com/users/jankatins/orgs",
      "repos_url": "https://api.github.com/users/jankatins/repos",
      "events_url": "https://api.github.com/users/jankatins/events{/privacy}",
      "received_events_url": "https://api.github.com/users/jankatins/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2014-09-29T12:37:07Z",
    "updated_at": "2014-09-29T12:37:07Z",
    "author_association": "CONTRIBUTOR",
    "body": "@jreback can you comment here?\n"
  },
  {
    "url": "https://api.github.com/repos/pandas-dev/pandas/issues/comments/57157181",
    "html_url": "https://github.com/pandas-dev/pandas/issues/8065#issuecomment-57157181",
    "issue_url": "https://api.github.com/repos/pandas-dev/pandas/issues/8065",
    "id": 57157181,
    "node_id": "MDEyOklzc3VlQ29tbWVudDU3MTU3MTgx",
    "user": {
      "login": "jreback",
      "id": 953992,
      "node_id": "MDQ6VXNlcjk1Mzk5Mg==",
      "avatar_url": "https://avatars2.githubusercontent.com/u/953992?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/jreback",
      "html_url": "https://github.com/jreback",
      "followers_url": "https://api.github.com/users/jreback/followers",
      "following_url": "https://api.github.com/users/jreback/following{/other_user}",
      "gists_url": "https://api.github.com/users/jreback/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/jreback/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/jreback/subscriptions",
      "organizations_url": "https://api.github.com/users/jreback/orgs",
      "repos_url": "https://api.github.com/users/jreback/repos",
      "events_url": "https://api.github.com/users/jreback/events{/privacy}",
      "received_events_url": "https://api.github.com/users/jreback/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2014-09-29T13:05:58Z",
    "updated_at": "2014-09-29T13:05:58Z",
    "author_association": "CONTRIBUTOR",
    "body": "@JanSchulz let me take a look.\n"
  },
  {
    "url": "https://api.github.com/repos/pandas-dev/pandas/issues/comments/57171327",
    "html_url": "https://github.com/pandas-dev/pandas/issues/8065#issuecomment-57171327",
    "issue_url": "https://api.github.com/repos/pandas-dev/pandas/issues/8065",
    "id": 57171327,
    "node_id": "MDEyOklzc3VlQ29tbWVudDU3MTcxMzI3",
    "user": {
      "login": "jreback",
      "id": 953992,
      "node_id": "MDQ6VXNlcjk1Mzk5Mg==",
      "avatar_url": "https://avatars2.githubusercontent.com/u/953992?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/jreback",
      "html_url": "https://github.com/jreback",
      "followers_url": "https://api.github.com/users/jreback/followers",
      "following_url": "https://api.github.com/users/jreback/following{/other_user}",
      "gists_url": "https://api.github.com/users/jreback/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/jreback/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/jreback/subscriptions",
      "organizations_url": "https://api.github.com/users/jreback/orgs",
      "repos_url": "https://api.github.com/users/jreback/repos",
      "events_url": "https://api.github.com/users/jreback/events{/privacy}",
      "received_events_url": "https://api.github.com/users/jreback/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2014-09-29T14:44:46Z",
    "updated_at": "2014-09-29T14:44:46Z",
    "author_association": "CONTRIBUTOR",
    "body": "@JanSchulz this is related to #7883 \n\nThe issue is that I did a short-cut to make Series.transformation fast. But that didn't with multiple-dtypes well.\n\nSo have to defer this (as you _can_ use the work-around I suggested in this issue). We can fix for 0.15.1.\n"
  },
  {
    "url": "https://api.github.com/repos/pandas-dev/pandas/issues/comments/403166081",
    "html_url": "https://github.com/pandas-dev/pandas/issues/8065#issuecomment-403166081",
    "issue_url": "https://api.github.com/repos/pandas-dev/pandas/issues/8065",
    "id": 403166081,
    "node_id": "MDEyOklzc3VlQ29tbWVudDQwMzE2NjA4MQ==",
    "user": {
      "login": "TomAugspurger",
      "id": 1312546,
      "node_id": "MDQ6VXNlcjEzMTI1NDY=",
      "avatar_url": "https://avatars3.githubusercontent.com/u/1312546?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/TomAugspurger",
      "html_url": "https://github.com/TomAugspurger",
      "followers_url": "https://api.github.com/users/TomAugspurger/followers",
      "following_url": "https://api.github.com/users/TomAugspurger/following{/other_user}",
      "gists_url": "https://api.github.com/users/TomAugspurger/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/TomAugspurger/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/TomAugspurger/subscriptions",
      "organizations_url": "https://api.github.com/users/TomAugspurger/orgs",
      "repos_url": "https://api.github.com/users/TomAugspurger/repos",
      "events_url": "https://api.github.com/users/TomAugspurger/events{/privacy}",
      "received_events_url": "https://api.github.com/users/TomAugspurger/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2018-07-06T22:58:12Z",
    "updated_at": "2018-07-06T22:58:28Z",
    "author_association": "CONTRIBUTOR",
    "body": "This now returns an object series of Intervals (soon to be an IntervalArray).\r\n\r\nI think the original issue is fixed.\r\n\r\n```python\r\nIn [140]: df.groupby('grp')['x'].transform(pd.qcut, 3)\r\nOut[140]:\r\n0       (0.796, 0.945]\r\n1       (0.571, 0.796]\r\n2       (0.571, 0.796]\r\n```"
  }
]
