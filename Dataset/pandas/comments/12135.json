[
  {
    "url": "https://api.github.com/repos/pandas-dev/pandas/issues/comments/174592370",
    "html_url": "https://github.com/pandas-dev/pandas/pull/12135#issuecomment-174592370",
    "issue_url": "https://api.github.com/repos/pandas-dev/pandas/issues/12135",
    "id": 174592370,
    "node_id": "MDEyOklzc3VlQ29tbWVudDE3NDU5MjM3MA==",
    "user": {
      "login": "wesm",
      "id": 329591,
      "node_id": "MDQ6VXNlcjMyOTU5MQ==",
      "avatar_url": "https://avatars2.githubusercontent.com/u/329591?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/wesm",
      "html_url": "https://github.com/wesm",
      "followers_url": "https://api.github.com/users/wesm/followers",
      "following_url": "https://api.github.com/users/wesm/following{/other_user}",
      "gists_url": "https://api.github.com/users/wesm/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/wesm/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/wesm/subscriptions",
      "organizations_url": "https://api.github.com/users/wesm/orgs",
      "repos_url": "https://api.github.com/users/wesm/repos",
      "events_url": "https://api.github.com/users/wesm/events{/privacy}",
      "received_events_url": "https://api.github.com/users/wesm/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2016-01-25T17:21:20Z",
    "updated_at": "2016-01-25T17:21:20Z",
    "author_association": "MEMBER",
    "body": "How large is the data file that's required to reproduce this? Since we understand the underlying cause now, we may be able to construct a much smaller one, maybe by appending garbage bytes to the end of a valid gzip file (which will cause the decompressor to fail and raise an exception, triggering this error, hopefully). \n"
  },
  {
    "url": "https://api.github.com/repos/pandas-dev/pandas/issues/comments/174592441",
    "html_url": "https://github.com/pandas-dev/pandas/pull/12135#issuecomment-174592441",
    "issue_url": "https://api.github.com/repos/pandas-dev/pandas/issues/12135",
    "id": 174592441,
    "node_id": "MDEyOklzc3VlQ29tbWVudDE3NDU5MjQ0MQ==",
    "user": {
      "login": "wesm",
      "id": 329591,
      "node_id": "MDQ6VXNlcjMyOTU5MQ==",
      "avatar_url": "https://avatars2.githubusercontent.com/u/329591?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/wesm",
      "html_url": "https://github.com/wesm",
      "followers_url": "https://api.github.com/users/wesm/followers",
      "following_url": "https://api.github.com/users/wesm/following{/other_user}",
      "gists_url": "https://api.github.com/users/wesm/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/wesm/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/wesm/subscriptions",
      "organizations_url": "https://api.github.com/users/wesm/orgs",
      "repos_url": "https://api.github.com/users/wesm/repos",
      "events_url": "https://api.github.com/users/wesm/events{/privacy}",
      "received_events_url": "https://api.github.com/users/wesm/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2016-01-25T17:21:36Z",
    "updated_at": "2016-01-25T17:21:36Z",
    "author_association": "MEMBER",
    "body": "Which is to say I would hate to merge this without a unit test. \n"
  },
  {
    "url": "https://api.github.com/repos/pandas-dev/pandas/issues/comments/174594206",
    "html_url": "https://github.com/pandas-dev/pandas/pull/12135#issuecomment-174594206",
    "issue_url": "https://api.github.com/repos/pandas-dev/pandas/issues/12135",
    "id": 174594206,
    "node_id": "MDEyOklzc3VlQ29tbWVudDE3NDU5NDIwNg==",
    "user": {
      "login": "jreback",
      "id": 953992,
      "node_id": "MDQ6VXNlcjk1Mzk5Mg==",
      "avatar_url": "https://avatars2.githubusercontent.com/u/953992?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/jreback",
      "html_url": "https://github.com/jreback",
      "followers_url": "https://api.github.com/users/jreback/followers",
      "following_url": "https://api.github.com/users/jreback/following{/other_user}",
      "gists_url": "https://api.github.com/users/jreback/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/jreback/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/jreback/subscriptions",
      "organizations_url": "https://api.github.com/users/jreback/orgs",
      "repos_url": "https://api.github.com/users/jreback/repos",
      "events_url": "https://api.github.com/users/jreback/events{/privacy}",
      "received_events_url": "https://api.github.com/users/jreback/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2016-01-25T17:27:37Z",
    "updated_at": "2016-01-25T17:27:37Z",
    "author_association": "CONTRIBUTOR",
    "body": "the example is 10k bytes \nso could use that or try to construct one\n"
  },
  {
    "url": "https://api.github.com/repos/pandas-dev/pandas/issues/comments/174594472",
    "html_url": "https://github.com/pandas-dev/pandas/pull/12135#issuecomment-174594472",
    "issue_url": "https://api.github.com/repos/pandas-dev/pandas/issues/12135",
    "id": 174594472,
    "node_id": "MDEyOklzc3VlQ29tbWVudDE3NDU5NDQ3Mg==",
    "user": {
      "login": "selasley",
      "id": 831833,
      "node_id": "MDQ6VXNlcjgzMTgzMw==",
      "avatar_url": "https://avatars1.githubusercontent.com/u/831833?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/selasley",
      "html_url": "https://github.com/selasley",
      "followers_url": "https://api.github.com/users/selasley/followers",
      "following_url": "https://api.github.com/users/selasley/following{/other_user}",
      "gists_url": "https://api.github.com/users/selasley/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/selasley/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/selasley/subscriptions",
      "organizations_url": "https://api.github.com/users/selasley/orgs",
      "repos_url": "https://api.github.com/users/selasley/repos",
      "events_url": "https://api.github.com/users/selasley/events{/privacy}",
      "received_events_url": "https://api.github.com/users/selasley/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2016-01-25T17:28:37Z",
    "updated_at": "2016-01-25T17:28:37Z",
    "author_association": "NONE",
    "body": "I tried removing parts of the data string from the original poster and tried creating a small corrupted gzip file but was unable to reproduce the segfault.  I'll try a few more small corrupted gzip files to see if I can get something small enough to fit in a unit test.\n"
  },
  {
    "url": "https://api.github.com/repos/pandas-dev/pandas/issues/comments/174596436",
    "html_url": "https://github.com/pandas-dev/pandas/pull/12135#issuecomment-174596436",
    "issue_url": "https://api.github.com/repos/pandas-dev/pandas/issues/12135",
    "id": 174596436,
    "node_id": "MDEyOklzc3VlQ29tbWVudDE3NDU5NjQzNg==",
    "user": {
      "login": "wesm",
      "id": 329591,
      "node_id": "MDQ6VXNlcjMyOTU5MQ==",
      "avatar_url": "https://avatars2.githubusercontent.com/u/329591?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/wesm",
      "html_url": "https://github.com/wesm",
      "followers_url": "https://api.github.com/users/wesm/followers",
      "following_url": "https://api.github.com/users/wesm/following{/other_user}",
      "gists_url": "https://api.github.com/users/wesm/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/wesm/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/wesm/subscriptions",
      "organizations_url": "https://api.github.com/users/wesm/orgs",
      "repos_url": "https://api.github.com/users/wesm/repos",
      "events_url": "https://api.github.com/users/wesm/events{/privacy}",
      "received_events_url": "https://api.github.com/users/wesm/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2016-01-25T17:34:37Z",
    "updated_at": "2016-01-25T17:34:37Z",
    "author_association": "MEMBER",
    "body": "This is tricky because the _first_ file read has to succeed to hit this bug, and the second to fail. So it's a buffer sizing issue (gzip has an internal buffer size)\n"
  },
  {
    "url": "https://api.github.com/repos/pandas-dev/pandas/issues/comments/174612913",
    "html_url": "https://github.com/pandas-dev/pandas/pull/12135#issuecomment-174612913",
    "issue_url": "https://api.github.com/repos/pandas-dev/pandas/issues/12135",
    "id": 174612913,
    "node_id": "MDEyOklzc3VlQ29tbWVudDE3NDYxMjkxMw==",
    "user": {
      "login": "selasley",
      "id": 831833,
      "node_id": "MDQ6VXNlcjgzMTgzMw==",
      "avatar_url": "https://avatars1.githubusercontent.com/u/831833?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/selasley",
      "html_url": "https://github.com/selasley",
      "followers_url": "https://api.github.com/users/selasley/followers",
      "following_url": "https://api.github.com/users/selasley/following{/other_user}",
      "gists_url": "https://api.github.com/users/selasley/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/selasley/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/selasley/subscriptions",
      "organizations_url": "https://api.github.com/users/selasley/orgs",
      "repos_url": "https://api.github.com/users/selasley/repos",
      "events_url": "https://api.github.com/users/selasley/events{/privacy}",
      "received_events_url": "https://api.github.com/users/selasley/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2016-01-25T18:32:44Z",
    "updated_at": "2016-01-25T18:32:44Z",
    "author_association": "NONE",
    "body": "Triggering the segfault varies depending on which python and pandas versions are used.  When I run the example with python2.7.11 and pandas 0.17.1,  read_csv executes 5 times in the loop before the segfault occurs.  The loop executes 9 times before the segfault when run with the latest master of pandas.  On a different Mac running python 2.7.10 and pandas 0.17.1 it loops once then segfaults on the second call to read_csv.  The example runs without segfaulting under python 3.5.1 using BytesIO instead of StringIO.\n"
  },
  {
    "url": "https://api.github.com/repos/pandas-dev/pandas/issues/comments/174614166",
    "html_url": "https://github.com/pandas-dev/pandas/pull/12135#issuecomment-174614166",
    "issue_url": "https://api.github.com/repos/pandas-dev/pandas/issues/12135",
    "id": 174614166,
    "node_id": "MDEyOklzc3VlQ29tbWVudDE3NDYxNDE2Ng==",
    "user": {
      "login": "wesm",
      "id": 329591,
      "node_id": "MDQ6VXNlcjMyOTU5MQ==",
      "avatar_url": "https://avatars2.githubusercontent.com/u/329591?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/wesm",
      "html_url": "https://github.com/wesm",
      "followers_url": "https://api.github.com/users/wesm/followers",
      "following_url": "https://api.github.com/users/wesm/following{/other_user}",
      "gists_url": "https://api.github.com/users/wesm/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/wesm/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/wesm/subscriptions",
      "organizations_url": "https://api.github.com/users/wesm/orgs",
      "repos_url": "https://api.github.com/users/wesm/repos",
      "events_url": "https://api.github.com/users/wesm/events{/privacy}",
      "received_events_url": "https://api.github.com/users/wesm/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2016-01-25T18:37:16Z",
    "updated_at": "2016-01-25T18:37:16Z",
    "author_association": "MEMBER",
    "body": "That's fine, as long as the test is consistently flaky on some platforms. Since we are dealing with a double free issue here it will cause non-deterministic failure. If you run valgrind you'll probably see the invalid deallocation\n"
  },
  {
    "url": "https://api.github.com/repos/pandas-dev/pandas/issues/comments/174868690",
    "html_url": "https://github.com/pandas-dev/pandas/pull/12135#issuecomment-174868690",
    "issue_url": "https://api.github.com/repos/pandas-dev/pandas/issues/12135",
    "id": 174868690,
    "node_id": "MDEyOklzc3VlQ29tbWVudDE3NDg2ODY5MA==",
    "user": {
      "login": "selasley",
      "id": 831833,
      "node_id": "MDQ6VXNlcjgzMTgzMw==",
      "avatar_url": "https://avatars1.githubusercontent.com/u/831833?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/selasley",
      "html_url": "https://github.com/selasley",
      "followers_url": "https://api.github.com/users/selasley/followers",
      "following_url": "https://api.github.com/users/selasley/following{/other_user}",
      "gists_url": "https://api.github.com/users/selasley/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/selasley/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/selasley/subscriptions",
      "organizations_url": "https://api.github.com/users/selasley/orgs",
      "repos_url": "https://api.github.com/users/selasley/repos",
      "events_url": "https://api.github.com/users/selasley/events{/privacy}",
      "received_events_url": "https://api.github.com/users/selasley/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2016-01-26T07:23:18Z",
    "updated_at": "2016-01-26T07:23:18Z",
    "author_association": "NONE",
    "body": "I was able to make a test with a shorter data string that segfaults without the src->buffer = NULL; bug fix\n\n```\ndef test_buffer_rd_bytes(self):\n    # GH 12098\n    # src->buffer can be freed twice leading to a segfault if a corrupt \n    # gzip file is read with read_csv and the buffer is filled more than\n    # once before gzip throws an exception\n\n    data = '\\x1F\\x8B\\x08\\x00\\x00\\x00\\x00\\x00\\x00\\x03\\xED\\xC3\\x41\\x09' \\\n           '\\x00\\x00\\x08\\x00\\xB1\\xB7\\xB6\\xBA\\xFE\\xA5\\xCC\\x21\\x6C\\xB0' \\\n           '\\xA6\\x4D' + '\\x55' * 267 + \\\n           '\\x7D\\xF7\\x00\\x91\\xE0\\x47\\x97\\x14\\x38\\x04\\x00' \\\n           '\\x1f\\x8b\\x08\\x00VT\\x97V\\x00\\x03\\xed]\\xefO'\n    for i in range(100):\n        try:\n            _ = pd.read_csv(StringIO(data),\n                            compression='gzip',\n                            delim_whitespace=True)\n        except Exception as e:\n            pass\n```\n\nI put the test in TestCParserHighMemory and in TestCParserLowMemory.  If that is the proper place for them I will update my PR\n"
  },
  {
    "url": "https://api.github.com/repos/pandas-dev/pandas/issues/comments/175030693",
    "html_url": "https://github.com/pandas-dev/pandas/pull/12135#issuecomment-175030693",
    "issue_url": "https://api.github.com/repos/pandas-dev/pandas/issues/12135",
    "id": 175030693,
    "node_id": "MDEyOklzc3VlQ29tbWVudDE3NTAzMDY5Mw==",
    "user": {
      "login": "jreback",
      "id": 953992,
      "node_id": "MDQ6VXNlcjk1Mzk5Mg==",
      "avatar_url": "https://avatars2.githubusercontent.com/u/953992?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/jreback",
      "html_url": "https://github.com/jreback",
      "followers_url": "https://api.github.com/users/jreback/followers",
      "following_url": "https://api.github.com/users/jreback/following{/other_user}",
      "gists_url": "https://api.github.com/users/jreback/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/jreback/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/jreback/subscriptions",
      "organizations_url": "https://api.github.com/users/jreback/orgs",
      "repos_url": "https://api.github.com/users/jreback/repos",
      "events_url": "https://api.github.com/users/jreback/events{/privacy}",
      "received_events_url": "https://api.github.com/users/jreback/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2016-01-26T14:06:09Z",
    "updated_at": "2016-01-26T14:06:09Z",
    "author_association": "CONTRIBUTOR",
    "body": "looks good, though use `self.read_csv` which will trigger calls based on the parser engine (e.g. c/python). \n"
  },
  {
    "url": "https://api.github.com/repos/pandas-dev/pandas/issues/comments/175678473",
    "html_url": "https://github.com/pandas-dev/pandas/pull/12135#issuecomment-175678473",
    "issue_url": "https://api.github.com/repos/pandas-dev/pandas/issues/12135",
    "id": 175678473,
    "node_id": "MDEyOklzc3VlQ29tbWVudDE3NTY3ODQ3Mw==",
    "user": {
      "login": "jreback",
      "id": 953992,
      "node_id": "MDQ6VXNlcjk1Mzk5Mg==",
      "avatar_url": "https://avatars2.githubusercontent.com/u/953992?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/jreback",
      "html_url": "https://github.com/jreback",
      "followers_url": "https://api.github.com/users/jreback/followers",
      "following_url": "https://api.github.com/users/jreback/following{/other_user}",
      "gists_url": "https://api.github.com/users/jreback/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/jreback/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/jreback/subscriptions",
      "organizations_url": "https://api.github.com/users/jreback/orgs",
      "repos_url": "https://api.github.com/users/jreback/repos",
      "events_url": "https://api.github.com/users/jreback/events{/privacy}",
      "received_events_url": "https://api.github.com/users/jreback/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2016-01-27T15:12:38Z",
    "updated_at": "2016-01-27T15:12:38Z",
    "author_association": "CONTRIBUTOR",
    "body": "@selasley thanks!\n"
  }
]
