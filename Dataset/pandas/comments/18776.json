[
  {
    "url": "https://api.github.com/repos/pandas-dev/pandas/issues/comments/356053890",
    "html_url": "https://github.com/pandas-dev/pandas/issues/18776#issuecomment-356053890",
    "issue_url": "https://api.github.com/repos/pandas-dev/pandas/issues/18776",
    "id": 356053890,
    "node_id": "MDEyOklzc3VlQ29tbWVudDM1NjA1Mzg5MA==",
    "user": {
      "login": "dhimmel",
      "id": 1117703,
      "node_id": "MDQ6VXNlcjExMTc3MDM=",
      "avatar_url": "https://avatars1.githubusercontent.com/u/1117703?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/dhimmel",
      "html_url": "https://github.com/dhimmel",
      "followers_url": "https://api.github.com/users/dhimmel/followers",
      "following_url": "https://api.github.com/users/dhimmel/following{/other_user}",
      "gists_url": "https://api.github.com/users/dhimmel/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/dhimmel/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/dhimmel/subscriptions",
      "organizations_url": "https://api.github.com/users/dhimmel/orgs",
      "repos_url": "https://api.github.com/users/dhimmel/repos",
      "events_url": "https://api.github.com/users/dhimmel/events{/privacy}",
      "received_events_url": "https://api.github.com/users/dhimmel/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2018-01-08T18:35:20Z",
    "updated_at": "2018-01-08T18:35:20Z",
    "author_association": "CONTRIBUTOR",
    "body": "I just noticed the same issue with pandas 0.22.0:\r\n\r\n![pandas-inner-merge-order](https://user-images.githubusercontent.com/1117703/34685992-2f5b99bc-f478-11e7-80f2-65c52fd688a3.png)\r\n\r\nThe expected behavior would be for rows ordering of `affil_map_df` to be preserved. Instead, it seems that instead the order of `affiliation_df` or perhaps the sorted `affiliation` column was used.\r\n\r\nThis behavior does not match the documentation:\r\n\r\nhttps://github.com/pandas-dev/pandas/blob/a00154dcfe5057cb3fd86653172e74b6893e337d/pandas/core/frame.py#L147-L148\r\n\r\nTo me, the documented behavior is intuitive and the actual behavior should be updated?"
  },
  {
    "url": "https://api.github.com/repos/pandas-dev/pandas/issues/comments/396705914",
    "html_url": "https://github.com/pandas-dev/pandas/issues/18776#issuecomment-396705914",
    "issue_url": "https://api.github.com/repos/pandas-dev/pandas/issues/18776",
    "id": 396705914,
    "node_id": "MDEyOklzc3VlQ29tbWVudDM5NjcwNTkxNA==",
    "user": {
      "login": "jschendel",
      "id": 5332445,
      "node_id": "MDQ6VXNlcjUzMzI0NDU=",
      "avatar_url": "https://avatars3.githubusercontent.com/u/5332445?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/jschendel",
      "html_url": "https://github.com/jschendel",
      "followers_url": "https://api.github.com/users/jschendel/followers",
      "following_url": "https://api.github.com/users/jschendel/following{/other_user}",
      "gists_url": "https://api.github.com/users/jschendel/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/jschendel/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/jschendel/subscriptions",
      "organizations_url": "https://api.github.com/users/jschendel/orgs",
      "repos_url": "https://api.github.com/users/jschendel/repos",
      "events_url": "https://api.github.com/users/jschendel/events{/privacy}",
      "received_events_url": "https://api.github.com/users/jschendel/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2018-06-12T19:28:34Z",
    "updated_at": "2018-06-12T19:28:34Z",
    "author_association": "MEMBER",
    "body": "To expand on this, the issue appears to occur when the merge key is non-unique.\r\n\r\nSetup:\r\n```python\r\nIn [2]: pd.__version__\r\nOut[2]: '0.24.0.dev0+88.gdefdb34'\r\n\r\nIn [3]: df = pd.DataFrame({'key': [7, 6, 8, 6], 'other': ['foo', 'bar', 'baz', 'qux']})\r\n\r\nIn [4]: df\r\nOut[4]:\r\n   key other\r\n0    7   foo\r\n1    6   bar\r\n2    8   baz\r\n3    6   qux\r\n```\r\n\r\nNon-unique merge key causes improper ordering:\r\n```python\r\nIn [5]: pd.merge(df, df, how='inner', on='key')\r\nOut[5]:\r\n   key other_x other_y\r\n0    7     foo     foo\r\n1    6     bar     bar\r\n2    6     bar     qux\r\n3    6     qux     bar\r\n4    6     qux     qux\r\n5    8     baz     baz\r\n```\r\n\r\nRestricting to a unique portion seems fine:\r\n```python\r\nIn [6]: pd.merge(df.loc[:2], df.loc[:2], how='inner', on='key')\r\nOut[6]:\r\n   key other_x other_y\r\n0    7     foo     foo\r\n1    6     bar     bar\r\n2    8     baz     baz\r\n```\r\n\r\nUsing `how='left'` maintains proper order:\r\n```python\r\nIn [7]: pd.merge(df, df, how='left', on='key')\r\nOut[7]:\r\n   key other_x other_y\r\n0    7     foo     foo\r\n1    6     bar     bar\r\n2    6     bar     qux\r\n3    8     baz     baz\r\n4    6     qux     bar\r\n5    6     qux     qux\r\n```"
  },
  {
    "url": "https://api.github.com/repos/pandas-dev/pandas/issues/comments/396708293",
    "html_url": "https://github.com/pandas-dev/pandas/issues/18776#issuecomment-396708293",
    "issue_url": "https://api.github.com/repos/pandas-dev/pandas/issues/18776",
    "id": 396708293,
    "node_id": "MDEyOklzc3VlQ29tbWVudDM5NjcwODI5Mw==",
    "user": {
      "login": "TartySG",
      "id": 29611093,
      "node_id": "MDQ6VXNlcjI5NjExMDkz",
      "avatar_url": "https://avatars0.githubusercontent.com/u/29611093?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/TartySG",
      "html_url": "https://github.com/TartySG",
      "followers_url": "https://api.github.com/users/TartySG/followers",
      "following_url": "https://api.github.com/users/TartySG/following{/other_user}",
      "gists_url": "https://api.github.com/users/TartySG/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/TartySG/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/TartySG/subscriptions",
      "organizations_url": "https://api.github.com/users/TartySG/orgs",
      "repos_url": "https://api.github.com/users/TartySG/repos",
      "events_url": "https://api.github.com/users/TartySG/events{/privacy}",
      "received_events_url": "https://api.github.com/users/TartySG/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2018-06-12T19:37:46Z",
    "updated_at": "2018-06-12T19:41:05Z",
    "author_association": "NONE",
    "body": "@jschendel \r\nIt has more to do with the order in which the merge encounters the values rather than \"non-uniqueness\".  \r\nThe order is the same as the first time it encounters the join key in the column. \r\nSo a unique value will only be encountered once, hence the absence of noticeable change in order.\r\n\r\n```python\r\ndf = pd.DataFrame([['A', 1],\r\n                   ['B', 2],\r\n                   ['B', 3],\r\n                   ['A', 4]\r\n                  ], columns=['Col1', 'Col2'])\r\n\r\n\tCol1\tCol2\r\n0\tA\t1\r\n1\tB\t2\r\n2\tB\t3\r\n3\tA\t4\r\n\r\ndf['Col1'] = pd.Categorical(df.Col1, categories=['A','B'], ordered=True)\r\npd.merge(df, df, on='Col1', how='inner')\r\n\r\n\tCol1\tCol2_x\tCol2_y\r\n0\tA\t1\t1\r\n1\tA\t1\t4\r\n2\tA\t4\t1\r\n3\tA\t4\t4\r\n4\tB\t2\t2\r\n5\tB\t2\t3\r\n6\tB\t3\t2\r\n7\tB\t3\t3\r\n````\r\nwill produce a merge with all 'A' first.  \r\non the other hand :\r\n\r\n```python\r\ndf = pd.DataFrame([['B', 2],\r\n                   ['A', 1],\r\n                   ['B', 3],\r\n                   ['A', 4]\r\n                  ], columns=['Col1', 'Col2'])\r\n\r\n\tCol1\tCol2\r\n0\tB\t2\r\n1\tA\t1\r\n2\tB\t3\r\n3\tA\t4\r\n\r\ndf['Col1'] = pd.Categorical(df.Col1, categories=['A','B'], ordered=True)\r\npd.merge(df, df, on='Col1', how='inner')\r\n\r\n\tCol1\tCol2_x\tCol2_y\r\n0\tB\t2\t2\r\n1\tB\t2\t3\r\n2\tB\t3\t2\r\n3\tB\t3\t3\r\n4\tA\t1\t1\r\n5\tA\t1\t4\r\n6\tA\t4\t1\r\n7\tA\t4\t4\r\n````\r\nwill produce a merge with all the 'B' first, regardless of the \"Order\" of the categorical data (or any ordered type e.g. interger)."
  },
  {
    "url": "https://api.github.com/repos/pandas-dev/pandas/issues/comments/396714558",
    "html_url": "https://github.com/pandas-dev/pandas/issues/18776#issuecomment-396714558",
    "issue_url": "https://api.github.com/repos/pandas-dev/pandas/issues/18776",
    "id": 396714558,
    "node_id": "MDEyOklzc3VlQ29tbWVudDM5NjcxNDU1OA==",
    "user": {
      "login": "jschendel",
      "id": 5332445,
      "node_id": "MDQ6VXNlcjUzMzI0NDU=",
      "avatar_url": "https://avatars3.githubusercontent.com/u/5332445?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/jschendel",
      "html_url": "https://github.com/jschendel",
      "followers_url": "https://api.github.com/users/jschendel/followers",
      "following_url": "https://api.github.com/users/jschendel/following{/other_user}",
      "gists_url": "https://api.github.com/users/jschendel/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/jschendel/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/jschendel/subscriptions",
      "organizations_url": "https://api.github.com/users/jschendel/orgs",
      "repos_url": "https://api.github.com/users/jschendel/repos",
      "events_url": "https://api.github.com/users/jschendel/events{/privacy}",
      "received_events_url": "https://api.github.com/users/jschendel/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2018-06-12T20:00:28Z",
    "updated_at": "2018-06-12T20:00:51Z",
    "author_association": "MEMBER",
    "body": "Yes, looks like I was a bit premature attributing the issue to non-uniquness."
  }
]
