[
  {
    "url": "https://api.github.com/repos/pandas-dev/pandas/issues/comments/19874642",
    "html_url": "https://github.com/pandas-dev/pandas/issues/4003#issuecomment-19874642",
    "issue_url": "https://api.github.com/repos/pandas-dev/pandas/issues/4003",
    "id": 19874642,
    "node_id": "MDEyOklzc3VlQ29tbWVudDE5ODc0NjQy",
    "user": {
      "login": "TomAugspurger",
      "id": 1312546,
      "node_id": "MDQ6VXNlcjEzMTI1NDY=",
      "avatar_url": "https://avatars3.githubusercontent.com/u/1312546?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/TomAugspurger",
      "html_url": "https://github.com/TomAugspurger",
      "followers_url": "https://api.github.com/users/TomAugspurger/followers",
      "following_url": "https://api.github.com/users/TomAugspurger/following{/other_user}",
      "gists_url": "https://api.github.com/users/TomAugspurger/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/TomAugspurger/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/TomAugspurger/subscriptions",
      "organizations_url": "https://api.github.com/users/TomAugspurger/orgs",
      "repos_url": "https://api.github.com/users/TomAugspurger/repos",
      "events_url": "https://api.github.com/users/TomAugspurger/events{/privacy}",
      "received_events_url": "https://api.github.com/users/TomAugspurger/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2013-06-23T14:19:32Z",
    "updated_at": "2013-06-23T14:28:24Z",
    "author_association": "CONTRIBUTOR",
    "body": "Just a note.  The problem isn't that two functions are being passed.  It's something to do with np.size being aggregated in a non-obvious way.\n\n``` python\nIn [32]: expected = crosstab(rows=[df['A'],df['B']], cols=[df['C']], margins=True, values=df[\n                             'D'], aggfunc=len)\n\nIn [33]: expected\nOut[33]: \n         C        bar  foo  All\n         A     B               \n         one   A    2    2    4\n               B    2    2    4\n               C    2    2    4\n         three A    2  NaN    2\n               B  NaN    2    2\n               C    2  NaN    2\n         two   A  NaN    2    2\n               B    2  NaN    2\n               C  NaN    2    2\n         All       12   12   24\n\nIn [34]: odd = crosstab(rows=[df['A'],df['B']], cols=[df['C']], margins=True, values=df['D'],\n                        aggfunc=np.size)\n\nIn [37]: odd\nOut[37]: \n         C        bar  foo  All\n         A     B               \n         one   A    2    2    4\n               B    2    2    4\n               C    2    2    4\n         three A    2  NaN    2\n               B  NaN    2    2\n               C    2  NaN    2\n         two   A  NaN    2    2\n               B    2  NaN    2\n               C  NaN    2    2\n         All       24   24   24\n```\n"
  },
  {
    "url": "https://api.github.com/repos/pandas-dev/pandas/issues/comments/19875121",
    "html_url": "https://github.com/pandas-dev/pandas/issues/4003#issuecomment-19875121",
    "issue_url": "https://api.github.com/repos/pandas-dev/pandas/issues/4003",
    "id": 19875121,
    "node_id": "MDEyOklzc3VlQ29tbWVudDE5ODc1MTIx",
    "user": {
      "login": "TomAugspurger",
      "id": 1312546,
      "node_id": "MDQ6VXNlcjEzMTI1NDY=",
      "avatar_url": "https://avatars3.githubusercontent.com/u/1312546?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/TomAugspurger",
      "html_url": "https://github.com/TomAugspurger",
      "followers_url": "https://api.github.com/users/TomAugspurger/followers",
      "following_url": "https://api.github.com/users/TomAugspurger/following{/other_user}",
      "gists_url": "https://api.github.com/users/TomAugspurger/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/TomAugspurger/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/TomAugspurger/subscriptions",
      "organizations_url": "https://api.github.com/users/TomAugspurger/orgs",
      "repos_url": "https://api.github.com/users/TomAugspurger/repos",
      "events_url": "https://api.github.com/users/TomAugspurger/events{/privacy}",
      "received_events_url": "https://api.github.com/users/TomAugspurger/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2013-06-23T14:54:34Z",
    "updated_at": "2013-06-23T14:56:57Z",
    "author_association": "CONTRIBUTOR",
    "body": "OK, I'm leaning toward this being the correct behavior.  The relevant line is \n\n``` python\nrow_margin = data[cols + values].groupby(cols).agg(aggfunc)\n```\n\nWe're working with the following groups:\n\n``` python\nbar       C  __dummy__\n3   bar   1.523030\n4   bar  -0.234153\n5   bar  -0.234137\n9   bar   0.542560\n10  bar  -0.463418\n11  bar  -0.465730\n15  bar  -0.562288\n16  bar  -1.012831\n17  bar   0.314247\n21  bar  -0.225776\n22  bar   0.067528\n23  bar  -1.424748\nfoo       C  __dummy__\n0   foo   0.496714\n1   foo  -0.138264\n2   foo   0.647689\n6   foo   1.579213\n7   foo   0.767435\n8   foo  -0.469474\n12  foo   0.241962\n13  foo  -1.913280\n14  foo  -1.724918\n18  foo  -0.908024\n19  foo  -1.412304\n20  foo   1.465649\n```\n\nWith `aggfunc = len`, it aggregates to 12 and 12 for `foo` and `bar`, since each `DataFrame` is 12 items long.\n\nWith `aggfunc = np.size`, it aggregates to 24 and 24 since each `DataFrame` is 12x2.\n\nSo the behavior is not necessarily intuitive, but it is correct.\n"
  },
  {
    "url": "https://api.github.com/repos/pandas-dev/pandas/issues/comments/19875661",
    "html_url": "https://github.com/pandas-dev/pandas/issues/4003#issuecomment-19875661",
    "issue_url": "https://api.github.com/repos/pandas-dev/pandas/issues/4003",
    "id": 19875661,
    "node_id": "MDEyOklzc3VlQ29tbWVudDE5ODc1NjYx",
    "user": {
      "login": "TomAugspurger",
      "id": 1312546,
      "node_id": "MDQ6VXNlcjEzMTI1NDY=",
      "avatar_url": "https://avatars3.githubusercontent.com/u/1312546?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/TomAugspurger",
      "html_url": "https://github.com/TomAugspurger",
      "followers_url": "https://api.github.com/users/TomAugspurger/followers",
      "following_url": "https://api.github.com/users/TomAugspurger/following{/other_user}",
      "gists_url": "https://api.github.com/users/TomAugspurger/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/TomAugspurger/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/TomAugspurger/subscriptions",
      "organizations_url": "https://api.github.com/users/TomAugspurger/orgs",
      "repos_url": "https://api.github.com/users/TomAugspurger/repos",
      "events_url": "https://api.github.com/users/TomAugspurger/events{/privacy}",
      "received_events_url": "https://api.github.com/users/TomAugspurger/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2013-06-23T15:28:29Z",
    "updated_at": "2013-06-23T15:28:29Z",
    "author_association": "CONTRIBUTOR",
    "body": "I guess it's also worth pointing out why they both get the same values for the `All` total.  That bit of code is operating on just the column passed as `values`, which makes it a `Series`.  So `len` and `np.size` will both give the same answer in this case.\n"
  },
  {
    "url": "https://api.github.com/repos/pandas-dev/pandas/issues/comments/19880874",
    "html_url": "https://github.com/pandas-dev/pandas/issues/4003#issuecomment-19880874",
    "issue_url": "https://api.github.com/repos/pandas-dev/pandas/issues/4003",
    "id": 19880874,
    "node_id": "MDEyOklzc3VlQ29tbWVudDE5ODgwODc0",
    "user": {
      "login": "brandonkane",
      "id": 1464072,
      "node_id": "MDQ6VXNlcjE0NjQwNzI=",
      "avatar_url": "https://avatars1.githubusercontent.com/u/1464072?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/brandonkane",
      "html_url": "https://github.com/brandonkane",
      "followers_url": "https://api.github.com/users/brandonkane/followers",
      "following_url": "https://api.github.com/users/brandonkane/following{/other_user}",
      "gists_url": "https://api.github.com/users/brandonkane/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/brandonkane/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/brandonkane/subscriptions",
      "organizations_url": "https://api.github.com/users/brandonkane/orgs",
      "repos_url": "https://api.github.com/users/brandonkane/repos",
      "events_url": "https://api.github.com/users/brandonkane/events{/privacy}",
      "received_events_url": "https://api.github.com/users/brandonkane/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2013-06-23T20:34:43Z",
    "updated_at": "2013-06-23T20:34:43Z",
    "author_association": "NONE",
    "body": "Tom, makes sense, thanks for investigating.  I guess my intuition would have been that in the case of the 12x2 dataframe, it should have excluded one of the columns for each margin.  The margins should be an aggregation of the data above it, and in this case they aren't. I would be curious to see what others would expect in this scenario.\n\nI'm fine just using len as the aggfunc instead of size, so this isn't a high priority thing.  \n"
  },
  {
    "url": "https://api.github.com/repos/pandas-dev/pandas/issues/comments/50523499",
    "html_url": "https://github.com/pandas-dev/pandas/issues/4003#issuecomment-50523499",
    "issue_url": "https://api.github.com/repos/pandas-dev/pandas/issues/4003",
    "id": 50523499,
    "node_id": "MDEyOklzc3VlQ29tbWVudDUwNTIzNDk5",
    "user": {
      "login": "dragoljub",
      "id": 2701562,
      "node_id": "MDQ6VXNlcjI3MDE1NjI=",
      "avatar_url": "https://avatars3.githubusercontent.com/u/2701562?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/dragoljub",
      "html_url": "https://github.com/dragoljub",
      "followers_url": "https://api.github.com/users/dragoljub/followers",
      "following_url": "https://api.github.com/users/dragoljub/following{/other_user}",
      "gists_url": "https://api.github.com/users/dragoljub/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/dragoljub/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/dragoljub/subscriptions",
      "organizations_url": "https://api.github.com/users/dragoljub/orgs",
      "repos_url": "https://api.github.com/users/dragoljub/repos",
      "events_url": "https://api.github.com/users/dragoljub/events{/privacy}",
      "received_events_url": "https://api.github.com/users/dragoljub/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2014-07-29T19:10:24Z",
    "updated_at": "2014-07-29T19:10:24Z",
    "author_association": "NONE",
    "body": "I just ran into this issue myself using the df.pivot_table(..., margins=True). I always felt it was somehow _wrong_ to use np.size to count the number of rows in the groupings and now I have a reason to avoid it. In my case I had both the row and column sums doubled. Interestingly doing the pivot table on the above DataFrame does not appear to cause the problem?\n\n``` python\ndf.pivot_table(values='D', rows=['A', 'B'], cols='C', aggfunc=np.size, fill_value=0, margins=True)\nOut[14]: \nC        bar  foo  All\nA     B               \none   A    2    2    4\n      B    2    2    4\n      C    2    2    4\nthree A    2    0    2\n      B    0    2    2\n      C    2    0    2\ntwo   A    0    2    2\n      B    2    0    2\n      C    0    2    2\nAll       12   12   24\n\ndf.pivot_table(values='D', rows=['A', 'B'], cols='C', aggfunc=len, fill_value=0, margins=True)\nOut[15]: \nC        bar  foo  All\nA     B               \none   A    2    2    4\n      B    2    2    4\n      C    2    2    4\nthree A    2    0    2\n      B    0    2    2\n      C    2    0    2\ntwo   A    0    2    2\n      B    2    0    2\n      C    0    2    2\nAll       12   12   24\n```\n"
  },
  {
    "url": "https://api.github.com/repos/pandas-dev/pandas/issues/comments/194523968",
    "html_url": "https://github.com/pandas-dev/pandas/issues/4003#issuecomment-194523968",
    "issue_url": "https://api.github.com/repos/pandas-dev/pandas/issues/4003",
    "id": 194523968,
    "node_id": "MDEyOklzc3VlQ29tbWVudDE5NDUyMzk2OA==",
    "user": {
      "login": "jreback",
      "id": 953992,
      "node_id": "MDQ6VXNlcjk1Mzk5Mg==",
      "avatar_url": "https://avatars2.githubusercontent.com/u/953992?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/jreback",
      "html_url": "https://github.com/jreback",
      "followers_url": "https://api.github.com/users/jreback/followers",
      "following_url": "https://api.github.com/users/jreback/following{/other_user}",
      "gists_url": "https://api.github.com/users/jreback/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/jreback/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/jreback/subscriptions",
      "organizations_url": "https://api.github.com/users/jreback/orgs",
      "repos_url": "https://api.github.com/users/jreback/repos",
      "events_url": "https://api.github.com/users/jreback/events{/privacy}",
      "received_events_url": "https://api.github.com/users/jreback/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2016-03-09T21:47:46Z",
    "updated_at": "2016-03-09T21:47:46Z",
    "author_association": "CONTRIBUTOR",
    "body": "@nickeubank can you confirm this is still an issue?\n"
  },
  {
    "url": "https://api.github.com/repos/pandas-dev/pandas/issues/comments/194529827",
    "html_url": "https://github.com/pandas-dev/pandas/issues/4003#issuecomment-194529827",
    "issue_url": "https://api.github.com/repos/pandas-dev/pandas/issues/4003",
    "id": 194529827,
    "node_id": "MDEyOklzc3VlQ29tbWVudDE5NDUyOTgyNw==",
    "user": {
      "login": "nickeubank",
      "id": 9683693,
      "node_id": "MDQ6VXNlcjk2ODM2OTM=",
      "avatar_url": "https://avatars0.githubusercontent.com/u/9683693?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/nickeubank",
      "html_url": "https://github.com/nickeubank",
      "followers_url": "https://api.github.com/users/nickeubank/followers",
      "following_url": "https://api.github.com/users/nickeubank/following{/other_user}",
      "gists_url": "https://api.github.com/users/nickeubank/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/nickeubank/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/nickeubank/subscriptions",
      "organizations_url": "https://api.github.com/users/nickeubank/orgs",
      "repos_url": "https://api.github.com/users/nickeubank/repos",
      "events_url": "https://api.github.com/users/nickeubank/events{/privacy}",
      "received_events_url": "https://api.github.com/users/nickeubank/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2016-03-09T22:03:55Z",
    "updated_at": "2016-03-09T22:03:55Z",
    "author_association": "CONTRIBUTOR",
    "body": "@jreback Looks fixed to me -- \n\n```\npd.crosstab(index=[df['A'],df['B']], columns=[df['C']], margins=True, aggfunc=[np.size, np.mean], values=df['D'])\nOut[243]: \n        size              mean                    \nC        bar foo All       bar       foo       All\nA     B                                           \none   A    2   2   4  1.152823  0.455740  0.804282\n      B    2   2   4 -0.033598  0.037608  0.002005\n      C    2   2   4  0.081817 -0.449494 -0.183838\nthree A    2 NaN   2 -0.146240       NaN -0.146240\n      B  NaN   2   2       NaN -0.269695 -0.269695\n      C    2 NaN   2  0.063828       NaN  0.063828\ntwo   A  NaN   2   2       NaN -0.496059 -0.496059\n      B    2 NaN   2 -0.394447       NaN -0.394447\n      C  NaN   2   2       NaN  0.863030  0.863030\nAll       12  12  24  0.120697  0.023522  0.072109\n```\n\nSee 12, 12, 24 along bottom row?\n"
  },
  {
    "url": "https://api.github.com/repos/pandas-dev/pandas/issues/comments/194532729",
    "html_url": "https://github.com/pandas-dev/pandas/issues/4003#issuecomment-194532729",
    "issue_url": "https://api.github.com/repos/pandas-dev/pandas/issues/4003",
    "id": 194532729,
    "node_id": "MDEyOklzc3VlQ29tbWVudDE5NDUzMjcyOQ==",
    "user": {
      "login": "jreback",
      "id": 953992,
      "node_id": "MDQ6VXNlcjk1Mzk5Mg==",
      "avatar_url": "https://avatars2.githubusercontent.com/u/953992?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/jreback",
      "html_url": "https://github.com/jreback",
      "followers_url": "https://api.github.com/users/jreback/followers",
      "following_url": "https://api.github.com/users/jreback/following{/other_user}",
      "gists_url": "https://api.github.com/users/jreback/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/jreback/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/jreback/subscriptions",
      "organizations_url": "https://api.github.com/users/jreback/orgs",
      "repos_url": "https://api.github.com/users/jreback/repos",
      "events_url": "https://api.github.com/users/jreback/events{/privacy}",
      "received_events_url": "https://api.github.com/users/jreback/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2016-03-09T22:12:21Z",
    "updated_at": "2016-03-09T22:12:21Z",
    "author_association": "CONTRIBUTOR",
    "body": "hmm, ok. so if you want to do a PR for a confirming test would be great.\n\nif you want to see if you can figure out where this was originally fixed we can reference.\n"
  }
]
