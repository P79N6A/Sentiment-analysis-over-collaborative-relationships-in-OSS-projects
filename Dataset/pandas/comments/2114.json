[
  {
    "url": "https://api.github.com/repos/pandas-dev/pandas/issues/comments/9752266",
    "html_url": "https://github.com/pandas-dev/pandas/issues/2114#issuecomment-9752266",
    "issue_url": "https://api.github.com/repos/pandas-dev/pandas/issues/2114",
    "id": 9752266,
    "node_id": "MDEyOklzc3VlQ29tbWVudDk3NTIyNjY=",
    "user": {
      "login": "mrjbq7",
      "id": 24195,
      "node_id": "MDQ6VXNlcjI0MTk1",
      "avatar_url": "https://avatars2.githubusercontent.com/u/24195?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/mrjbq7",
      "html_url": "https://github.com/mrjbq7",
      "followers_url": "https://api.github.com/users/mrjbq7/followers",
      "following_url": "https://api.github.com/users/mrjbq7/following{/other_user}",
      "gists_url": "https://api.github.com/users/mrjbq7/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/mrjbq7/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/mrjbq7/subscriptions",
      "organizations_url": "https://api.github.com/users/mrjbq7/orgs",
      "repos_url": "https://api.github.com/users/mrjbq7/repos",
      "events_url": "https://api.github.com/users/mrjbq7/events{/privacy}",
      "received_events_url": "https://api.github.com/users/mrjbq7/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2012-10-24T19:10:44Z",
    "updated_at": "2012-10-24T19:10:44Z",
    "author_association": "NONE",
    "body": "It looks like `bottleneck` doesn't have this problem...\n"
  },
  {
    "url": "https://api.github.com/repos/pandas-dev/pandas/issues/comments/9754807",
    "html_url": "https://github.com/pandas-dev/pandas/issues/2114#issuecomment-9754807",
    "issue_url": "https://api.github.com/repos/pandas-dev/pandas/issues/2114",
    "id": 9754807,
    "node_id": "MDEyOklzc3VlQ29tbWVudDk3NTQ4MDc=",
    "user": {
      "login": "mrjbq7",
      "id": 24195,
      "node_id": "MDQ6VXNlcjI0MTk1",
      "avatar_url": "https://avatars2.githubusercontent.com/u/24195?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/mrjbq7",
      "html_url": "https://github.com/mrjbq7",
      "followers_url": "https://api.github.com/users/mrjbq7/followers",
      "following_url": "https://api.github.com/users/mrjbq7/following{/other_user}",
      "gists_url": "https://api.github.com/users/mrjbq7/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/mrjbq7/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/mrjbq7/subscriptions",
      "organizations_url": "https://api.github.com/users/mrjbq7/orgs",
      "repos_url": "https://api.github.com/users/mrjbq7/repos",
      "events_url": "https://api.github.com/users/mrjbq7/events{/privacy}",
      "received_events_url": "https://api.github.com/users/mrjbq7/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2012-10-24T20:19:28Z",
    "updated_at": "2012-10-24T20:19:28Z",
    "author_association": "NONE",
    "body": "I used a similar approach to `bottleneck` where the new value is added first before the previous value is subtracted and it fixes this particular bug...\n\n``` diff\ndiff --git a/pandas/src/moments.pyx b/pandas/src/moments.pyx\nindex 503a63c..9b5b621 100644\n--- a/pandas/src/moments.pyx\n+++ b/pandas/src/moments.pyx\n@@ -175,16 +175,16 @@ def roll_sum(ndarray[double_t] input, int win, int minp):\n     for i from minp - 1 <= i < N:\n         val = input[i]\n\n+        if val == val:\n+            nobs += 1\n+            sum_x += val\n+\n         if i > win - 1:\n             prev = input[i - win]\n             if prev == prev:\n                 sum_x -= prev\n                 nobs -= 1\n\n-        if val == val:\n-            nobs += 1\n-            sum_x += val\n-\n         if nobs >= minp:\n             output[i] = sum_x\n         else:\n@@ -218,16 +218,16 @@ def roll_mean(ndarray[double_t] input,\n     for i from minp - 1 <= i < N:\n         val = input[i]\n\n+        if val == val:\n+            nobs += 1\n+            sum_x += val\n+\n         if i > win - 1:\n             prev = input[i - win]\n             if prev == prev:\n                 sum_x -= prev\n                 nobs -= 1\n\n-        if val == val:\n-            nobs += 1\n-            sum_x += val\n-\n         if nobs >= minp:\n             output[i] = sum_x / nobs\n         else:\n```\n"
  }
]
