[
  {
    "url": "https://api.github.com/repos/pandas-dev/pandas/issues/comments/409067924",
    "html_url": "https://github.com/pandas-dev/pandas/issues/22130#issuecomment-409067924",
    "issue_url": "https://api.github.com/repos/pandas-dev/pandas/issues/22130",
    "id": 409067924,
    "node_id": "MDEyOklzc3VlQ29tbWVudDQwOTA2NzkyNA==",
    "user": {
      "login": "jreback",
      "id": 953992,
      "node_id": "MDQ6VXNlcjk1Mzk5Mg==",
      "avatar_url": "https://avatars2.githubusercontent.com/u/953992?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/jreback",
      "html_url": "https://github.com/jreback",
      "followers_url": "https://api.github.com/users/jreback/followers",
      "following_url": "https://api.github.com/users/jreback/following{/other_user}",
      "gists_url": "https://api.github.com/users/jreback/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/jreback/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/jreback/subscriptions",
      "organizations_url": "https://api.github.com/users/jreback/orgs",
      "repos_url": "https://api.github.com/users/jreback/repos",
      "events_url": "https://api.github.com/users/jreback/events{/privacy}",
      "received_events_url": "https://api.github.com/users/jreback/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2018-07-31T01:54:02Z",
    "updated_at": "2018-07-31T01:54:02Z",
    "author_association": "CONTRIBUTOR",
    "body": "1st\r\n\r\ncategorical that are appended must be rencoded to the on disk categories\r\nso subsequent writes are more expensive \r\n\r\n2nd\r\n\r\ncategorical write an auxiliary array as a leaf; so for each column you are writing a node in the file\r\nnodes are not super cheap. this allows you to have different categorical encoding per column. pandas does not support a 2-D encoded categorical\r\n\r\nso then it should be obvious why integers are so fast to write; they are simply written as a table row (how the table format is written); in a single node\r\n\r\n"
  },
  {
    "url": "https://api.github.com/repos/pandas-dev/pandas/issues/comments/409122472",
    "html_url": "https://github.com/pandas-dev/pandas/issues/22130#issuecomment-409122472",
    "issue_url": "https://api.github.com/repos/pandas-dev/pandas/issues/22130",
    "id": 409122472,
    "node_id": "MDEyOklzc3VlQ29tbWVudDQwOTEyMjQ3Mg==",
    "user": {
      "login": "jpiabrantes",
      "id": 2369107,
      "node_id": "MDQ6VXNlcjIzNjkxMDc=",
      "avatar_url": "https://avatars0.githubusercontent.com/u/2369107?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/jpiabrantes",
      "html_url": "https://github.com/jpiabrantes",
      "followers_url": "https://api.github.com/users/jpiabrantes/followers",
      "following_url": "https://api.github.com/users/jpiabrantes/following{/other_user}",
      "gists_url": "https://api.github.com/users/jpiabrantes/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/jpiabrantes/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/jpiabrantes/subscriptions",
      "organizations_url": "https://api.github.com/users/jpiabrantes/orgs",
      "repos_url": "https://api.github.com/users/jpiabrantes/repos",
      "events_url": "https://api.github.com/users/jpiabrantes/events{/privacy}",
      "received_events_url": "https://api.github.com/users/jpiabrantes/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2018-07-31T07:25:15Z",
    "updated_at": "2018-07-31T07:26:06Z",
    "author_association": "NONE",
    "body": "@jreback thanks for your reply. I think it might be worth rethinking the way categorical features are written into the HDF5 given that we can potentially speed up thinks 1000x (after the first iteration). \r\n\r\nAre things done the way you described to maintain compatibility with other libraries? This way of writing makes categorical features incompatible with HDF5 for all practical reasons, a small database of integers that would take 5 minutes to write into disk would take 3.5 days to write if it had categorical features, and for smaller datasets it's not even worth using HDF5. I would rather lose compatibility with other libraries than not using it at all.\r\n\r\nMy suggestion would be:\r\n1st\r\nEach category should be seen as a different dtype and pandas shouldn't allow different dtypes to be appended on disk data, raising an error like it already happens for other dtypes.\r\n\r\n2nd \r\nData is stored as integers. Metadata for each column is written once with the ordered list of categories."
  }
]
