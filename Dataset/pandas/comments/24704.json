[
  {
    "url": "https://api.github.com/repos/pandas-dev/pandas/issues/comments/453120896",
    "html_url": "https://github.com/pandas-dev/pandas/issues/24704#issuecomment-453120896",
    "issue_url": "https://api.github.com/repos/pandas-dev/pandas/issues/24704",
    "id": 453120896,
    "node_id": "MDEyOklzc3VlQ29tbWVudDQ1MzEyMDg5Ng==",
    "user": {
      "login": "thomasfrederikhoeck",
      "id": 44194839,
      "node_id": "MDQ6VXNlcjQ0MTk0ODM5",
      "avatar_url": "https://avatars2.githubusercontent.com/u/44194839?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/thomasfrederikhoeck",
      "html_url": "https://github.com/thomasfrederikhoeck",
      "followers_url": "https://api.github.com/users/thomasfrederikhoeck/followers",
      "following_url": "https://api.github.com/users/thomasfrederikhoeck/following{/other_user}",
      "gists_url": "https://api.github.com/users/thomasfrederikhoeck/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/thomasfrederikhoeck/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/thomasfrederikhoeck/subscriptions",
      "organizations_url": "https://api.github.com/users/thomasfrederikhoeck/orgs",
      "repos_url": "https://api.github.com/users/thomasfrederikhoeck/repos",
      "events_url": "https://api.github.com/users/thomasfrederikhoeck/events{/privacy}",
      "received_events_url": "https://api.github.com/users/thomasfrederikhoeck/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2019-01-10T14:48:23Z",
    "updated_at": "2019-01-10T14:48:23Z",
    "author_association": "NONE",
    "body": "It also seem to be the case when mapping from int64 too (so not specific to object):\r\n\r\n```python\r\n\r\nimport pandas as pd\r\n\r\ndf = pd.DataFrame({'a': ['1',1,3], 'b' : [1,2,3]})\r\n\r\nprint(df.dtypes)\r\n\r\ncategoricals = list(df.select_dtypes(include='int64').columns.values)\r\ncategoricals =categoricals + ['b']\r\n\r\ndf[categoricals] = df[categoricals].astype('category')\r\n\r\nprint(df.dtypes)\r\n\r\n```\r\n\r\n```\r\na    object\r\nb     int64\r\ndtype: object\r\nFatal Python error: Cannot recover from stack overflow.\r\n\r\nCurrent thread 0x00007fa47ad78700 (most recent call first):\r\n  File \"<frozen importlib._bootstrap>\", line 172 in _get_module_lock\r\n  File \"<frozen importlib._bootstrap>\", line 148 in __enter__\r\n  File \"<frozen importlib._bootstrap>\", line 960 in _find_and_load\r\n  File \"<frozen importlib._bootstrap>\", line 205 in _call_with_frames_removed\r\n  File \"<frozen importlib._bootstrap>\", line 936 in _find_and_load_unlocked\r\n  File \"<frozen importlib._bootstrap>\", line 961 in _find_and_load\r\n  File \"<frozen importlib._bootstrap>\", line 205 in _call_with_frames_removed\r\n  File \"<frozen importlib._bootstrap>\", line 936 in _find_and_load_unlocked\r\n  File \"<frozen importlib._bootstrap>\", line 961 in _find_and_load\r\n  File \"/home/runner/.site-packages/pandas/core/indexes/base.py\", line 4960 in _ensure_index\r\n  File \"/home/runner/.site-packages/pandas/core/indexes/base.py\", line 3363 in get_indexer_non_unique\r\n  File \"/home/runner/.site-packages/pandas/core/indexes/base.py\", line 3386 in get_indexer_for\r\n  File \"/home/runner/.site-packages/pandas/core/internals.py\", line 4132 in get\r\n  File \"/home/runner/.site-packages/pandas/core/frame.py\", line 2698 in _getitem_column\r\n  File \"/home/runner/.site-packages/pandas/core/frame.py\", line 2671 in __getitem__\r\n  File \"/home/runner/.site-packages/pandas/core/generic.py\", line 4996 in <genexpr>\r\n  File \"/home/runner/.site-packages/pandas/core/reshape/concat.py\", line 256 in __init__\r\n  File \"/home/runner/.site-packages/pandas/core/reshape/concat.py\", line 225 in concat\r\n  File \"/home/runner/.site-packages/pandas/core/generic.py\", line 5005 in astype\r\n  File \"/home/runner/.site-packages/pandas/util/_decorators.py\", line 178 in wrapper\r\n  File \"/home/runner/.site-packages/pandas/core/generic.py\", line 4996 in <genexpr>\r\n  File \"/home/runner/.site-packages/pandas/core/reshape/concat.py\", line 256 in __init__\r\n  File \"/home/runner/.site-packages/pandas/core/reshape/concat.py\", line 225 in concat\r\n  File \"/home/runner/.site-packages/pandas/core/generic.py\", line 5005 in astype\r\n  File \"/home/runner/.site-packages/pandas/util/_decorators.py\", line 178 in wrapper\r\n  File \"/home/runner/.site-packages/pandas/core/generic.py\", line 4996 in <genexpr>\r\n  File \"/home/runner/.site-packages/pandas/core/reshape/concat.py\", line 256 in __init__\r\n  File \"/home/runner/.site-packages/pandas/core/reshape/concat.py\", line 225 in concat\r\n  File \"/home/runner/.site-packages/pandas/core/generic.py\", line 5005 in astype\r\n  File \"/home/runner/.site-packages/pandas/util/_decorators.py\", line 178 in wrapper\r\n  File \"/home/runner/.site-packages/pandas/core/generic.py\", line 4996 in <genexpr>\r\n  File \"/home/runner/.site-packages/pandas/core/reshape/concat.py\", line 256 in __init__\r\n  File \"/home/runner/.site-packages/pandas/core/reshape/concat.py\", line 225 in concat\r\n  File \"/home/runner/.site-packages/pandas/core/generic.py\", line 5005 in astype\r\n  File \"/home/runner/.site-packages/pandas/util/_decorators.py\", line 178 in wrapper\r\n  File \"/home/runner/.site-packages/pandas/core/generic.py\", line 4996 in <genexpr>\r\n  File \"/home/runner/.site-packages/pandas/core/reshape/concat.py\", line 256 in __init__\r\n  File \"/home/runner/.site-packages/pandas/core/reshape/concat.py\", line 225 in concat\r\n  File \"/home/runner/.site-packages/pandas/core/generic.py\", line 5005 in astype\r\n  File \"/home/runner/.site-packages/pandas/util/_decorators.py\", line 178 in wrapper\r\n  File \"/home/runner/.site-packages/pandas/core/generic.py\", line 4996 in <genexpr>\r\n  File \"/home/runner/.site-packages/pandas/core/reshape/concat.py\", line 256 in __init__\r\n  File \"/home/runner/.site-packages/pandas/core/reshape/concat.py\", line 225 in concat\r\n  File \"/home/runner/.site-packages/pandas/core/generic.py\", line 5005 in astype\r\n  File \"/home/runner/.site-packages/pandas/util/_decorators.py\", line 178 in wrapper\r\n  File \"/home/runner/.site-packages/pandas/core/generic.py\", line 4996 in <genexpr>\r\n  File \"/home/runner/.site-packages/pandas/core/reshape/concat.py\", line 256 in __init__\r\n  File \"/home/runner/.site-packages/pandas/core/reshape/concat.py\", line 225 in concat\r\n  File \"/home/runner/.site-packages/pandas/core/generic.py\", line 5005 in astype\r\n  File \"/home/runner/.site-packages/pandas/util/_decorators.py\", line 178 in wrapper\r\n  File \"/home/runner/.site-packages/pandas/core/generic.py\", line 4996 in <genexpr>\r\n  File \"/home/runner/.site-packages/pandas/core/reshape/concat.py\", line 256 in __init__\r\n  File \"/home/runner/.site-packages/pandas/core/reshape/concat.py\", line 225 in concat\r\n  File \"/home/runner/.site-packages/pandas/core/generic.py\", line 5005 in astype\r\n  File \"/home/runner/.site-packages/pandas/util/_decorators.py\", line 178 in wrapper\r\n  File \"/home/runner/.site-packages/pandas/core/generic.py\", line 4996 in <genexpr>\r\n  File \"/home/runner/.site-packages/pandas/core/reshape/concat.py\", line 256 in __init__\r\n  File \"/home/runner/.site-packages/pandas/core/reshape/concat.py\", line 225 in concat\r\n  File \"/home/runner/.site-packages/pandas/core/generic.py\", line 5005 in astype\r\n  File \"/home/runner/.site-packages/pandas/util/_decorators.py\", line 178 in wrapper\r\n  File \"/home/runner/.site-packages/pandas/core/generic.py\", line 4996 in <genexpr>\r\n  File \"/home/runner/.site-packages/pandas/core/reshape/concat.py\", line 256 in __init__\r\n  File \"/home/runner/.site-packages/pandas/core/reshape/concat.py\", line 225 in concat\r\n  File \"/home/runner/.site-packages/pandas/core/generic.py\", line 5005 in astype\r\n  File \"/home/runner/.site-packages/pandas/util/_decorators.py\", line 178 in wrapper\r\n  File \"/home/runner/.site-packages/pandas/core/generic.py\", line 4996 in <genexpr>\r\n  File \"/home/runner/.site-packages/pandas/core/reshape/concat.py\", line 256 in __init__\r\n  File \"/home/runner/.site-packages/pandas/core/reshape/concat.py\", line 225 in concat\r\n  File \"/home/runner/.site-packages/pandas/core/generic.py\", line 5005 in astype\r\n  File \"/home/runner/.site-packages/pandas/util/_decorators.py\", line 178 in wrapper\r\n  File \"/home/runner/.site-packages/pandas/core/generic.py\", line 4996 in <genexpr>\r\n  File \"/home/runner/.site-packages/pandas/core/reshape/concat.py\", line 256 in __init__\r\n  File \"/home/runner/.site-packages/pandas/core/reshape/concat.py\", line 225 in concat\r\n  File \"/home/runner/.site-packages/pandas/core/generic.py\", line 5005 in astype\r\n  File \"/home/runner/.site-packages/pandas/util/_decorators.py\", line 178 in wrapper\r\n  File \"/home/runner/.site-packages/pandas/core/generic.py\", line 4996 in <genexpr>\r\n  File \"/home/runner/.site-packages/pandas/core/reshape/concat.py\", line 256 in __init__\r\n  File \"/home/runner/.site-packages/pandas/core/reshape/concat.py\", line 225 in concat\r\n  File \"/home/runner/.site-packages/pandas/core/generic.py\", line 5005 in astype\r\n  File \"/home/runner/.site-packages/pandas/util/_decorators.py\", line 178 in wrapper\r\n  File \"/home/runner/.site-packages/pandas/core/generic.py\", line 4996 in <genexpr>\r\n  File \"/home/runner/.site-packages/pandas/core/reshape/concat.py\", line 256 in __init__\r\n  File \"/home/runner/.site-packages/pandas/core/reshape/concat.py\", line 225 in concat\r\n  File \"/home/runner/.site-packages/pandas/core/generic.py\", line 5005 in astype\r\n  File \"/home/runner/.site-packages/pandas/util/_decorators.py\", line 178 in wrapper\r\n  File \"/home/runner/.site-packages/pandas/core/generic.py\", line 4996 in <genexpr>\r\n  File \"/home/runner/.site-packages/pandas/core/reshape/concat.py\", line 256 in __init__\r\n  File \"/home/runner/.site-packages/pandas/core/reshape/concat.py\", line 225 in concat\r\n  File \"/home/runner/.site-packages/pandas/core/generic.py\", line 5005 in astype\r\n  File \"/home/runner/.site-packages/pandas/util/_decorators.py\", line 178 in wrapper\r\n  File \"/home/runner/.site-packages/pandas/core/generic.py\", line 4996 in <genexpr>\r\n  File \"/home/runner/.site-packages/pandas/core/reshape/concat.py\", line 256 in __init__\r\n  File \"/home/runner/.site-packages/pandas/core/reshape/concat.py\", line 225 in concat\r\n  File \"/home/runner/.site-packages/pandas/core/generic.py\", line 5005 in astype\r\n  File \"/home/runner/.site-packages/pandas/util/_decorators.py\", line 178 in wrapper\r\n  File \"/home/runner/.site-packages/pandas/core/generic.py\", line 4996 in <genexpr>\r\n  File \"/home/runner/.site-packages/pandas/core/reshape/concat.py\", line 256 in __init__\r\n  File \"/home/runner/.site-packages/pandas/core/reshape/concat.py\", line 225 in concat\r\n  File \"/home/runner/.site-packages/pandas/core/generic.py\", line 5005 in astype\r\n  File \"/home/runner/.site-packages/pandas/util/_decorators.py\", line 178 in wrapper\r\n```\r\n"
  },
  {
    "url": "https://api.github.com/repos/pandas-dev/pandas/issues/comments/453121737",
    "html_url": "https://github.com/pandas-dev/pandas/issues/24704#issuecomment-453121737",
    "issue_url": "https://api.github.com/repos/pandas-dev/pandas/issues/24704",
    "id": 453121737,
    "node_id": "MDEyOklzc3VlQ29tbWVudDQ1MzEyMTczNw==",
    "user": {
      "login": "thomasfrederikhoeck",
      "id": 44194839,
      "node_id": "MDQ6VXNlcjQ0MTk0ODM5",
      "avatar_url": "https://avatars2.githubusercontent.com/u/44194839?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/thomasfrederikhoeck",
      "html_url": "https://github.com/thomasfrederikhoeck",
      "followers_url": "https://api.github.com/users/thomasfrederikhoeck/followers",
      "following_url": "https://api.github.com/users/thomasfrederikhoeck/following{/other_user}",
      "gists_url": "https://api.github.com/users/thomasfrederikhoeck/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/thomasfrederikhoeck/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/thomasfrederikhoeck/subscriptions",
      "organizations_url": "https://api.github.com/users/thomasfrederikhoeck/orgs",
      "repos_url": "https://api.github.com/users/thomasfrederikhoeck/repos",
      "events_url": "https://api.github.com/users/thomasfrederikhoeck/events{/privacy}",
      "received_events_url": "https://api.github.com/users/thomasfrederikhoeck/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2019-01-10T14:50:46Z",
    "updated_at": "2019-01-10T14:50:46Z",
    "author_association": "NONE",
    "body": "But not when the astype is 'int64':\r\n\r\n```python\r\nimport pandas as pd\r\n\r\ndf = pd.DataFrame({'a': ['1',1,3], 'b' : [1,2,3]})\r\n\r\nprint(df.dtypes)\r\n\r\ncategoricals = list(df.select_dtypes(include='object').columns.values)\r\ncategoricals =categoricals + ['a']\r\n\r\ndf[categoricals] = df[categoricals].astype('int64')\r\n\r\nprint(df.dtypes)\r\n```\r\n\r\n```\r\na    object\r\nb     int64\r\ndtype: object\r\na    int64\r\nb    int64\r\ndtype: object\r\n```\r\n\r\nSo it is probably related to category. "
  },
  {
    "url": "https://api.github.com/repos/pandas-dev/pandas/issues/comments/453231585",
    "html_url": "https://github.com/pandas-dev/pandas/issues/24704#issuecomment-453231585",
    "issue_url": "https://api.github.com/repos/pandas-dev/pandas/issues/24704",
    "id": 453231585,
    "node_id": "MDEyOklzc3VlQ29tbWVudDQ1MzIzMTU4NQ==",
    "user": {
      "login": "jreback",
      "id": 953992,
      "node_id": "MDQ6VXNlcjk1Mzk5Mg==",
      "avatar_url": "https://avatars2.githubusercontent.com/u/953992?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/jreback",
      "html_url": "https://github.com/jreback",
      "followers_url": "https://api.github.com/users/jreback/followers",
      "following_url": "https://api.github.com/users/jreback/following{/other_user}",
      "gists_url": "https://api.github.com/users/jreback/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/jreback/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/jreback/subscriptions",
      "organizations_url": "https://api.github.com/users/jreback/orgs",
      "repos_url": "https://api.github.com/users/jreback/repos",
      "events_url": "https://api.github.com/users/jreback/events{/privacy}",
      "received_events_url": "https://api.github.com/users/jreback/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2019-01-10T19:54:40Z",
    "updated_at": "2019-01-10T19:54:40Z",
    "author_association": "CONTRIBUTOR",
    "body": "you are trying to set with a duplicate\r\n\r\n```\r\nIn [6]: categoricals\r\nOut[6]: ['b', 'b']\r\n```"
  },
  {
    "url": "https://api.github.com/repos/pandas-dev/pandas/issues/comments/453266869",
    "html_url": "https://github.com/pandas-dev/pandas/issues/24704#issuecomment-453266869",
    "issue_url": "https://api.github.com/repos/pandas-dev/pandas/issues/24704",
    "id": 453266869,
    "node_id": "MDEyOklzc3VlQ29tbWVudDQ1MzI2Njg2OQ==",
    "user": {
      "login": "jschendel",
      "id": 5332445,
      "node_id": "MDQ6VXNlcjUzMzI0NDU=",
      "avatar_url": "https://avatars3.githubusercontent.com/u/5332445?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/jschendel",
      "html_url": "https://github.com/jschendel",
      "followers_url": "https://api.github.com/users/jschendel/followers",
      "following_url": "https://api.github.com/users/jschendel/following{/other_user}",
      "gists_url": "https://api.github.com/users/jschendel/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/jschendel/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/jschendel/subscriptions",
      "organizations_url": "https://api.github.com/users/jschendel/orgs",
      "repos_url": "https://api.github.com/users/jschendel/repos",
      "events_url": "https://api.github.com/users/jschendel/events{/privacy}",
      "received_events_url": "https://api.github.com/users/jschendel/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2019-01-10T21:49:26Z",
    "updated_at": "2019-01-10T21:49:26Z",
    "author_association": "MEMBER",
    "body": "It looks like there are actually two issues here:\r\n\r\n**1. `DataFrame.astype(ExtensionDtype)` fails with duplicate columns**\r\n```python\r\nIn [2]: df = pd.DataFrame([[1, 2], [1, 1], [3, 2]], columns=['a', 'a'])\r\n\r\nIn [3]: df\r\nOut[3]:\r\n   a  a\r\n0  1  2\r\n1  1  1\r\n2  3  2\r\n\r\nIn [4]: df.astype('category')\r\n---------------------------------------------------------------------------\r\nRecursionError: maximum recursion depth exceeded\r\n\r\nIn [5]: df.astype('Int64')\r\n---------------------------------------------------------------------------\r\nRecursionError: maximum recursion depth exceeded\r\n```\r\nThis works for other dtypes when duplicate columns are present, and the fix looks easy, so we could probably support it.\r\n\r\n\r\n**2. Setting to a `DataFrame[ExtensionDtype]` with duplicate columns results in `object` dtype**\r\n\r\nEven if item 1 was fixed, the setting process would result in an object dtype instead of a categorical/extension dtype:\r\n```python\r\nIn [6]: df = pd.DataFrame({'a': [1, 1, 2], 'b' :['foo', 'bar', 'baz']})\r\n\r\nIn [7]: df\r\nOut[7]:\r\n   a    b\r\n0  1  foo\r\n1  1  bar\r\n2  2  baz\r\n\r\nIn [8]: df.dtypes\r\nOut[8]:\r\na     int64\r\nb    object\r\ndtype: object\r\n\r\nIn [9]: df_aa = pd.concat([pd.Series([10, 20, 30], name='a', dtype='category'),\r\n    ...:                   pd.Series([11, 22, 33], name='a', dtype='category')], axis=1)\r\n\r\nIn [10]: df_aa\r\nOut[10]:\r\n    a   a\r\n0  10  11\r\n1  20  22\r\n2  30  33\r\n\r\nIn [11]: df_aa.dtypes\r\nOut[11]:\r\na    category\r\na    category\r\ndtype: object\r\n\r\nIn [12]: df['a'] = df_aa\r\n\r\nIn [13]: df\r\nOut[13]:\r\n    a    b\r\n0  10  foo\r\n1  20  bar\r\n2  30  baz\r\n\r\nIn [14]: df.dtypes\r\nOut[14]:\r\na    object\r\nb    object\r\ndtype: object\r\n\r\nIn [15]: df[['a', 'a']] = df_aa\r\n\r\nIn [16]: df\r\nOut[16]:\r\n    a    b\r\n0  10  foo\r\n1  20  bar\r\n2  30  baz\r\n\r\nIn [17]: df.dtypes\r\nOut[17]:\r\na    object\r\nb    object\r\ndtype: object\r\n```\r\nI'm not sure that this should be supported.  The operation doesn't really make sense to me, and I'm a little bit surprised that it didn't raise.\r\n\r\n@jreback : what are your thoughts on items 1 and 2?"
  },
  {
    "url": "https://api.github.com/repos/pandas-dev/pandas/issues/comments/453267474",
    "html_url": "https://github.com/pandas-dev/pandas/issues/24704#issuecomment-453267474",
    "issue_url": "https://api.github.com/repos/pandas-dev/pandas/issues/24704",
    "id": 453267474,
    "node_id": "MDEyOklzc3VlQ29tbWVudDQ1MzI2NzQ3NA==",
    "user": {
      "login": "jreback",
      "id": 953992,
      "node_id": "MDQ6VXNlcjk1Mzk5Mg==",
      "avatar_url": "https://avatars2.githubusercontent.com/u/953992?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/jreback",
      "html_url": "https://github.com/jreback",
      "followers_url": "https://api.github.com/users/jreback/followers",
      "following_url": "https://api.github.com/users/jreback/following{/other_user}",
      "gists_url": "https://api.github.com/users/jreback/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/jreback/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/jreback/subscriptions",
      "organizations_url": "https://api.github.com/users/jreback/orgs",
      "repos_url": "https://api.github.com/users/jreback/repos",
      "events_url": "https://api.github.com/users/jreback/events{/privacy}",
      "received_events_url": "https://api.github.com/users/jreback/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2019-01-10T21:51:20Z",
    "updated_at": "2019-01-10T21:51:20Z",
    "author_association": "CONTRIBUTOR",
    "body": "yeah 1) is ok, 2) is somewhat tricky and prob ok to not support right away."
  }
]
