[
  {
    "url": "https://api.github.com/repos/pandas-dev/pandas/issues/comments/354359404",
    "html_url": "https://github.com/pandas-dev/pandas/issues/18977#issuecomment-354359404",
    "issue_url": "https://api.github.com/repos/pandas-dev/pandas/issues/18977",
    "id": 354359404,
    "node_id": "MDEyOklzc3VlQ29tbWVudDM1NDM1OTQwNA==",
    "user": {
      "login": "rockg",
      "id": 3195015,
      "node_id": "MDQ6VXNlcjMxOTUwMTU=",
      "avatar_url": "https://avatars2.githubusercontent.com/u/3195015?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/rockg",
      "html_url": "https://github.com/rockg",
      "followers_url": "https://api.github.com/users/rockg/followers",
      "following_url": "https://api.github.com/users/rockg/following{/other_user}",
      "gists_url": "https://api.github.com/users/rockg/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/rockg/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/rockg/subscriptions",
      "organizations_url": "https://api.github.com/users/rockg/orgs",
      "repos_url": "https://api.github.com/users/rockg/repos",
      "events_url": "https://api.github.com/users/rockg/events{/privacy}",
      "received_events_url": "https://api.github.com/users/rockg/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2017-12-28T21:18:29Z",
    "updated_at": "2017-12-28T21:18:29Z",
    "author_association": "CONTRIBUTOR",
    "body": "That was added in #9623.  Basically some rules need to remove the timezone, apply the rule, and then add the timezone back in order to get the right offset after applying the rule.  These are mostly rules that use `dateutil.relativedelta` for the underlying logic.  `Timedelta`s just work out of the box around the DST transition so these subclasses did not need any adjustment.  Not clear if `LastWeekOfMonth` just works."
  },
  {
    "url": "https://api.github.com/repos/pandas-dev/pandas/issues/comments/354389645",
    "html_url": "https://github.com/pandas-dev/pandas/issues/18977#issuecomment-354389645",
    "issue_url": "https://api.github.com/repos/pandas-dev/pandas/issues/18977",
    "id": 354389645,
    "node_id": "MDEyOklzc3VlQ29tbWVudDM1NDM4OTY0NQ==",
    "user": {
      "login": "jbrockmendel",
      "id": 8078968,
      "node_id": "MDQ6VXNlcjgwNzg5Njg=",
      "avatar_url": "https://avatars1.githubusercontent.com/u/8078968?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/jbrockmendel",
      "html_url": "https://github.com/jbrockmendel",
      "followers_url": "https://api.github.com/users/jbrockmendel/followers",
      "following_url": "https://api.github.com/users/jbrockmendel/following{/other_user}",
      "gists_url": "https://api.github.com/users/jbrockmendel/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/jbrockmendel/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/jbrockmendel/subscriptions",
      "organizations_url": "https://api.github.com/users/jbrockmendel/orgs",
      "repos_url": "https://api.github.com/users/jbrockmendel/repos",
      "events_url": "https://api.github.com/users/jbrockmendel/events{/privacy}",
      "received_events_url": "https://api.github.com/users/jbrockmendel/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2017-12-29T02:38:59Z",
    "updated_at": "2017-12-29T02:38:59Z",
    "author_association": "MEMBER",
    "body": "@rockg thanks, that's a helpful reference. Unfortunately you've made the mistake of volunteering yourself for follow-up questions.\r\n\r\n> These are mostly rules that use dateutil.relativedelta for the underlying logic\r\n\r\nLuckily we're down to the base `DateOffset` class being the only one that uses `relativedelta`s anymore.  The singular/plural args for that have been the source of quite a bit of confusion.\r\n\r\n> Not clear if `LastWeekOfMonth` just works.\r\n\r\nThe sanity test I've been using recently is to check that `(ts + offset) - offset == ts` if and only if `offset.onOffset(ts)`.  The add-then-subtract implementation is the general version in the DateOffset class, so I'm implicitly assuming that it should hold forever and always (so if you have reason to believe this heuristic is wrong, please let me know).  By that measure, LastWeekOfMonth definitely does not work.\r\n\r\nAs for `BusinessHour` and `CustomBusinessHour` I haven't looked at them _that_ closely yet.  If you happen to have any insight into the decision there, I'd appreciate it.\r\n\r\nAnd last, there's a roundup in #18854 of offsets-related issues.  A handful of them are along the lines of \"if anybody knows what was intended here please let me know\".  If you find yourself with nothing better to do..."
  },
  {
    "url": "https://api.github.com/repos/pandas-dev/pandas/issues/comments/354455066",
    "html_url": "https://github.com/pandas-dev/pandas/issues/18977#issuecomment-354455066",
    "issue_url": "https://api.github.com/repos/pandas-dev/pandas/issues/18977",
    "id": 354455066,
    "node_id": "MDEyOklzc3VlQ29tbWVudDM1NDQ1NTA2Ng==",
    "user": {
      "login": "rockg",
      "id": 3195015,
      "node_id": "MDQ6VXNlcjMxOTUwMTU=",
      "avatar_url": "https://avatars2.githubusercontent.com/u/3195015?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/rockg",
      "html_url": "https://github.com/rockg",
      "followers_url": "https://api.github.com/users/rockg/followers",
      "following_url": "https://api.github.com/users/rockg/following{/other_user}",
      "gists_url": "https://api.github.com/users/rockg/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/rockg/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/rockg/subscriptions",
      "organizations_url": "https://api.github.com/users/rockg/orgs",
      "repos_url": "https://api.github.com/users/rockg/repos",
      "events_url": "https://api.github.com/users/rockg/events{/privacy}",
      "received_events_url": "https://api.github.com/users/rockg/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2017-12-29T14:48:44Z",
    "updated_at": "2017-12-29T14:48:44Z",
    "author_association": "CONTRIBUTOR",
    "body": "The singular/plural is confusing for `relativedelta` but if one knows that those are passed to dateutil, the dateutil documentation is pretty clear as to how those are handled.\r\n\r\nThat sanity check isn't clear that it will work properly over DST transitions.  At least before this change was made, I believe that logic will work but the ts + offset will result in the wrong DST, but subtracting the offset will \"undo\" the incorrect DST.  The tests I added in the PR explicitly test that the DST transitions are correct and that is the litmus test for these types of operations.  `BusinessHour` and `CusomBusinessHour` seem to primarily use `timedeltas` which should just work.  However, these, like `LastWeekOfMonth` weren't added to the tests so it's probably good to add them to see if they work.\r\n\r\nIt's not clear with the transition to the cython routines if the `_adjust_dst` flag is still needed for everything or not.  Worth taking an offset class setting it to False and seeing if it works."
  },
  {
    "url": "https://api.github.com/repos/pandas-dev/pandas/issues/comments/354456362",
    "html_url": "https://github.com/pandas-dev/pandas/issues/18977#issuecomment-354456362",
    "issue_url": "https://api.github.com/repos/pandas-dev/pandas/issues/18977",
    "id": 354456362,
    "node_id": "MDEyOklzc3VlQ29tbWVudDM1NDQ1NjM2Mg==",
    "user": {
      "login": "rockg",
      "id": 3195015,
      "node_id": "MDQ6VXNlcjMxOTUwMTU=",
      "avatar_url": "https://avatars2.githubusercontent.com/u/3195015?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/rockg",
      "html_url": "https://github.com/rockg",
      "followers_url": "https://api.github.com/users/rockg/followers",
      "following_url": "https://api.github.com/users/rockg/following{/other_user}",
      "gists_url": "https://api.github.com/users/rockg/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/rockg/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/rockg/subscriptions",
      "organizations_url": "https://api.github.com/users/rockg/orgs",
      "repos_url": "https://api.github.com/users/rockg/repos",
      "events_url": "https://api.github.com/users/rockg/events{/privacy}",
      "received_events_url": "https://api.github.com/users/rockg/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2017-12-29T15:00:17Z",
    "updated_at": "2017-12-29T15:00:17Z",
    "author_association": "CONTRIBUTOR",
    "body": "Also, the test you describe is another completely necessary test of offset operations."
  }
]
