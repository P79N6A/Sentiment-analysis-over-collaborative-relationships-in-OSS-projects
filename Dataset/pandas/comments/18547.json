[
  {
    "url": "https://api.github.com/repos/pandas-dev/pandas/issues/comments/347617118",
    "html_url": "https://github.com/pandas-dev/pandas/issues/18547#issuecomment-347617118",
    "issue_url": "https://api.github.com/repos/pandas-dev/pandas/issues/18547",
    "id": 347617118,
    "node_id": "MDEyOklzc3VlQ29tbWVudDM0NzYxNzExOA==",
    "user": {
      "login": "jschendel",
      "id": 5332445,
      "node_id": "MDQ6VXNlcjUzMzI0NDU=",
      "avatar_url": "https://avatars3.githubusercontent.com/u/5332445?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/jschendel",
      "html_url": "https://github.com/jschendel",
      "followers_url": "https://api.github.com/users/jschendel/followers",
      "following_url": "https://api.github.com/users/jschendel/following{/other_user}",
      "gists_url": "https://api.github.com/users/jschendel/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/jschendel/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/jschendel/subscriptions",
      "organizations_url": "https://api.github.com/users/jschendel/orgs",
      "repos_url": "https://api.github.com/users/jschendel/repos",
      "events_url": "https://api.github.com/users/jschendel/events{/privacy}",
      "received_events_url": "https://api.github.com/users/jschendel/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2017-11-28T18:25:26Z",
    "updated_at": "2017-11-28T18:25:26Z",
    "author_association": "MEMBER",
    "body": "I think this is mostly due to the array you're creating needing dtype conversion.  In numpy strings have unicode dtype, but for various reasons pandas uses object dtype.\r\n\r\nUsing the following setup:\r\n```python\r\nIn [3]: a_list = ['string'] * 1000000\r\n   ...: arr = np.array(a_list)\r\n   ...: arr2 = np.array(a_list, dtype=object)\r\n   ...:\r\n\r\nIn [4]: arr.dtype\r\nOut[4]: dtype('<U6')\r\n\r\nIn [5]: arr2.dtype\r\nOut[5]: dtype('O')\r\n```\r\n\r\nCreating a `Series` from the object dtype array is by far the fastest:\r\n```python\r\nIn [6]: %timeit pd.Series(a_list)\r\n17.4 ms ± 38.3 µs per loop (mean ± std. dev. of 7 runs, 100 loops each)\r\n\r\nIn [7]: %timeit pd.Series(arr)\r\n141 ms ± 335 µs per loop (mean ± std. dev. of 7 runs, 10 loops each)\r\n\r\nIn [8]: %timeit pd.Series(arr2)\r\n56.1 µs ± 163 ns per loop (mean ± std. dev. of 7 runs, 10000 loops each)\r\n```\r\n\r\nAnd the bulk of the time for creating the `Series` from your original array appears to be spent casting to object dtype:\r\n```python\r\nIn [9]: %timeit arr.astype(object)\r\n138 ms ± 155 µs per loop (mean ± std. dev. of 7 runs, 10 loops each)\r\n```"
  },
  {
    "url": "https://api.github.com/repos/pandas-dev/pandas/issues/comments/347626345",
    "html_url": "https://github.com/pandas-dev/pandas/issues/18547#issuecomment-347626345",
    "issue_url": "https://api.github.com/repos/pandas-dev/pandas/issues/18547",
    "id": 347626345,
    "node_id": "MDEyOklzc3VlQ29tbWVudDM0NzYyNjM0NQ==",
    "user": {
      "login": "tdpetrou",
      "id": 7226751,
      "node_id": "MDQ6VXNlcjcyMjY3NTE=",
      "avatar_url": "https://avatars1.githubusercontent.com/u/7226751?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/tdpetrou",
      "html_url": "https://github.com/tdpetrou",
      "followers_url": "https://api.github.com/users/tdpetrou/followers",
      "following_url": "https://api.github.com/users/tdpetrou/following{/other_user}",
      "gists_url": "https://api.github.com/users/tdpetrou/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/tdpetrou/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/tdpetrou/subscriptions",
      "organizations_url": "https://api.github.com/users/tdpetrou/orgs",
      "repos_url": "https://api.github.com/users/tdpetrou/repos",
      "events_url": "https://api.github.com/users/tdpetrou/events{/privacy}",
      "received_events_url": "https://api.github.com/users/tdpetrou/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2017-11-28T18:54:18Z",
    "updated_at": "2017-11-28T18:54:39Z",
    "author_association": "CONTRIBUTOR",
    "body": "Thanks for going through this @jschendel. The list of strings still need to be converted to `object` correct? So shouldn't the performance still be on par with for array to Series conversion?\r\n\r\nBasically, a Python string --> Numpy `object` is much faster than NumPy unicode --> Numpy object? A 5x discrepancy seems really large."
  },
  {
    "url": "https://api.github.com/repos/pandas-dev/pandas/issues/comments/347639959",
    "html_url": "https://github.com/pandas-dev/pandas/issues/18547#issuecomment-347639959",
    "issue_url": "https://api.github.com/repos/pandas-dev/pandas/issues/18547",
    "id": 347639959,
    "node_id": "MDEyOklzc3VlQ29tbWVudDM0NzYzOTk1OQ==",
    "user": {
      "login": "jschendel",
      "id": 5332445,
      "node_id": "MDQ6VXNlcjUzMzI0NDU=",
      "avatar_url": "https://avatars3.githubusercontent.com/u/5332445?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/jschendel",
      "html_url": "https://github.com/jschendel",
      "followers_url": "https://api.github.com/users/jschendel/followers",
      "following_url": "https://api.github.com/users/jschendel/following{/other_user}",
      "gists_url": "https://api.github.com/users/jschendel/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/jschendel/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/jschendel/subscriptions",
      "organizations_url": "https://api.github.com/users/jschendel/orgs",
      "repos_url": "https://api.github.com/users/jschendel/repos",
      "events_url": "https://api.github.com/users/jschendel/events{/privacy}",
      "received_events_url": "https://api.github.com/users/jschendel/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2017-11-28T19:40:00Z",
    "updated_at": "2017-11-28T19:40:00Z",
    "author_association": "MEMBER",
    "body": "I'm not 100% sure what I'm about to say is correct, so keep that in mind until someone more knowledgeable confirms/refutes, but it makes sense to me that python string -> numpy object is faster than numpy unicode -> numpy object.  \r\n\r\nPer my understanding, for most dtypes numpy arrays are stored as contiguous blocks of memory that have a single datatype (fixed length unicode in this case).  However, arrays with object dtype are a bit different; the array is filled with pointers to python objects that are stored elsewhere in memory.  When you start with a list of python strings you already have the python objects, but starting with a numpy unicode array you don't, so extra steps are needed to get python objects.\r\n\r\nNote that converting the unicode array to a python list is consistent with the time it takes to use `astype(object)`, which makes sense in light of the above:\r\n```python\r\nIn [2]: arr = np.array(['string'] * 1000000)\r\n\r\nIn [3]: %timeit arr.tolist()\r\n142 ms ± 2.95 ms per loop (mean ± std. dev. of 7 runs, 10 loops each)\r\n\r\nIn [4]: %timeit arr.astype(object)\r\n139 ms ± 263 µs per loop (mean ± std. dev. of 7 runs, 10 loops each)\r\n```\r\n\r\nI'm not sure how to quantify how long a process like this _should_ take, or if a 5x discrepancy is indeed large; it could very well be the case that there is something suboptimal occurring here, but at the very least I don't find the 5x discrepancy especially surprising.\r\n"
  },
  {
    "url": "https://api.github.com/repos/pandas-dev/pandas/issues/comments/347643623",
    "html_url": "https://github.com/pandas-dev/pandas/issues/18547#issuecomment-347643623",
    "issue_url": "https://api.github.com/repos/pandas-dev/pandas/issues/18547",
    "id": 347643623,
    "node_id": "MDEyOklzc3VlQ29tbWVudDM0NzY0MzYyMw==",
    "user": {
      "login": "tdpetrou",
      "id": 7226751,
      "node_id": "MDQ6VXNlcjcyMjY3NTE=",
      "avatar_url": "https://avatars1.githubusercontent.com/u/7226751?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/tdpetrou",
      "html_url": "https://github.com/tdpetrou",
      "followers_url": "https://api.github.com/users/tdpetrou/followers",
      "following_url": "https://api.github.com/users/tdpetrou/following{/other_user}",
      "gists_url": "https://api.github.com/users/tdpetrou/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/tdpetrou/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/tdpetrou/subscriptions",
      "organizations_url": "https://api.github.com/users/tdpetrou/orgs",
      "repos_url": "https://api.github.com/users/tdpetrou/repos",
      "events_url": "https://api.github.com/users/tdpetrou/events{/privacy}",
      "received_events_url": "https://api.github.com/users/tdpetrou/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2017-11-28T19:52:47Z",
    "updated_at": "2017-11-28T19:52:47Z",
    "author_association": "CONTRIBUTOR",
    "body": "Thanks @jschendel. That explanation makes sense and sounds correct."
  },
  {
    "url": "https://api.github.com/repos/pandas-dev/pandas/issues/comments/347695722",
    "html_url": "https://github.com/pandas-dev/pandas/issues/18547#issuecomment-347695722",
    "issue_url": "https://api.github.com/repos/pandas-dev/pandas/issues/18547",
    "id": 347695722,
    "node_id": "MDEyOklzc3VlQ29tbWVudDM0NzY5NTcyMg==",
    "user": {
      "login": "jorisvandenbossche",
      "id": 1020496,
      "node_id": "MDQ6VXNlcjEwMjA0OTY=",
      "avatar_url": "https://avatars2.githubusercontent.com/u/1020496?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/jorisvandenbossche",
      "html_url": "https://github.com/jorisvandenbossche",
      "followers_url": "https://api.github.com/users/jorisvandenbossche/followers",
      "following_url": "https://api.github.com/users/jorisvandenbossche/following{/other_user}",
      "gists_url": "https://api.github.com/users/jorisvandenbossche/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/jorisvandenbossche/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/jorisvandenbossche/subscriptions",
      "organizations_url": "https://api.github.com/users/jorisvandenbossche/orgs",
      "repos_url": "https://api.github.com/users/jorisvandenbossche/repos",
      "events_url": "https://api.github.com/users/jorisvandenbossche/events{/privacy}",
      "received_events_url": "https://api.github.com/users/jorisvandenbossche/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2017-11-28T23:11:43Z",
    "updated_at": "2017-11-28T23:11:43Z",
    "author_association": "MEMBER",
    "body": "Yes I think that is a perfect explanation. This can then be closed then I think, as even if you want to look into why it is 5x slower, that would be on the numpy side as almost all time to convert string array to Series is in the string array to object array conversion."
  }
]
