[
  {
    "url": "https://api.github.com/repos/pandas-dev/pandas/issues/comments/351496055",
    "html_url": "https://github.com/pandas-dev/pandas/issues/18768#issuecomment-351496055",
    "issue_url": "https://api.github.com/repos/pandas-dev/pandas/issues/18768",
    "id": 351496055,
    "node_id": "MDEyOklzc3VlQ29tbWVudDM1MTQ5NjA1NQ==",
    "user": {
      "login": "soxofaan",
      "id": 44946,
      "node_id": "MDQ6VXNlcjQ0OTQ2",
      "avatar_url": "https://avatars1.githubusercontent.com/u/44946?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/soxofaan",
      "html_url": "https://github.com/soxofaan",
      "followers_url": "https://api.github.com/users/soxofaan/followers",
      "following_url": "https://api.github.com/users/soxofaan/following{/other_user}",
      "gists_url": "https://api.github.com/users/soxofaan/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/soxofaan/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/soxofaan/subscriptions",
      "organizations_url": "https://api.github.com/users/soxofaan/orgs",
      "repos_url": "https://api.github.com/users/soxofaan/repos",
      "events_url": "https://api.github.com/users/soxofaan/events{/privacy}",
      "received_events_url": "https://api.github.com/users/soxofaan/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2017-12-13T19:27:25Z",
    "updated_at": "2017-12-13T19:27:25Z",
    "author_association": "CONTRIBUTOR",
    "body": "FYI: just upgraded to pandas 0.21.1 and issue still manifests itself"
  },
  {
    "url": "https://api.github.com/repos/pandas-dev/pandas/issues/comments/351552743",
    "html_url": "https://github.com/pandas-dev/pandas/issues/18768#issuecomment-351552743",
    "issue_url": "https://api.github.com/repos/pandas-dev/pandas/issues/18768",
    "id": 351552743,
    "node_id": "MDEyOklzc3VlQ29tbWVudDM1MTU1Mjc0Mw==",
    "user": {
      "login": "TomAugspurger",
      "id": 1312546,
      "node_id": "MDQ6VXNlcjEzMTI1NDY=",
      "avatar_url": "https://avatars3.githubusercontent.com/u/1312546?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/TomAugspurger",
      "html_url": "https://github.com/TomAugspurger",
      "followers_url": "https://api.github.com/users/TomAugspurger/followers",
      "following_url": "https://api.github.com/users/TomAugspurger/following{/other_user}",
      "gists_url": "https://api.github.com/users/TomAugspurger/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/TomAugspurger/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/TomAugspurger/subscriptions",
      "organizations_url": "https://api.github.com/users/TomAugspurger/orgs",
      "repos_url": "https://api.github.com/users/TomAugspurger/repos",
      "events_url": "https://api.github.com/users/TomAugspurger/events{/privacy}",
      "received_events_url": "https://api.github.com/users/TomAugspurger/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2017-12-13T22:59:41Z",
    "updated_at": "2017-12-13T22:59:41Z",
    "author_association": "CONTRIBUTOR",
    "body": "Thanks for checking on the new release.\r\n\r\nCould you try dropping some breakpoints in `pandas/plotting/_core.py` to see what's going on? Maybe somewhere around https://github.com/pandas-dev/pandas/blob/265e3272b8709a7be274321ee8b505a0e74b8e10/pandas/plotting/_core.py#L999? I think we might store some data on the `axes` object, and I suspect that could be confusing things when you have a secondary y. Or maybe it's something else :)\r\n"
  },
  {
    "url": "https://api.github.com/repos/pandas-dev/pandas/issues/comments/352147935",
    "html_url": "https://github.com/pandas-dev/pandas/issues/18768#issuecomment-352147935",
    "issue_url": "https://api.github.com/repos/pandas-dev/pandas/issues/18768",
    "id": 352147935,
    "node_id": "MDEyOklzc3VlQ29tbWVudDM1MjE0NzkzNQ==",
    "user": {
      "login": "soxofaan",
      "id": 44946,
      "node_id": "MDQ6VXNlcjQ0OTQ2",
      "avatar_url": "https://avatars1.githubusercontent.com/u/44946?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/soxofaan",
      "html_url": "https://github.com/soxofaan",
      "followers_url": "https://api.github.com/users/soxofaan/followers",
      "following_url": "https://api.github.com/users/soxofaan/following{/other_user}",
      "gists_url": "https://api.github.com/users/soxofaan/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/soxofaan/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/soxofaan/subscriptions",
      "organizations_url": "https://api.github.com/users/soxofaan/orgs",
      "repos_url": "https://api.github.com/users/soxofaan/repos",
      "events_url": "https://api.github.com/users/soxofaan/events{/privacy}",
      "received_events_url": "https://api.github.com/users/soxofaan/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2017-12-16T01:02:18Z",
    "updated_at": "2017-12-16T01:02:18Z",
    "author_association": "CONTRIBUTOR",
    "body": "Ok, this was quite a rabbit hole to debug, let's see if I can manage to write down what I found.\r\n\r\nMain reason that the lines in graph with primary and secondary axis do not properly cover the same x range, is the difference in conversion between:\r\n- `pandas.plotting._converter.DatetimeConverter` converts date to number of days since 0001-01-01 plus one. Example: 2017-12-16 -> 736679\r\n- `pandas.plotting._converter.PeriodConverter` convers to number of days since 1970-01-01. Example: 2017-12-16 -> 17516\r\n\r\n\r\nShort description what is happening, starting with the same data as above:\r\n```python\r\na = pd.Series([16, 13, 11], index=pd.to_datetime(['2017-09-13', '2017-09-14', '2017-09-16'], format='%Y-%m-%d'))\r\nb = pd.Series([23, 27, 25], index=pd.to_datetime(['2017-09-13', '2017-09-14', '2017-09-15'], format='%Y-%m-%d'))\r\n```\r\n\r\n### First plot on primary axis:\r\n```python\r\na.plot(ax=ax, style='o-', secondary_y=False)\r\n```\r\nin `LinePlot._make_plot` the `self._is_ts_plot()` check returns `False`\r\nhttps://github.com/pandas-dev/pandas/blob/265e3272b8709a7be274321ee8b505a0e74b8e10/pandas/plotting/_core.py#L947 because (among other reasons) in `pandas.plotting._timeseries._use_dynamic_x` the frequency variables `freq` (and `ax_freq`) are `None` for (\"irregular\") series `a`.\r\nhttps://github.com/pandas-dev/pandas/blob/265e3272b8709a7be274321ee8b505a0e74b8e10/pandas/plotting/_timeseries.py#L211\r\nAs a result of this a `DatetimeConverter` is set up as converter for the x axis .\r\n\r\n### Second plot on secondary axis:\r\n```python\r\nb.plot(ax=ax, style='o-', secondary_y=True)\r\n```\r\nFor the secondary axis twin axes is created. \r\nNow, in `LinePlot._make_plot`, the `self._is_ts_plot()` check returns `True`:\r\n- in `pandas.plotting._timeseries._use_dynamic_x` we have now `freq='D'` (and `ax_freq = None` ) because the `b` series has a clean successive day index.\r\n- a bit further there is https://github.com/pandas-dev/pandas/blob/265e3272b8709a7be274321ee8b505a0e74b8e10/pandas/plotting/_timeseries.py#L217  which, if I understand the comment correctly, seems to want to cover the problem of mixing \"irregular\" and \"clean\" time indexes. However: there is an additional check `len(ax.get_lines()) > 0`  which evaluates to `False` because the previous plot is done on the primary axes, and we can not reach that from here and we count zero lines.\r\n- the control flow  in `_use_dynamic_x` goes a bit further, but finally returns `True`\r\n\r\nBack in `LinePlot._make_plot`, the series with `DatetimeIndex` is now converted to one with `PeriodIndex`, and as a result a `PeriodConverter` is associated now with the axes.\r\n\r\n### Summary\r\nDuring plot of `a` the axes are initially set up using the `DatetimeConverter` mapping (e.g. for xlim stuff). During plot of `b` a non compatible `PeriodConverter` enters the stage. The end result is confusion in x axis conversion for the two line plots. \r\n\r\nI guess there are several possible solutions (but my understanding of the inner workings of pandas and matplotlib are limited, so I don't really know the best way forward in terms of breaking things and keeping things managable):\r\n- make sure `DatetimeConverter` and `PeriodConverter` are \"more compatible\"\r\n- for `pandas.plotting._timeseries._use_dynamic_x` in a secondary axes context: make it possible to check if there are already lines in the corresponding primary axes, to avoid replacing the `DatetimeConverter` with `PeriodConverter`\r\n- don't do the conversion to a `PeriodIndex` series/dataframe in `LinePlot._make_plot` in the first place\r\n\r\n\r\nI hope this sheds some light on what is happening here.\r\n\r\n(note that I didn't look into the case where both plots are done on the secondary axes, but I guess it is related)"
  },
  {
    "url": "https://api.github.com/repos/pandas-dev/pandas/issues/comments/385114154",
    "html_url": "https://github.com/pandas-dev/pandas/issues/18768#issuecomment-385114154",
    "issue_url": "https://api.github.com/repos/pandas-dev/pandas/issues/18768",
    "id": 385114154,
    "node_id": "MDEyOklzc3VlQ29tbWVudDM4NTExNDE1NA==",
    "user": {
      "login": "ajoros",
      "id": 2615433,
      "node_id": "MDQ6VXNlcjI2MTU0MzM=",
      "avatar_url": "https://avatars3.githubusercontent.com/u/2615433?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/ajoros",
      "html_url": "https://github.com/ajoros",
      "followers_url": "https://api.github.com/users/ajoros/followers",
      "following_url": "https://api.github.com/users/ajoros/following{/other_user}",
      "gists_url": "https://api.github.com/users/ajoros/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/ajoros/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/ajoros/subscriptions",
      "organizations_url": "https://api.github.com/users/ajoros/orgs",
      "repos_url": "https://api.github.com/users/ajoros/repos",
      "events_url": "https://api.github.com/users/ajoros/events{/privacy}",
      "received_events_url": "https://api.github.com/users/ajoros/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2018-04-27T22:57:00Z",
    "updated_at": "2018-04-27T22:57:00Z",
    "author_association": "NONE",
    "body": "Has there been any progress on this issue at all? I have been struggling to find some solutions."
  },
  {
    "url": "https://api.github.com/repos/pandas-dev/pandas/issues/comments/385166998",
    "html_url": "https://github.com/pandas-dev/pandas/issues/18768#issuecomment-385166998",
    "issue_url": "https://api.github.com/repos/pandas-dev/pandas/issues/18768",
    "id": 385166998,
    "node_id": "MDEyOklzc3VlQ29tbWVudDM4NTE2Njk5OA==",
    "user": {
      "login": "TomAugspurger",
      "id": 1312546,
      "node_id": "MDQ6VXNlcjEzMTI1NDY=",
      "avatar_url": "https://avatars3.githubusercontent.com/u/1312546?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/TomAugspurger",
      "html_url": "https://github.com/TomAugspurger",
      "followers_url": "https://api.github.com/users/TomAugspurger/followers",
      "following_url": "https://api.github.com/users/TomAugspurger/following{/other_user}",
      "gists_url": "https://api.github.com/users/TomAugspurger/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/TomAugspurger/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/TomAugspurger/subscriptions",
      "organizations_url": "https://api.github.com/users/TomAugspurger/orgs",
      "repos_url": "https://api.github.com/users/TomAugspurger/repos",
      "events_url": "https://api.github.com/users/TomAugspurger/events{/privacy}",
      "received_events_url": "https://api.github.com/users/TomAugspurger/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2018-04-28T11:12:29Z",
    "updated_at": "2018-04-28T11:12:29Z",
    "author_association": "CONTRIBUTOR",
    "body": "I haven't had time to go through @soxofaan's (excellent) debugging yet."
  }
]
