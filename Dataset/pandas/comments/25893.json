[
  {
    "url": "https://api.github.com/repos/pandas-dev/pandas/issues/comments/477204375",
    "html_url": "https://github.com/pandas-dev/pandas/issues/25893#issuecomment-477204375",
    "issue_url": "https://api.github.com/repos/pandas-dev/pandas/issues/25893",
    "id": 477204375,
    "node_id": "MDEyOklzc3VlQ29tbWVudDQ3NzIwNDM3NQ==",
    "user": {
      "login": "WillAyd",
      "id": 609873,
      "node_id": "MDQ6VXNlcjYwOTg3Mw==",
      "avatar_url": "https://avatars0.githubusercontent.com/u/609873?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/WillAyd",
      "html_url": "https://github.com/WillAyd",
      "followers_url": "https://api.github.com/users/WillAyd/followers",
      "following_url": "https://api.github.com/users/WillAyd/following{/other_user}",
      "gists_url": "https://api.github.com/users/WillAyd/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/WillAyd/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/WillAyd/subscriptions",
      "organizations_url": "https://api.github.com/users/WillAyd/orgs",
      "repos_url": "https://api.github.com/users/WillAyd/repos",
      "events_url": "https://api.github.com/users/WillAyd/events{/privacy}",
      "received_events_url": "https://api.github.com/users/WillAyd/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2019-03-27T15:17:47Z",
    "updated_at": "2019-03-27T15:17:47Z",
    "author_association": "MEMBER",
    "body": "Can you profile and try to isolate the issue?"
  },
  {
    "url": "https://api.github.com/repos/pandas-dev/pandas/issues/comments/477208844",
    "html_url": "https://github.com/pandas-dev/pandas/issues/25893#issuecomment-477208844",
    "issue_url": "https://api.github.com/repos/pandas-dev/pandas/issues/25893",
    "id": 477208844,
    "node_id": "MDEyOklzc3VlQ29tbWVudDQ3NzIwODg0NA==",
    "user": {
      "login": "labodyn",
      "id": 16204193,
      "node_id": "MDQ6VXNlcjE2MjA0MTkz",
      "avatar_url": "https://avatars3.githubusercontent.com/u/16204193?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/labodyn",
      "html_url": "https://github.com/labodyn",
      "followers_url": "https://api.github.com/users/labodyn/followers",
      "following_url": "https://api.github.com/users/labodyn/following{/other_user}",
      "gists_url": "https://api.github.com/users/labodyn/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/labodyn/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/labodyn/subscriptions",
      "organizations_url": "https://api.github.com/users/labodyn/orgs",
      "repos_url": "https://api.github.com/users/labodyn/repos",
      "events_url": "https://api.github.com/users/labodyn/events{/privacy}",
      "received_events_url": "https://api.github.com/users/labodyn/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2019-03-27T15:27:05Z",
    "updated_at": "2019-03-27T15:27:05Z",
    "author_association": "NONE",
    "body": "```python\r\nimport os\r\nimport psutil\r\nimport numpy as np\r\nimport pandas as pd\r\n\r\nprocess = psutil.Process(os.getpid())\r\ni = 0\r\n\r\ndef sink():\r\n    global i\r\n    i += 1\r\n    if i % 100 == 0:\r\n        mem = process.memory_info().rss / 1e6\r\n        print(\"mem %fMB\" % mem)\r\n\r\nwhile True:\r\n    pd.Series(data=np.random.rand(5000)).rolling(4000).max()\r\n    sink()\r\n```\r\n\r\nI was wrong, it has nothing to do with the dataset I provided. This is a pretty huge bug in pandas imo."
  },
  {
    "url": "https://api.github.com/repos/pandas-dev/pandas/issues/comments/477211725",
    "html_url": "https://github.com/pandas-dev/pandas/issues/25893#issuecomment-477211725",
    "issue_url": "https://api.github.com/repos/pandas-dev/pandas/issues/25893",
    "id": 477211725,
    "node_id": "MDEyOklzc3VlQ29tbWVudDQ3NzIxMTcyNQ==",
    "user": {
      "login": "WillAyd",
      "id": 609873,
      "node_id": "MDQ6VXNlcjYwOTg3Mw==",
      "avatar_url": "https://avatars0.githubusercontent.com/u/609873?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/WillAyd",
      "html_url": "https://github.com/WillAyd",
      "followers_url": "https://api.github.com/users/WillAyd/followers",
      "following_url": "https://api.github.com/users/WillAyd/following{/other_user}",
      "gists_url": "https://api.github.com/users/WillAyd/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/WillAyd/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/WillAyd/subscriptions",
      "organizations_url": "https://api.github.com/users/WillAyd/orgs",
      "repos_url": "https://api.github.com/users/WillAyd/repos",
      "events_url": "https://api.github.com/users/WillAyd/events{/privacy}",
      "received_events_url": "https://api.github.com/users/WillAyd/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2019-03-27T15:32:47Z",
    "updated_at": "2019-03-27T15:32:47Z",
    "author_association": "MEMBER",
    "body": "Thanks for the code sample. Investigation and PRs are always welcome!"
  },
  {
    "url": "https://api.github.com/repos/pandas-dev/pandas/issues/comments/477213409",
    "html_url": "https://github.com/pandas-dev/pandas/issues/25893#issuecomment-477213409",
    "issue_url": "https://api.github.com/repos/pandas-dev/pandas/issues/25893",
    "id": 477213409,
    "node_id": "MDEyOklzc3VlQ29tbWVudDQ3NzIxMzQwOQ==",
    "user": {
      "login": "labodyn",
      "id": 16204193,
      "node_id": "MDQ6VXNlcjE2MjA0MTkz",
      "avatar_url": "https://avatars3.githubusercontent.com/u/16204193?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/labodyn",
      "html_url": "https://github.com/labodyn",
      "followers_url": "https://api.github.com/users/labodyn/followers",
      "following_url": "https://api.github.com/users/labodyn/following{/other_user}",
      "gists_url": "https://api.github.com/users/labodyn/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/labodyn/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/labodyn/subscriptions",
      "organizations_url": "https://api.github.com/users/labodyn/orgs",
      "repos_url": "https://api.github.com/users/labodyn/repos",
      "events_url": "https://api.github.com/users/labodyn/events{/privacy}",
      "received_events_url": "https://api.github.com/users/labodyn/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2019-03-27T15:36:10Z",
    "updated_at": "2019-03-27T15:36:10Z",
    "author_association": "NONE",
    "body": "The bug does not occur with rolling().mean(), but it does with rolling().min()."
  },
  {
    "url": "https://api.github.com/repos/pandas-dev/pandas/issues/comments/477217091",
    "html_url": "https://github.com/pandas-dev/pandas/issues/25893#issuecomment-477217091",
    "issue_url": "https://api.github.com/repos/pandas-dev/pandas/issues/25893",
    "id": 477217091,
    "node_id": "MDEyOklzc3VlQ29tbWVudDQ3NzIxNzA5MQ==",
    "user": {
      "login": "WillAyd",
      "id": 609873,
      "node_id": "MDQ6VXNlcjYwOTg3Mw==",
      "avatar_url": "https://avatars0.githubusercontent.com/u/609873?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/WillAyd",
      "html_url": "https://github.com/WillAyd",
      "followers_url": "https://api.github.com/users/WillAyd/followers",
      "following_url": "https://api.github.com/users/WillAyd/following{/other_user}",
      "gists_url": "https://api.github.com/users/WillAyd/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/WillAyd/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/WillAyd/subscriptions",
      "organizations_url": "https://api.github.com/users/WillAyd/orgs",
      "repos_url": "https://api.github.com/users/WillAyd/repos",
      "events_url": "https://api.github.com/users/WillAyd/events{/privacy}",
      "received_events_url": "https://api.github.com/users/WillAyd/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2019-03-27T15:43:37Z",
    "updated_at": "2019-03-27T15:43:37Z",
    "author_association": "MEMBER",
    "body": "It does look like the min/max implementation is the only window func with calls to malloc/free:\r\n\r\nhttps://github.com/pandas-dev/pandas/blob/ac318d26cdbe3d10030f4863b84a06e938da9bba/pandas/_libs/window.pyx#L1372\r\n\r\nPer Cython docs it may be preferable to use the C-API functions for better memory management and reporting back to the Python layer:\r\n\r\nhttps://cython.readthedocs.io/en/latest/src/tutorial/memory_allocation.html#memory-allocation\r\n\r\nWould take a PR trying that or other ideas for sure"
  },
  {
    "url": "https://api.github.com/repos/pandas-dev/pandas/issues/comments/477221836",
    "html_url": "https://github.com/pandas-dev/pandas/issues/25893#issuecomment-477221836",
    "issue_url": "https://api.github.com/repos/pandas-dev/pandas/issues/25893",
    "id": 477221836,
    "node_id": "MDEyOklzc3VlQ29tbWVudDQ3NzIyMTgzNg==",
    "user": {
      "login": "WillAyd",
      "id": 609873,
      "node_id": "MDQ6VXNlcjYwOTg3Mw==",
      "avatar_url": "https://avatars0.githubusercontent.com/u/609873?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/WillAyd",
      "html_url": "https://github.com/WillAyd",
      "followers_url": "https://api.github.com/users/WillAyd/followers",
      "following_url": "https://api.github.com/users/WillAyd/following{/other_user}",
      "gists_url": "https://api.github.com/users/WillAyd/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/WillAyd/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/WillAyd/subscriptions",
      "organizations_url": "https://api.github.com/users/WillAyd/orgs",
      "repos_url": "https://api.github.com/users/WillAyd/repos",
      "events_url": "https://api.github.com/users/WillAyd/events{/privacy}",
      "received_events_url": "https://api.github.com/users/WillAyd/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2019-03-27T15:52:58Z",
    "updated_at": "2019-03-27T15:52:58Z",
    "author_association": "MEMBER",
    "body": "May also be that the GIL is released when free is called in current implementation"
  },
  {
    "url": "https://api.github.com/repos/pandas-dev/pandas/issues/comments/477837468",
    "html_url": "https://github.com/pandas-dev/pandas/issues/25893#issuecomment-477837468",
    "issue_url": "https://api.github.com/repos/pandas-dev/pandas/issues/25893",
    "id": 477837468,
    "node_id": "MDEyOklzc3VlQ29tbWVudDQ3NzgzNzQ2OA==",
    "user": {
      "login": "ArtificialQualia",
      "id": 25773476,
      "node_id": "MDQ6VXNlcjI1NzczNDc2",
      "avatar_url": "https://avatars1.githubusercontent.com/u/25773476?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/ArtificialQualia",
      "html_url": "https://github.com/ArtificialQualia",
      "followers_url": "https://api.github.com/users/ArtificialQualia/followers",
      "following_url": "https://api.github.com/users/ArtificialQualia/following{/other_user}",
      "gists_url": "https://api.github.com/users/ArtificialQualia/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/ArtificialQualia/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/ArtificialQualia/subscriptions",
      "organizations_url": "https://api.github.com/users/ArtificialQualia/orgs",
      "repos_url": "https://api.github.com/users/ArtificialQualia/repos",
      "events_url": "https://api.github.com/users/ArtificialQualia/events{/privacy}",
      "received_events_url": "https://api.github.com/users/ArtificialQualia/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2019-03-29T02:05:31Z",
    "updated_at": "2019-03-29T02:05:31Z",
    "author_association": "CONTRIBUTOR",
    "body": "After some testing, it doesn't seem to have anything to do with the GIL or using the C-API vs direct malloc/free calls.\r\n\r\nIt looks like this bug was introduced when separating variable/fixed into separate functions.  For some reason, passing some of the cdef variables to separate functions (likely `starti` and `endi` in this case) are what cause the memory leak.\r\n\r\nA simple fix is to just combine the functions into one large function again, but it may be better to work out an alternative that doesn't cause the leak, like using pointers or perhaps a [memory view](https://cython.readthedocs.io/en/latest/src/userguide/memoryviews.html#memoryviews).\r\n\r\nI can take a shot at a proper fix, but it may be a couple of days until I have a PR."
  },
  {
    "url": "https://api.github.com/repos/pandas-dev/pandas/issues/comments/477843918",
    "html_url": "https://github.com/pandas-dev/pandas/issues/25893#issuecomment-477843918",
    "issue_url": "https://api.github.com/repos/pandas-dev/pandas/issues/25893",
    "id": 477843918,
    "node_id": "MDEyOklzc3VlQ29tbWVudDQ3Nzg0MzkxOA==",
    "user": {
      "login": "WillAyd",
      "id": 609873,
      "node_id": "MDQ6VXNlcjYwOTg3Mw==",
      "avatar_url": "https://avatars0.githubusercontent.com/u/609873?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/WillAyd",
      "html_url": "https://github.com/WillAyd",
      "followers_url": "https://api.github.com/users/WillAyd/followers",
      "following_url": "https://api.github.com/users/WillAyd/following{/other_user}",
      "gists_url": "https://api.github.com/users/WillAyd/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/WillAyd/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/WillAyd/subscriptions",
      "organizations_url": "https://api.github.com/users/WillAyd/orgs",
      "repos_url": "https://api.github.com/users/WillAyd/repos",
      "events_url": "https://api.github.com/users/WillAyd/events{/privacy}",
      "received_events_url": "https://api.github.com/users/WillAyd/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2019-03-29T02:39:07Z",
    "updated_at": "2019-03-29T02:39:07Z",
    "author_association": "MEMBER",
    "body": "Sounds good thanks for investigating @ArtificialQualia !"
  }
]
