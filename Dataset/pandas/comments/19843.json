[
  {
    "url": "https://api.github.com/repos/pandas-dev/pandas/issues/comments/367796172",
    "html_url": "https://github.com/pandas-dev/pandas/issues/19843#issuecomment-367796172",
    "issue_url": "https://api.github.com/repos/pandas-dev/pandas/issues/19843",
    "id": 367796172,
    "node_id": "MDEyOklzc3VlQ29tbWVudDM2Nzc5NjE3Mg==",
    "user": {
      "login": "DylanDmitri",
      "id": 13950346,
      "node_id": "MDQ6VXNlcjEzOTUwMzQ2",
      "avatar_url": "https://avatars0.githubusercontent.com/u/13950346?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/DylanDmitri",
      "html_url": "https://github.com/DylanDmitri",
      "followers_url": "https://api.github.com/users/DylanDmitri/followers",
      "following_url": "https://api.github.com/users/DylanDmitri/following{/other_user}",
      "gists_url": "https://api.github.com/users/DylanDmitri/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/DylanDmitri/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/DylanDmitri/subscriptions",
      "organizations_url": "https://api.github.com/users/DylanDmitri/orgs",
      "repos_url": "https://api.github.com/users/DylanDmitri/repos",
      "events_url": "https://api.github.com/users/DylanDmitri/events{/privacy}",
      "received_events_url": "https://api.github.com/users/DylanDmitri/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2018-02-22T19:39:23Z",
    "updated_at": "2018-02-22T19:39:23Z",
    "author_association": "CONTRIBUTOR",
    "body": "I will try and fix this."
  },
  {
    "url": "https://api.github.com/repos/pandas-dev/pandas/issues/comments/367885024",
    "html_url": "https://github.com/pandas-dev/pandas/issues/19843#issuecomment-367885024",
    "issue_url": "https://api.github.com/repos/pandas-dev/pandas/issues/19843",
    "id": 367885024,
    "node_id": "MDEyOklzc3VlQ29tbWVudDM2Nzg4NTAyNA==",
    "user": {
      "login": "jreback",
      "id": 953992,
      "node_id": "MDQ6VXNlcjk1Mzk5Mg==",
      "avatar_url": "https://avatars2.githubusercontent.com/u/953992?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/jreback",
      "html_url": "https://github.com/jreback",
      "followers_url": "https://api.github.com/users/jreback/followers",
      "following_url": "https://api.github.com/users/jreback/following{/other_user}",
      "gists_url": "https://api.github.com/users/jreback/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/jreback/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/jreback/subscriptions",
      "organizations_url": "https://api.github.com/users/jreback/orgs",
      "repos_url": "https://api.github.com/users/jreback/repos",
      "events_url": "https://api.github.com/users/jreback/events{/privacy}",
      "received_events_url": "https://api.github.com/users/jreback/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2018-02-23T01:53:58Z",
    "updated_at": "2018-02-23T01:53:58Z",
    "author_association": "CONTRIBUTOR",
    "body": "great!"
  },
  {
    "url": "https://api.github.com/repos/pandas-dev/pandas/issues/comments/367951085",
    "html_url": "https://github.com/pandas-dev/pandas/issues/19843#issuecomment-367951085",
    "issue_url": "https://api.github.com/repos/pandas-dev/pandas/issues/19843",
    "id": 367951085,
    "node_id": "MDEyOklzc3VlQ29tbWVudDM2Nzk1MTA4NQ==",
    "user": {
      "login": "DylanDmitri",
      "id": 13950346,
      "node_id": "MDQ6VXNlcjEzOTUwMzQ2",
      "avatar_url": "https://avatars0.githubusercontent.com/u/13950346?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/DylanDmitri",
      "html_url": "https://github.com/DylanDmitri",
      "followers_url": "https://api.github.com/users/DylanDmitri/followers",
      "following_url": "https://api.github.com/users/DylanDmitri/following{/other_user}",
      "gists_url": "https://api.github.com/users/DylanDmitri/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/DylanDmitri/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/DylanDmitri/subscriptions",
      "organizations_url": "https://api.github.com/users/DylanDmitri/orgs",
      "repos_url": "https://api.github.com/users/DylanDmitri/repos",
      "events_url": "https://api.github.com/users/DylanDmitri/events{/privacy}",
      "received_events_url": "https://api.github.com/users/DylanDmitri/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2018-02-23T09:06:05Z",
    "updated_at": "2018-02-23T09:12:37Z",
    "author_association": "CONTRIBUTOR",
    "body": "Currently, ```infer_dtype_from_scalar``` (on datetimey/timestampy objects) returns a ```np.datetime64``` if no timezone is given, and defaults to ```np.object_``` on objects with timezones. Fixing this problem means returning something else, rather than ```np.object_```. \r\n\r\nIdeally return ```DatetimeTZDtypeType```. However, this crashes on ```np.empty(shape, dtype=dtype)``` in ```cast_scalar_to_array```. Seems like this should work, but it doesn't.\r\n\r\nQuick fix is returning ```np.datetime64``` rather than ```np.object_```. You lose the timezone name, but numpy applies the correct offset before saving so the numbers are correct. This change doesn't break any tests, and results in the following behavior:\r\n\r\n```\r\nIn [1]: df = pd.DataFrame({'A': [0, 1]})\r\n\r\nIn [3]: df['now'] = pd.Timestamp('20130101', tz='UTC')\r\n\r\nIn [5]: df.dtypes\r\nOut[5]: \r\nA               int64\r\nnow    datetime64[ns]\r\ndtype: object\r\n\r\nIn [6]: df['now2'] = pd.DatetimeIndex([pd.Timestamp('20130101', tz='UTC')]).repeat(len(df))\r\n\r\nIn [7]: df.dtypes\r\nOut[7]: \r\nA                     int64\r\nnow          datetime64[ns]\r\nnow2    datetime64[ns, UTC]\r\ndtype: object\r\n```\r\nRaises some inconsistencies, potentially problems with mixing in timezone-naive datetimes. Is the quick fix good enough?"
  },
  {
    "url": "https://api.github.com/repos/pandas-dev/pandas/issues/comments/367981270",
    "html_url": "https://github.com/pandas-dev/pandas/issues/19843#issuecomment-367981270",
    "issue_url": "https://api.github.com/repos/pandas-dev/pandas/issues/19843",
    "id": 367981270,
    "node_id": "MDEyOklzc3VlQ29tbWVudDM2Nzk4MTI3MA==",
    "user": {
      "login": "jreback",
      "id": 953992,
      "node_id": "MDQ6VXNlcjk1Mzk5Mg==",
      "avatar_url": "https://avatars2.githubusercontent.com/u/953992?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/jreback",
      "html_url": "https://github.com/jreback",
      "followers_url": "https://api.github.com/users/jreback/followers",
      "following_url": "https://api.github.com/users/jreback/following{/other_user}",
      "gists_url": "https://api.github.com/users/jreback/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/jreback/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/jreback/subscriptions",
      "organizations_url": "https://api.github.com/users/jreback/orgs",
      "repos_url": "https://api.github.com/users/jreback/repos",
      "events_url": "https://api.github.com/users/jreback/events{/privacy}",
      "received_events_url": "https://api.github.com/users/jreback/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2018-02-23T11:13:01Z",
    "updated_at": "2018-02-23T11:13:01Z",
    "author_association": "CONTRIBUTOR",
    "body": "@DylanDmitri you don't want to *ever* have numpy deal with timezones, they are completely wrong. ``infer_dtype_from_scalar`` has a ``pandas_dtype`` parameter that will make this work. We should actully just change this to do this by default (though this might break other things)"
  },
  {
    "url": "https://api.github.com/repos/pandas-dev/pandas/issues/comments/370009041",
    "html_url": "https://github.com/pandas-dev/pandas/issues/19843#issuecomment-370009041",
    "issue_url": "https://api.github.com/repos/pandas-dev/pandas/issues/19843",
    "id": 370009041,
    "node_id": "MDEyOklzc3VlQ29tbWVudDM3MDAwOTA0MQ==",
    "user": {
      "login": "DylanDmitri",
      "id": 13950346,
      "node_id": "MDQ6VXNlcjEzOTUwMzQ2",
      "avatar_url": "https://avatars0.githubusercontent.com/u/13950346?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/DylanDmitri",
      "html_url": "https://github.com/DylanDmitri",
      "followers_url": "https://api.github.com/users/DylanDmitri/followers",
      "following_url": "https://api.github.com/users/DylanDmitri/following{/other_user}",
      "gists_url": "https://api.github.com/users/DylanDmitri/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/DylanDmitri/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/DylanDmitri/subscriptions",
      "organizations_url": "https://api.github.com/users/DylanDmitri/orgs",
      "repos_url": "https://api.github.com/users/DylanDmitri/repos",
      "events_url": "https://api.github.com/users/DylanDmitri/events{/privacy}",
      "received_events_url": "https://api.github.com/users/DylanDmitri/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2018-03-02T18:24:32Z",
    "updated_at": "2018-03-02T18:25:22Z",
    "author_association": "CONTRIBUTOR",
    "body": "Been busy the last week, sorry.  Here's the problem code (from line 2874 of ```frame.py```)\r\n\r\n```\r\n# BEFORE\r\nvalue = cast_scalar_to_array(len(self.index), value)\r\nvalue = maybe_cast_to_datetime(value, value.dtype)\r\n```\r\n\r\nMain issue: ```cast_scalar_to_array``` defaults to dtype ```np.object_```, which is then ignored by ```maybe_cast_to_datetime```. Want to capture the real pandas dtype, and then pass that into ```maybe_cast_to_datetime```, which then works properly.\r\n\r\n```\r\n# AFTER\r\nfrom pandas.core.dtypes.cast import infer_dtype_from_scalar\r\npandas_dtype, _ = infer_dtype_from_scalar(value, pandas_dtype=True)\r\n\r\nvalue = cast_scalar_to_array(len(self.index), value)\r\nvalue = maybe_cast_to_datetime(value, pandas_dtype)\r\n```\r\n\r\nThis fixes the problem. Will check tests, and have a PR soon."
  }
]
