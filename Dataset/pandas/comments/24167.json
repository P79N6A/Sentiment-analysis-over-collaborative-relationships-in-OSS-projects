[
  {
    "url": "https://api.github.com/repos/pandas-dev/pandas/issues/comments/445532870",
    "html_url": "https://github.com/pandas-dev/pandas/issues/24167#issuecomment-445532870",
    "issue_url": "https://api.github.com/repos/pandas-dev/pandas/issues/24167",
    "id": 445532870,
    "node_id": "MDEyOklzc3VlQ29tbWVudDQ0NTUzMjg3MA==",
    "user": {
      "login": "TomAugspurger",
      "id": 1312546,
      "node_id": "MDQ6VXNlcjEzMTI1NDY=",
      "avatar_url": "https://avatars3.githubusercontent.com/u/1312546?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/TomAugspurger",
      "html_url": "https://github.com/TomAugspurger",
      "followers_url": "https://api.github.com/users/TomAugspurger/followers",
      "following_url": "https://api.github.com/users/TomAugspurger/following{/other_user}",
      "gists_url": "https://api.github.com/users/TomAugspurger/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/TomAugspurger/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/TomAugspurger/subscriptions",
      "organizations_url": "https://api.github.com/users/TomAugspurger/orgs",
      "repos_url": "https://api.github.com/users/TomAugspurger/repos",
      "events_url": "https://api.github.com/users/TomAugspurger/events{/privacy}",
      "received_events_url": "https://api.github.com/users/TomAugspurger/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2018-12-09T12:21:14Z",
    "updated_at": "2018-12-09T12:21:14Z",
    "author_association": "CONTRIBUTOR",
    "body": "Maybe missing a `urreg = pint.UnitsRegistry()`?\r\n\r\n---\r\n\r\nIn your ExtensionArray, do you define `_values_for_factorize()`? If you're able to return numeric values there, I *think* you shouldn't be hitting this branch. I may be wrong though."
  },
  {
    "url": "https://api.github.com/repos/pandas-dev/pandas/issues/comments/445538543",
    "html_url": "https://github.com/pandas-dev/pandas/issues/24167#issuecomment-445538543",
    "issue_url": "https://api.github.com/repos/pandas-dev/pandas/issues/24167",
    "id": 445538543,
    "node_id": "MDEyOklzc3VlQ29tbWVudDQ0NTUzODU0Mw==",
    "user": {
      "login": "andrewgsavage",
      "id": 13157776,
      "node_id": "MDQ6VXNlcjEzMTU3Nzc2",
      "avatar_url": "https://avatars0.githubusercontent.com/u/13157776?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/andrewgsavage",
      "html_url": "https://github.com/andrewgsavage",
      "followers_url": "https://api.github.com/users/andrewgsavage/followers",
      "following_url": "https://api.github.com/users/andrewgsavage/following{/other_user}",
      "gists_url": "https://api.github.com/users/andrewgsavage/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/andrewgsavage/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/andrewgsavage/subscriptions",
      "organizations_url": "https://api.github.com/users/andrewgsavage/orgs",
      "repos_url": "https://api.github.com/users/andrewgsavage/repos",
      "events_url": "https://api.github.com/users/andrewgsavage/events{/privacy}",
      "received_events_url": "https://api.github.com/users/andrewgsavage/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2018-12-09T13:30:51Z",
    "updated_at": "2018-12-09T13:30:51Z",
    "author_association": "NONE",
    "body": "Oops yea, missed that.\n\n_values_for_factorize returns an array of quantity objects. Quantity\nobjects being necessary to prevent losing the units.\n\nSo I think I should be hitting that branch. The merge request makes the\nhashing tests pass for pint.\n\nOn Sun, 9 Dec 2018, 13:21 Tom Augspurger <notifications@github.com wrote:\n\n> Maybe missing a urreg = pint.UnitsRegistry()?\n> ------------------------------\n>\n> In your ExtensionArray, do you define _values_for_factorize()? If you're\n> able to return numeric values there, I *think* you shouldn't be hitting\n> this branch. I may be wrong though.\n>\n> â€”\n> You are receiving this because you authored the thread.\n> Reply to this email directly, view it on GitHub\n> <https://github.com/pandas-dev/pandas/issues/24167#issuecomment-445532870>,\n> or mute the thread\n> <https://github.com/notifications/unsubscribe-auth/AMjFkAVk-2WegnajSTGH8GfQGfWFjeQNks5u3QBQgaJpZM4ZJ3fs>\n> .\n>\n"
  },
  {
    "url": "https://api.github.com/repos/pandas-dev/pandas/issues/comments/445570705",
    "html_url": "https://github.com/pandas-dev/pandas/issues/24167#issuecomment-445570705",
    "issue_url": "https://api.github.com/repos/pandas-dev/pandas/issues/24167",
    "id": 445570705,
    "node_id": "MDEyOklzc3VlQ29tbWVudDQ0NTU3MDcwNQ==",
    "user": {
      "login": "TomAugspurger",
      "id": 1312546,
      "node_id": "MDQ6VXNlcjEzMTI1NDY=",
      "avatar_url": "https://avatars3.githubusercontent.com/u/1312546?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/TomAugspurger",
      "html_url": "https://github.com/TomAugspurger",
      "followers_url": "https://api.github.com/users/TomAugspurger/followers",
      "following_url": "https://api.github.com/users/TomAugspurger/following{/other_user}",
      "gists_url": "https://api.github.com/users/TomAugspurger/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/TomAugspurger/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/TomAugspurger/subscriptions",
      "organizations_url": "https://api.github.com/users/TomAugspurger/orgs",
      "repos_url": "https://api.github.com/users/TomAugspurger/repos",
      "events_url": "https://api.github.com/users/TomAugspurger/events{/privacy}",
      "received_events_url": "https://api.github.com/users/TomAugspurger/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2018-12-09T20:53:24Z",
    "updated_at": "2018-12-09T20:53:24Z",
    "author_association": "CONTRIBUTOR",
    "body": "> _values_for_factorize returns an array of quantity objects.\r\n\r\nThe default is to return an object-dtype ndarray, but ideally that would be avoided.\r\n\r\nI'll need to familiar myself with `PintArray`, but is the idea that the entire array has the same `unit`? If so, I *suspect* that `_values_for_factorize` could return something like the underlying `._data`. Maybe take a look at how `pandas.Categorical` does it. Since `factorize` returns the `labels, uniques` tuple, the `uniques` has all the type information we need to preserve things (the units in your case)."
  },
  {
    "url": "https://api.github.com/repos/pandas-dev/pandas/issues/comments/447378392",
    "html_url": "https://github.com/pandas-dev/pandas/issues/24167#issuecomment-447378392",
    "issue_url": "https://api.github.com/repos/pandas-dev/pandas/issues/24167",
    "id": 447378392,
    "node_id": "MDEyOklzc3VlQ29tbWVudDQ0NzM3ODM5Mg==",
    "user": {
      "login": "TomAugspurger",
      "id": 1312546,
      "node_id": "MDQ6VXNlcjEzMTI1NDY=",
      "avatar_url": "https://avatars3.githubusercontent.com/u/1312546?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/TomAugspurger",
      "html_url": "https://github.com/TomAugspurger",
      "followers_url": "https://api.github.com/users/TomAugspurger/followers",
      "following_url": "https://api.github.com/users/TomAugspurger/following{/other_user}",
      "gists_url": "https://api.github.com/users/TomAugspurger/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/TomAugspurger/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/TomAugspurger/subscriptions",
      "organizations_url": "https://api.github.com/users/TomAugspurger/orgs",
      "repos_url": "https://api.github.com/users/TomAugspurger/repos",
      "events_url": "https://api.github.com/users/TomAugspurger/events{/privacy}",
      "received_events_url": "https://api.github.com/users/TomAugspurger/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2018-12-14T16:32:11Z",
    "updated_at": "2018-12-14T16:32:11Z",
    "author_association": "CONTRIBUTOR",
    "body": "@andrewgsavage here's what I meant.\r\n\r\n```diff\r\ndiff --git a/pint/compat/__init__.py b/pint/compat/__init__.py\r\nindex 1fc438d..6fbf616 100644\r\n--- a/pint/compat/__init__.py\r\n+++ b/pint/compat/__init__.py\r\n@@ -126,9 +126,9 @@ if not HAS_PROPER_BABEL:\r\n \r\n try:\r\n     import pandas as pd\r\n-    HAS_PANDAS = True\r\n+    HAS_PROPER_PANDAS = HAS_PANDAS = True\r\n     # pin Pandas version for now\r\n-    HAS_PROPER_PANDAS = pd.__version__.startswith(\"0.24.0.dev0+625.gbdb7a16\")\r\n+    # HAS_PROPER_PANDAS = pd.__version__.startswith(\"0.24.0.dev0+625.gbdb7a16\")\r\n except ImportError:\r\n     HAS_PROPER_PANDAS = HAS_PANDAS = False\r\n \r\ndiff --git a/pint/pandas_interface/pint_array.py b/pint/pandas_interface/pint_array.py\r\nindex 935cc42..1d3dba7 100644\r\n--- a/pint/pandas_interface/pint_array.py\r\n+++ b/pint/pandas_interface/pint_array.py\r\n@@ -72,6 +72,11 @@ class PintArray(ExtensionArray, ExtensionOpsMixin):\r\n             assert self._dtype.type._REGISTRY == values._REGISTRY\r\n         self._data = self._coerce_to_pint_array(values, dtype=dtype, copy=copy)\r\n \r\n+    def _values_for_factorize(self):\r\n+        from pandas.core.dtypes.missing import na_value_for_dtype\r\n+        arr = np.asarray(self._data)\r\n+        return arr, na_value_for_dtype(arr.dtype)\r\n+\r\n     def _coerce_to_pint_array(self, values, dtype=None, copy=False):\r\n         if isinstance(values, self._dtype.type):\r\n             return values\r\n```\r\n\r\n\r\nWith that, things seemingly work\r\n\r\n```python\r\n\r\nIn [1]: paste\r\n>>> import pandas as pd\r\n>>> import numpy as np\r\n>>> import pint\r\n>>> from pint.pandas_interface import PintArray\r\n\r\n>>> ureg = pint.UnitRegistry()\r\n>>> Q_ = ureg.Quantity\r\n>>> torque = PintArray(Q_([1, 2, 2, 3], \"lbf ft\"))\r\n>>> angular_velocity = PintArray(Q_([1000, 2000, 2000, 3000], \"rpm\"))\r\n>>> df = pd.DataFrame({\"torque\": torque, \"angular_velocity\": angular_velocity})\r\n## -- End pasted text --\r\n\r\nIn [2]: pd.util.hash_pandas_object(df.torque)\r\nOut[2]:\r\n0    14639053686158035780\r\n1     3869563279212530728\r\n2     1687604933839263903\r\n3     7587835399775615123\r\ndtype: uint64\r\n```\r\n\r\n\r\n`pandas.core` is private, so you shouldn't use that. We could maybe add `na_value_for_dtype` to the public API in `api.types`.\r\n\r\nThat does cause warnings. Presumably there's a way to turn a pint array to an ndarray without that.\r\n\r\nAnd it seemingly broke `factorize`. I haven't looked yet at why, but `_from_factorize` will presumably need to be updated."
  },
  {
    "url": "https://api.github.com/repos/pandas-dev/pandas/issues/comments/449584416",
    "html_url": "https://github.com/pandas-dev/pandas/issues/24167#issuecomment-449584416",
    "issue_url": "https://api.github.com/repos/pandas-dev/pandas/issues/24167",
    "id": 449584416,
    "node_id": "MDEyOklzc3VlQ29tbWVudDQ0OTU4NDQxNg==",
    "user": {
      "login": "andrewgsavage",
      "id": 13157776,
      "node_id": "MDQ6VXNlcjEzMTU3Nzc2",
      "avatar_url": "https://avatars0.githubusercontent.com/u/13157776?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/andrewgsavage",
      "html_url": "https://github.com/andrewgsavage",
      "followers_url": "https://api.github.com/users/andrewgsavage/followers",
      "following_url": "https://api.github.com/users/andrewgsavage/following{/other_user}",
      "gists_url": "https://api.github.com/users/andrewgsavage/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/andrewgsavage/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/andrewgsavage/subscriptions",
      "organizations_url": "https://api.github.com/users/andrewgsavage/orgs",
      "repos_url": "https://api.github.com/users/andrewgsavage/repos",
      "events_url": "https://api.github.com/users/andrewgsavage/events{/privacy}",
      "received_events_url": "https://api.github.com/users/andrewgsavage/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2018-12-22T17:06:21Z",
    "updated_at": "2018-12-22T17:06:21Z",
    "author_association": "NONE",
    "body": "Cheers that worked after modifying _from_factorize. Can use np.NaN there so no need to add that to the public API.\r\n\r\nThere's a few other imports from pandas.core that I guess need changing now I'm aware."
  },
  {
    "url": "https://api.github.com/repos/pandas-dev/pandas/issues/comments/451652213",
    "html_url": "https://github.com/pandas-dev/pandas/issues/24167#issuecomment-451652213",
    "issue_url": "https://api.github.com/repos/pandas-dev/pandas/issues/24167",
    "id": 451652213,
    "node_id": "MDEyOklzc3VlQ29tbWVudDQ1MTY1MjIxMw==",
    "user": {
      "login": "TomAugspurger",
      "id": 1312546,
      "node_id": "MDQ6VXNlcjEzMTI1NDY=",
      "avatar_url": "https://avatars3.githubusercontent.com/u/1312546?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/TomAugspurger",
      "html_url": "https://github.com/TomAugspurger",
      "followers_url": "https://api.github.com/users/TomAugspurger/followers",
      "following_url": "https://api.github.com/users/TomAugspurger/following{/other_user}",
      "gists_url": "https://api.github.com/users/TomAugspurger/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/TomAugspurger/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/TomAugspurger/subscriptions",
      "organizations_url": "https://api.github.com/users/TomAugspurger/orgs",
      "repos_url": "https://api.github.com/users/TomAugspurger/repos",
      "events_url": "https://api.github.com/users/TomAugspurger/events{/privacy}",
      "received_events_url": "https://api.github.com/users/TomAugspurger/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2019-01-05T12:38:10Z",
    "updated_at": "2019-01-05T12:38:10Z",
    "author_association": "CONTRIBUTOR",
    "body": "I think no action is needed here right now."
  }
]
