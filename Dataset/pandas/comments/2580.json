[
  {
    "url": "https://api.github.com/repos/pandas-dev/pandas/issues/comments/11630802",
    "html_url": "https://github.com/pandas-dev/pandas/issues/2580#issuecomment-11630802",
    "issue_url": "https://api.github.com/repos/pandas-dev/pandas/issues/2580",
    "id": 11630802,
    "node_id": "MDEyOklzc3VlQ29tbWVudDExNjMwODAy",
    "user": {
      "login": "jreback",
      "id": 953992,
      "node_id": "MDQ6VXNlcjk1Mzk5Mg==",
      "avatar_url": "https://avatars2.githubusercontent.com/u/953992?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/jreback",
      "html_url": "https://github.com/jreback",
      "followers_url": "https://api.github.com/users/jreback/followers",
      "following_url": "https://api.github.com/users/jreback/following{/other_user}",
      "gists_url": "https://api.github.com/users/jreback/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/jreback/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/jreback/subscriptions",
      "organizations_url": "https://api.github.com/users/jreback/orgs",
      "repos_url": "https://api.github.com/users/jreback/repos",
      "events_url": "https://api.github.com/users/jreback/events{/privacy}",
      "received_events_url": "https://api.github.com/users/jreback/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2012-12-21T23:48:23Z",
    "updated_at": "2012-12-22T00:08:52Z",
    "author_association": "CONTRIBUTOR",
    "body": "see the following\n\nhttp://comments.gmane.org/gmane.comp.python\nhttp://stackoverflow.com/questions/11194927/deleting-information-from-an-hdf5-file\n\nIn my experience it is necessary to recreate the file in order to reclaim the space\n\nthere is going to be a section in the pandas dev docs (it's not updated quite yet)\nhttp://pandas.pydata.org/pandas-docs/dev/io.html#delete-from-a-table\n\nas an aside even though h5py can read these file they r built using Pytables, so a \nptdump -av file.h5 gives a listing of all of the attributes IMHO a more concise format\n\nOn Dec 21, 2012, at 6:39 PM, rafaljozefowicz notifications@github.com wrote:\n\n> I noticed some really weird behaviour of new HD5Store. I am using pandas 0.10.0 and pytables 2.4.0.\n> \n> When I try to serialize my Panel structure and then remove it from the store, the memory is not reclaimed - the store appears to be empty while it is still using 90MB on my hard drive.\n> \n> I am trying to find any repro steps using synthetic data but so far I am failing - It is working as I would expect (file becomes empty after removal of the panel). I can't give you the actual files/data but maybe any stats of the h5 file itself would be helpful.\n> \n> What makes it even worse, when I repeat the same operation over and over again, h5 file grows to ~num_iterations \\* 90MB in size while still appearing as empty. I am able to reproduce it every single time with my dataset.\n> \n> My code:\n> \n> # some_panel is a ~ 30 x 10000 x 30 structure with mostly floats:\n> \n> store = pd.HDFStore(file_name)\n> store[\"panel\"] = some_panel\n> del store[\"panel\"]\n> store\n> Output:\n> \n> <class 'pandas.io.pytables.HDFStore'>\n> File path: <my_file_name>\n> Empty\n> However, the file is 90M big. Here is the h5dump output of my file:\n> \n> HDF5 \"<my_file_name.h5>\" {\n> GROUP \"/\" {\n>    ATTRIBUTE \"CLASS\" {\n>       DATATYPE  H5T_STRING {\n>          STRSIZE 5;\n>          STRPAD H5T_STR_NULLTERM;\n>          CSET H5T_CSET_ASCII;\n>          CTYPE H5T_C_S1;\n>       }\n>       DATASPACE  SCALAR\n>       DATA {\n>       (0): \"GROUP\"\n>       }\n>    }\n>    ATTRIBUTE \"PYTABLES_FORMAT_VERSION\" {\n>       DATATYPE  H5T_STRING {\n>          STRSIZE 3;\n>          STRPAD H5T_STR_NULLTERM;\n>          CSET H5T_CSET_ASCII;\n>          CTYPE H5T_C_S1;\n>       }\n>       DATASPACE  SCALAR\n>       DATA {\n>       (0): \"2.0\"\n>       }\n>    }\n>    ATTRIBUTE \"TITLE\" {\n>       DATATYPE  H5T_STRING {\n>          STRSIZE 1;\n>          STRPAD H5T_STR_NULLTERM;\n>          CSET H5T_CSET_ASCII;\n>          CTYPE H5T_C_S1;\n>       }\n>       DATASPACE  SCALAR\n>       DATA {\n>       (0): \"\"\n>       }\n>    }\n>    ATTRIBUTE \"VERSION\" {\n>       DATATYPE  H5T_STRING {\n>          STRSIZE 3;\n>          STRPAD H5T_STR_NULLTERM;\n>          CSET H5T_CSET_ASCII;\n>          CTYPE H5T_C_S1;\n>       }\n>       DATASPACE  SCALAR\n>       DATA {\n>       (0): \"1.0\"\n>       }\n>    }\n> }\n> }\n> and h5debug output:\n> \n> Reading signature at address 0 (rel)\n> File Super Block...\n> File name (as opened):                             <my_file_name>\n> File name (after resolving symlinks):             <my_file_name>\n> File access flags                                  0x00000000\n> File open reference count:                         1\n> Address of super block:                            0 (abs)\n> Size of userblock:                                 0 bytes\n> Superblock version number:                         0\n> Free list version number:                          0\n> Root group symbol table entry version number:      0\n> Shared header version number:                      0\n> Size of file offsets (haddr_t type):               8 bytes\n> Size of file lengths (hsize_t type):               8 bytes\n> Symbol table leaf node 1/2 rank:                   4\n> Symbol table internal node 1/2 rank:               16\n> File status flags:                                 0x00\n> Superblock extension address:                      UNDEF (rel)\n> Shared object header message table address:        UNDEF (rel)\n> Shared object header message version number:       0\n> Number of shared object header message indexes:    0\n> Address of driver information block:               UNDEF (rel)\n> Root group symbol table entry:\n>    Name offset into private heap:                  0\n>    Object header address:                          96\n>    Cache info type:                                Symbol Table\n>    Cached entry information:\n>       B-tree address:                              136\n>       Heap address:                                680\n> and h5stat:\n> \n> Filename: <my_file_name>\n> File information\n>         # of unique groups: 1\n>         # of unique datasets: 0\n>         # of unique named datatypes: 0\n>         # of unique links: 0\n>         # of unique other: 0\n>         Max. # of links to object: 1\n>         Max. # of objects in group: 0\n> File space information for file metadata (in bytes):\n>         Superblock extension: 0\n>         User block: 0\n>         Object headers: (total/unused)\n>                 Groups: 272/0\n>                 Datasets(exclude compact data): 0/0\n>                 Datatypes: 0/0\n>         Groups:\n>                 B-tree/List: 544\n>                 Heap: 120\n>         Attributes:\n>                 B-tree/List: 0\n>                 Heap: 0\n>         Chunked datasets:\n>                 Index: 0\n>         Datasets:\n>                 Heap: 0\n>         Shared Messages:\n>                 Header: 0\n>                 B-tree/List: 0\n>                 Heap: 0\n> Small groups:\n>         # of groups of size 0: 1\n>         Total # of small groups: 1\n> Group bins:\n>         # of groups of size 0: 1\n>         Total # of groups: 1\n> Small # of attributes:\n>         # of objects with 4 attributes: 1\n>         Total # of objects with small # of attributes: 1\n> Attribute bins:\n>         # of objects with 1 - 9 attributes: 1\n>         Total # of objects with attributes: 1\n>         Max. # of attributes to objects: 4\n> Summary of file space information:\n>   File metadata: 936 bytes\n>   Raw data: 0 bytes\n>   Unaccounted space: 94094088 bytes\n> Total space: 94095024 bytes\n> Total space is showing actual space on the drive ~90MB. Let me know if I can provide any more information\n> \n> â€”\n> Reply to this email directly or view it on GitHub.\n"
  },
  {
    "url": "https://api.github.com/repos/pandas-dev/pandas/issues/comments/11631151",
    "html_url": "https://github.com/pandas-dev/pandas/issues/2580#issuecomment-11631151",
    "issue_url": "https://api.github.com/repos/pandas-dev/pandas/issues/2580",
    "id": 11631151,
    "node_id": "MDEyOklzc3VlQ29tbWVudDExNjMxMTUx",
    "user": {
      "login": "rafaljozefowicz",
      "id": 2983769,
      "node_id": "MDQ6VXNlcjI5ODM3Njk=",
      "avatar_url": "https://avatars1.githubusercontent.com/u/2983769?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/rafaljozefowicz",
      "html_url": "https://github.com/rafaljozefowicz",
      "followers_url": "https://api.github.com/users/rafaljozefowicz/followers",
      "following_url": "https://api.github.com/users/rafaljozefowicz/following{/other_user}",
      "gists_url": "https://api.github.com/users/rafaljozefowicz/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/rafaljozefowicz/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/rafaljozefowicz/subscriptions",
      "organizations_url": "https://api.github.com/users/rafaljozefowicz/orgs",
      "repos_url": "https://api.github.com/users/rafaljozefowicz/repos",
      "events_url": "https://api.github.com/users/rafaljozefowicz/events{/privacy}",
      "received_events_url": "https://api.github.com/users/rafaljozefowicz/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2012-12-22T00:09:53Z",
    "updated_at": "2012-12-22T00:09:53Z",
    "author_association": "NONE",
    "body": "Thanks, that is my workaround right now.\n\nptdump -av gives me:\n\n```\n/ (RootGroup) ''\n  /._v_attrs (AttributeSet), 4 attributes:\n   [CLASS := 'GROUP',\n    PYTABLES_FORMAT_VERSION := '2.0',\n    TITLE := '',\n    VERSION := '1.0']\n```\n\nWhat is interesting is that I fail to reproduce this with any other data, for example:\n\n``` python\ndef generate_data():\n    data = {}\n    index = pd.date_range(\"2012-01-01\", periods=10000)\n    for item in range(30):\n        data[item] = {}\n        for minor in range(30):\n            data[item][minor] = pd.TimeSeries(index=index, data=np.random.random(len(index)))\n    return data\n\nfor i in xrange(5):\n    test_store = pd.HDFStore(file_name)\n    test_store[\"panel\"] = pd.Panel(generate_data())\n    #test_store[\"panel\"] = some_panel\n    test_store.flush()\n    test_store.close()\n    print(\"File size is: %s\" % (os.stat(file_name).st_size))\nout = !rm -f $file_name\n```\n\nGives me:\n\n```\nFile size is: 72087960\nFile size is: 72088296\nFile size is: 72088600\nFile size is: 72088656\nFile size is: 72088656\n```\n\nWhen I try to do the same with my dataset, here is the output:\n\n```\nFile size is: 94095024\nFile size is: 174072904\nFile size is: 253002152\nFile size is: 331933384\nFile size is: 410862568\n```\n"
  },
  {
    "url": "https://api.github.com/repos/pandas-dev/pandas/issues/comments/11631389",
    "html_url": "https://github.com/pandas-dev/pandas/issues/2580#issuecomment-11631389",
    "issue_url": "https://api.github.com/repos/pandas-dev/pandas/issues/2580",
    "id": 11631389,
    "node_id": "MDEyOklzc3VlQ29tbWVudDExNjMxMzg5",
    "user": {
      "login": "jreback",
      "id": 953992,
      "node_id": "MDQ6VXNlcjk1Mzk5Mg==",
      "avatar_url": "https://avatars2.githubusercontent.com/u/953992?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/jreback",
      "html_url": "https://github.com/jreback",
      "followers_url": "https://api.github.com/users/jreback/followers",
      "following_url": "https://api.github.com/users/jreback/following{/other_user}",
      "gists_url": "https://api.github.com/users/jreback/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/jreback/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/jreback/subscriptions",
      "organizations_url": "https://api.github.com/users/jreback/orgs",
      "repos_url": "https://api.github.com/users/jreback/repos",
      "events_url": "https://api.github.com/users/jreback/events{/privacy}",
      "received_events_url": "https://api.github.com/users/jreback/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2012-12-22T00:25:16Z",
    "updated_at": "2012-12-22T01:03:18Z",
    "author_association": "CONTRIBUTOR",
    "body": "That looks odd. Best guess is that your data somehow hits an 'optimization' in PyTables that is meant to align data. If yours were slightly bigger than this size (as opposed to the test data being slightly smaller), the PyTables (or the HDF5 library) might move it to a new section each time. \n\nSo, you could try cutting your data slightly as a test to see if that fixes it (not that this is a good solution, but might tell you the problem).\n\nAlso can try to store the data as a table and see if it changes.\n\nto store\n`store.append('panel',panel)`\n\nto retrieve\n`store.select('panel')`\n\ntry deleting in the same manner as before\n\nalso when 0.10.1 comes out you can convert to a multi-index frame and store it....\n"
  },
  {
    "url": "https://api.github.com/repos/pandas-dev/pandas/issues/comments/11632079",
    "html_url": "https://github.com/pandas-dev/pandas/issues/2580#issuecomment-11632079",
    "issue_url": "https://api.github.com/repos/pandas-dev/pandas/issues/2580",
    "id": 11632079,
    "node_id": "MDEyOklzc3VlQ29tbWVudDExNjMyMDc5",
    "user": {
      "login": "rafaljozefowicz",
      "id": 2983769,
      "node_id": "MDQ6VXNlcjI5ODM3Njk=",
      "avatar_url": "https://avatars1.githubusercontent.com/u/2983769?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/rafaljozefowicz",
      "html_url": "https://github.com/rafaljozefowicz",
      "followers_url": "https://api.github.com/users/rafaljozefowicz/followers",
      "following_url": "https://api.github.com/users/rafaljozefowicz/following{/other_user}",
      "gists_url": "https://api.github.com/users/rafaljozefowicz/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/rafaljozefowicz/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/rafaljozefowicz/subscriptions",
      "organizations_url": "https://api.github.com/users/rafaljozefowicz/orgs",
      "repos_url": "https://api.github.com/users/rafaljozefowicz/repos",
      "events_url": "https://api.github.com/users/rafaljozefowicz/events{/privacy}",
      "received_events_url": "https://api.github.com/users/rafaljozefowicz/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2012-12-22T01:18:11Z",
    "updated_at": "2012-12-22T01:18:11Z",
    "author_association": "NONE",
    "body": "dtype('object') seems to be causing problems:\n\n``` python\nfor i in xrange(5):\n    test_store = pd.HDFStore(file_name)\n    test_store[\"series\"] = pd.Series(np.zeros(0, dtype=dtype('object')))\n    #test_store[\"series\"] = pd.Series(np.zeros(0))\n    del test_store[\"series\"]\n    test_store.flush()\n\n    test_store.close()\n    print(\"File size is: %s\" % (os.stat(file_name).st_size))\nout = !rm -f $file_name\n```\n\nOutputs:\n\n```\nFile size is: 11840\nFile size is: 22704\nFile size is: 33568\nFile size is: 44432\nFile size is: 55296\n```\n"
  },
  {
    "url": "https://api.github.com/repos/pandas-dev/pandas/issues/comments/11632321",
    "html_url": "https://github.com/pandas-dev/pandas/issues/2580#issuecomment-11632321",
    "issue_url": "https://api.github.com/repos/pandas-dev/pandas/issues/2580",
    "id": 11632321,
    "node_id": "MDEyOklzc3VlQ29tbWVudDExNjMyMzIx",
    "user": {
      "login": "jreback",
      "id": 953992,
      "node_id": "MDQ6VXNlcjk1Mzk5Mg==",
      "avatar_url": "https://avatars2.githubusercontent.com/u/953992?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/jreback",
      "html_url": "https://github.com/jreback",
      "followers_url": "https://api.github.com/users/jreback/followers",
      "following_url": "https://api.github.com/users/jreback/following{/other_user}",
      "gists_url": "https://api.github.com/users/jreback/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/jreback/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/jreback/subscriptions",
      "organizations_url": "https://api.github.com/users/jreback/orgs",
      "repos_url": "https://api.github.com/users/jreback/repos",
      "events_url": "https://api.github.com/users/jreback/events{/privacy}",
      "received_events_url": "https://api.github.com/users/jreback/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2012-12-22T01:36:00Z",
    "updated_at": "2012-12-22T01:36:00Z",
    "author_association": "CONTRIBUTOR",
    "body": "Definitely could be. Best not store pure 'object' types. PyTables pickles these I believe, and therefor cannot do a very efficient job of it. Try doing something like this on  your data before your store it.\n\n`Panel(dict([ (k.v.convert_objects()) for k, v in panel.iteritems() ])`\n\nthis tries to force get convert any object types in your data - which can happen sometimes after multiple operations\nn.b. convert_objects doesn't exist on Panel (at this time)...only on frames\n"
  },
  {
    "url": "https://api.github.com/repos/pandas-dev/pandas/issues/comments/12463492",
    "html_url": "https://github.com/pandas-dev/pandas/issues/2580#issuecomment-12463492",
    "issue_url": "https://api.github.com/repos/pandas-dev/pandas/issues/2580",
    "id": 12463492,
    "node_id": "MDEyOklzc3VlQ29tbWVudDEyNDYzNDky",
    "user": {
      "login": "jreback",
      "id": 953992,
      "node_id": "MDQ6VXNlcjk1Mzk5Mg==",
      "avatar_url": "https://avatars2.githubusercontent.com/u/953992?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/jreback",
      "html_url": "https://github.com/jreback",
      "followers_url": "https://api.github.com/users/jreback/followers",
      "following_url": "https://api.github.com/users/jreback/following{/other_user}",
      "gists_url": "https://api.github.com/users/jreback/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/jreback/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/jreback/subscriptions",
      "organizations_url": "https://api.github.com/users/jreback/orgs",
      "repos_url": "https://api.github.com/users/jreback/repos",
      "events_url": "https://api.github.com/users/jreback/events{/privacy}",
      "received_events_url": "https://api.github.com/users/jreback/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2013-01-19T23:58:41Z",
    "updated_at": "2013-01-19T23:58:41Z",
    "author_association": "CONTRIBUTOR",
    "body": "any objection to closing this? or are there additional issues?\n"
  },
  {
    "url": "https://api.github.com/repos/pandas-dev/pandas/issues/comments/12471685",
    "html_url": "https://github.com/pandas-dev/pandas/issues/2580#issuecomment-12471685",
    "issue_url": "https://api.github.com/repos/pandas-dev/pandas/issues/2580",
    "id": 12471685,
    "node_id": "MDEyOklzc3VlQ29tbWVudDEyNDcxNjg1",
    "user": {
      "login": "rafaljozefowicz",
      "id": 2983769,
      "node_id": "MDQ6VXNlcjI5ODM3Njk=",
      "avatar_url": "https://avatars1.githubusercontent.com/u/2983769?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/rafaljozefowicz",
      "html_url": "https://github.com/rafaljozefowicz",
      "followers_url": "https://api.github.com/users/rafaljozefowicz/followers",
      "following_url": "https://api.github.com/users/rafaljozefowicz/following{/other_user}",
      "gists_url": "https://api.github.com/users/rafaljozefowicz/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/rafaljozefowicz/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/rafaljozefowicz/subscriptions",
      "organizations_url": "https://api.github.com/users/rafaljozefowicz/orgs",
      "repos_url": "https://api.github.com/users/rafaljozefowicz/repos",
      "events_url": "https://api.github.com/users/rafaljozefowicz/events{/privacy}",
      "received_events_url": "https://api.github.com/users/rafaljozefowicz/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2013-01-20T14:58:46Z",
    "updated_at": "2013-01-20T14:58:46Z",
    "author_association": "NONE",
    "body": "Thanks, I didn't notice any other issues\n"
  }
]
