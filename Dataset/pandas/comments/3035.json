[
  {
    "url": "https://api.github.com/repos/pandas-dev/pandas/issues/comments/14848998",
    "html_url": "https://github.com/pandas-dev/pandas/issues/3035#issuecomment-14848998",
    "issue_url": "https://api.github.com/repos/pandas-dev/pandas/issues/3035",
    "id": 14848998,
    "node_id": "MDEyOklzc3VlQ29tbWVudDE0ODQ4OTk4",
    "user": {
      "login": "ghost",
      "id": 10137,
      "node_id": "MDQ6VXNlcjEwMTM3",
      "avatar_url": "https://avatars3.githubusercontent.com/u/10137?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/ghost",
      "html_url": "https://github.com/ghost",
      "followers_url": "https://api.github.com/users/ghost/followers",
      "following_url": "https://api.github.com/users/ghost/following{/other_user}",
      "gists_url": "https://api.github.com/users/ghost/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/ghost/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/ghost/subscriptions",
      "organizations_url": "https://api.github.com/users/ghost/orgs",
      "repos_url": "https://api.github.com/users/ghost/repos",
      "events_url": "https://api.github.com/users/ghost/events{/privacy}",
      "received_events_url": "https://api.github.com/users/ghost/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2013-03-13T15:44:24Z",
    "updated_at": "2013-03-13T17:48:05Z",
    "author_association": "NONE",
    "body": "Short answer: added a fix to #3031. \n\n``` python\nIn [11]: N=12\n    ...: dates = pd.date_range('01-Jan-2013', periods=N, freq='MS')\n    ...: ts = pd.TimeSeries(randn(N), index=dates)\n    ...: ts.groupby(lambda key: key[0:4]).first()\n---------------------------------------------------------------------------\n\nAssertionError: Grouper result violates len(labels) == len(data)\nresult: [2013-01-01 00:00:00, 2013-02-01 00:00:00, 2013-03-01 00:00:00, 2013-04-01 00:00:00]\n```\n\nVery long answer:\nI think this is a case where pandas is too clever by half.\n\nWhen your grouper is a function, it's applied using `index.map`.\n`index.map` tries really hard to guess what you want, and so if the function\nthrows an exception when applied to the elements, it's tried again on the entire \nindex as a sequence and the result is used as the grouping result.\n\nPresumably, `lambda key: str(key)[0:4]` is what you wanted, but you're using `key[0:4]` when \nkey is a `Timestamp`, so that failes, the fallback path is triggered and you end\nup getting the first 4 elements of _the index_, rather then a sequence of the first \n4 chars of _each element_.\nThat produces a label/data len mismatch, which is uncaught by the cython code\ndown the road, which borks (similar to #3011 from a few days ago, but a different code path).\n\nThe fix in #3011, still doesn't address the corner case where an erroneous lambda throws an exception\non the element, but returns a result of the correct length when applied to the entire index:\n\n``` python\nIn [17]: N=5\n    ...: dates = pd.date_range('01-Jan-2013', periods=N, freq='MS')\n    ...: ts = pd.TimeSeries(randn(N), index=dates)\n    ...: ts.groupby(lambda key: key[0:len(ts.index)]).count()\nOut[17]: \n2013-01-01    1\n2013-02-01    1\n2013-03-01    1\n2013-04-01    1\n2013-05-01    1\ndtype: int64\n```\n\ncompare with `lambda key: str(key)[0:len(ts.index)]`:\n\n``` python\nIn [16]: N=5\n    ...: dates = pd.date_range('01-Jan-2013', periods=N, freq='MS')\n    ...: ts = pd.TimeSeries(randn(N), index=dates)\n    ...: ts.groupby(lambda key: str(key)[0:len(ts.index)]).count()\nOut[16]: \n2013-    5\ndtype: int64\n```\n\nThat could give someone a nasty surprise. \n\nComments in the code suggest that in the hands of a trained professional\nthis is a feature, not a bug. well, ok then.\n\n**EDIT**: this behaviour is specific to DatetimeIndex, and it's actually the other way around, first\nthe index itself is tried, then each element, [code](https://github.com/pydata/pandas/blob/master/pandas/tseries/index.py#L1218)\n"
  },
  {
    "url": "https://api.github.com/repos/pandas-dev/pandas/issues/comments/15024549",
    "html_url": "https://github.com/pandas-dev/pandas/issues/3035#issuecomment-15024549",
    "issue_url": "https://api.github.com/repos/pandas-dev/pandas/issues/3035",
    "id": 15024549,
    "node_id": "MDEyOklzc3VlQ29tbWVudDE1MDI0NTQ5",
    "user": {
      "login": "ghost",
      "id": 10137,
      "node_id": "MDQ6VXNlcjEwMTM3",
      "avatar_url": "https://avatars3.githubusercontent.com/u/10137?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/ghost",
      "html_url": "https://github.com/ghost",
      "followers_url": "https://api.github.com/users/ghost/followers",
      "following_url": "https://api.github.com/users/ghost/following{/other_user}",
      "gists_url": "https://api.github.com/users/ghost/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/ghost/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/ghost/subscriptions",
      "organizations_url": "https://api.github.com/users/ghost/orgs",
      "repos_url": "https://api.github.com/users/ghost/repos",
      "events_url": "https://api.github.com/users/ghost/events{/privacy}",
      "received_events_url": "https://api.github.com/users/ghost/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2013-03-17T15:33:15Z",
    "updated_at": "2013-03-17T15:33:15Z",
    "author_association": "NONE",
    "body": "fixed in master.\n"
  }
]
