[
  {
    "url": "https://api.github.com/repos/pandas-dev/pandas/issues/comments/306169616",
    "html_url": "https://github.com/pandas-dev/pandas/pull/16599#issuecomment-306169616",
    "issue_url": "https://api.github.com/repos/pandas-dev/pandas/issues/16599",
    "id": 306169616,
    "node_id": "MDEyOklzc3VlQ29tbWVudDMwNjE2OTYxNg==",
    "user": {
      "login": "codecov[bot]",
      "id": 22429695,
      "node_id": "MDM6Qm90MjI0Mjk2OTU=",
      "avatar_url": "https://avatars2.githubusercontent.com/in/254?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/codecov%5Bbot%5D",
      "html_url": "https://github.com/apps/codecov",
      "followers_url": "https://api.github.com/users/codecov%5Bbot%5D/followers",
      "following_url": "https://api.github.com/users/codecov%5Bbot%5D/following{/other_user}",
      "gists_url": "https://api.github.com/users/codecov%5Bbot%5D/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/codecov%5Bbot%5D/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/codecov%5Bbot%5D/subscriptions",
      "organizations_url": "https://api.github.com/users/codecov%5Bbot%5D/orgs",
      "repos_url": "https://api.github.com/users/codecov%5Bbot%5D/repos",
      "events_url": "https://api.github.com/users/codecov%5Bbot%5D/events{/privacy}",
      "received_events_url": "https://api.github.com/users/codecov%5Bbot%5D/received_events",
      "type": "Bot",
      "site_admin": false
    },
    "created_at": "2017-06-05T11:51:27Z",
    "updated_at": "2017-06-05T11:51:27Z",
    "author_association": "NONE",
    "body": "# [Codecov](https://codecov.io/gh/pandas-dev/pandas/pull/16599?src=pr&el=h1) Report\n> Merging [#16599](https://codecov.io/gh/pandas-dev/pandas/pull/16599?src=pr&el=desc) into [master](https://codecov.io/gh/pandas-dev/pandas/commit/bf9997520443e0a5f505f11e11f46290ea95b3a3?src=pr&el=desc) will **decrease** coverage by `<.01%`.\n> The diff coverage is `100%`.\n\n[![Impacted file tree graph](https://codecov.io/gh/pandas-dev/pandas/pull/16599/graphs/tree.svg?src=pr&token=eZ4WkYLtcO&width=650&height=150)](https://codecov.io/gh/pandas-dev/pandas/pull/16599?src=pr&el=tree)\n\n```diff\n@@            Coverage Diff             @@\n##           master   #16599      +/-   ##\n==========================================\n- Coverage   90.93%   90.93%   -0.01%     \n==========================================\n  Files         161      161              \n  Lines       49267    49253      -14     \n==========================================\n- Hits        44800    44787      -13     \n+ Misses       4467     4466       -1\n```\n\n| Flag | Coverage Δ | |\n|---|---|---|\n| #multiple | `88.69% <100%> (-0.01%)` | :arrow_down: |\n| #single | `40.23% <0%> (+0.01%)` | :arrow_up: |\n\n| [Impacted Files](https://codecov.io/gh/pandas-dev/pandas/pull/16599?src=pr&el=tree) | Coverage Δ | |\n|---|---|---|\n| [pandas/core/reshape/pivot.py](https://codecov.io/gh/pandas-dev/pandas/pull/16599?src=pr&el=tree#diff-cGFuZGFzL2NvcmUvcmVzaGFwZS9waXZvdC5weQ==) | `95.2% <100%> (+0.11%)` | :arrow_up: |\n\n------\n\n[Continue to review full report at Codecov](https://codecov.io/gh/pandas-dev/pandas/pull/16599?src=pr&el=continue).\n> **Legend** - [Click here to learn more](https://docs.codecov.io/docs/codecov-delta)\n> `Δ = absolute <relative> (impact)`, `ø = not affected`, `? = missing data`\n> Powered by [Codecov](https://codecov.io/gh/pandas-dev/pandas/pull/16599?src=pr&el=footer). Last update [bf99975...268ce49](https://codecov.io/gh/pandas-dev/pandas/pull/16599?src=pr&el=lastupdated). Read the [comment docs](https://docs.codecov.io/docs/pull-request-comments).\n"
  },
  {
    "url": "https://api.github.com/repos/pandas-dev/pandas/issues/comments/306169626",
    "html_url": "https://github.com/pandas-dev/pandas/pull/16599#issuecomment-306169626",
    "issue_url": "https://api.github.com/repos/pandas-dev/pandas/issues/16599",
    "id": 306169626,
    "node_id": "MDEyOklzc3VlQ29tbWVudDMwNjE2OTYyNg==",
    "user": {
      "login": "codecov[bot]",
      "id": 22429695,
      "node_id": "MDM6Qm90MjI0Mjk2OTU=",
      "avatar_url": "https://avatars2.githubusercontent.com/in/254?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/codecov%5Bbot%5D",
      "html_url": "https://github.com/apps/codecov",
      "followers_url": "https://api.github.com/users/codecov%5Bbot%5D/followers",
      "following_url": "https://api.github.com/users/codecov%5Bbot%5D/following{/other_user}",
      "gists_url": "https://api.github.com/users/codecov%5Bbot%5D/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/codecov%5Bbot%5D/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/codecov%5Bbot%5D/subscriptions",
      "organizations_url": "https://api.github.com/users/codecov%5Bbot%5D/orgs",
      "repos_url": "https://api.github.com/users/codecov%5Bbot%5D/repos",
      "events_url": "https://api.github.com/users/codecov%5Bbot%5D/events{/privacy}",
      "received_events_url": "https://api.github.com/users/codecov%5Bbot%5D/received_events",
      "type": "Bot",
      "site_admin": false
    },
    "created_at": "2017-06-05T11:51:30Z",
    "updated_at": "2017-07-25T15:48:31Z",
    "author_association": "NONE",
    "body": "# [Codecov](https://codecov.io/gh/pandas-dev/pandas/pull/16599?src=pr&el=h1) Report\n> Merging [#16599](https://codecov.io/gh/pandas-dev/pandas/pull/16599?src=pr&el=desc) into [master](https://codecov.io/gh/pandas-dev/pandas/commit/793020293ee1e5fa023f45c12943a4ac51cc23d0?src=pr&el=desc) will **increase** coverage by `1.57%`.\n> The diff coverage is `100%`.\n\n[![Impacted file tree graph](https://codecov.io/gh/pandas-dev/pandas/pull/16599/graphs/tree.svg?height=150&width=650&token=eZ4WkYLtcO&src=pr)](https://codecov.io/gh/pandas-dev/pandas/pull/16599?src=pr&el=tree)\n\n```diff\n@@            Coverage Diff             @@\n##           master   #16599      +/-   ##\n==========================================\n+ Coverage   91.02%    92.6%   +1.57%     \n==========================================\n  Files         161      161              \n  Lines       49393    63210   +13817     \n==========================================\n+ Hits        44962    58536   +13574     \n- Misses       4431     4674     +243\n```\n\n| Flag | Coverage Δ | |\n|---|---|---|\n| #multiple | `90.42% <100%> (+1.64%)` | :arrow_up: |\n| #single | `44.48% <4.65%> (+4.14%)` | :arrow_up: |\n\n| [Impacted Files](https://codecov.io/gh/pandas-dev/pandas/pull/16599?src=pr&el=tree) | Coverage Δ | |\n|---|---|---|\n| [pandas/core/reshape/pivot.py](https://codecov.io/gh/pandas-dev/pandas/pull/16599?src=pr&el=tree#diff-cGFuZGFzL2NvcmUvcmVzaGFwZS9waXZvdC5weQ==) | `97.51% <100%> (+2.32%)` | :arrow_up: |\n| [pandas/io/gbq.py](https://codecov.io/gh/pandas-dev/pandas/pull/16599?src=pr&el=tree#diff-cGFuZGFzL2lvL2dicS5weQ==) | `25% <0%> (-58.34%)` | :arrow_down: |\n| [pandas/util/\\_print\\_versions.py](https://codecov.io/gh/pandas-dev/pandas/pull/16599?src=pr&el=tree#diff-cGFuZGFzL3V0aWwvX3ByaW50X3ZlcnNpb25zLnB5) | `14.28% <0%> (-1.43%)` | :arrow_down: |\n| [pandas/core/config\\_init.py](https://codecov.io/gh/pandas-dev/pandas/pull/16599?src=pr&el=tree#diff-cGFuZGFzL2NvcmUvY29uZmlnX2luaXQucHk=) | `95.33% <0%> (-0.57%)` | :arrow_down: |\n| [pandas/core/computation/eval.py](https://codecov.io/gh/pandas-dev/pandas/pull/16599?src=pr&el=tree#diff-cGFuZGFzL2NvcmUvY29tcHV0YXRpb24vZXZhbC5weQ==) | `96.47% <0%> (-0.46%)` | :arrow_down: |\n| [pandas/core/common.py](https://codecov.io/gh/pandas-dev/pandas/pull/16599?src=pr&el=tree#diff-cGFuZGFzL2NvcmUvY29tbW9uLnB5) | `91.26% <0%> (-0.18%)` | :arrow_down: |\n| [pandas/core/indexes/category.py](https://codecov.io/gh/pandas-dev/pandas/pull/16599?src=pr&el=tree#diff-cGFuZGFzL2NvcmUvaW5kZXhlcy9jYXRlZ29yeS5weQ==) | `98.53% <0%> (+0.02%)` | :arrow_up: |\n| [pandas/core/panel.py](https://codecov.io/gh/pandas-dev/pandas/pull/16599?src=pr&el=tree#diff-cGFuZGFzL2NvcmUvcGFuZWwucHk=) | `97.03% <0%> (+0.11%)` | :arrow_up: |\n| [pandas/tseries/frequencies.py](https://codecov.io/gh/pandas-dev/pandas/pull/16599?src=pr&el=tree#diff-cGFuZGFzL3RzZXJpZXMvZnJlcXVlbmNpZXMucHk=) | `96.87% <0%> (+0.2%)` | :arrow_up: |\n| [pandas/core/categorical.py](https://codecov.io/gh/pandas-dev/pandas/pull/16599?src=pr&el=tree#diff-cGFuZGFzL2NvcmUvY2F0ZWdvcmljYWwucHk=) | `95.82% <0%> (+0.36%)` | :arrow_up: |\n| ... and [40 more](https://codecov.io/gh/pandas-dev/pandas/pull/16599?src=pr&el=tree-more) | |\n\n------\n\n[Continue to review full report at Codecov](https://codecov.io/gh/pandas-dev/pandas/pull/16599?src=pr&el=continue).\n> **Legend** - [Click here to learn more](https://docs.codecov.io/docs/codecov-delta)\n> `Δ = absolute <relative> (impact)`, `ø = not affected`, `? = missing data`\n> Powered by [Codecov](https://codecov.io/gh/pandas-dev/pandas/pull/16599?src=pr&el=footer). Last update [7930202...93cb736](https://codecov.io/gh/pandas-dev/pandas/pull/16599?src=pr&el=lastupdated). Read the [comment docs](https://docs.codecov.io/docs/pull-request-comments).\n"
  },
  {
    "url": "https://api.github.com/repos/pandas-dev/pandas/issues/comments/307333165",
    "html_url": "https://github.com/pandas-dev/pandas/pull/16599#issuecomment-307333165",
    "issue_url": "https://api.github.com/repos/pandas-dev/pandas/issues/16599",
    "id": 307333165,
    "node_id": "MDEyOklzc3VlQ29tbWVudDMwNzMzMzE2NQ==",
    "user": {
      "login": "cmohl2013",
      "id": 4705426,
      "node_id": "MDQ6VXNlcjQ3MDU0MjY=",
      "avatar_url": "https://avatars0.githubusercontent.com/u/4705426?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/cmohl2013",
      "html_url": "https://github.com/cmohl2013",
      "followers_url": "https://api.github.com/users/cmohl2013/followers",
      "following_url": "https://api.github.com/users/cmohl2013/following{/other_user}",
      "gists_url": "https://api.github.com/users/cmohl2013/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/cmohl2013/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/cmohl2013/subscriptions",
      "organizations_url": "https://api.github.com/users/cmohl2013/orgs",
      "repos_url": "https://api.github.com/users/cmohl2013/repos",
      "events_url": "https://api.github.com/users/cmohl2013/events{/privacy}",
      "received_events_url": "https://api.github.com/users/cmohl2013/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2017-06-09T08:49:02Z",
    "updated_at": "2017-06-09T08:49:02Z",
    "author_association": "CONTRIBUTOR",
    "body": "Ok. Thank you for checking. I'll modify the error messages and add the whatsnew.\r\n\r\nCould someone comment on my point above: I think that margins are not calculated correctly when normalize is set to 'columns' or 'index'. See my example above. Should I post a bug report for that? Or is the calculation correct?  "
  },
  {
    "url": "https://api.github.com/repos/pandas-dev/pandas/issues/comments/308387357",
    "html_url": "https://github.com/pandas-dev/pandas/pull/16599#issuecomment-308387357",
    "issue_url": "https://api.github.com/repos/pandas-dev/pandas/issues/16599",
    "id": 308387357,
    "node_id": "MDEyOklzc3VlQ29tbWVudDMwODM4NzM1Nw==",
    "user": {
      "login": "cmohl2013",
      "id": 4705426,
      "node_id": "MDQ6VXNlcjQ3MDU0MjY=",
      "avatar_url": "https://avatars0.githubusercontent.com/u/4705426?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/cmohl2013",
      "html_url": "https://github.com/cmohl2013",
      "followers_url": "https://api.github.com/users/cmohl2013/followers",
      "following_url": "https://api.github.com/users/cmohl2013/following{/other_user}",
      "gists_url": "https://api.github.com/users/cmohl2013/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/cmohl2013/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/cmohl2013/subscriptions",
      "organizations_url": "https://api.github.com/users/cmohl2013/orgs",
      "repos_url": "https://api.github.com/users/cmohl2013/repos",
      "events_url": "https://api.github.com/users/cmohl2013/events{/privacy}",
      "received_events_url": "https://api.github.com/users/cmohl2013/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2017-06-14T10:11:14Z",
    "updated_at": "2017-06-14T10:11:14Z",
    "author_association": "CONTRIBUTOR",
    "body": "I tried to implement the changes as requested. I also modified some values in validation data of test_margin_dropna, because the expected margin values were not correct."
  },
  {
    "url": "https://api.github.com/repos/pandas-dev/pandas/issues/comments/311990116",
    "html_url": "https://github.com/pandas-dev/pandas/pull/16599#issuecomment-311990116",
    "issue_url": "https://api.github.com/repos/pandas-dev/pandas/issues/16599",
    "id": 311990116,
    "node_id": "MDEyOklzc3VlQ29tbWVudDMxMTk5MDExNg==",
    "user": {
      "login": "cmohl2013",
      "id": 4705426,
      "node_id": "MDQ6VXNlcjQ3MDU0MjY=",
      "avatar_url": "https://avatars0.githubusercontent.com/u/4705426?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/cmohl2013",
      "html_url": "https://github.com/cmohl2013",
      "followers_url": "https://api.github.com/users/cmohl2013/followers",
      "following_url": "https://api.github.com/users/cmohl2013/following{/other_user}",
      "gists_url": "https://api.github.com/users/cmohl2013/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/cmohl2013/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/cmohl2013/subscriptions",
      "organizations_url": "https://api.github.com/users/cmohl2013/orgs",
      "repos_url": "https://api.github.com/users/cmohl2013/repos",
      "events_url": "https://api.github.com/users/cmohl2013/events{/privacy}",
      "received_events_url": "https://api.github.com/users/cmohl2013/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2017-06-29T14:48:32Z",
    "updated_at": "2017-06-29T14:48:32Z",
    "author_association": "CONTRIBUTOR",
    "body": "@jreback \r\nI reformatted the test to be more readable, as you requested. is it ok now? "
  },
  {
    "url": "https://api.github.com/repos/pandas-dev/pandas/issues/comments/316344046",
    "html_url": "https://github.com/pandas-dev/pandas/pull/16599#issuecomment-316344046",
    "issue_url": "https://api.github.com/repos/pandas-dev/pandas/issues/16599",
    "id": 316344046,
    "node_id": "MDEyOklzc3VlQ29tbWVudDMxNjM0NDA0Ng==",
    "user": {
      "login": "jreback",
      "id": 953992,
      "node_id": "MDQ6VXNlcjk1Mzk5Mg==",
      "avatar_url": "https://avatars2.githubusercontent.com/u/953992?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/jreback",
      "html_url": "https://github.com/jreback",
      "followers_url": "https://api.github.com/users/jreback/followers",
      "following_url": "https://api.github.com/users/jreback/following{/other_user}",
      "gists_url": "https://api.github.com/users/jreback/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/jreback/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/jreback/subscriptions",
      "organizations_url": "https://api.github.com/users/jreback/orgs",
      "repos_url": "https://api.github.com/users/jreback/repos",
      "events_url": "https://api.github.com/users/jreback/events{/privacy}",
      "received_events_url": "https://api.github.com/users/jreback/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2017-07-19T10:34:19Z",
    "updated_at": "2017-07-19T10:34:19Z",
    "author_association": "CONTRIBUTOR",
    "body": "@gfyoung can you have a look\r\n@toobaz can you have a look"
  },
  {
    "url": "https://api.github.com/repos/pandas-dev/pandas/issues/comments/316396330",
    "html_url": "https://github.com/pandas-dev/pandas/pull/16599#issuecomment-316396330",
    "issue_url": "https://api.github.com/repos/pandas-dev/pandas/issues/16599",
    "id": 316396330,
    "node_id": "MDEyOklzc3VlQ29tbWVudDMxNjM5NjMzMA==",
    "user": {
      "login": "toobaz",
      "id": 1224492,
      "node_id": "MDQ6VXNlcjEyMjQ0OTI=",
      "avatar_url": "https://avatars1.githubusercontent.com/u/1224492?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/toobaz",
      "html_url": "https://github.com/toobaz",
      "followers_url": "https://api.github.com/users/toobaz/followers",
      "following_url": "https://api.github.com/users/toobaz/following{/other_user}",
      "gists_url": "https://api.github.com/users/toobaz/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/toobaz/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/toobaz/subscriptions",
      "organizations_url": "https://api.github.com/users/toobaz/orgs",
      "repos_url": "https://api.github.com/users/toobaz/repos",
      "events_url": "https://api.github.com/users/toobaz/events{/privacy}",
      "received_events_url": "https://api.github.com/users/toobaz/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2017-07-19T13:58:46Z",
    "updated_at": "2017-07-19T14:00:18Z",
    "author_association": "MEMBER",
    "body": "@cmohl2013 Sorry for coming in the discussion now only.\r\n\r\nThis said: from #15150 :\r\n\r\n> Possible solution: calling pivot_table in crosstab always with margins=False, then\r\n> do normalization and finally call _add_margins, if margins=True.\r\n\r\nI wonder whether we couldn't directly fix ``pivot_table``... as an ugly hack, the following seems to work: https://github.com/pandas-dev/pandas/compare/master...toobaz:crosstab_hack?expand=1\r\n\r\n(it's not just a hack - one of the two changes just works around #17024 I think - it will also fail on >2 levels... but it seems pretty simple to fix)"
  },
  {
    "url": "https://api.github.com/repos/pandas-dev/pandas/issues/comments/316629274",
    "html_url": "https://github.com/pandas-dev/pandas/pull/16599#issuecomment-316629274",
    "issue_url": "https://api.github.com/repos/pandas-dev/pandas/issues/16599",
    "id": 316629274,
    "node_id": "MDEyOklzc3VlQ29tbWVudDMxNjYyOTI3NA==",
    "user": {
      "login": "cmohl2013",
      "id": 4705426,
      "node_id": "MDQ6VXNlcjQ3MDU0MjY=",
      "avatar_url": "https://avatars0.githubusercontent.com/u/4705426?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/cmohl2013",
      "html_url": "https://github.com/cmohl2013",
      "followers_url": "https://api.github.com/users/cmohl2013/followers",
      "following_url": "https://api.github.com/users/cmohl2013/following{/other_user}",
      "gists_url": "https://api.github.com/users/cmohl2013/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/cmohl2013/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/cmohl2013/subscriptions",
      "organizations_url": "https://api.github.com/users/cmohl2013/orgs",
      "repos_url": "https://api.github.com/users/cmohl2013/repos",
      "events_url": "https://api.github.com/users/cmohl2013/events{/privacy}",
      "received_events_url": "https://api.github.com/users/cmohl2013/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2017-07-20T08:07:12Z",
    "updated_at": "2017-07-20T08:07:12Z",
    "author_association": "CONTRIBUTOR",
    "body": "@toobaz Yes, fixing pivot_table was my original plan as commented in #15150, but I did not manage to come up with a good solution, so I implemented adding margins in crosstable directly. \r\nYour solution looks good to me (and can be adjusted as soon as #17024 is fixed).\r\n"
  },
  {
    "url": "https://api.github.com/repos/pandas-dev/pandas/issues/comments/317820546",
    "html_url": "https://github.com/pandas-dev/pandas/pull/16599#issuecomment-317820546",
    "issue_url": "https://api.github.com/repos/pandas-dev/pandas/issues/16599",
    "id": 317820546,
    "node_id": "MDEyOklzc3VlQ29tbWVudDMxNzgyMDU0Ng==",
    "user": {
      "login": "cmohl2013",
      "id": 4705426,
      "node_id": "MDQ6VXNlcjQ3MDU0MjY=",
      "avatar_url": "https://avatars0.githubusercontent.com/u/4705426?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/cmohl2013",
      "html_url": "https://github.com/cmohl2013",
      "followers_url": "https://api.github.com/users/cmohl2013/followers",
      "following_url": "https://api.github.com/users/cmohl2013/following{/other_user}",
      "gists_url": "https://api.github.com/users/cmohl2013/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/cmohl2013/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/cmohl2013/subscriptions",
      "organizations_url": "https://api.github.com/users/cmohl2013/orgs",
      "repos_url": "https://api.github.com/users/cmohl2013/repos",
      "events_url": "https://api.github.com/users/cmohl2013/events{/privacy}",
      "received_events_url": "https://api.github.com/users/cmohl2013/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2017-07-25T18:04:58Z",
    "updated_at": "2017-07-25T18:04:58Z",
    "author_association": "CONTRIBUTOR",
    "body": "@toobaz \r\nI tried your solution, but then ran into problems with concat and MultiIndex. So I ended up with my previous solution and added the function _add_margins_to_multiindex as workaround for #17024. I left a comment in the code that the workaround should be removed when #17024 is solved. "
  },
  {
    "url": "https://api.github.com/repos/pandas-dev/pandas/issues/comments/317894981",
    "html_url": "https://github.com/pandas-dev/pandas/pull/16599#issuecomment-317894981",
    "issue_url": "https://api.github.com/repos/pandas-dev/pandas/issues/16599",
    "id": 317894981,
    "node_id": "MDEyOklzc3VlQ29tbWVudDMxNzg5NDk4MQ==",
    "user": {
      "login": "toobaz",
      "id": 1224492,
      "node_id": "MDQ6VXNlcjEyMjQ0OTI=",
      "avatar_url": "https://avatars1.githubusercontent.com/u/1224492?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/toobaz",
      "html_url": "https://github.com/toobaz",
      "followers_url": "https://api.github.com/users/toobaz/followers",
      "following_url": "https://api.github.com/users/toobaz/following{/other_user}",
      "gists_url": "https://api.github.com/users/toobaz/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/toobaz/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/toobaz/subscriptions",
      "organizations_url": "https://api.github.com/users/toobaz/orgs",
      "repos_url": "https://api.github.com/users/toobaz/repos",
      "events_url": "https://api.github.com/users/toobaz/events{/privacy}",
      "received_events_url": "https://api.github.com/users/toobaz/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2017-07-25T22:46:32Z",
    "updated_at": "2017-07-25T22:46:32Z",
    "author_association": "MEMBER",
    "body": "> I tried your solution, but then ran into problems with concat and MultiIndex\r\n\r\nCouldn't we try to solve these problems? I'd be happy to help.\r\n\r\nOn the other hand, the current PR introduces a lot of code duplication which I personally would prefer to avoid. Moreover, my understanding (admittedly after just a quick glance at the changes) is that you are fixing something in ``crosstable`` but the same exact problem will remain in ``pivot_table``, while if you fix it in ``pivot_table`` then ``crosstable`` will automatically benefit.\r\n\r\n(Disclaimer: those are just suggestions, I'm not a maintainer)"
  },
  {
    "url": "https://api.github.com/repos/pandas-dev/pandas/issues/comments/318026318",
    "html_url": "https://github.com/pandas-dev/pandas/pull/16599#issuecomment-318026318",
    "issue_url": "https://api.github.com/repos/pandas-dev/pandas/issues/16599",
    "id": 318026318,
    "node_id": "MDEyOklzc3VlQ29tbWVudDMxODAyNjMxOA==",
    "user": {
      "login": "cmohl2013",
      "id": 4705426,
      "node_id": "MDQ6VXNlcjQ3MDU0MjY=",
      "avatar_url": "https://avatars0.githubusercontent.com/u/4705426?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/cmohl2013",
      "html_url": "https://github.com/cmohl2013",
      "followers_url": "https://api.github.com/users/cmohl2013/followers",
      "following_url": "https://api.github.com/users/cmohl2013/following{/other_user}",
      "gists_url": "https://api.github.com/users/cmohl2013/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/cmohl2013/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/cmohl2013/subscriptions",
      "organizations_url": "https://api.github.com/users/cmohl2013/orgs",
      "repos_url": "https://api.github.com/users/cmohl2013/repos",
      "events_url": "https://api.github.com/users/cmohl2013/events{/privacy}",
      "received_events_url": "https://api.github.com/users/cmohl2013/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2017-07-26T11:28:08Z",
    "updated_at": "2017-07-26T11:28:08Z",
    "author_association": "CONTRIBUTOR",
    "body": "@toobaz \r\n\r\n>On the other hand, the current PR introduces a lot of code duplication which I personally would >prefer to avoid.\r\n\r\nIn fact, it reduces the code. We get rid of the whole margins dropping and fixing that goes on in lines  568 to 606 (in the master branch). Here we have also a separate calculation of margins, independent from the calculation in pivot_table. So the PR did not introduce this duplication of margins calculation, it was there before. \r\n\r\nHowever, I see your point that it is not good to use different code to either calculate margins in pivot_table or crosstable. I find the calculation of margins in pivot_table not very readable and cryptic. Would it be an option to transfer the code for calculating margins how I did it in crosstable to pivot_table and rewrite _add_margins? Could well be that I miss something and that it would be not as easy. What do you think?"
  },
  {
    "url": "https://api.github.com/repos/pandas-dev/pandas/issues/comments/331650565",
    "html_url": "https://github.com/pandas-dev/pandas/pull/16599#issuecomment-331650565",
    "issue_url": "https://api.github.com/repos/pandas-dev/pandas/issues/16599",
    "id": 331650565,
    "node_id": "MDEyOklzc3VlQ29tbWVudDMzMTY1MDU2NQ==",
    "user": {
      "login": "jreback",
      "id": 953992,
      "node_id": "MDQ6VXNlcjk1Mzk5Mg==",
      "avatar_url": "https://avatars2.githubusercontent.com/u/953992?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/jreback",
      "html_url": "https://github.com/jreback",
      "followers_url": "https://api.github.com/users/jreback/followers",
      "following_url": "https://api.github.com/users/jreback/following{/other_user}",
      "gists_url": "https://api.github.com/users/jreback/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/jreback/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/jreback/subscriptions",
      "organizations_url": "https://api.github.com/users/jreback/orgs",
      "repos_url": "https://api.github.com/users/jreback/repos",
      "events_url": "https://api.github.com/users/jreback/events{/privacy}",
      "received_events_url": "https://api.github.com/users/jreback/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2017-09-23T16:56:06Z",
    "updated_at": "2017-09-23T16:56:06Z",
    "author_association": "CONTRIBUTOR",
    "body": "not sure what to do with this PR. @toobaz want to take a look and see how we can reconcile this (and other's indicated above)"
  },
  {
    "url": "https://api.github.com/repos/pandas-dev/pandas/issues/comments/331701785",
    "html_url": "https://github.com/pandas-dev/pandas/pull/16599#issuecomment-331701785",
    "issue_url": "https://api.github.com/repos/pandas-dev/pandas/issues/16599",
    "id": 331701785,
    "node_id": "MDEyOklzc3VlQ29tbWVudDMzMTcwMTc4NQ==",
    "user": {
      "login": "toobaz",
      "id": 1224492,
      "node_id": "MDQ6VXNlcjEyMjQ0OTI=",
      "avatar_url": "https://avatars1.githubusercontent.com/u/1224492?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/toobaz",
      "html_url": "https://github.com/toobaz",
      "followers_url": "https://api.github.com/users/toobaz/followers",
      "following_url": "https://api.github.com/users/toobaz/following{/other_user}",
      "gists_url": "https://api.github.com/users/toobaz/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/toobaz/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/toobaz/subscriptions",
      "organizations_url": "https://api.github.com/users/toobaz/orgs",
      "repos_url": "https://api.github.com/users/toobaz/repos",
      "events_url": "https://api.github.com/users/toobaz/events{/privacy}",
      "received_events_url": "https://api.github.com/users/toobaz/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2017-09-24T10:46:31Z",
    "updated_at": "2017-09-24T10:46:31Z",
    "author_association": "MEMBER",
    "body": "@jreback @cmohl2013 sorry for disappearing\r\n\r\n> In fact, it reduces the code\r\n\r\nCool, but this is not a guarantee that there is no (also future) duplication involved... and the fact that you call ``pivot_table`` with ``margins=False`` looks to me conceptually wrong (the ``if margins:`` part really mostly replicates stuff from ``pivot_table``).\r\n\r\n> Would it be an option to transfer the code for calculating margins how I did it in crosstable to pivot_table and rewrite _add_margins?\r\n\r\nProbably, yes. I admit I'm a bit confused (and rebasing could help): the bug you are fixing is raised in the call to ``_normalize`` inside ``crosstab``. So either 1) ``_normalize`` must be fixed, or 2) the input that ``crosstab`` passes to ``_normalize`` is in some way wrong (or both). Now [my approach](https://github.com/pandas-dev/pandas/compare/master...toobaz:crosstab_hack) just fixed ``_normalize``, and apparently worked. So I tend to exclude that 2) is a problem. However, most of your changes take effect _before_ the call to ``_normalize``. Maybe some of them are good, but I fail to understand their purpose. Are they unrelated to the bug?\r\n\r\nOh, by the way:\r\n\r\n> When debugging this issue I came across some unexpected results for margins\r\n\r\nAdmittedly the result looks strange and the design choice can be discussed, but it is, strictly speaking, correct. You are asking to normalize columns, which means that each column should add up to 1... including the ``All`` column. But if you think this is worth reconsidering (i.e. \"_first_ normalize, _then_ calculate margins\"), I suggest to do so in a separate issue."
  },
  {
    "url": "https://api.github.com/repos/pandas-dev/pandas/issues/comments/343575633",
    "html_url": "https://github.com/pandas-dev/pandas/pull/16599#issuecomment-343575633",
    "issue_url": "https://api.github.com/repos/pandas-dev/pandas/issues/16599",
    "id": 343575633,
    "node_id": "MDEyOklzc3VlQ29tbWVudDM0MzU3NTYzMw==",
    "user": {
      "login": "jreback",
      "id": 953992,
      "node_id": "MDQ6VXNlcjk1Mzk5Mg==",
      "avatar_url": "https://avatars2.githubusercontent.com/u/953992?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/jreback",
      "html_url": "https://github.com/jreback",
      "followers_url": "https://api.github.com/users/jreback/followers",
      "following_url": "https://api.github.com/users/jreback/following{/other_user}",
      "gists_url": "https://api.github.com/users/jreback/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/jreback/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/jreback/subscriptions",
      "organizations_url": "https://api.github.com/users/jreback/orgs",
      "repos_url": "https://api.github.com/users/jreback/repos",
      "events_url": "https://api.github.com/users/jreback/events{/privacy}",
      "received_events_url": "https://api.github.com/users/jreback/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2017-11-10T20:19:16Z",
    "updated_at": "2017-11-10T20:19:16Z",
    "author_association": "CONTRIBUTOR",
    "body": "closing as stale. if you'd like to continue working, pls ping."
  }
]
