[
  {
    "url": "https://api.github.com/repos/pandas-dev/pandas/issues/comments/391521544",
    "html_url": "https://github.com/pandas-dev/pandas/issues/21184#issuecomment-391521544",
    "issue_url": "https://api.github.com/repos/pandas-dev/pandas/issues/21184",
    "id": 391521544,
    "node_id": "MDEyOklzc3VlQ29tbWVudDM5MTUyMTU0NA==",
    "user": {
      "login": "jschendel",
      "id": 5332445,
      "node_id": "MDQ6VXNlcjUzMzI0NDU=",
      "avatar_url": "https://avatars3.githubusercontent.com/u/5332445?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/jschendel",
      "html_url": "https://github.com/jschendel",
      "followers_url": "https://api.github.com/users/jschendel/followers",
      "following_url": "https://api.github.com/users/jschendel/following{/other_user}",
      "gists_url": "https://api.github.com/users/jschendel/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/jschendel/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/jschendel/subscriptions",
      "organizations_url": "https://api.github.com/users/jschendel/orgs",
      "repos_url": "https://api.github.com/users/jschendel/repos",
      "events_url": "https://api.github.com/users/jschendel/events{/privacy}",
      "received_events_url": "https://api.github.com/users/jschendel/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2018-05-23T22:39:48Z",
    "updated_at": "2018-05-23T22:39:48Z",
    "author_association": "MEMBER",
    "body": "Thanks, I can confirm that this bug is occurring on master.  PR to fix is welcome!"
  },
  {
    "url": "https://api.github.com/repos/pandas-dev/pandas/issues/comments/391522084",
    "html_url": "https://github.com/pandas-dev/pandas/issues/21184#issuecomment-391522084",
    "issue_url": "https://api.github.com/repos/pandas-dev/pandas/issues/21184",
    "id": 391522084,
    "node_id": "MDEyOklzc3VlQ29tbWVudDM5MTUyMjA4NA==",
    "user": {
      "login": "jschendel",
      "id": 5332445,
      "node_id": "MDQ6VXNlcjUzMzI0NDU=",
      "avatar_url": "https://avatars3.githubusercontent.com/u/5332445?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/jschendel",
      "html_url": "https://github.com/jschendel",
      "followers_url": "https://api.github.com/users/jschendel/followers",
      "following_url": "https://api.github.com/users/jschendel/following{/other_user}",
      "gists_url": "https://api.github.com/users/jschendel/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/jschendel/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/jschendel/subscriptions",
      "organizations_url": "https://api.github.com/users/jschendel/orgs",
      "repos_url": "https://api.github.com/users/jschendel/repos",
      "events_url": "https://api.github.com/users/jschendel/events{/privacy}",
      "received_events_url": "https://api.github.com/users/jschendel/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2018-05-23T22:41:34Z",
    "updated_at": "2018-05-23T22:41:34Z",
    "author_association": "MEMBER",
    "body": "xref #14844 : a similar `merge_asof` tz-aware issue that's been fixed, and could potentially be useful for determining a fix here (not certain though)."
  },
  {
    "url": "https://api.github.com/repos/pandas-dev/pandas/issues/comments/391531448",
    "html_url": "https://github.com/pandas-dev/pandas/issues/21184#issuecomment-391531448",
    "issue_url": "https://api.github.com/repos/pandas-dev/pandas/issues/21184",
    "id": 391531448,
    "node_id": "MDEyOklzc3VlQ29tbWVudDM5MTUzMTQ0OA==",
    "user": {
      "login": "ldmnt",
      "id": 39568069,
      "node_id": "MDQ6VXNlcjM5NTY4MDY5",
      "avatar_url": "https://avatars2.githubusercontent.com/u/39568069?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/ldmnt",
      "html_url": "https://github.com/ldmnt",
      "followers_url": "https://api.github.com/users/ldmnt/followers",
      "following_url": "https://api.github.com/users/ldmnt/following{/other_user}",
      "gists_url": "https://api.github.com/users/ldmnt/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/ldmnt/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/ldmnt/subscriptions",
      "organizations_url": "https://api.github.com/users/ldmnt/orgs",
      "repos_url": "https://api.github.com/users/ldmnt/repos",
      "events_url": "https://api.github.com/users/ldmnt/events{/privacy}",
      "received_events_url": "https://api.github.com/users/ldmnt/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2018-05-23T23:22:43Z",
    "updated_at": "2018-05-23T23:22:55Z",
    "author_association": "NONE",
    "body": "I'd be glad to help, but have no experience in contributing to a big project. So I can try to find a fix when I have time to dive into it, but no promises yet ! :)"
  },
  {
    "url": "https://api.github.com/repos/pandas-dev/pandas/issues/comments/391546919",
    "html_url": "https://github.com/pandas-dev/pandas/issues/21184#issuecomment-391546919",
    "issue_url": "https://api.github.com/repos/pandas-dev/pandas/issues/21184",
    "id": 391546919,
    "node_id": "MDEyOklzc3VlQ29tbWVudDM5MTU0NjkxOQ==",
    "user": {
      "login": "mroeschke",
      "id": 10647082,
      "node_id": "MDQ6VXNlcjEwNjQ3MDgy",
      "avatar_url": "https://avatars0.githubusercontent.com/u/10647082?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/mroeschke",
      "html_url": "https://github.com/mroeschke",
      "followers_url": "https://api.github.com/users/mroeschke/followers",
      "following_url": "https://api.github.com/users/mroeschke/following{/other_user}",
      "gists_url": "https://api.github.com/users/mroeschke/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/mroeschke/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/mroeschke/subscriptions",
      "organizations_url": "https://api.github.com/users/mroeschke/orgs",
      "repos_url": "https://api.github.com/users/mroeschke/repos",
      "events_url": "https://api.github.com/users/mroeschke/events{/privacy}",
      "received_events_url": "https://api.github.com/users/mroeschke/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2018-05-24T00:36:14Z",
    "updated_at": "2018-05-24T00:36:14Z",
    "author_association": "MEMBER",
    "body": "When  the `_get_merge_keys` function preps the keys in `pandas/core/reshape/merge.py`, essentially this happens:\r\n\r\n```\r\nIn [8]: left\r\nOut[8]:\r\n                     by_col  on_col values\r\n0 2018-01-01 00:00:00+00:00       2      a\r\n\r\nIn [9]: left_naive\r\nOut[9]:\r\n      by_col  on_col values\r\n0 2018-01-01       2      a\r\n\r\nIn [10]: left._get_label_or_level_values('by_col')\r\nOut[10]: DatetimeIndex(['2018-01-01'], dtype='datetime64[ns, UTC]', freq=None)\r\n\r\nIn [11]: left_naive._get_label_or_level_values('by_col')\r\nOut[11]: array(['2018-01-01T00:00:00.000000000'], dtype='datetime64[ns]')\r\n```\r\n\r\nThe results are cast to object dtype, but are passed to a cython function that expects a numpy array instead of an Index. A `.values` call is needed somewhere in the flow to cast timezone aware keys to a numpy array."
  },
  {
    "url": "https://api.github.com/repos/pandas-dev/pandas/issues/comments/392019260",
    "html_url": "https://github.com/pandas-dev/pandas/issues/21184#issuecomment-392019260",
    "issue_url": "https://api.github.com/repos/pandas-dev/pandas/issues/21184",
    "id": 392019260,
    "node_id": "MDEyOklzc3VlQ29tbWVudDM5MjAxOTI2MA==",
    "user": {
      "login": "jreback",
      "id": 953992,
      "node_id": "MDQ6VXNlcjk1Mzk5Mg==",
      "avatar_url": "https://avatars2.githubusercontent.com/u/953992?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/jreback",
      "html_url": "https://github.com/jreback",
      "followers_url": "https://api.github.com/users/jreback/followers",
      "following_url": "https://api.github.com/users/jreback/following{/other_user}",
      "gists_url": "https://api.github.com/users/jreback/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/jreback/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/jreback/subscriptions",
      "organizations_url": "https://api.github.com/users/jreback/orgs",
      "repos_url": "https://api.github.com/users/jreback/repos",
      "events_url": "https://api.github.com/users/jreback/events{/privacy}",
      "received_events_url": "https://api.github.com/users/jreback/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2018-05-25T11:04:18Z",
    "updated_at": "2018-05-25T11:04:18Z",
    "author_association": "CONTRIBUTOR",
    "body": "here's a patch to fix. prob could use some general refactoring in this routine (maybe), but can do in the future \r\n```\r\ndiff --git a/pandas/core/reshape/merge.py b/pandas/core/reshape/merge.py\r\nindex 4d8897fb7..58454d0cf 100644\r\n--- a/pandas/core/reshape/merge.py\r\n+++ b/pandas/core/reshape/merge.py\r\n@@ -1420,6 +1420,11 @@ class _AsOfMerge(_OrderedMerge):\r\n                 left_by_values = flip(left_by_values)\r\n                 right_by_values = flip(right_by_values)\r\n \r\n+            # initial type conversion as needed\r\n+            if needs_i8_conversion(left_by_values):\r\n+                left_by_values = left_by_values.view('i8')\r\n+                right_by_values = right_by_values.view('i8')\r\n+\r\n             # upcast 'by' parameter because HashTable is limited\r\n             by_type = _get_cython_type_upcast(left_by_values.dtype)\r\n             by_type_caster = _type_casters[by_type]\r\n```"
  },
  {
    "url": "https://api.github.com/repos/pandas-dev/pandas/issues/comments/392110295",
    "html_url": "https://github.com/pandas-dev/pandas/issues/21184#issuecomment-392110295",
    "issue_url": "https://api.github.com/repos/pandas-dev/pandas/issues/21184",
    "id": 392110295,
    "node_id": "MDEyOklzc3VlQ29tbWVudDM5MjExMDI5NQ==",
    "user": {
      "login": "ldmnt",
      "id": 39568069,
      "node_id": "MDQ6VXNlcjM5NTY4MDY5",
      "avatar_url": "https://avatars2.githubusercontent.com/u/39568069?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/ldmnt",
      "html_url": "https://github.com/ldmnt",
      "followers_url": "https://api.github.com/users/ldmnt/followers",
      "following_url": "https://api.github.com/users/ldmnt/following{/other_user}",
      "gists_url": "https://api.github.com/users/ldmnt/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/ldmnt/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/ldmnt/subscriptions",
      "organizations_url": "https://api.github.com/users/ldmnt/orgs",
      "repos_url": "https://api.github.com/users/ldmnt/repos",
      "events_url": "https://api.github.com/users/ldmnt/events{/privacy}",
      "received_events_url": "https://api.github.com/users/ldmnt/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2018-05-25T16:24:07Z",
    "updated_at": "2018-05-25T17:08:44Z",
    "author_association": "NONE",
    "body": "I was actually looking into a fix too this morning, and in the process found out that the bug originated in a typing issue in the following function of pandas/core/generic.py (line 1327) :  \r\n```\r\n def _get_label_or_level_values(self, key, axis=0, stacklevel=1):\r\n        \"\"\"\r\n        Return a 1-D array of values associated with `key`, a label or level\r\n        from the given `axis`.\r\n```\r\nThe expected return type is a numpy array, but the following (line 1375) :\r\n```\r\nvalues = self.xs(key, axis=other_axes[0])._values\r\n```\r\nproduces a DateTimeIndex in the case when _values is accessed on a tz-aware datetime Series.\r\nThis is because _values is overridden in pandas/core/indexes/datetimes.py (line 675):\r\n```\r\n@property\r\n    def _values(self):\r\n        # tz-naive -> ndarray\r\n        # tz-aware -> DatetimeIndex\r\n        if self.tz is not None:\r\n            return self\r\n        else:\r\n            return self.values\r\n```\r\n\r\nedit: The problem i'm pointing out also yields an error when doing things such as\r\n```\r\nleft = pd.DataFrame({'on_col': pd.DatetimeIndex(['2018-01-01']).tz_localize('UTC'), 'values': ['a']})\r\nright = pd.DataFrame({'values': ['b']}, index=pd.DatetimeIndex(['2018-01-01']).tz_localize('UTC'))\r\n\r\nmerged = left.merge(right, left_on='on_col', right_index=True)\r\n```\r\nSorry for the lack of details, i'm a bit out of time right now, i can elaborate later if needed."
  },
  {
    "url": "https://api.github.com/repos/pandas-dev/pandas/issues/comments/451368087",
    "html_url": "https://github.com/pandas-dev/pandas/issues/21184#issuecomment-451368087",
    "issue_url": "https://api.github.com/repos/pandas-dev/pandas/issues/21184",
    "id": 451368087,
    "node_id": "MDEyOklzc3VlQ29tbWVudDQ1MTM2ODA4Nw==",
    "user": {
      "login": "mroeschke",
      "id": 10647082,
      "node_id": "MDQ6VXNlcjEwNjQ3MDgy",
      "avatar_url": "https://avatars0.githubusercontent.com/u/10647082?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/mroeschke",
      "html_url": "https://github.com/mroeschke",
      "followers_url": "https://api.github.com/users/mroeschke/followers",
      "following_url": "https://api.github.com/users/mroeschke/following{/other_user}",
      "gists_url": "https://api.github.com/users/mroeschke/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/mroeschke/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/mroeschke/subscriptions",
      "organizations_url": "https://api.github.com/users/mroeschke/orgs",
      "repos_url": "https://api.github.com/users/mroeschke/repos",
      "events_url": "https://api.github.com/users/mroeschke/events{/privacy}",
      "received_events_url": "https://api.github.com/users/mroeschke/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2019-01-04T07:12:22Z",
    "updated_at": "2019-01-04T07:12:22Z",
    "author_association": "MEMBER",
    "body": "This looks to be fixed on master now. Could use a test."
  }
]
