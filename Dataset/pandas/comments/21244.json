[
  {
    "url": "https://api.github.com/repos/pandas-dev/pandas/issues/comments/465357926",
    "html_url": "https://github.com/pandas-dev/pandas/issues/21244#issuecomment-465357926",
    "issue_url": "https://api.github.com/repos/pandas-dev/pandas/issues/21244",
    "id": 465357926,
    "node_id": "MDEyOklzc3VlQ29tbWVudDQ2NTM1NzkyNg==",
    "user": {
      "login": "orthaeus",
      "id": 25488471,
      "node_id": "MDQ6VXNlcjI1NDg4NDcx",
      "avatar_url": "https://avatars1.githubusercontent.com/u/25488471?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/orthaeus",
      "html_url": "https://github.com/orthaeus",
      "followers_url": "https://api.github.com/users/orthaeus/followers",
      "following_url": "https://api.github.com/users/orthaeus/following{/other_user}",
      "gists_url": "https://api.github.com/users/orthaeus/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/orthaeus/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/orthaeus/subscriptions",
      "organizations_url": "https://api.github.com/users/orthaeus/orgs",
      "repos_url": "https://api.github.com/users/orthaeus/repos",
      "events_url": "https://api.github.com/users/orthaeus/events{/privacy}",
      "received_events_url": "https://api.github.com/users/orthaeus/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2019-02-19T23:41:51Z",
    "updated_at": "2019-02-19T23:41:51Z",
    "author_association": "NONE",
    "body": "> #### Code Sample, a copy-pastable example if possible\r\n> ```python\r\n> import pandas\r\n> data = pandas.read_stata(file_with_latin1_encoding, chunksize=1048576)\r\n> for chunk in data:\r\n>     pass # do something with chunk (never reached)\r\n> ```\r\n> \r\n> This raises `UnicodeDecodeError: 'utf8' codec can't decode byte 0x?? in position ?: invalid start byte`.\r\n> OK. So the file isn't a **utf8** one. Even though the StataReader doesn't specify any Unicode support; I then try and open it with a **latin-1** encoding:\r\n> \r\n> ```python\r\n> import pandas\r\n> data = pandas.read_stata(file_with_latin1_encoding, chunksize=1048576, encoding='latin-1')\r\n> for chunk in data:\r\n>     pass # do something with chunk (never reached)\r\n> ```\r\n> \r\n> This raises the same exception at exactly the same place (still **utf-8**).\r\n> \r\n> #### Problem description\r\n> This is a problem because it appears that `read_stata` doesn't honour the `encoding` argument.\r\n> I think this line introduced a bug. The `StataReader` doesn't manage any other type of data than **ascii** or **latin-1**.\r\n> \r\n> Changing the line **1338** of the `pandas.io.stata` module:\r\n> \r\n> ```python\r\n>         return s.decode('utf-8')\r\n> ```\r\n> \r\n> to:\r\n> \r\n> ```python\r\n>         return s.decode('latin-1')\r\n> ```\r\n> \r\n> Seemed to make everything work and I could read the data from the given file.\r\n> Even better, changing it to the following:\r\n> \r\n> ```python\r\n>         return s.decode(self._encoding or self._default_encoding)\r\n> ```\r\n> \r\n> also seems to have made it work.\r\n> \r\n> I believe though, that if you want to make this work with **Unicode** too you'd have to add the following encodings to `VALID_ENCODINGS`: **utf-8**, **utf8**, **iso10646**.\r\n> \r\n> #### Expected Output\r\n> The file should be correctly read and parsed\r\n> \r\n> #### Output of `pd.show_versions()`\r\n\r\nPerfectly solved the problem I was having, thank you."
  },
  {
    "url": "https://api.github.com/repos/pandas-dev/pandas/issues/comments/466721101",
    "html_url": "https://github.com/pandas-dev/pandas/issues/21244#issuecomment-466721101",
    "issue_url": "https://api.github.com/repos/pandas-dev/pandas/issues/21244",
    "id": 466721101,
    "node_id": "MDEyOklzc3VlQ29tbWVudDQ2NjcyMTEwMQ==",
    "user": {
      "login": "hudcap",
      "id": 4990645,
      "node_id": "MDQ6VXNlcjQ5OTA2NDU=",
      "avatar_url": "https://avatars0.githubusercontent.com/u/4990645?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/hudcap",
      "html_url": "https://github.com/hudcap",
      "followers_url": "https://api.github.com/users/hudcap/followers",
      "following_url": "https://api.github.com/users/hudcap/following{/other_user}",
      "gists_url": "https://api.github.com/users/hudcap/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/hudcap/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/hudcap/subscriptions",
      "organizations_url": "https://api.github.com/users/hudcap/orgs",
      "repos_url": "https://api.github.com/users/hudcap/repos",
      "events_url": "https://api.github.com/users/hudcap/events{/privacy}",
      "received_events_url": "https://api.github.com/users/hudcap/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2019-02-24T00:59:15Z",
    "updated_at": "2019-02-24T00:59:15Z",
    "author_association": "NONE",
    "body": "I am still having issues with this. I'm using a 118 Stata file, and I'm getting the same `UnicodeDecodeError`.\r\nWhen I edit the `stata.py` file to use `latin-1` as per @adrian-castravete, everything works."
  },
  {
    "url": "https://api.github.com/repos/pandas-dev/pandas/issues/comments/468527969",
    "html_url": "https://github.com/pandas-dev/pandas/issues/21244#issuecomment-468527969",
    "issue_url": "https://api.github.com/repos/pandas-dev/pandas/issues/21244",
    "id": 468527969,
    "node_id": "MDEyOklzc3VlQ29tbWVudDQ2ODUyNzk2OQ==",
    "user": {
      "login": "naranjja",
      "id": 5874023,
      "node_id": "MDQ6VXNlcjU4NzQwMjM=",
      "avatar_url": "https://avatars1.githubusercontent.com/u/5874023?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/naranjja",
      "html_url": "https://github.com/naranjja",
      "followers_url": "https://api.github.com/users/naranjja/followers",
      "following_url": "https://api.github.com/users/naranjja/following{/other_user}",
      "gists_url": "https://api.github.com/users/naranjja/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/naranjja/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/naranjja/subscriptions",
      "organizations_url": "https://api.github.com/users/naranjja/orgs",
      "repos_url": "https://api.github.com/users/naranjja/repos",
      "events_url": "https://api.github.com/users/naranjja/events{/privacy}",
      "received_events_url": "https://api.github.com/users/naranjja/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2019-03-01T03:21:20Z",
    "updated_at": "2019-03-01T03:21:20Z",
    "author_association": "NONE",
    "body": "Having the same issue just today. Changing line 1339 from `site-packages/pandas/io/stata.py` fixed it:\r\n```python\r\ndef _null_terminate(self, s):\r\n    # have bytes not strings, so must decode\r\n    s = s.partition(b\"\\0\")[0]\r\n    return s.decode('latin-1')  # instead of s.decode(self._encoding)\r\n```"
  },
  {
    "url": "https://api.github.com/repos/pandas-dev/pandas/issues/comments/478823092",
    "html_url": "https://github.com/pandas-dev/pandas/issues/21244#issuecomment-478823092",
    "issue_url": "https://api.github.com/repos/pandas-dev/pandas/issues/21244",
    "id": 478823092,
    "node_id": "MDEyOklzc3VlQ29tbWVudDQ3ODgyMzA5Mg==",
    "user": {
      "login": "hudcap",
      "id": 4990645,
      "node_id": "MDQ6VXNlcjQ5OTA2NDU=",
      "avatar_url": "https://avatars0.githubusercontent.com/u/4990645?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/hudcap",
      "html_url": "https://github.com/hudcap",
      "followers_url": "https://api.github.com/users/hudcap/followers",
      "following_url": "https://api.github.com/users/hudcap/following{/other_user}",
      "gists_url": "https://api.github.com/users/hudcap/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/hudcap/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/hudcap/subscriptions",
      "organizations_url": "https://api.github.com/users/hudcap/orgs",
      "repos_url": "https://api.github.com/users/hudcap/repos",
      "events_url": "https://api.github.com/users/hudcap/events{/privacy}",
      "received_events_url": "https://api.github.com/users/hudcap/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2019-04-02T02:49:41Z",
    "updated_at": "2019-04-02T02:49:41Z",
    "author_association": "NONE",
    "body": "Can this bug please be reopened?"
  },
  {
    "url": "https://api.github.com/repos/pandas-dev/pandas/issues/comments/478840163",
    "html_url": "https://github.com/pandas-dev/pandas/issues/21244#issuecomment-478840163",
    "issue_url": "https://api.github.com/repos/pandas-dev/pandas/issues/21244",
    "id": 478840163,
    "node_id": "MDEyOklzc3VlQ29tbWVudDQ3ODg0MDE2Mw==",
    "user": {
      "login": "jreback",
      "id": 953992,
      "node_id": "MDQ6VXNlcjk1Mzk5Mg==",
      "avatar_url": "https://avatars2.githubusercontent.com/u/953992?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/jreback",
      "html_url": "https://github.com/jreback",
      "followers_url": "https://api.github.com/users/jreback/followers",
      "following_url": "https://api.github.com/users/jreback/following{/other_user}",
      "gists_url": "https://api.github.com/users/jreback/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/jreback/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/jreback/subscriptions",
      "organizations_url": "https://api.github.com/users/jreback/orgs",
      "repos_url": "https://api.github.com/users/jreback/repos",
      "events_url": "https://api.github.com/users/jreback/events{/privacy}",
      "received_events_url": "https://api.github.com/users/jreback/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2019-04-02T04:30:05Z",
    "updated_at": "2019-04-02T04:30:05Z",
    "author_association": "CONTRIBUTOR",
    "body": "if u have a self contained example reproducing with master pls open a new issue"
  },
  {
    "url": "https://api.github.com/repos/pandas-dev/pandas/issues/comments/480292021",
    "html_url": "https://github.com/pandas-dev/pandas/issues/21244#issuecomment-480292021",
    "issue_url": "https://api.github.com/repos/pandas-dev/pandas/issues/21244",
    "id": 480292021,
    "node_id": "MDEyOklzc3VlQ29tbWVudDQ4MDI5MjAyMQ==",
    "user": {
      "login": "harmbuisman",
      "id": 7702207,
      "node_id": "MDQ6VXNlcjc3MDIyMDc=",
      "avatar_url": "https://avatars1.githubusercontent.com/u/7702207?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/harmbuisman",
      "html_url": "https://github.com/harmbuisman",
      "followers_url": "https://api.github.com/users/harmbuisman/followers",
      "following_url": "https://api.github.com/users/harmbuisman/following{/other_user}",
      "gists_url": "https://api.github.com/users/harmbuisman/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/harmbuisman/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/harmbuisman/subscriptions",
      "organizations_url": "https://api.github.com/users/harmbuisman/orgs",
      "repos_url": "https://api.github.com/users/harmbuisman/repos",
      "events_url": "https://api.github.com/users/harmbuisman/events{/privacy}",
      "received_events_url": "https://api.github.com/users/harmbuisman/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2019-04-05T14:17:13Z",
    "updated_at": "2019-04-05T14:17:13Z",
    "author_association": "NONE",
    "body": "> Having the same issue just today. Changing line 1339 from `site-packages/pandas/io/stata.py` fixed it:\r\n> \r\n> ```python\r\n> def _null_terminate(self, s):\r\n>     # have bytes not strings, so must decode\r\n>     s = s.partition(b\"\\0\")[0]\r\n>     return s.decode('latin-1')  # instead of s.decode(self._encoding)\r\n> ```\r\n\r\nThanks, this fixed my issue. Not sure why this issue is closed while the problem is still around, even though the issue doesn't contain the dataset to reproduce this. Problem description seems quite clear to me."
  },
  {
    "url": "https://api.github.com/repos/pandas-dev/pandas/issues/comments/480303218",
    "html_url": "https://github.com/pandas-dev/pandas/issues/21244#issuecomment-480303218",
    "issue_url": "https://api.github.com/repos/pandas-dev/pandas/issues/21244",
    "id": 480303218,
    "node_id": "MDEyOklzc3VlQ29tbWVudDQ4MDMwMzIxOA==",
    "user": {
      "login": "jorisvandenbossche",
      "id": 1020496,
      "node_id": "MDQ6VXNlcjEwMjA0OTY=",
      "avatar_url": "https://avatars2.githubusercontent.com/u/1020496?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/jorisvandenbossche",
      "html_url": "https://github.com/jorisvandenbossche",
      "followers_url": "https://api.github.com/users/jorisvandenbossche/followers",
      "following_url": "https://api.github.com/users/jorisvandenbossche/following{/other_user}",
      "gists_url": "https://api.github.com/users/jorisvandenbossche/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/jorisvandenbossche/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/jorisvandenbossche/subscriptions",
      "organizations_url": "https://api.github.com/users/jorisvandenbossche/orgs",
      "repos_url": "https://api.github.com/users/jorisvandenbossche/repos",
      "events_url": "https://api.github.com/users/jorisvandenbossche/events{/privacy}",
      "received_events_url": "https://api.github.com/users/jorisvandenbossche/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2019-04-05T14:47:21Z",
    "updated_at": "2019-04-05T14:47:21Z",
    "author_association": "MEMBER",
    "body": "To all: this has been fixed by @bashtage with a fallback + warning in https://github.com/pandas-dev/pandas/pull/25967"
  },
  {
    "url": "https://api.github.com/repos/pandas-dev/pandas/issues/comments/480311485",
    "html_url": "https://github.com/pandas-dev/pandas/issues/21244#issuecomment-480311485",
    "issue_url": "https://api.github.com/repos/pandas-dev/pandas/issues/21244",
    "id": 480311485,
    "node_id": "MDEyOklzc3VlQ29tbWVudDQ4MDMxMTQ4NQ==",
    "user": {
      "login": "bashtage",
      "id": 5585221,
      "node_id": "MDQ6VXNlcjU1ODUyMjE=",
      "avatar_url": "https://avatars3.githubusercontent.com/u/5585221?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/bashtage",
      "html_url": "https://github.com/bashtage",
      "followers_url": "https://api.github.com/users/bashtage/followers",
      "following_url": "https://api.github.com/users/bashtage/following{/other_user}",
      "gists_url": "https://api.github.com/users/bashtage/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/bashtage/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/bashtage/subscriptions",
      "organizations_url": "https://api.github.com/users/bashtage/orgs",
      "repos_url": "https://api.github.com/users/bashtage/repos",
      "events_url": "https://api.github.com/users/bashtage/events{/privacy}",
      "received_events_url": "https://api.github.com/users/bashtage/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2019-04-05T15:09:05Z",
    "updated_at": "2019-04-05T15:09:20Z",
    "author_association": "CONTRIBUTOR",
    "body": "@harmbuisman It was hard to produce a dataset that has this characteristic since it can only be produced due to a bug in Stata. Stata incorrectly writes latin-1 encoded 117 format files with latin-1 encoding when saving as 118.  This doesn't happen if a new file is created and then saved to 118 format. "
  },
  {
    "url": "https://api.github.com/repos/pandas-dev/pandas/issues/comments/480312163",
    "html_url": "https://github.com/pandas-dev/pandas/issues/21244#issuecomment-480312163",
    "issue_url": "https://api.github.com/repos/pandas-dev/pandas/issues/21244",
    "id": 480312163,
    "node_id": "MDEyOklzc3VlQ29tbWVudDQ4MDMxMjE2Mw==",
    "user": {
      "login": "bashtage",
      "id": 5585221,
      "node_id": "MDQ6VXNlcjU1ODUyMjE=",
      "avatar_url": "https://avatars3.githubusercontent.com/u/5585221?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/bashtage",
      "html_url": "https://github.com/bashtage",
      "followers_url": "https://api.github.com/users/bashtage/followers",
      "following_url": "https://api.github.com/users/bashtage/following{/other_user}",
      "gists_url": "https://api.github.com/users/bashtage/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/bashtage/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/bashtage/subscriptions",
      "organizations_url": "https://api.github.com/users/bashtage/orgs",
      "repos_url": "https://api.github.com/users/bashtage/repos",
      "events_url": "https://api.github.com/users/bashtage/events{/privacy}",
      "received_events_url": "https://api.github.com/users/bashtage/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2019-04-05T15:10:49Z",
    "updated_at": "2019-04-05T15:10:49Z",
    "author_association": "CONTRIBUTOR",
    "body": "If this bug can be reproduced using master, please make sure you share a datafile (it could be a small extraction from a larger file, as long as the small extraction reproduced the issue), so that the structure of the file can be inspected. "
  }
]
