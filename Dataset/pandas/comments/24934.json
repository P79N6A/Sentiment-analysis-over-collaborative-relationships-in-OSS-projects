[
  {
    "url": "https://api.github.com/repos/pandas-dev/pandas/issues/comments/457664692",
    "html_url": "https://github.com/pandas-dev/pandas/issues/24934#issuecomment-457664692",
    "issue_url": "https://api.github.com/repos/pandas-dev/pandas/issues/24934",
    "id": 457664692,
    "node_id": "MDEyOklzc3VlQ29tbWVudDQ1NzY2NDY5Mg==",
    "user": {
      "login": "WillAyd",
      "id": 609873,
      "node_id": "MDQ6VXNlcjYwOTg3Mw==",
      "avatar_url": "https://avatars0.githubusercontent.com/u/609873?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/WillAyd",
      "html_url": "https://github.com/WillAyd",
      "followers_url": "https://api.github.com/users/WillAyd/followers",
      "following_url": "https://api.github.com/users/WillAyd/following{/other_user}",
      "gists_url": "https://api.github.com/users/WillAyd/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/WillAyd/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/WillAyd/subscriptions",
      "organizations_url": "https://api.github.com/users/WillAyd/orgs",
      "repos_url": "https://api.github.com/users/WillAyd/repos",
      "events_url": "https://api.github.com/users/WillAyd/events{/privacy}",
      "received_events_url": "https://api.github.com/users/WillAyd/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2019-01-25T18:07:09Z",
    "updated_at": "2019-01-25T18:07:09Z",
    "author_association": "MEMBER",
    "body": "Why do you expect these results to be the same? Might be overlooking a detail but in the former case you are shifting the data frame, whereas in the latter you are shifting each group, so the calls are not equivalent"
  },
  {
    "url": "https://api.github.com/repos/pandas-dev/pandas/issues/comments/457671340",
    "html_url": "https://github.com/pandas-dev/pandas/issues/24934#issuecomment-457671340",
    "issue_url": "https://api.github.com/repos/pandas-dev/pandas/issues/24934",
    "id": 457671340,
    "node_id": "MDEyOklzc3VlQ29tbWVudDQ1NzY3MTM0MA==",
    "user": {
      "login": "MichaelNorman",
      "id": 1462796,
      "node_id": "MDQ6VXNlcjE0NjI3OTY=",
      "avatar_url": "https://avatars0.githubusercontent.com/u/1462796?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/MichaelNorman",
      "html_url": "https://github.com/MichaelNorman",
      "followers_url": "https://api.github.com/users/MichaelNorman/followers",
      "following_url": "https://api.github.com/users/MichaelNorman/following{/other_user}",
      "gists_url": "https://api.github.com/users/MichaelNorman/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/MichaelNorman/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/MichaelNorman/subscriptions",
      "organizations_url": "https://api.github.com/users/MichaelNorman/orgs",
      "repos_url": "https://api.github.com/users/MichaelNorman/repos",
      "events_url": "https://api.github.com/users/MichaelNorman/events{/privacy}",
      "received_events_url": "https://api.github.com/users/MichaelNorman/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2019-01-25T18:25:29Z",
    "updated_at": "2019-01-25T23:09:06Z",
    "author_association": "NONE",
    "body": "I might be overlooking a detail. I hate to go all StackOverflow and ask for help, but how does one shift each of the resulting groups of a `groupby()` without iterating? Am I stuck with `apply()` (which is dead slow)? It does seem to me like `df.groupby(column).shift()...` should shift within each group, however."
  },
  {
    "url": "https://api.github.com/repos/pandas-dev/pandas/issues/comments/457676874",
    "html_url": "https://github.com/pandas-dev/pandas/issues/24934#issuecomment-457676874",
    "issue_url": "https://api.github.com/repos/pandas-dev/pandas/issues/24934",
    "id": 457676874,
    "node_id": "MDEyOklzc3VlQ29tbWVudDQ1NzY3Njg3NA==",
    "user": {
      "login": "WillAyd",
      "id": 609873,
      "node_id": "MDQ6VXNlcjYwOTg3Mw==",
      "avatar_url": "https://avatars0.githubusercontent.com/u/609873?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/WillAyd",
      "html_url": "https://github.com/WillAyd",
      "followers_url": "https://api.github.com/users/WillAyd/followers",
      "following_url": "https://api.github.com/users/WillAyd/following{/other_user}",
      "gists_url": "https://api.github.com/users/WillAyd/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/WillAyd/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/WillAyd/subscriptions",
      "organizations_url": "https://api.github.com/users/WillAyd/orgs",
      "repos_url": "https://api.github.com/users/WillAyd/repos",
      "events_url": "https://api.github.com/users/WillAyd/events{/privacy}",
      "received_events_url": "https://api.github.com/users/WillAyd/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2019-01-25T18:40:58Z",
    "updated_at": "2019-01-25T18:40:58Z",
    "author_association": "MEMBER",
    "body": "I misread your original post but at the same time based off of your last response I don't think the issue is where you think it is. You should be able to shift after a groupby, so if you inspect the result of:\r\n\r\n```python\r\ngames.groupby('player')['hicat'].shift() \r\n```\r\n\r\nIt will be roughly equivalent to\r\n\r\n```python\r\nfor k, g in games.groupby('player'): \r\n    g['hicat'].shift() \r\n```\r\n\r\nSave the piece of actually glueing all of the elements back together in the former.\r\n\r\nCan you take another look and make a *minimal* example which isolates the issue you see:\r\n\r\nhttp://matthewrocklin.com/blog/work/2018/02/28/minimal-bug-reports\r\n"
  },
  {
    "url": "https://api.github.com/repos/pandas-dev/pandas/issues/comments/457719997",
    "html_url": "https://github.com/pandas-dev/pandas/issues/24934#issuecomment-457719997",
    "issue_url": "https://api.github.com/repos/pandas-dev/pandas/issues/24934",
    "id": 457719997,
    "node_id": "MDEyOklzc3VlQ29tbWVudDQ1NzcxOTk5Nw==",
    "user": {
      "login": "MichaelNorman",
      "id": 1462796,
      "node_id": "MDQ6VXNlcjE0NjI3OTY=",
      "avatar_url": "https://avatars0.githubusercontent.com/u/1462796?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/MichaelNorman",
      "html_url": "https://github.com/MichaelNorman",
      "followers_url": "https://api.github.com/users/MichaelNorman/followers",
      "following_url": "https://api.github.com/users/MichaelNorman/following{/other_user}",
      "gists_url": "https://api.github.com/users/MichaelNorman/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/MichaelNorman/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/MichaelNorman/subscriptions",
      "organizations_url": "https://api.github.com/users/MichaelNorman/orgs",
      "repos_url": "https://api.github.com/users/MichaelNorman/repos",
      "events_url": "https://api.github.com/users/MichaelNorman/events{/privacy}",
      "received_events_url": "https://api.github.com/users/MichaelNorman/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2019-01-25T20:40:37Z",
    "updated_at": "2019-01-25T20:40:37Z",
    "author_association": "NONE",
    "body": "I do think you've misread it. For one:\r\n```python\r\ngames.groupby('player').shift()['hicat'].fillna(True) == games.groupby('player')['hicat'].shift().fillna(True)\r\n0     True\r\n1     True\r\n2     True\r\n3     True\r\n4     True\r\n5     True\r\n6     True\r\n7     True\r\n8     True\r\n9     True\r\n10    True\r\n11    True\r\n12    True\r\n13    True\r\n14    True\r\n15    True\r\n16    True\r\n```\r\nSo, the order of the selector and the shift doesn't change anything. Also, I'm not shifting a `DataFrame`, I'm shifting a `DataFrameGroupBy` object. I can see why someone would want to \"shift groups,\" but, clearly, people would also want to shift _within_ groups.\r\n\r\nFurther, this is a minimal example that produces the bug. Shorter examples do not produce it. Longer examples are longer. I'm beginning to doubt whether pandas actually can tell me how many times out of the previous n occurrences that a certain event happened. That's another story, though.\r\n\r\nWhat I'm after is given by:\r\n```python\r\ngames.groupby('player').category.apply(lambda x: x.shift().gt(2).rolling(3).sum().fillna(0, downcast='infer').astype(int).gt(1))\r\n```\r\nHowever, on a modest df with 250k rows, this takes 12s. If this is the right way to get around this bug, I guess I'll have to be fine with that."
  },
  {
    "url": "https://api.github.com/repos/pandas-dev/pandas/issues/comments/458387268",
    "html_url": "https://github.com/pandas-dev/pandas/issues/24934#issuecomment-458387268",
    "issue_url": "https://api.github.com/repos/pandas-dev/pandas/issues/24934",
    "id": 458387268,
    "node_id": "MDEyOklzc3VlQ29tbWVudDQ1ODM4NzI2OA==",
    "user": {
      "login": "WillAyd",
      "id": 609873,
      "node_id": "MDQ6VXNlcjYwOTg3Mw==",
      "avatar_url": "https://avatars0.githubusercontent.com/u/609873?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/WillAyd",
      "html_url": "https://github.com/WillAyd",
      "followers_url": "https://api.github.com/users/WillAyd/followers",
      "following_url": "https://api.github.com/users/WillAyd/following{/other_user}",
      "gists_url": "https://api.github.com/users/WillAyd/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/WillAyd/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/WillAyd/subscriptions",
      "organizations_url": "https://api.github.com/users/WillAyd/orgs",
      "repos_url": "https://api.github.com/users/WillAyd/repos",
      "events_url": "https://api.github.com/users/WillAyd/events{/privacy}",
      "received_events_url": "https://api.github.com/users/WillAyd/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2019-01-29T02:50:37Z",
    "updated_at": "2019-01-29T02:50:37Z",
    "author_association": "MEMBER",
    "body": "So the problem here is that the calls you have aren't equivalent, and the diversion happens right at this point:\r\n\r\n```python\r\nIn [23]: games.groupby('player').shift()                                                                                             \r\nOut[23]: \r\n   match  category   hc  hicat hicat_calc\r\n0    NaN       NaN  NaN    NaN        NaN\r\n1    NaN       NaN  NaN    NaN        NaN\r\n2    NaN       NaN  NaN    NaN        NaN\r\n3      a       3.0  0.0   True      False\r\n4    NaN       NaN  NaN    NaN        NaN\r\n5      a       3.0  0.0   True      False\r\n6      b       2.0  0.0  False       True\r\n7    NaN       NaN  NaN    NaN        NaN\r\n8      b       2.0  0.0  False      False\r\n9      b       2.0  0.0  False      False\r\n10     c       3.0  0.0   True      False\r\n11   NaN       NaN  NaN    NaN        NaN\r\n12     c       3.0  0.0   True      False\r\n13     c       3.0  0.0   True      False\r\n14     d       3.0  0.0   True      False\r\n15     c       3.0  0.0   True      False\r\n16     d       3.0  1.0   True       True\r\n```\r\n\r\nvs \r\n\r\n```python\r\nIn [22]: for k, g in games.groupby('player'): \r\n    ...:     print(g.shift()) \r\n    ...:                                                                                                                             \r\n  match  category player  hc hicat hicat_calc\r\n0   NaN       NaN    NaN NaN   NaN        NaN\r\n   match  category player   hc  hicat hicat_calc\r\n1    NaN       NaN    NaN  NaN    NaN        NaN\r\n3      a       3.0    baz  0.0   True      False\r\n8      b       2.0    baz  0.0  False      False\r\n12     c       3.0    baz  0.0   True      False\r\n16     d       3.0    baz  1.0   True       True\r\n   match  category player  hc hicat hicat_calc\r\n11   NaN       NaN    NaN NaN   NaN        NaN\r\n   match  category player   hc  hicat hicat_calc\r\n2    NaN       NaN    NaN  NaN    NaN        NaN\r\n5      a       3.0   chaz  0.0   True      False\r\n6      b       2.0   chaz  0.0  False       True\r\n15     c       3.0   chaz  0.0   True      False\r\n   match  category player   hc  hicat hicat_calc\r\n4    NaN       NaN    NaN  NaN    NaN        NaN\r\n9      b       2.0   choo  0.0  False      False\r\n13     c       3.0   choo  0.0   True      False\r\n   match  category player   hc hicat hicat_calc\r\n7    NaN       NaN    NaN  NaN   NaN        NaN\r\n10     c       3.0    foo  0.0  True      False\r\n14     d       3.0    foo  0.0  True      False\r\n```\r\n\r\nThe former returns a DataFrame whereas the latter is still iterating over the groups, hence the difference in the application of the `.rolling` function."
  },
  {
    "url": "https://api.github.com/repos/pandas-dev/pandas/issues/comments/476482944",
    "html_url": "https://github.com/pandas-dev/pandas/issues/24934#issuecomment-476482944",
    "issue_url": "https://api.github.com/repos/pandas-dev/pandas/issues/24934",
    "id": 476482944,
    "node_id": "MDEyOklzc3VlQ29tbWVudDQ3NjQ4Mjk0NA==",
    "user": {
      "login": "WillAyd",
      "id": 609873,
      "node_id": "MDQ6VXNlcjYwOTg3Mw==",
      "avatar_url": "https://avatars0.githubusercontent.com/u/609873?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/WillAyd",
      "html_url": "https://github.com/WillAyd",
      "followers_url": "https://api.github.com/users/WillAyd/followers",
      "following_url": "https://api.github.com/users/WillAyd/following{/other_user}",
      "gists_url": "https://api.github.com/users/WillAyd/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/WillAyd/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/WillAyd/subscriptions",
      "organizations_url": "https://api.github.com/users/WillAyd/orgs",
      "repos_url": "https://api.github.com/users/WillAyd/repos",
      "events_url": "https://api.github.com/users/WillAyd/events{/privacy}",
      "received_events_url": "https://api.github.com/users/WillAyd/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2019-03-26T05:39:31Z",
    "updated_at": "2019-03-26T05:39:31Z",
    "author_association": "MEMBER",
    "body": "Closing per latest response - I don't think there's a bug here but if you disagree feel free to reopen"
  }
]
