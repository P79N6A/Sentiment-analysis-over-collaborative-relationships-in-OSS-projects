[
  {
    "url": "https://api.github.com/repos/ipython/ipython/issues/comments/201224191",
    "html_url": "https://github.com/ipython/ipython/pull/9356#issuecomment-201224191",
    "issue_url": "https://api.github.com/repos/ipython/ipython/issues/9356",
    "id": 201224191,
    "node_id": "MDEyOklzc3VlQ29tbWVudDIwMTIyNDE5MQ==",
    "user": {
      "login": "takluyver",
      "id": 327925,
      "node_id": "MDQ6VXNlcjMyNzkyNQ==",
      "avatar_url": "https://avatars3.githubusercontent.com/u/327925?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/takluyver",
      "html_url": "https://github.com/takluyver",
      "followers_url": "https://api.github.com/users/takluyver/followers",
      "following_url": "https://api.github.com/users/takluyver/following{/other_user}",
      "gists_url": "https://api.github.com/users/takluyver/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/takluyver/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/takluyver/subscriptions",
      "organizations_url": "https://api.github.com/users/takluyver/orgs",
      "repos_url": "https://api.github.com/users/takluyver/repos",
      "events_url": "https://api.github.com/users/takluyver/events{/privacy}",
      "received_events_url": "https://api.github.com/users/takluyver/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2016-03-25T09:54:24Z",
    "updated_at": "2016-03-25T09:54:24Z",
    "author_association": "MEMBER",
    "body": "Is your config definitely being loaded and used in the relevant code?\nOn 24 Mar 2016 22:02, \"Trevor Bekolay\" notifications@github.com wrote:\n\n> We run Jupyter notebooks in our test suite. When running in multiple\n> threads, we were getting issues with the SQLite database that manages\n> history, so we added c.HistoryAccessor.enabled = False the the IPython\n> config in our test scripts.\n> \n> However, we still get the following error sporadically:\n> \n> Traceback (most recent call last):\n>   File \"/home/travis/miniconda/envs/test/lib/python2.7/atexit.py\", line 24, in _run_exitfuncs\n>     func(_targs, *_kargs)\n>   File \"/home/travis/miniconda/envs/test/lib/python2.7/site-packages/IPython/core/interactiveshell.py\", line 3213, in atexit_operations\n>     self.history_manager.end_session()\n>   File \"/home/travis/miniconda/envs/test/lib/python2.7/site-packages/IPython/core/history.py\", line 549, in end_session\n>     self.writeout_cache()\n>   File \"<decorator-gen-22>\", line 2, in writeout_cache\n>   File \"/home/travis/miniconda/envs/test/lib/python2.7/site-packages/IPython/core/history.py\", line 68, in needs_sqlite\n>     return f(self, _a, *_kw)\n>   File \"/home/travis/miniconda/envs/test/lib/python2.7/site-packages/IPython/core/history.py\", line 755, in writeout_cache\n>     self._writeout_input_cache(conn)\n>   File \"/home/travis/miniconda/envs/test/lib/python2.7/site-packages/IPython/core/history.py\", line 739, in _writeout_input_cache\n>     (self.session_number,)+line)\n> sqlite3.ProgrammingError: SQLite objects created in a thread can only be used in that same thread.The object was created in thread id 140005330646784 and this is thread id 140005449897728\n> \n> (see this TravisCI build\n> https://travis-ci.org/nengo/nengo/jobs/118276959#L1975) and\n> history.sqlite is still created, even though printing\n> get_ipython().history_manager.enabled prints False.\n> \n> I attempted to investigate this a bit by adding a unit test to ensure that\n> a history.sqlite file isn't created if the config option is set, but this\n> test passes, so it does appear to be working. I'm at a bit of a loss for\n> where to look next!\n> \n> For reference, what we run in our test suite amounts to:\n> \n> from nbformat import readfrom nbconvert import PythonExporter\n> exporter = PythonExporter()\n> nb = read(filepointer)\n> body, resources = exporter.from_notebook_node(nb)... save to .py file ...execfile(pyfile, {})\n> \n> Is this an issue in nbconvert perhaps? Any pointers to things to look at\n> would be appreciated! If I can get a failing test then hopefully I can fix\n> \n> ## it ;)\n> \n> You can view, comment on, or merge this pull request online at:\n> \n>   https://github.com/ipython/ipython/pull/9356\n> Commit Summary\n> - Add test for disabling history manager\n> \n> File Changes\n> - _M_ IPython/core/tests/test_history.py\n>   https://github.com/ipython/ipython/pull/9356/files#diff-0 (23)\n> \n> Patch Links:\n> - https://github.com/ipython/ipython/pull/9356.patch\n> - https://github.com/ipython/ipython/pull/9356.diff\n> \n> â€”\n> You are receiving this because you are subscribed to this thread.\n> Reply to this email directly or view it on GitHub\n> https://github.com/ipython/ipython/pull/9356\n"
  },
  {
    "url": "https://api.github.com/repos/ipython/ipython/issues/comments/201225894",
    "html_url": "https://github.com/ipython/ipython/pull/9356#issuecomment-201225894",
    "issue_url": "https://api.github.com/repos/ipython/ipython/issues/9356",
    "id": 201225894,
    "node_id": "MDEyOklzc3VlQ29tbWVudDIwMTIyNTg5NA==",
    "user": {
      "login": "tbekolay",
      "id": 203709,
      "node_id": "MDQ6VXNlcjIwMzcwOQ==",
      "avatar_url": "https://avatars2.githubusercontent.com/u/203709?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/tbekolay",
      "html_url": "https://github.com/tbekolay",
      "followers_url": "https://api.github.com/users/tbekolay/followers",
      "following_url": "https://api.github.com/users/tbekolay/following{/other_user}",
      "gists_url": "https://api.github.com/users/tbekolay/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/tbekolay/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/tbekolay/subscriptions",
      "organizations_url": "https://api.github.com/users/tbekolay/orgs",
      "repos_url": "https://api.github.com/users/tbekolay/repos",
      "events_url": "https://api.github.com/users/tbekolay/events{/privacy}",
      "received_events_url": "https://api.github.com/users/tbekolay/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2016-03-25T10:02:45Z",
    "updated_at": "2016-03-25T10:02:45Z",
    "author_association": "CONTRIBUTOR",
    "body": "In the build, I did `ipython -c \"print(get_ipython().history_manager.enabled)\"` and it printed `False`. Are there situations where IPython can be used (imported by `nbconvert`, for example) but the config is not loaded?\n"
  },
  {
    "url": "https://api.github.com/repos/ipython/ipython/issues/comments/201227236",
    "html_url": "https://github.com/ipython/ipython/pull/9356#issuecomment-201227236",
    "issue_url": "https://api.github.com/repos/ipython/ipython/issues/9356",
    "id": 201227236,
    "node_id": "MDEyOklzc3VlQ29tbWVudDIwMTIyNzIzNg==",
    "user": {
      "login": "tbekolay",
      "id": 203709,
      "node_id": "MDQ6VXNlcjIwMzcwOQ==",
      "avatar_url": "https://avatars2.githubusercontent.com/u/203709?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/tbekolay",
      "html_url": "https://github.com/tbekolay",
      "followers_url": "https://api.github.com/users/tbekolay/followers",
      "following_url": "https://api.github.com/users/tbekolay/following{/other_user}",
      "gists_url": "https://api.github.com/users/tbekolay/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/tbekolay/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/tbekolay/subscriptions",
      "organizations_url": "https://api.github.com/users/tbekolay/orgs",
      "repos_url": "https://api.github.com/users/tbekolay/repos",
      "events_url": "https://api.github.com/users/tbekolay/events{/privacy}",
      "received_events_url": "https://api.github.com/users/tbekolay/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2016-03-25T10:07:56Z",
    "updated_at": "2016-03-25T10:07:56Z",
    "author_association": "CONTRIBUTOR",
    "body": "Or, are there other parts of IPython that write to `history.sqlite`?\n"
  },
  {
    "url": "https://api.github.com/repos/ipython/ipython/issues/comments/201227646",
    "html_url": "https://github.com/ipython/ipython/pull/9356#issuecomment-201227646",
    "issue_url": "https://api.github.com/repos/ipython/ipython/issues/9356",
    "id": 201227646,
    "node_id": "MDEyOklzc3VlQ29tbWVudDIwMTIyNzY0Ng==",
    "user": {
      "login": "takluyver",
      "id": 327925,
      "node_id": "MDQ6VXNlcjMyNzkyNQ==",
      "avatar_url": "https://avatars3.githubusercontent.com/u/327925?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/takluyver",
      "html_url": "https://github.com/takluyver",
      "followers_url": "https://api.github.com/users/takluyver/followers",
      "following_url": "https://api.github.com/users/takluyver/following{/other_user}",
      "gists_url": "https://api.github.com/users/takluyver/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/takluyver/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/takluyver/subscriptions",
      "organizations_url": "https://api.github.com/users/takluyver/orgs",
      "repos_url": "https://api.github.com/users/takluyver/repos",
      "events_url": "https://api.github.com/users/takluyver/events{/privacy}",
      "received_events_url": "https://api.github.com/users/takluyver/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2016-03-25T10:10:25Z",
    "updated_at": "2016-03-25T10:10:25Z",
    "author_association": "MEMBER",
    "body": "The IPython application loads the config, so if nbconvert loaded some of\nthe IPython machinery to use, it probably wouldn't load the IPython config.\nNbconvert has its own config file, of course.\n\nHowever, if you're using the nbconvert execute preprocessor, that runs the\nkernel in a separate process, and if that kernel is IPython, it should load\nthe IPython config.\n"
  },
  {
    "url": "https://api.github.com/repos/ipython/ipython/issues/comments/201230138",
    "html_url": "https://github.com/ipython/ipython/pull/9356#issuecomment-201230138",
    "issue_url": "https://api.github.com/repos/ipython/ipython/issues/9356",
    "id": 201230138,
    "node_id": "MDEyOklzc3VlQ29tbWVudDIwMTIzMDEzOA==",
    "user": {
      "login": "tbekolay",
      "id": 203709,
      "node_id": "MDQ6VXNlcjIwMzcwOQ==",
      "avatar_url": "https://avatars2.githubusercontent.com/u/203709?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/tbekolay",
      "html_url": "https://github.com/tbekolay",
      "followers_url": "https://api.github.com/users/tbekolay/followers",
      "following_url": "https://api.github.com/users/tbekolay/following{/other_user}",
      "gists_url": "https://api.github.com/users/tbekolay/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/tbekolay/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/tbekolay/subscriptions",
      "organizations_url": "https://api.github.com/users/tbekolay/orgs",
      "repos_url": "https://api.github.com/users/tbekolay/repos",
      "events_url": "https://api.github.com/users/tbekolay/events{/privacy}",
      "received_events_url": "https://api.github.com/users/tbekolay/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2016-03-25T10:18:51Z",
    "updated_at": "2016-03-25T10:18:51Z",
    "author_association": "CONTRIBUTOR",
    "body": "Thanks, I'll look into what we and nbconvert are doing more closely to see if we're skirting around the config file.\n"
  },
  {
    "url": "https://api.github.com/repos/ipython/ipython/issues/comments/202474225",
    "html_url": "https://github.com/ipython/ipython/pull/9356#issuecomment-202474225",
    "issue_url": "https://api.github.com/repos/ipython/ipython/issues/9356",
    "id": 202474225,
    "node_id": "MDEyOklzc3VlQ29tbWVudDIwMjQ3NDIyNQ==",
    "user": {
      "login": "tbekolay",
      "id": 203709,
      "node_id": "MDQ6VXNlcjIwMzcwOQ==",
      "avatar_url": "https://avatars2.githubusercontent.com/u/203709?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/tbekolay",
      "html_url": "https://github.com/tbekolay",
      "followers_url": "https://api.github.com/users/tbekolay/followers",
      "following_url": "https://api.github.com/users/tbekolay/following{/other_user}",
      "gists_url": "https://api.github.com/users/tbekolay/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/tbekolay/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/tbekolay/subscriptions",
      "organizations_url": "https://api.github.com/users/tbekolay/orgs",
      "repos_url": "https://api.github.com/users/tbekolay/repos",
      "events_url": "https://api.github.com/users/tbekolay/events{/privacy}",
      "received_events_url": "https://api.github.com/users/tbekolay/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2016-03-28T16:33:47Z",
    "updated_at": "2016-03-28T16:33:47Z",
    "author_association": "CONTRIBUTOR",
    "body": "Update! The issue ended up being with the Python exporter in `nbconvert`. I reported the issue in https://github.com/jupyter/nbconvert/issues/273, and as it turns out, the issue was fixed in https://github.com/jupyter/nbconvert/pull/229, which will be released in `nbconvert` 4.2.\n\nSo, the issue motivating this PR is moot. This PR does add a test of the `HistoryAccessor.enabled` configuration option, so if that's deemed useful, then I'd be happy for this PR to be merged as is. If additional unit tests are deemed to be more bloat than useful, then feel free to close this PR, no hard feelings :) Thanks!\n"
  },
  {
    "url": "https://api.github.com/repos/ipython/ipython/issues/comments/202958758",
    "html_url": "https://github.com/ipython/ipython/pull/9356#issuecomment-202958758",
    "issue_url": "https://api.github.com/repos/ipython/ipython/issues/9356",
    "id": 202958758,
    "node_id": "MDEyOklzc3VlQ29tbWVudDIwMjk1ODc1OA==",
    "user": {
      "login": "takluyver",
      "id": 327925,
      "node_id": "MDQ6VXNlcjMyNzkyNQ==",
      "avatar_url": "https://avatars3.githubusercontent.com/u/327925?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/takluyver",
      "html_url": "https://github.com/takluyver",
      "followers_url": "https://api.github.com/users/takluyver/followers",
      "following_url": "https://api.github.com/users/takluyver/following{/other_user}",
      "gists_url": "https://api.github.com/users/takluyver/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/takluyver/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/takluyver/subscriptions",
      "organizations_url": "https://api.github.com/users/takluyver/orgs",
      "repos_url": "https://api.github.com/users/takluyver/repos",
      "events_url": "https://api.github.com/users/takluyver/events{/privacy}",
      "received_events_url": "https://api.github.com/users/takluyver/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2016-03-29T15:35:03Z",
    "updated_at": "2016-03-29T15:35:03Z",
    "author_association": "MEMBER",
    "body": "Thanks @tbekolay. I think it's probably a sensible sanity check.\n"
  }
]
