[
  {
    "url": "https://api.github.com/repos/ipython/ipython/issues/comments/427032232",
    "html_url": "https://github.com/ipython/ipython/issues/11362#issuecomment-427032232",
    "issue_url": "https://api.github.com/repos/ipython/ipython/issues/11362",
    "id": 427032232,
    "node_id": "MDEyOklzc3VlQ29tbWVudDQyNzAzMjIzMg==",
    "user": {
      "login": "TomAugspurger",
      "id": 1312546,
      "node_id": "MDQ6VXNlcjEzMTI1NDY=",
      "avatar_url": "https://avatars3.githubusercontent.com/u/1312546?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/TomAugspurger",
      "html_url": "https://github.com/TomAugspurger",
      "followers_url": "https://api.github.com/users/TomAugspurger/followers",
      "following_url": "https://api.github.com/users/TomAugspurger/following{/other_user}",
      "gists_url": "https://api.github.com/users/TomAugspurger/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/TomAugspurger/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/TomAugspurger/subscriptions",
      "organizations_url": "https://api.github.com/users/TomAugspurger/orgs",
      "repos_url": "https://api.github.com/users/TomAugspurger/repos",
      "events_url": "https://api.github.com/users/TomAugspurger/events{/privacy}",
      "received_events_url": "https://api.github.com/users/TomAugspurger/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2018-10-04T14:06:33Z",
    "updated_at": "2018-10-04T14:06:33Z",
    "author_association": "NONE",
    "body": "In `process_block`\r\n\r\n```\r\n(Pdb) pp data\r\n(None, 'def f(x):\\n    x = 2\\n    return x', '')\r\n(Pdb) self.process_input(data, input_prompt, lineno)\r\n(['In [1]: def f(x):', '   ...:     x = 2', '   ...:     return x', '   ...: ', '  File \"<ipython-input-2-50e9b99ff1e2>\", line 1\\n    return x\\n            ^\\nSyntaxError: \\'return\\' outside function\\n\\n'], ['def f(x):', '    x = 2', '    return x', ''], '  File \"<ipython-input-2-50e9b99ff1e2>\", line 1\\n    return x\\n            ^\\nSyntaxError: \\'return\\' outside function\\n\\n', False, None, None, None)\r\n```\r\n\r\nSo something in `process_input` in going awry."
  },
  {
    "url": "https://api.github.com/repos/ipython/ipython/issues/comments/427033392",
    "html_url": "https://github.com/ipython/ipython/issues/11362#issuecomment-427033392",
    "issue_url": "https://api.github.com/repos/ipython/ipython/issues/11362",
    "id": 427033392,
    "node_id": "MDEyOklzc3VlQ29tbWVudDQyNzAzMzM5Mg==",
    "user": {
      "login": "dsblank",
      "id": 168568,
      "node_id": "MDQ6VXNlcjE2ODU2OA==",
      "avatar_url": "https://avatars1.githubusercontent.com/u/168568?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/dsblank",
      "html_url": "https://github.com/dsblank",
      "followers_url": "https://api.github.com/users/dsblank/followers",
      "following_url": "https://api.github.com/users/dsblank/following{/other_user}",
      "gists_url": "https://api.github.com/users/dsblank/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/dsblank/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/dsblank/subscriptions",
      "organizations_url": "https://api.github.com/users/dsblank/orgs",
      "repos_url": "https://api.github.com/users/dsblank/repos",
      "events_url": "https://api.github.com/users/dsblank/events{/privacy}",
      "received_events_url": "https://api.github.com/users/dsblank/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2018-10-04T14:09:47Z",
    "updated_at": "2018-10-04T14:09:47Z",
    "author_association": "CONTRIBUTOR",
    "body": "Maybe a hint: it thinks the error is in line 1. Maybe the newlines are being removed?"
  },
  {
    "url": "https://api.github.com/repos/ipython/ipython/issues/comments/427035936",
    "html_url": "https://github.com/ipython/ipython/issues/11362#issuecomment-427035936",
    "issue_url": "https://api.github.com/repos/ipython/ipython/issues/11362",
    "id": 427035936,
    "node_id": "MDEyOklzc3VlQ29tbWVudDQyNzAzNTkzNg==",
    "user": {
      "login": "TomAugspurger",
      "id": 1312546,
      "node_id": "MDQ6VXNlcjEzMTI1NDY=",
      "avatar_url": "https://avatars3.githubusercontent.com/u/1312546?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/TomAugspurger",
      "html_url": "https://github.com/TomAugspurger",
      "followers_url": "https://api.github.com/users/TomAugspurger/followers",
      "following_url": "https://api.github.com/users/TomAugspurger/following{/other_user}",
      "gists_url": "https://api.github.com/users/TomAugspurger/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/TomAugspurger/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/TomAugspurger/subscriptions",
      "organizations_url": "https://api.github.com/users/TomAugspurger/orgs",
      "repos_url": "https://api.github.com/users/TomAugspurger/repos",
      "events_url": "https://api.github.com/users/TomAugspurger/events{/privacy}",
      "received_events_url": "https://api.github.com/users/TomAugspurger/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2018-10-04T14:16:34Z",
    "updated_at": "2018-10-04T14:16:34Z",
    "author_association": "NONE",
    "body": "I haven't dug further, but it seems like the use of `InteractiveShell.check_complete` is the issue. On 6.x and 7.x this is true\r\n\r\n```python\r\nIn [1]: from IPython import InteractiveShell\r\n\r\nIn [2]: shell = InteractiveShell()\r\n\r\nIn [3]: shell.check_complete(\"def f(x):    x = 2\")\r\nOut[3]: ('complete', '')\r\n```\r\n\r\nOn 6.x `splitter = self.IP.input_splitter` was used in `process_input_line` to see if there should be more lines coming."
  },
  {
    "url": "https://api.github.com/repos/ipython/ipython/issues/comments/427060150",
    "html_url": "https://github.com/ipython/ipython/issues/11362#issuecomment-427060150",
    "issue_url": "https://api.github.com/repos/ipython/ipython/issues/11362",
    "id": 427060150,
    "node_id": "MDEyOklzc3VlQ29tbWVudDQyNzA2MDE1MA==",
    "user": {
      "login": "TomAugspurger",
      "id": 1312546,
      "node_id": "MDQ6VXNlcjEzMTI1NDY=",
      "avatar_url": "https://avatars3.githubusercontent.com/u/1312546?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/TomAugspurger",
      "html_url": "https://github.com/TomAugspurger",
      "followers_url": "https://api.github.com/users/TomAugspurger/followers",
      "following_url": "https://api.github.com/users/TomAugspurger/following{/other_user}",
      "gists_url": "https://api.github.com/users/TomAugspurger/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/TomAugspurger/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/TomAugspurger/subscriptions",
      "organizations_url": "https://api.github.com/users/TomAugspurger/orgs",
      "repos_url": "https://api.github.com/users/TomAugspurger/repos",
      "events_url": "https://api.github.com/users/TomAugspurger/events{/privacy}",
      "received_events_url": "https://api.github.com/users/TomAugspurger/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2018-10-04T15:21:17Z",
    "updated_at": "2018-10-04T15:21:17Z",
    "author_association": "NONE",
    "body": "> Maybe a hint: it thinks the error is in line 1. Maybe the newlines are being removed?\r\n\r\nThe error being line 1 was correct, though I think it's because lines aren't being joined properly.\r\n\r\nFYI, I've stopped debugging this for now, in the hope that someone will more familiar with this bit of code will instantly know what's wrong. Though I think the pandas and matplotlib devs should be expected to share the maintenance burden since we're the main users :)"
  },
  {
    "url": "https://api.github.com/repos/ipython/ipython/issues/comments/427214023",
    "html_url": "https://github.com/ipython/ipython/issues/11362#issuecomment-427214023",
    "issue_url": "https://api.github.com/repos/ipython/ipython/issues/11362",
    "id": 427214023,
    "node_id": "MDEyOklzc3VlQ29tbWVudDQyNzIxNDAyMw==",
    "user": {
      "login": "adamklein",
      "id": 869232,
      "node_id": "MDQ6VXNlcjg2OTIzMg==",
      "avatar_url": "https://avatars1.githubusercontent.com/u/869232?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/adamklein",
      "html_url": "https://github.com/adamklein",
      "followers_url": "https://api.github.com/users/adamklein/followers",
      "following_url": "https://api.github.com/users/adamklein/following{/other_user}",
      "gists_url": "https://api.github.com/users/adamklein/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/adamklein/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/adamklein/subscriptions",
      "organizations_url": "https://api.github.com/users/adamklein/orgs",
      "repos_url": "https://api.github.com/users/adamklein/repos",
      "events_url": "https://api.github.com/users/adamklein/events{/privacy}",
      "received_events_url": "https://api.github.com/users/adamklein/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2018-10-05T00:53:08Z",
    "updated_at": "2018-10-05T00:53:08Z",
    "author_association": "NONE",
    "body": "I am seeing perhaps the same issue in the sphinx extension. My code is failing to process multiple lines such as:\r\n\r\n```\r\n.. ipython::\r\n\r\n   In [1]: @decorated_func\r\n      ...: def my_func():\r\n      ...:     return pd.DataFrame(index=pd.date_range('20050101', '20050110', freq='D'))\r\n\r\n   In [2]: n = my_func()\r\n```\r\n\r\nwith sphinx-build I get\r\n\r\n```\r\n>>>-------------------------------------------------------------------------\r\nException in .../docs/cookbook.rst at block ending on line 46\r\nSpecify :okexcept: as an option in the ipython:: block to suppress this message\r\n---------------------------------------------------------------------------\r\nNameError                                 Traceback (most recent call last)\r\n<ipython-input-2-e7d2bcb4e770> in <module>\r\n----> 1 n = my_func()\r\n\r\nNameError: name 'my_func' is not defined\r\n<<<-------------------------------------------------------------------------\r\n```\r\nDoes this sound like the same issue?"
  },
  {
    "url": "https://api.github.com/repos/ipython/ipython/issues/comments/430068334",
    "html_url": "https://github.com/ipython/ipython/issues/11362#issuecomment-430068334",
    "issue_url": "https://api.github.com/repos/ipython/ipython/issues/11362",
    "id": 430068334,
    "node_id": "MDEyOklzc3VlQ29tbWVudDQzMDA2ODMzNA==",
    "user": {
      "login": "Carreau",
      "id": 335567,
      "node_id": "MDQ6VXNlcjMzNTU2Nw==",
      "avatar_url": "https://avatars3.githubusercontent.com/u/335567?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/Carreau",
      "html_url": "https://github.com/Carreau",
      "followers_url": "https://api.github.com/users/Carreau/followers",
      "following_url": "https://api.github.com/users/Carreau/following{/other_user}",
      "gists_url": "https://api.github.com/users/Carreau/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/Carreau/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/Carreau/subscriptions",
      "organizations_url": "https://api.github.com/users/Carreau/orgs",
      "repos_url": "https://api.github.com/users/Carreau/repos",
      "events_url": "https://api.github.com/users/Carreau/events{/privacy}",
      "received_events_url": "https://api.github.com/users/Carreau/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2018-10-16T01:24:19Z",
    "updated_at": "2018-10-16T01:24:19Z",
    "author_association": "MEMBER",
    "body": "See #11402 I'm not sure that completely restore all the functionalities of the sphinx extension. In particular there seem to be the ability to 'auto split' long chunks of code that is separated by blank lines (but I did not manage to make that work in IPython 6.x so....). \r\n\r\n#11402 make it dumb. Submit all the text in the directive at once\r\n\r\nI also need to restore the documentation and tests.. that apparently have dispeared somewhere in history..."
  },
  {
    "url": "https://api.github.com/repos/ipython/ipython/issues/comments/431608592",
    "html_url": "https://github.com/ipython/ipython/issues/11362#issuecomment-431608592",
    "issue_url": "https://api.github.com/repos/ipython/ipython/issues/11362",
    "id": 431608592,
    "node_id": "MDEyOklzc3VlQ29tbWVudDQzMTYwODU5Mg==",
    "user": {
      "login": "Carreau",
      "id": 335567,
      "node_id": "MDQ6VXNlcjMzNTU2Nw==",
      "avatar_url": "https://avatars3.githubusercontent.com/u/335567?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/Carreau",
      "html_url": "https://github.com/Carreau",
      "followers_url": "https://api.github.com/users/Carreau/followers",
      "following_url": "https://api.github.com/users/Carreau/following{/other_user}",
      "gists_url": "https://api.github.com/users/Carreau/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/Carreau/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/Carreau/subscriptions",
      "organizations_url": "https://api.github.com/users/Carreau/orgs",
      "repos_url": "https://api.github.com/users/Carreau/repos",
      "events_url": "https://api.github.com/users/Carreau/events{/privacy}",
      "received_events_url": "https://api.github.com/users/Carreau/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2018-10-20T18:51:49Z",
    "updated_at": "2018-10-20T18:51:49Z",
    "author_association": "MEMBER",
    "body": "closed by #11402 "
  },
  {
    "url": "https://api.github.com/repos/ipython/ipython/issues/comments/451102059",
    "html_url": "https://github.com/ipython/ipython/issues/11362#issuecomment-451102059",
    "issue_url": "https://api.github.com/repos/ipython/ipython/issues/11362",
    "id": 451102059,
    "node_id": "MDEyOklzc3VlQ29tbWVudDQ1MTEwMjA1OQ==",
    "user": {
      "login": "thequackdaddy",
      "id": 8186432,
      "node_id": "MDQ6VXNlcjgxODY0MzI=",
      "avatar_url": "https://avatars2.githubusercontent.com/u/8186432?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/thequackdaddy",
      "html_url": "https://github.com/thequackdaddy",
      "followers_url": "https://api.github.com/users/thequackdaddy/followers",
      "following_url": "https://api.github.com/users/thequackdaddy/following{/other_user}",
      "gists_url": "https://api.github.com/users/thequackdaddy/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/thequackdaddy/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/thequackdaddy/subscriptions",
      "organizations_url": "https://api.github.com/users/thequackdaddy/orgs",
      "repos_url": "https://api.github.com/users/thequackdaddy/repos",
      "events_url": "https://api.github.com/users/thequackdaddy/events{/privacy}",
      "received_events_url": "https://api.github.com/users/thequackdaddy/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2019-01-03T10:12:54Z",
    "updated_at": "2019-01-03T10:12:54Z",
    "author_association": "NONE",
    "body": "Could this be re-opened? \r\n\r\nI am working on this again and I think the issue still exists when you have classes?\r\n\r\nsphinx seems to work fine with ipython 7.2 on [this](https://github.com/statsmodels/statsmodels/blob/master/docs/source/contrasts.rst) file, but only if I remove the class `Simple` (and all the instances thereof). \r\n\r\nThus, I think there might be problem with classes. Not sure how to provide a minimal example, sadly."
  },
  {
    "url": "https://api.github.com/repos/ipython/ipython/issues/comments/451527491",
    "html_url": "https://github.com/ipython/ipython/issues/11362#issuecomment-451527491",
    "issue_url": "https://api.github.com/repos/ipython/ipython/issues/11362",
    "id": 451527491,
    "node_id": "MDEyOklzc3VlQ29tbWVudDQ1MTUyNzQ5MQ==",
    "user": {
      "login": "Carreau",
      "id": 335567,
      "node_id": "MDQ6VXNlcjMzNTU2Nw==",
      "avatar_url": "https://avatars3.githubusercontent.com/u/335567?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/Carreau",
      "html_url": "https://github.com/Carreau",
      "followers_url": "https://api.github.com/users/Carreau/followers",
      "following_url": "https://api.github.com/users/Carreau/following{/other_user}",
      "gists_url": "https://api.github.com/users/Carreau/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/Carreau/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/Carreau/subscriptions",
      "organizations_url": "https://api.github.com/users/Carreau/orgs",
      "repos_url": "https://api.github.com/users/Carreau/repos",
      "events_url": "https://api.github.com/users/Carreau/events{/privacy}",
      "received_events_url": "https://api.github.com/users/Carreau/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2019-01-04T18:28:25Z",
    "updated_at": "2019-01-04T18:28:25Z",
    "author_association": "MEMBER",
    "body": "Reopened. "
  },
  {
    "url": "https://api.github.com/repos/ipython/ipython/issues/comments/480672077",
    "html_url": "https://github.com/ipython/ipython/issues/11362#issuecomment-480672077",
    "issue_url": "https://api.github.com/repos/ipython/ipython/issues/11362",
    "id": 480672077,
    "node_id": "MDEyOklzc3VlQ29tbWVudDQ4MDY3MjA3Nw==",
    "user": {
      "login": "thequackdaddy",
      "id": 8186432,
      "node_id": "MDQ6VXNlcjgxODY0MzI=",
      "avatar_url": "https://avatars2.githubusercontent.com/u/8186432?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/thequackdaddy",
      "html_url": "https://github.com/thequackdaddy",
      "followers_url": "https://api.github.com/users/thequackdaddy/followers",
      "following_url": "https://api.github.com/users/thequackdaddy/following{/other_user}",
      "gists_url": "https://api.github.com/users/thequackdaddy/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/thequackdaddy/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/thequackdaddy/subscriptions",
      "organizations_url": "https://api.github.com/users/thequackdaddy/orgs",
      "repos_url": "https://api.github.com/users/thequackdaddy/repos",
      "events_url": "https://api.github.com/users/thequackdaddy/events{/privacy}",
      "received_events_url": "https://api.github.com/users/thequackdaddy/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2019-04-08T03:36:22Z",
    "updated_at": "2019-04-08T03:36:22Z",
    "author_association": "NONE",
    "body": "Ok I have done some investigation of this... \r\n\r\nI think the real problem is here:\r\n\r\nhttps://github.com/ipython/ipython/blob/4f901de17aff2132365fc3741fc5b4b8a9a98dc6/IPython/sphinxext/ipython_directive.py#L800-L852\r\n\r\nBottom line is that we have some very simple logic that basically:\r\n* Creates \"breaks\" after every line that starts with a \"@\" (used because `@savefig` is some pseudo decorator that saves figures as files.)\r\n* Creates \"breaks\" after every line that starts with a \"#\".\r\n* Inside functions--but nothing else--checks to see if the function has a return statement. Once found, it exits the function. \r\n\r\nMy main criticism is that if you have a class, it doesn't try to go to the end of the class. If you have multiple functions, it will likely \"break\" after the first function. Additionally, python already has a pretty good `ast.parse` function, and we are basically ignoring it. \r\n\r\nI wrote a quick PR to address some of my concerns. I notice there's no real unit testing, so that's likely my next challenge. "
  }
]
