[
  {
    "url": "https://api.github.com/repos/ipython/ipython/issues/comments/456625751",
    "html_url": "https://github.com/ipython/ipython/issues/11569#issuecomment-456625751",
    "issue_url": "https://api.github.com/repos/ipython/ipython/issues/11569",
    "id": 456625751,
    "node_id": "MDEyOklzc3VlQ29tbWVudDQ1NjYyNTc1MQ==",
    "user": {
      "login": "Carreau",
      "id": 335567,
      "node_id": "MDQ6VXNlcjMzNTU2Nw==",
      "avatar_url": "https://avatars3.githubusercontent.com/u/335567?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/Carreau",
      "html_url": "https://github.com/Carreau",
      "followers_url": "https://api.github.com/users/Carreau/followers",
      "following_url": "https://api.github.com/users/Carreau/following{/other_user}",
      "gists_url": "https://api.github.com/users/Carreau/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/Carreau/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/Carreau/subscriptions",
      "organizations_url": "https://api.github.com/users/Carreau/orgs",
      "repos_url": "https://api.github.com/users/Carreau/repos",
      "events_url": "https://api.github.com/users/Carreau/events{/privacy}",
      "received_events_url": "https://api.github.com/users/Carreau/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2019-01-23T01:03:02Z",
    "updated_at": "2019-01-23T01:03:02Z",
    "author_association": "MEMBER",
    "body": "You will need to  follow the instruction on [how to manage kernels in multiple environements](https://ipython.readthedocs.io/en/stable/install/kernel_install.html#kernels-for-different-environments)"
  },
  {
    "url": "https://api.github.com/repos/ipython/ipython/issues/comments/456702635",
    "html_url": "https://github.com/ipython/ipython/issues/11569#issuecomment-456702635",
    "issue_url": "https://api.github.com/repos/ipython/ipython/issues/11569",
    "id": 456702635,
    "node_id": "MDEyOklzc3VlQ29tbWVudDQ1NjcwMjYzNQ==",
    "user": {
      "login": "kubaraczkowski",
      "id": 554652,
      "node_id": "MDQ6VXNlcjU1NDY1Mg==",
      "avatar_url": "https://avatars3.githubusercontent.com/u/554652?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/kubaraczkowski",
      "html_url": "https://github.com/kubaraczkowski",
      "followers_url": "https://api.github.com/users/kubaraczkowski/followers",
      "following_url": "https://api.github.com/users/kubaraczkowski/following{/other_user}",
      "gists_url": "https://api.github.com/users/kubaraczkowski/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/kubaraczkowski/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/kubaraczkowski/subscriptions",
      "organizations_url": "https://api.github.com/users/kubaraczkowski/orgs",
      "repos_url": "https://api.github.com/users/kubaraczkowski/repos",
      "events_url": "https://api.github.com/users/kubaraczkowski/events{/privacy}",
      "received_events_url": "https://api.github.com/users/kubaraczkowski/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2019-01-23T07:47:51Z",
    "updated_at": "2019-01-23T07:47:51Z",
    "author_association": "NONE",
    "body": "I have indeed.\r\n\r\nI've figured out though that the behaviour depends whether the virtualenv is created with \"`--system-site-packages`\" or not.\r\nIn an \"isolated\" venv the ipykernel install points to the correct python executable.\r\nIn an \"`--system-site-packages`\" one, if ipykernel is already present in the \"system packages\" the executable of the \"system\" is taken, not of the virtualenv.\r\n\r\nIs this the expected behavior? \r\n"
  },
  {
    "url": "https://api.github.com/repos/ipython/ipython/issues/comments/457020504",
    "html_url": "https://github.com/ipython/ipython/issues/11569#issuecomment-457020504",
    "issue_url": "https://api.github.com/repos/ipython/ipython/issues/11569",
    "id": 457020504,
    "node_id": "MDEyOklzc3VlQ29tbWVudDQ1NzAyMDUwNA==",
    "user": {
      "login": "Carreau",
      "id": 335567,
      "node_id": "MDQ6VXNlcjMzNTU2Nw==",
      "avatar_url": "https://avatars3.githubusercontent.com/u/335567?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/Carreau",
      "html_url": "https://github.com/Carreau",
      "followers_url": "https://api.github.com/users/Carreau/followers",
      "following_url": "https://api.github.com/users/Carreau/following{/other_user}",
      "gists_url": "https://api.github.com/users/Carreau/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/Carreau/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/Carreau/subscriptions",
      "organizations_url": "https://api.github.com/users/Carreau/orgs",
      "repos_url": "https://api.github.com/users/Carreau/repos",
      "events_url": "https://api.github.com/users/Carreau/events{/privacy}",
      "received_events_url": "https://api.github.com/users/Carreau/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2019-01-24T00:32:22Z",
    "updated_at": "2019-01-24T00:32:22Z",
    "author_association": "MEMBER",
    "body": "Apologies for the previous scarce reply, I had to run, and did not completely read your issue.\r\n\r\nFrom the top of my head I'm unsure which ipykernel will take precedence and what's the logic beyond what you see, it does appear weird indeed, but my guess is that we are using heuristics to find which python executable to run based on the site-packages location.\r\n\r\nSo my wild guess is the `ipykernel install` think \"oh system site package so I'm going to use system  python\".\r\n\r\nI'm afraid thee logic of that might be in `ipykernel` , or even `jupyter_client`, so I'll have to dig deep. @takluyver  and @mpacer worked recently on kernelspec I believe so might know. \r\n\r\n"
  },
  {
    "url": "https://api.github.com/repos/ipython/ipython/issues/comments/457101280",
    "html_url": "https://github.com/ipython/ipython/issues/11569#issuecomment-457101280",
    "issue_url": "https://api.github.com/repos/ipython/ipython/issues/11569",
    "id": 457101280,
    "node_id": "MDEyOklzc3VlQ29tbWVudDQ1NzEwMTI4MA==",
    "user": {
      "login": "kubaraczkowski",
      "id": 554652,
      "node_id": "MDQ6VXNlcjU1NDY1Mg==",
      "avatar_url": "https://avatars3.githubusercontent.com/u/554652?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/kubaraczkowski",
      "html_url": "https://github.com/kubaraczkowski",
      "followers_url": "https://api.github.com/users/kubaraczkowski/followers",
      "following_url": "https://api.github.com/users/kubaraczkowski/following{/other_user}",
      "gists_url": "https://api.github.com/users/kubaraczkowski/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/kubaraczkowski/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/kubaraczkowski/subscriptions",
      "organizations_url": "https://api.github.com/users/kubaraczkowski/orgs",
      "repos_url": "https://api.github.com/users/kubaraczkowski/repos",
      "events_url": "https://api.github.com/users/kubaraczkowski/events{/privacy}",
      "received_events_url": "https://api.github.com/users/kubaraczkowski/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2019-01-24T07:56:11Z",
    "updated_at": "2019-01-24T07:56:11Z",
    "author_association": "NONE",
    "body": "No need for apologies. I also tried restarting my computer before asking ;)\n\nIndeed, it seems like the kernelspec is created as you describe. Correct me\nif i'm wrong, but that's not what the user might expect.\nThe scenario in which we're working is that there's jupyter installed in\nthe 'system' (brewed) python and then virtualenvs are 'linked' to that\ncentral system. this way the user needs to start one jupyter session only.\nThat means though that ipykernel is also present in the\n'system-site-packages'.\n\nIs it really needed to use heuristics here? sys.executable should normally\nbe all that's needed I'd guess?\n\n\n\nOn Thu, 24 Jan 2019 at 01:32, Matthias Bussonnier <notifications@github.com>\nwrote:\n\n> Apologies for the previous scarce reply, I had to run, and did not\n> completely read your issue.\n>\n> From the top of my head I'm unsure which ipykernel will take precedence\n> and what's the logic beyond what you see, it does appear weird indeed, but\n> my guess is that we are using heuristics to find which python executable to\n> run based on the site-packages location.\n>\n> So my wild guess is the ipykernel install think \"oh system site package\n> so I'm going to use system python\".\n>\n> I'm afraid thee logic of that might be in ipykernel , or even\n> jupyter_client, so I'll have to dig deep. @takluyver\n> <https://github.com/takluyver> and @mpacer <https://github.com/mpacer>\n> worked recently on kernelspec I believe so might know.\n>\n> —\n> You are receiving this because you authored the thread.\n> Reply to this email directly, view it on GitHub\n> <https://github.com/ipython/ipython/issues/11569#issuecomment-457020504>,\n> or mute the thread\n> <https://github.com/notifications/unsubscribe-auth/AAh2nCbzr5sViNUcGkL5WMTEQ65j_Q-hks5vGP8ogaJpZM4aKzEQ>\n> .\n>\n"
  },
  {
    "url": "https://api.github.com/repos/ipython/ipython/issues/comments/457162777",
    "html_url": "https://github.com/ipython/ipython/issues/11569#issuecomment-457162777",
    "issue_url": "https://api.github.com/repos/ipython/ipython/issues/11569",
    "id": 457162777,
    "node_id": "MDEyOklzc3VlQ29tbWVudDQ1NzE2Mjc3Nw==",
    "user": {
      "login": "takluyver",
      "id": 327925,
      "node_id": "MDQ6VXNlcjMyNzkyNQ==",
      "avatar_url": "https://avatars3.githubusercontent.com/u/327925?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/takluyver",
      "html_url": "https://github.com/takluyver",
      "followers_url": "https://api.github.com/users/takluyver/followers",
      "following_url": "https://api.github.com/users/takluyver/following{/other_user}",
      "gists_url": "https://api.github.com/users/takluyver/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/takluyver/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/takluyver/subscriptions",
      "organizations_url": "https://api.github.com/users/takluyver/orgs",
      "repos_url": "https://api.github.com/users/takluyver/repos",
      "events_url": "https://api.github.com/users/takluyver/events{/privacy}",
      "received_events_url": "https://api.github.com/users/takluyver/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2019-01-24T11:22:22Z",
    "updated_at": "2019-01-24T11:22:22Z",
    "author_association": "MEMBER",
    "body": "As far as I know it does use `sys.executable`. You can follow the relevant code here: https://github.com/ipython/ipykernel/blob/5.1.0/ipykernel/kernelspec.py\r\n\r\nThings to check:\r\n\r\n1. Your shell can cache command locations, so if you run `python3 ...`, then activate a virtualenv, then run another `python3 ...` command, it may still be using the executable outside the env, even if `which python3` shows something different. In bash,  `hash -r` clears this cache so it searches PATH again the next time you use the command.\r\n2. IIRC, the standard library `venv` module has a few differences from classic `virtualenv`. Maybe when created with `--system-site-packages`, one of those differences means that `sys.executable` does point to the system Python."
  },
  {
    "url": "https://api.github.com/repos/ipython/ipython/issues/comments/457266155",
    "html_url": "https://github.com/ipython/ipython/issues/11569#issuecomment-457266155",
    "issue_url": "https://api.github.com/repos/ipython/ipython/issues/11569",
    "id": 457266155,
    "node_id": "MDEyOklzc3VlQ29tbWVudDQ1NzI2NjE1NQ==",
    "user": {
      "login": "kubaraczkowski",
      "id": 554652,
      "node_id": "MDQ6VXNlcjU1NDY1Mg==",
      "avatar_url": "https://avatars3.githubusercontent.com/u/554652?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/kubaraczkowski",
      "html_url": "https://github.com/kubaraczkowski",
      "followers_url": "https://api.github.com/users/kubaraczkowski/followers",
      "following_url": "https://api.github.com/users/kubaraczkowski/following{/other_user}",
      "gists_url": "https://api.github.com/users/kubaraczkowski/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/kubaraczkowski/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/kubaraczkowski/subscriptions",
      "organizations_url": "https://api.github.com/users/kubaraczkowski/orgs",
      "repos_url": "https://api.github.com/users/kubaraczkowski/repos",
      "events_url": "https://api.github.com/users/kubaraczkowski/events{/privacy}",
      "received_events_url": "https://api.github.com/users/kubaraczkowski/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2019-01-24T16:40:19Z",
    "updated_at": "2019-01-24T16:40:19Z",
    "author_association": "NONE",
    "body": "You're right, i've digged into the kernelspec.py and sys.executable it is!\n\nHowever, it seems that using --system-site-packages does influence\nsys.executable. Not only in ipykernel, but in general. This is kind of\nunexpected, but perhaps needed to get the imports right. Interestingly the\nsys.base_path and sys.path remain unaffected...\n\nI looked for a reliable way of figuring out the 'effective' executable, but\ndidn't find one. Maybe you have more experience with that?\n\nOn Thu, 24 Jan 2019 at 12:22, Thomas Kluyver <notifications@github.com>\nwrote:\n\n> As far as I know it does use sys.executable. You can follow the relevant\n> code here:\n> https://github.com/ipython/ipykernel/blob/5.1.0/ipykernel/kernelspec.py\n>\n> Things to check:\n>\n>    1. Your shell can cache command locations, so if you run python3 ...,\n>    then activate a virtualenv, then run another python3 ... command, it\n>    may still be using the executable outside the env, even if which\n>    python3 shows something different. In bash, hash -r clears this cache\n>    so it searches PATH again the next time you use the command.\n>    2. IIRC, the standard library venv module has a few differences from\n>    classic virtualenv. Maybe when created with --system-site-packages,\n>    one of those differences means that sys.executable does point to the\n>    system Python.\n>\n> —\n> You are receiving this because you authored the thread.\n> Reply to this email directly, view it on GitHub\n> <https://github.com/ipython/ipython/issues/11569#issuecomment-457162777>,\n> or mute the thread\n> <https://github.com/notifications/unsubscribe-auth/AAh2nM5DeXf-RuxKsAEHvbILgnn_TUOjks5vGZeCgaJpZM4aKzEQ>\n> .\n>\n"
  },
  {
    "url": "https://api.github.com/repos/ipython/ipython/issues/comments/457276086",
    "html_url": "https://github.com/ipython/ipython/issues/11569#issuecomment-457276086",
    "issue_url": "https://api.github.com/repos/ipython/ipython/issues/11569",
    "id": 457276086,
    "node_id": "MDEyOklzc3VlQ29tbWVudDQ1NzI3NjA4Ng==",
    "user": {
      "login": "takluyver",
      "id": 327925,
      "node_id": "MDQ6VXNlcjMyNzkyNQ==",
      "avatar_url": "https://avatars3.githubusercontent.com/u/327925?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/takluyver",
      "html_url": "https://github.com/takluyver",
      "followers_url": "https://api.github.com/users/takluyver/followers",
      "following_url": "https://api.github.com/users/takluyver/following{/other_user}",
      "gists_url": "https://api.github.com/users/takluyver/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/takluyver/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/takluyver/subscriptions",
      "organizations_url": "https://api.github.com/users/takluyver/orgs",
      "repos_url": "https://api.github.com/users/takluyver/repos",
      "events_url": "https://api.github.com/users/takluyver/events{/privacy}",
      "received_events_url": "https://api.github.com/users/takluyver/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2019-01-24T17:05:48Z",
    "updated_at": "2019-01-24T17:05:48Z",
    "author_association": "MEMBER",
    "body": "Does the venv you create (with `--system-site-packages`) have a `bin/python3` itself? And if so, is it a symlink to your system Python? And does this differ when `--system-site-packages` isn't used?"
  },
  {
    "url": "https://api.github.com/repos/ipython/ipython/issues/comments/457305708",
    "html_url": "https://github.com/ipython/ipython/issues/11569#issuecomment-457305708",
    "issue_url": "https://api.github.com/repos/ipython/ipython/issues/11569",
    "id": 457305708,
    "node_id": "MDEyOklzc3VlQ29tbWVudDQ1NzMwNTcwOA==",
    "user": {
      "login": "kubaraczkowski",
      "id": 554652,
      "node_id": "MDQ6VXNlcjU1NDY1Mg==",
      "avatar_url": "https://avatars3.githubusercontent.com/u/554652?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/kubaraczkowski",
      "html_url": "https://github.com/kubaraczkowski",
      "followers_url": "https://api.github.com/users/kubaraczkowski/followers",
      "following_url": "https://api.github.com/users/kubaraczkowski/following{/other_user}",
      "gists_url": "https://api.github.com/users/kubaraczkowski/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/kubaraczkowski/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/kubaraczkowski/subscriptions",
      "organizations_url": "https://api.github.com/users/kubaraczkowski/orgs",
      "repos_url": "https://api.github.com/users/kubaraczkowski/repos",
      "events_url": "https://api.github.com/users/kubaraczkowski/events{/privacy}",
      "received_events_url": "https://api.github.com/users/kubaraczkowski/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2019-01-24T18:30:19Z",
    "updated_at": "2019-01-24T18:30:19Z",
    "author_association": "NONE",
    "body": "In both cases bin/python3 is a symlink to /usr/local/opt/python/bin/python3.7 (as created by homebrew)\r\n\r\nRunning both executables produces different result:\r\n\r\n```\r\n > ./ipykerneltest/bin/python3 -c \"import sys; print(sys.executable)\"\r\n/usr/local/opt/python/bin/python3.7\r\n```\r\n```\r\n> ./ipykerneltestnosite/bin/python3 -c \"import sys; print(sys.executable)\"\r\n/Users/kuba.raczkowski/python/ipykerneltestnosite/bin/python3\r\n```\r\nwhere `ipykerneltestnosite` is the one _without_ `--system-site-packages`\r\n\r\none would say it's \"magic\"... :)"
  },
  {
    "url": "https://api.github.com/repos/ipython/ipython/issues/comments/469670373",
    "html_url": "https://github.com/ipython/ipython/issues/11569#issuecomment-469670373",
    "issue_url": "https://api.github.com/repos/ipython/ipython/issues/11569",
    "id": 469670373,
    "node_id": "MDEyOklzc3VlQ29tbWVudDQ2OTY3MDM3Mw==",
    "user": {
      "login": "alexgawrilow",
      "id": 40760987,
      "node_id": "MDQ6VXNlcjQwNzYwOTg3",
      "avatar_url": "https://avatars2.githubusercontent.com/u/40760987?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/alexgawrilow",
      "html_url": "https://github.com/alexgawrilow",
      "followers_url": "https://api.github.com/users/alexgawrilow/followers",
      "following_url": "https://api.github.com/users/alexgawrilow/following{/other_user}",
      "gists_url": "https://api.github.com/users/alexgawrilow/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/alexgawrilow/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/alexgawrilow/subscriptions",
      "organizations_url": "https://api.github.com/users/alexgawrilow/orgs",
      "repos_url": "https://api.github.com/users/alexgawrilow/repos",
      "events_url": "https://api.github.com/users/alexgawrilow/events{/privacy}",
      "received_events_url": "https://api.github.com/users/alexgawrilow/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2019-03-05T12:58:47Z",
    "updated_at": "2019-03-05T12:58:47Z",
    "author_association": "NONE",
    "body": "I had the same problem on Ubuntu.\r\nAfter installing the ipykernel inside the virtual environment, the python path was set to the standard python path (/usr/bin/python3). However, when I deactivated the virtual environment and reactivated it and installed another ipykernel in the virtual environment, the python path was set correctly to the path of the virtual environment."
  }
]
