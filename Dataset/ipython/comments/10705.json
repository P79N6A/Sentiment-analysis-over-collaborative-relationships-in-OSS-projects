[
  {
    "url": "https://api.github.com/repos/ipython/ipython/issues/comments/316150778",
    "html_url": "https://github.com/ipython/ipython/issues/10705#issuecomment-316150778",
    "issue_url": "https://api.github.com/repos/ipython/ipython/issues/10705",
    "id": 316150778,
    "node_id": "MDEyOklzc3VlQ29tbWVudDMxNjE1MDc3OA==",
    "user": {
      "login": "takluyver",
      "id": 327925,
      "node_id": "MDQ6VXNlcjMyNzkyNQ==",
      "avatar_url": "https://avatars3.githubusercontent.com/u/327925?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/takluyver",
      "html_url": "https://github.com/takluyver",
      "followers_url": "https://api.github.com/users/takluyver/followers",
      "following_url": "https://api.github.com/users/takluyver/following{/other_user}",
      "gists_url": "https://api.github.com/users/takluyver/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/takluyver/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/takluyver/subscriptions",
      "organizations_url": "https://api.github.com/users/takluyver/orgs",
      "repos_url": "https://api.github.com/users/takluyver/repos",
      "events_url": "https://api.github.com/users/takluyver/events{/privacy}",
      "received_events_url": "https://api.github.com/users/takluyver/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2017-07-18T18:17:27Z",
    "updated_at": "2017-07-18T18:17:27Z",
    "author_association": "MEMBER",
    "body": "I think this is another consequence of the difficulty Python has with dynamic execution and local variables. There's an optimisation Python does to make accessing local variables quicker, but it means you can't modify local variables from dynamic execution (which is what magics do)."
  },
  {
    "url": "https://api.github.com/repos/ipython/ipython/issues/comments/316150905",
    "html_url": "https://github.com/ipython/ipython/issues/10705#issuecomment-316150905",
    "issue_url": "https://api.github.com/repos/ipython/ipython/issues/10705",
    "id": 316150905,
    "node_id": "MDEyOklzc3VlQ29tbWVudDMxNjE1MDkwNQ==",
    "user": {
      "login": "sergeny",
      "id": 5010099,
      "node_id": "MDQ6VXNlcjUwMTAwOTk=",
      "avatar_url": "https://avatars3.githubusercontent.com/u/5010099?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/sergeny",
      "html_url": "https://github.com/sergeny",
      "followers_url": "https://api.github.com/users/sergeny/followers",
      "following_url": "https://api.github.com/users/sergeny/following{/other_user}",
      "gists_url": "https://api.github.com/users/sergeny/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/sergeny/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/sergeny/subscriptions",
      "organizations_url": "https://api.github.com/users/sergeny/orgs",
      "repos_url": "https://api.github.com/users/sergeny/repos",
      "events_url": "https://api.github.com/users/sergeny/events{/privacy}",
      "received_events_url": "https://api.github.com/users/sergeny/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2017-07-18T18:17:52Z",
    "updated_at": "2017-07-18T18:17:52Z",
    "author_association": "NONE",
    "body": "No, it does modify it."
  },
  {
    "url": "https://api.github.com/repos/ipython/ipython/issues/comments/316151210",
    "html_url": "https://github.com/ipython/ipython/issues/10705#issuecomment-316151210",
    "issue_url": "https://api.github.com/repos/ipython/ipython/issues/10705",
    "id": 316151210,
    "node_id": "MDEyOklzc3VlQ29tbWVudDMxNjE1MTIxMA==",
    "user": {
      "login": "sergeny",
      "id": 5010099,
      "node_id": "MDQ6VXNlcjUwMTAwOTk=",
      "avatar_url": "https://avatars3.githubusercontent.com/u/5010099?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/sergeny",
      "html_url": "https://github.com/sergeny",
      "followers_url": "https://api.github.com/users/sergeny/followers",
      "following_url": "https://api.github.com/users/sergeny/following{/other_user}",
      "gists_url": "https://api.github.com/users/sergeny/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/sergeny/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/sergeny/subscriptions",
      "organizations_url": "https://api.github.com/users/sergeny/orgs",
      "repos_url": "https://api.github.com/users/sergeny/repos",
      "events_url": "https://api.github.com/users/sergeny/events{/privacy}",
      "received_events_url": "https://api.github.com/users/sergeny/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2017-07-18T18:18:56Z",
    "updated_at": "2017-07-18T18:19:05Z",
    "author_association": "NONE",
    "body": "    x = 3\r\n    def f():\r\n        %time x = 2 + 2\r\n        print locals()\r\n        return x\r\n    print f()\r\n---\r\n\r\nCPU times: user 0 ns, sys: 0 ns, total: 0 ns\r\nWall time: 8.82 Âµs\r\n{'x': 4}\r\n3\r\n\r\n---\r\n\r\n    x = 3\r\n    def f():\r\n        x = 2 + 2\r\n        print locals()\r\n        return x\r\n    print f()\r\n---\r\n{'x':4}\r\n4"
  },
  {
    "url": "https://api.github.com/repos/ipython/ipython/issues/comments/316152723",
    "html_url": "https://github.com/ipython/ipython/issues/10705#issuecomment-316152723",
    "issue_url": "https://api.github.com/repos/ipython/ipython/issues/10705",
    "id": 316152723,
    "node_id": "MDEyOklzc3VlQ29tbWVudDMxNjE1MjcyMw==",
    "user": {
      "login": "takluyver",
      "id": 327925,
      "node_id": "MDQ6VXNlcjMyNzkyNQ==",
      "avatar_url": "https://avatars3.githubusercontent.com/u/327925?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/takluyver",
      "html_url": "https://github.com/takluyver",
      "followers_url": "https://api.github.com/users/takluyver/followers",
      "following_url": "https://api.github.com/users/takluyver/following{/other_user}",
      "gists_url": "https://api.github.com/users/takluyver/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/takluyver/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/takluyver/subscriptions",
      "organizations_url": "https://api.github.com/users/takluyver/orgs",
      "repos_url": "https://api.github.com/users/takluyver/repos",
      "events_url": "https://api.github.com/users/takluyver/events{/privacy}",
      "received_events_url": "https://api.github.com/users/takluyver/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2017-07-18T18:24:24Z",
    "updated_at": "2017-07-18T18:24:24Z",
    "author_association": "MEMBER",
    "body": "Right, but that's not what Python actually uses.\r\n\r\nIn your example, the `x` in `return x` will be compiled to a `LOAD_GLOBAL` operation, because as far as Python is concerned, there's no local `x` inside the function. So we can modify the locals dictionary, but Python still looks for it in globals."
  }
]
