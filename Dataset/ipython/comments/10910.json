[
  {
    "url": "https://api.github.com/repos/ipython/ipython/issues/comments/345714650",
    "html_url": "https://github.com/ipython/ipython/issues/10910#issuecomment-345714650",
    "issue_url": "https://api.github.com/repos/ipython/ipython/issues/10910",
    "id": 345714650,
    "node_id": "MDEyOklzc3VlQ29tbWVudDM0NTcxNDY1MA==",
    "user": {
      "login": "bialix",
      "id": 82971,
      "node_id": "MDQ6VXNlcjgyOTcx",
      "avatar_url": "https://avatars0.githubusercontent.com/u/82971?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/bialix",
      "html_url": "https://github.com/bialix",
      "followers_url": "https://api.github.com/users/bialix/followers",
      "following_url": "https://api.github.com/users/bialix/following{/other_user}",
      "gists_url": "https://api.github.com/users/bialix/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/bialix/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/bialix/subscriptions",
      "organizations_url": "https://api.github.com/users/bialix/orgs",
      "repos_url": "https://api.github.com/users/bialix/repos",
      "events_url": "https://api.github.com/users/bialix/events{/privacy}",
      "received_events_url": "https://api.github.com/users/bialix/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2017-11-20T14:39:47Z",
    "updated_at": "2017-11-20T14:39:47Z",
    "author_association": "NONE",
    "body": "Of course I'm running cmd.exe - is it illegal now?"
  },
  {
    "url": "https://api.github.com/repos/ipython/ipython/issues/comments/345717494",
    "html_url": "https://github.com/ipython/ipython/issues/10910#issuecomment-345717494",
    "issue_url": "https://api.github.com/repos/ipython/ipython/issues/10910",
    "id": 345717494,
    "node_id": "MDEyOklzc3VlQ29tbWVudDM0NTcxNzQ5NA==",
    "user": {
      "login": "bialix",
      "id": 82971,
      "node_id": "MDQ6VXNlcjgyOTcx",
      "avatar_url": "https://avatars0.githubusercontent.com/u/82971?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/bialix",
      "html_url": "https://github.com/bialix",
      "followers_url": "https://api.github.com/users/bialix/followers",
      "following_url": "https://api.github.com/users/bialix/following{/other_user}",
      "gists_url": "https://api.github.com/users/bialix/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/bialix/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/bialix/subscriptions",
      "organizations_url": "https://api.github.com/users/bialix/orgs",
      "repos_url": "https://api.github.com/users/bialix/repos",
      "events_url": "https://api.github.com/users/bialix/events{/privacy}",
      "received_events_url": "https://api.github.com/users/bialix/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2017-11-20T14:49:06Z",
    "updated_at": "2017-11-20T14:49:06Z",
    "author_association": "NONE",
    "body": "The same with version 5.0. I've read news and found you've switched to use prompt_toolkit. And that library seems does not work on Windows."
  },
  {
    "url": "https://api.github.com/repos/ipython/ipython/issues/comments/345718073",
    "html_url": "https://github.com/ipython/ipython/issues/10910#issuecomment-345718073",
    "issue_url": "https://api.github.com/repos/ipython/ipython/issues/10910",
    "id": 345718073,
    "node_id": "MDEyOklzc3VlQ29tbWVudDM0NTcxODA3Mw==",
    "user": {
      "login": "bialix",
      "id": 82971,
      "node_id": "MDQ6VXNlcjgyOTcx",
      "avatar_url": "https://avatars0.githubusercontent.com/u/82971?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/bialix",
      "html_url": "https://github.com/bialix",
      "followers_url": "https://api.github.com/users/bialix/followers",
      "following_url": "https://api.github.com/users/bialix/following{/other_user}",
      "gists_url": "https://api.github.com/users/bialix/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/bialix/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/bialix/subscriptions",
      "organizations_url": "https://api.github.com/users/bialix/orgs",
      "repos_url": "https://api.github.com/users/bialix/repos",
      "events_url": "https://api.github.com/users/bialix/events{/privacy}",
      "received_events_url": "https://api.github.com/users/bialix/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2017-11-20T14:51:03Z",
    "updated_at": "2017-11-20T16:22:35Z",
    "author_association": "NONE",
    "body": "OK, ipython 4.2 with pyreadline still works. I should remember to install exactly that version."
  },
  {
    "url": "https://api.github.com/repos/ipython/ipython/issues/comments/345739005",
    "html_url": "https://github.com/ipython/ipython/issues/10910#issuecomment-345739005",
    "issue_url": "https://api.github.com/repos/ipython/ipython/issues/10910",
    "id": 345739005,
    "node_id": "MDEyOklzc3VlQ29tbWVudDM0NTczOTAwNQ==",
    "user": {
      "login": "takluyver",
      "id": 327925,
      "node_id": "MDQ6VXNlcjMyNzkyNQ==",
      "avatar_url": "https://avatars3.githubusercontent.com/u/327925?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/takluyver",
      "html_url": "https://github.com/takluyver",
      "followers_url": "https://api.github.com/users/takluyver/followers",
      "following_url": "https://api.github.com/users/takluyver/following{/other_user}",
      "gists_url": "https://api.github.com/users/takluyver/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/takluyver/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/takluyver/subscriptions",
      "organizations_url": "https://api.github.com/users/takluyver/orgs",
      "repos_url": "https://api.github.com/users/takluyver/repos",
      "events_url": "https://api.github.com/users/takluyver/events{/privacy}",
      "received_events_url": "https://api.github.com/users/takluyver/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2017-11-20T15:57:07Z",
    "updated_at": "2017-11-20T15:57:07Z",
    "author_association": "MEMBER",
    "body": "There's nothing wrong with using `cmd.exe`, and prompt_toolkit is meant to work on Windows. There's some mysterious bug that crops up occasionally that results in that error. At least one cause of it has been fixed, but apparently there's another.\r\n\r\ncc @jonathanslenders - how do we debug the dreaded `NoConsoleScreenBufferError` ?"
  },
  {
    "url": "https://api.github.com/repos/ipython/ipython/issues/comments/345746274",
    "html_url": "https://github.com/ipython/ipython/issues/10910#issuecomment-345746274",
    "issue_url": "https://api.github.com/repos/ipython/ipython/issues/10910",
    "id": 345746274,
    "node_id": "MDEyOklzc3VlQ29tbWVudDM0NTc0NjI3NA==",
    "user": {
      "login": "bialix",
      "id": 82971,
      "node_id": "MDQ6VXNlcjgyOTcx",
      "avatar_url": "https://avatars0.githubusercontent.com/u/82971?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/bialix",
      "html_url": "https://github.com/bialix",
      "followers_url": "https://api.github.com/users/bialix/followers",
      "following_url": "https://api.github.com/users/bialix/following{/other_user}",
      "gists_url": "https://api.github.com/users/bialix/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/bialix/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/bialix/subscriptions",
      "organizations_url": "https://api.github.com/users/bialix/orgs",
      "repos_url": "https://api.github.com/users/bialix/repos",
      "events_url": "https://api.github.com/users/bialix/events{/privacy}",
      "received_events_url": "https://api.github.com/users/bialix/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2017-11-20T16:19:12Z",
    "updated_at": "2017-11-20T16:20:42Z",
    "author_association": "NONE",
    "body": "I've just tested on almost fresh installation of Python 3.4 64-bit with virtualenv. And it worked.\r\nMaybe it's somehow related to Python 3.3 or maybe virtualenv not fully isolate ipython from installed packages.\r\n\r\nThe only strange thing is warning:\r\n\r\n`c:\\temp\\test\\lib\\site-packages\\win_unicode_console\\__init__.py:31: RuntimeWarning: sys.stdin.encoding == 'cp1251', whereas sys.stdout.encoding == 'utf-8', readline hook consumer may assume they are th\r\ne same\r\n  readline_hook.enable(use_pyreadline=use_pyreadline)`\r\n\r\n```\r\nC:\\Temp\\test\\Scripts>ipython\r\nc:\\temp\\test\\lib\\site-packages\\win_unicode_console\\__init__.py:31: RuntimeWarning: sys.stdin.encoding == 'cp1251', whereas sys.stdout.encoding == 'utf-8', readline hook consumer may assume they are th\r\ne same\r\n  readline_hook.enable(use_pyreadline=use_pyreadline)\r\nPython 3.4.4 (v3.4.4:737efcadf5a6, Dec 20 2015, 20:20:57) [MSC v.1600 64 bit (AMD64)]\r\nType 'copyright', 'credits' or 'license' for more information\r\nIPython 6.2.1 -- An enhanced Interactive Python. Type '?' for help.\r\n```"
  },
  {
    "url": "https://api.github.com/repos/ipython/ipython/issues/comments/345748531",
    "html_url": "https://github.com/ipython/ipython/issues/10910#issuecomment-345748531",
    "issue_url": "https://api.github.com/repos/ipython/ipython/issues/10910",
    "id": 345748531,
    "node_id": "MDEyOklzc3VlQ29tbWVudDM0NTc0ODUzMQ==",
    "user": {
      "login": "jonathanslenders",
      "id": 216638,
      "node_id": "MDQ6VXNlcjIxNjYzOA==",
      "avatar_url": "https://avatars3.githubusercontent.com/u/216638?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/jonathanslenders",
      "html_url": "https://github.com/jonathanslenders",
      "followers_url": "https://api.github.com/users/jonathanslenders/followers",
      "following_url": "https://api.github.com/users/jonathanslenders/following{/other_user}",
      "gists_url": "https://api.github.com/users/jonathanslenders/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/jonathanslenders/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/jonathanslenders/subscriptions",
      "organizations_url": "https://api.github.com/users/jonathanslenders/orgs",
      "repos_url": "https://api.github.com/users/jonathanslenders/repos",
      "events_url": "https://api.github.com/users/jonathanslenders/events{/privacy}",
      "received_events_url": "https://api.github.com/users/jonathanslenders/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2017-11-20T16:26:04Z",
    "updated_at": "2017-11-20T16:26:04Z",
    "author_association": "CONTRIBUTOR",
    "body": "The code for testing would be the following:\r\n\r\n```python\r\nimport sys\r\nfrom prompt_toolkit.terminal.win32_output import Win32Output\r\noutput = Win32Output(sys.stdout)\r\nsbinfo = output.get_win32_screen_buffer_info()\r\nprint(sbinfo)  # This should print the console screen buffer info or raise a `NoConsoleScreenBufferError`\r\n```\r\n\r\nHonestly, I'm still not sure why in certain situations it doesn't work. There are differences between Python versions and Windows versions. If it breaks, then it's because the API call to the Win32 kernel fails. There was also a *very* weird issue where calling this function through another function that wrapped it failed systematically on some systems. See this comment: https://github.com/jonathanslenders/python-prompt-toolkit/blob/4476b3c28add85c5a8169fbb81ded8c3b845e588/prompt_toolkit/terminal/win32_output.py#L144\r\n\r\nMaybe it's indeed related to Python 3.3\r\n"
  },
  {
    "url": "https://api.github.com/repos/ipython/ipython/issues/comments/345750338",
    "html_url": "https://github.com/ipython/ipython/issues/10910#issuecomment-345750338",
    "issue_url": "https://api.github.com/repos/ipython/ipython/issues/10910",
    "id": 345750338,
    "node_id": "MDEyOklzc3VlQ29tbWVudDM0NTc1MDMzOA==",
    "user": {
      "login": "bialix",
      "id": 82971,
      "node_id": "MDQ6VXNlcjgyOTcx",
      "avatar_url": "https://avatars0.githubusercontent.com/u/82971?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/bialix",
      "html_url": "https://github.com/bialix",
      "followers_url": "https://api.github.com/users/bialix/followers",
      "following_url": "https://api.github.com/users/bialix/following{/other_user}",
      "gists_url": "https://api.github.com/users/bialix/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/bialix/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/bialix/subscriptions",
      "organizations_url": "https://api.github.com/users/bialix/orgs",
      "repos_url": "https://api.github.com/users/bialix/repos",
      "events_url": "https://api.github.com/users/bialix/events{/privacy}",
      "received_events_url": "https://api.github.com/users/bialix/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2017-11-20T16:31:32Z",
    "updated_at": "2017-11-20T16:31:52Z",
    "author_association": "NONE",
    "body": "@jonathanslenders I've just checked your code example and it works:\r\n\r\n```\r\nC:\\Temp\\test\\venv\\Scripts>python.EXE\r\nPython 3.3.5 (v3.3.5:62cf4e77f785, Mar  9 2014, 10:35:05) [MSC v.1600 64 bit (AMD64)] on win32\r\nType \"help\", \"copyright\", \"credits\" or \"license\" for more information.\r\n>>> import sys\r\n>>> from prompt_toolkit.terminal.win32_output import Win32Output\r\n>>> output = Win32Output(sys.stdout)\r\n>>> sbinfo = output.get_win32_screen_buffer_info()\r\n>>> print(sbinfo)\r\n(52,200,51,0,7,0,0,51,199,52,200)\r\n```\r\n\r\nBut ipython still raises NoConsoleScreenBufferError"
  },
  {
    "url": "https://api.github.com/repos/ipython/ipython/issues/comments/345756029",
    "html_url": "https://github.com/ipython/ipython/issues/10910#issuecomment-345756029",
    "issue_url": "https://api.github.com/repos/ipython/ipython/issues/10910",
    "id": 345756029,
    "node_id": "MDEyOklzc3VlQ29tbWVudDM0NTc1NjAyOQ==",
    "user": {
      "login": "jonathanslenders",
      "id": 216638,
      "node_id": "MDQ6VXNlcjIxNjYzOA==",
      "avatar_url": "https://avatars3.githubusercontent.com/u/216638?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/jonathanslenders",
      "html_url": "https://github.com/jonathanslenders",
      "followers_url": "https://api.github.com/users/jonathanslenders/followers",
      "following_url": "https://api.github.com/users/jonathanslenders/following{/other_user}",
      "gists_url": "https://api.github.com/users/jonathanslenders/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/jonathanslenders/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/jonathanslenders/subscriptions",
      "organizations_url": "https://api.github.com/users/jonathanslenders/orgs",
      "repos_url": "https://api.github.com/users/jonathanslenders/repos",
      "events_url": "https://api.github.com/users/jonathanslenders/events{/privacy}",
      "received_events_url": "https://api.github.com/users/jonathanslenders/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2017-11-20T16:48:48Z",
    "updated_at": "2017-11-20T16:48:48Z",
    "author_association": "CONTRIBUTOR",
    "body": "Very weird.\r\nI wonder whether at some point the window handle ( ``Win32Output.hconsole``) becomes corrupt.\r\n\r\nWhat if you would change ``get_win32_screen_buffer_info`` [1], so that if it is not successful, instead of raising an error, it does the following:\r\n```python\r\nif success:\r\n    return sbinfo\r\nelse:\r\n    # raise NoConsoleScreenBufferError\r\n    self.hconsole = windll.kernel32.GetStdHandle(STD_OUTPUT_HANDLE)\r\n    return self.get_win32_screen_buffer_info()  # Call itself again.\r\n```\r\n\r\n[1] https://github.com/jonathanslenders/python-prompt-toolkit/blob/4476b3c28add85c5a8169fbb81ded8c3b845e588/prompt_toolkit/terminal/win32_output.py#L140"
  },
  {
    "url": "https://api.github.com/repos/ipython/ipython/issues/comments/345983373",
    "html_url": "https://github.com/ipython/ipython/issues/10910#issuecomment-345983373",
    "issue_url": "https://api.github.com/repos/ipython/ipython/issues/10910",
    "id": 345983373,
    "node_id": "MDEyOklzc3VlQ29tbWVudDM0NTk4MzM3Mw==",
    "user": {
      "login": "bialix",
      "id": 82971,
      "node_id": "MDQ6VXNlcjgyOTcx",
      "avatar_url": "https://avatars0.githubusercontent.com/u/82971?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/bialix",
      "html_url": "https://github.com/bialix",
      "followers_url": "https://api.github.com/users/bialix/followers",
      "following_url": "https://api.github.com/users/bialix/following{/other_user}",
      "gists_url": "https://api.github.com/users/bialix/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/bialix/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/bialix/subscriptions",
      "organizations_url": "https://api.github.com/users/bialix/orgs",
      "repos_url": "https://api.github.com/users/bialix/repos",
      "events_url": "https://api.github.com/users/bialix/events{/privacy}",
      "received_events_url": "https://api.github.com/users/bialix/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2017-11-21T10:27:00Z",
    "updated_at": "2017-11-21T10:27:00Z",
    "author_association": "NONE",
    "body": "I wonder if there are second thread involved in this bug, or ipython is always single-threaded?"
  },
  {
    "url": "https://api.github.com/repos/ipython/ipython/issues/comments/345987049",
    "html_url": "https://github.com/ipython/ipython/issues/10910#issuecomment-345987049",
    "issue_url": "https://api.github.com/repos/ipython/ipython/issues/10910",
    "id": 345987049,
    "node_id": "MDEyOklzc3VlQ29tbWVudDM0NTk4NzA0OQ==",
    "user": {
      "login": "bialix",
      "id": 82971,
      "node_id": "MDQ6VXNlcjgyOTcx",
      "avatar_url": "https://avatars0.githubusercontent.com/u/82971?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/bialix",
      "html_url": "https://github.com/bialix",
      "followers_url": "https://api.github.com/users/bialix/followers",
      "following_url": "https://api.github.com/users/bialix/following{/other_user}",
      "gists_url": "https://api.github.com/users/bialix/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/bialix/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/bialix/subscriptions",
      "organizations_url": "https://api.github.com/users/bialix/orgs",
      "repos_url": "https://api.github.com/users/bialix/repos",
      "events_url": "https://api.github.com/users/bialix/events{/privacy}",
      "received_events_url": "https://api.github.com/users/bialix/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2017-11-21T10:41:06Z",
    "updated_at": "2017-11-21T10:41:06Z",
    "author_association": "NONE",
    "body": "> Very weird.\r\n> I wonder whether at some point the window handle ( Win32Output.hconsole) becomes corrupt.\r\n\r\nYep, it seems your assumption are not far from true.\r\nI've added logging to win32_output.py and found that self.hconsole is 19 in constructor and then later in get_win32_screen_buffer_info. But error was still here with ipython.\r\n\r\nBut when I changed the code as following:\r\n\r\n```\r\n    def get_win32_screen_buffer_info(self):\r\n        self.flush()\r\n        sbinfo = CONSOLE_SCREEN_BUFFER_INFO()\r\n        hconsole = windll.kernel32.GetStdHandle(STD_OUTPUT_HANDLE)\r\n        success = windll.kernel32.GetConsoleScreenBufferInfo(hconsole, byref(sbinfo))\r\n```\r\n\r\nAnd it started to work fine and ipython now works. Quite strange."
  },
  {
    "url": "https://api.github.com/repos/ipython/ipython/issues/comments/346151791",
    "html_url": "https://github.com/ipython/ipython/issues/10910#issuecomment-346151791",
    "issue_url": "https://api.github.com/repos/ipython/ipython/issues/10910",
    "id": 346151791,
    "node_id": "MDEyOklzc3VlQ29tbWVudDM0NjE1MTc5MQ==",
    "user": {
      "login": "jonathanslenders",
      "id": 216638,
      "node_id": "MDQ6VXNlcjIxNjYzOA==",
      "avatar_url": "https://avatars3.githubusercontent.com/u/216638?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/jonathanslenders",
      "html_url": "https://github.com/jonathanslenders",
      "followers_url": "https://api.github.com/users/jonathanslenders/followers",
      "following_url": "https://api.github.com/users/jonathanslenders/following{/other_user}",
      "gists_url": "https://api.github.com/users/jonathanslenders/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/jonathanslenders/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/jonathanslenders/subscriptions",
      "organizations_url": "https://api.github.com/users/jonathanslenders/orgs",
      "repos_url": "https://api.github.com/users/jonathanslenders/repos",
      "events_url": "https://api.github.com/users/jonathanslenders/events{/privacy}",
      "received_events_url": "https://api.github.com/users/jonathanslenders/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2017-11-21T20:31:39Z",
    "updated_at": "2017-11-21T20:31:39Z",
    "author_association": "CONTRIBUTOR",
    "body": "Hi @bialix,\r\n\r\nThanks a lot for testing! This is really helpful. I'm willing to merge this as a fix if it doesn't break anything. I'll check whether I can reproduce it on a Win 7 Python 3.3 64bit machine. Feel free to open a pull request.\r\n\r\nSome related issues: https://github.com/jonathanslenders/python-prompt-toolkit/issues/406 and https://github.com/jonathanslenders/python-prompt-toolkit/issues/86\r\n"
  },
  {
    "url": "https://api.github.com/repos/ipython/ipython/issues/comments/346280029",
    "html_url": "https://github.com/ipython/ipython/issues/10910#issuecomment-346280029",
    "issue_url": "https://api.github.com/repos/ipython/ipython/issues/10910",
    "id": 346280029,
    "node_id": "MDEyOklzc3VlQ29tbWVudDM0NjI4MDAyOQ==",
    "user": {
      "login": "bialix",
      "id": 82971,
      "node_id": "MDQ6VXNlcjgyOTcx",
      "avatar_url": "https://avatars0.githubusercontent.com/u/82971?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/bialix",
      "html_url": "https://github.com/bialix",
      "followers_url": "https://api.github.com/users/bialix/followers",
      "following_url": "https://api.github.com/users/bialix/following{/other_user}",
      "gists_url": "https://api.github.com/users/bialix/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/bialix/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/bialix/subscriptions",
      "organizations_url": "https://api.github.com/users/bialix/orgs",
      "repos_url": "https://api.github.com/users/bialix/repos",
      "events_url": "https://api.github.com/users/bialix/events{/privacy}",
      "received_events_url": "https://api.github.com/users/bialix/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2017-11-22T08:37:55Z",
    "updated_at": "2017-11-22T08:37:55Z",
    "author_association": "NONE",
    "body": "@jonathanslenders I did more research. According to MSDN if GetConsoleScreenBufferInfo is failed then detailed info should be obtained with GetLastError. I've added call to GetLastError and indeed: last error code is 6 which is\r\n\r\n> ERROR_INVALID_HANDLE\r\n> 6 (0x6)\r\n> The handle is invalid.\r\n\r\n https://msdn.microsoft.com/ru-ru/library/windows/desktop/ms681382(v=vs.85).aspx\r\n\r\nMaybe it's worth to check GetLastError and refresh self.hconsole handle it this case?"
  },
  {
    "url": "https://api.github.com/repos/ipython/ipython/issues/comments/346282887",
    "html_url": "https://github.com/ipython/ipython/issues/10910#issuecomment-346282887",
    "issue_url": "https://api.github.com/repos/ipython/ipython/issues/10910",
    "id": 346282887,
    "node_id": "MDEyOklzc3VlQ29tbWVudDM0NjI4Mjg4Nw==",
    "user": {
      "login": "bialix",
      "id": 82971,
      "node_id": "MDQ6VXNlcjgyOTcx",
      "avatar_url": "https://avatars0.githubusercontent.com/u/82971?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/bialix",
      "html_url": "https://github.com/bialix",
      "followers_url": "https://api.github.com/users/bialix/followers",
      "following_url": "https://api.github.com/users/bialix/following{/other_user}",
      "gists_url": "https://api.github.com/users/bialix/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/bialix/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/bialix/subscriptions",
      "organizations_url": "https://api.github.com/users/bialix/orgs",
      "repos_url": "https://api.github.com/users/bialix/repos",
      "events_url": "https://api.github.com/users/bialix/events{/privacy}",
      "received_events_url": "https://api.github.com/users/bialix/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2017-11-22T08:49:56Z",
    "updated_at": "2017-11-22T08:51:50Z",
    "author_association": "NONE",
    "body": "@jonathanslenders May I suggest the following changes:\r\n\r\n```\r\n    def get_win32_screen_buffer_info(self, again=False):\r\n        self.flush()\r\n        sbinfo = CONSOLE_SCREEN_BUFFER_INFO()\r\n        success = windll.kernel32.GetConsoleScreenBufferInfo(self.hconsole, byref(sbinfo))\r\n        if success:\r\n            return sbinfo\r\n        else:\r\n            err = windll.kernel32.GetLastError()\r\n            #logging.debug(\"Win32Output.get_win32_screen_buffer_info: last err=%s\", err)\r\n            if not again:\r\n                if err == 6:    # ERROR_INVALID_HANDLE\r\n                    self.hconsole = self.get_stdout_handle() #windll.kernel32.GetStdHandle(STD_OUTPUT_HANDLE)\r\n                    return self.get_win32_screen_buffer_info(True)\r\n            raise NoConsoleScreenBufferError\r\n\r\n    def get_stdout_handle(self):\r\n        handle = windll.kernel32.GetStdHandle(STD_OUTPUT_HANDLE)\r\n        if handle == -1:    # INVALID_HANDLE_VALUE\r\n            raise InvalidHandleValue\r\n        return handle\r\n```\r\n\r\nAnd in `Win32Output.__init__` we can use new method as well:\r\n\r\n```\r\n        self.hconsole = self.get_stdout_handle() # windll.kernel32.GetStdHandle(STD_OUTPUT_HANDLE)\r\n```"
  },
  {
    "url": "https://api.github.com/repos/ipython/ipython/issues/comments/346286705",
    "html_url": "https://github.com/ipython/ipython/issues/10910#issuecomment-346286705",
    "issue_url": "https://api.github.com/repos/ipython/ipython/issues/10910",
    "id": 346286705,
    "node_id": "MDEyOklzc3VlQ29tbWVudDM0NjI4NjcwNQ==",
    "user": {
      "login": "bialix",
      "id": 82971,
      "node_id": "MDQ6VXNlcjgyOTcx",
      "avatar_url": "https://avatars0.githubusercontent.com/u/82971?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/bialix",
      "html_url": "https://github.com/bialix",
      "followers_url": "https://api.github.com/users/bialix/followers",
      "following_url": "https://api.github.com/users/bialix/following{/other_user}",
      "gists_url": "https://api.github.com/users/bialix/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/bialix/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/bialix/subscriptions",
      "organizations_url": "https://api.github.com/users/bialix/orgs",
      "repos_url": "https://api.github.com/users/bialix/repos",
      "events_url": "https://api.github.com/users/bialix/events{/privacy}",
      "received_events_url": "https://api.github.com/users/bialix/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2017-11-22T09:04:29Z",
    "updated_at": "2017-11-22T09:04:29Z",
    "author_association": "NONE",
    "body": "I suspect some race condition here. Ater I've implemented the changes above (additional method get_stdout_handle) then I no more get error with handle. That might explain why this issue is so elusive."
  },
  {
    "url": "https://api.github.com/repos/ipython/ipython/issues/comments/346477327",
    "html_url": "https://github.com/ipython/ipython/issues/10910#issuecomment-346477327",
    "issue_url": "https://api.github.com/repos/ipython/ipython/issues/10910",
    "id": 346477327,
    "node_id": "MDEyOklzc3VlQ29tbWVudDM0NjQ3NzMyNw==",
    "user": {
      "login": "jonathanslenders",
      "id": 216638,
      "node_id": "MDQ6VXNlcjIxNjYzOA==",
      "avatar_url": "https://avatars3.githubusercontent.com/u/216638?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/jonathanslenders",
      "html_url": "https://github.com/jonathanslenders",
      "followers_url": "https://api.github.com/users/jonathanslenders/followers",
      "following_url": "https://api.github.com/users/jonathanslenders/following{/other_user}",
      "gists_url": "https://api.github.com/users/jonathanslenders/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/jonathanslenders/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/jonathanslenders/subscriptions",
      "organizations_url": "https://api.github.com/users/jonathanslenders/orgs",
      "repos_url": "https://api.github.com/users/jonathanslenders/repos",
      "events_url": "https://api.github.com/users/jonathanslenders/events{/privacy}",
      "received_events_url": "https://api.github.com/users/jonathanslenders/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2017-11-22T21:24:51Z",
    "updated_at": "2017-11-22T21:25:06Z",
    "author_association": "CONTRIBUTOR",
    "body": "Interesting about ``GetLastError`` is that it already returns 6 in an empty Python shell. I'm not sure what that means.\r\n\r\n![image](https://user-images.githubusercontent.com/216638/33150407-97577b90-cfd3-11e7-8751-ff674fa41927.png)\r\n\r\nThe code looks good to me. We still don't know the actual underlying cause, but I'm happy enough to merge this, given the trouble that it saves in certain situations. Thanks for that!\r\n\r\n"
  },
  {
    "url": "https://api.github.com/repos/ipython/ipython/issues/comments/346553959",
    "html_url": "https://github.com/ipython/ipython/issues/10910#issuecomment-346553959",
    "issue_url": "https://api.github.com/repos/ipython/ipython/issues/10910",
    "id": 346553959,
    "node_id": "MDEyOklzc3VlQ29tbWVudDM0NjU1Mzk1OQ==",
    "user": {
      "login": "bialix",
      "id": 82971,
      "node_id": "MDQ6VXNlcjgyOTcx",
      "avatar_url": "https://avatars0.githubusercontent.com/u/82971?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/bialix",
      "html_url": "https://github.com/bialix",
      "followers_url": "https://api.github.com/users/bialix/followers",
      "following_url": "https://api.github.com/users/bialix/following{/other_user}",
      "gists_url": "https://api.github.com/users/bialix/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/bialix/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/bialix/subscriptions",
      "organizations_url": "https://api.github.com/users/bialix/orgs",
      "repos_url": "https://api.github.com/users/bialix/repos",
      "events_url": "https://api.github.com/users/bialix/events{/privacy}",
      "received_events_url": "https://api.github.com/users/bialix/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2017-11-23T08:21:06Z",
    "updated_at": "2017-11-23T08:21:16Z",
    "author_association": "NONE",
    "body": "Probably Python has tried to make some Windows API calls behind the scenes? Anyway, I can't confirm:\r\n\r\n```\r\nPython 3.3.5 (v3.3.5:62cf4e77f785, Mar  9 2014, 10:35:05) [MSC v.1600 64 bit (AMD64)] on win32\r\nType \"help\", \"copyright\", \"credits\" or \"license\" for more information.\r\n>>> import ctypes\r\n>>> print(ctypes.windll.kernel32.GetLastError())\r\n0\r\n```\r\n\r\nI suspect it depends on Python version, build and underlying system."
  }
]
