[
  {
    "url": "https://api.github.com/repos/ipython/ipython/issues/comments/94469430",
    "html_url": "https://github.com/ipython/ipython/issues/8293#issuecomment-94469430",
    "issue_url": "https://api.github.com/repos/ipython/ipython/issues/8293",
    "id": 94469430,
    "node_id": "MDEyOklzc3VlQ29tbWVudDk0NDY5NDMw",
    "user": {
      "login": "musically-ut",
      "id": 502876,
      "node_id": "MDQ6VXNlcjUwMjg3Ng==",
      "avatar_url": "https://avatars1.githubusercontent.com/u/502876?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/musically-ut",
      "html_url": "https://github.com/musically-ut",
      "followers_url": "https://api.github.com/users/musically-ut/followers",
      "following_url": "https://api.github.com/users/musically-ut/following{/other_user}",
      "gists_url": "https://api.github.com/users/musically-ut/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/musically-ut/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/musically-ut/subscriptions",
      "organizations_url": "https://api.github.com/users/musically-ut/orgs",
      "repos_url": "https://api.github.com/users/musically-ut/repos",
      "events_url": "https://api.github.com/users/musically-ut/events{/privacy}",
      "received_events_url": "https://api.github.com/users/musically-ut/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2015-04-20T14:36:08Z",
    "updated_at": "2015-04-20T14:36:08Z",
    "author_association": "CONTRIBUTOR",
    "body": "Update, this problem doesn't occur with Python-3, i.e. the correct traceback is shown for both the statements:\n\n```\nsum(sum(foo(u) for u in [0]) for _ in [0])\nsum(sum(foo(u) for _ in [0]) for u in [0])\n```\n"
  },
  {
    "url": "https://api.github.com/repos/ipython/ipython/issues/comments/94519049",
    "html_url": "https://github.com/ipython/ipython/issues/8293#issuecomment-94519049",
    "issue_url": "https://api.github.com/repos/ipython/ipython/issues/8293",
    "id": 94519049,
    "node_id": "MDEyOklzc3VlQ29tbWVudDk0NTE5MDQ5",
    "user": {
      "login": "Carreau",
      "id": 335567,
      "node_id": "MDQ6VXNlcjMzNTU2Nw==",
      "avatar_url": "https://avatars3.githubusercontent.com/u/335567?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/Carreau",
      "html_url": "https://github.com/Carreau",
      "followers_url": "https://api.github.com/users/Carreau/followers",
      "following_url": "https://api.github.com/users/Carreau/following{/other_user}",
      "gists_url": "https://api.github.com/users/Carreau/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/Carreau/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/Carreau/subscriptions",
      "organizations_url": "https://api.github.com/users/Carreau/orgs",
      "repos_url": "https://api.github.com/users/Carreau/repos",
      "events_url": "https://api.github.com/users/Carreau/events{/privacy}",
      "received_events_url": "https://api.github.com/users/Carreau/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2015-04-20T17:39:28Z",
    "updated_at": "2015-04-20T17:39:28Z",
    "author_association": "MEMBER",
    "body": "Might be a Python 2.7 bug. the frame does: \n\n```\nLOAD_FAST\nFOR_ITER\nSTORE_DEREF\nLOAD_GLOBAL\nLOAD_CLOSURE\nBUILD_TUPLE\nLOAD_CONST\nMAKE_CLOSURE\nLOAD_CONST\nBUILD_LIST\nGET_ITER\nCALL_FUNCTION\nCALL_FUNCTION\nYIELD_VALUE\nPOP_TOP\nJUMP_ABSOLUTE\nLOAD_CONST\nRETURN_VALUE\n```\n\nFor which obviously getargs will fail. ...\n"
  },
  {
    "url": "https://api.github.com/repos/ipython/ipython/issues/comments/94523710",
    "html_url": "https://github.com/ipython/ipython/issues/8293#issuecomment-94523710",
    "issue_url": "https://api.github.com/repos/ipython/ipython/issues/8293",
    "id": 94523710,
    "node_id": "MDEyOklzc3VlQ29tbWVudDk0NTIzNzEw",
    "user": {
      "login": "musically-ut",
      "id": 502876,
      "node_id": "MDQ6VXNlcjUwMjg3Ng==",
      "avatar_url": "https://avatars1.githubusercontent.com/u/502876?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/musically-ut",
      "html_url": "https://github.com/musically-ut",
      "followers_url": "https://api.github.com/users/musically-ut/followers",
      "following_url": "https://api.github.com/users/musically-ut/following{/other_user}",
      "gists_url": "https://api.github.com/users/musically-ut/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/musically-ut/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/musically-ut/subscriptions",
      "organizations_url": "https://api.github.com/users/musically-ut/orgs",
      "repos_url": "https://api.github.com/users/musically-ut/repos",
      "events_url": "https://api.github.com/users/musically-ut/events{/privacy}",
      "received_events_url": "https://api.github.com/users/musically-ut/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2015-04-20T17:53:22Z",
    "updated_at": "2015-04-20T17:53:22Z",
    "author_association": "CONTRIBUTOR",
    "body": "Then should it be escalated to the Python2.7 bug tracker?  \nI think it would be best if you (@Carreau) write the report. :)\n"
  },
  {
    "url": "https://api.github.com/repos/ipython/ipython/issues/comments/94523825",
    "html_url": "https://github.com/ipython/ipython/issues/8293#issuecomment-94523825",
    "issue_url": "https://api.github.com/repos/ipython/ipython/issues/8293",
    "id": 94523825,
    "node_id": "MDEyOklzc3VlQ29tbWVudDk0NTIzODI1",
    "user": {
      "login": "Carreau",
      "id": 335567,
      "node_id": "MDQ6VXNlcjMzNTU2Nw==",
      "avatar_url": "https://avatars3.githubusercontent.com/u/335567?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/Carreau",
      "html_url": "https://github.com/Carreau",
      "followers_url": "https://api.github.com/users/Carreau/followers",
      "following_url": "https://api.github.com/users/Carreau/following{/other_user}",
      "gists_url": "https://api.github.com/users/Carreau/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/Carreau/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/Carreau/subscriptions",
      "organizations_url": "https://api.github.com/users/Carreau/orgs",
      "repos_url": "https://api.github.com/users/Carreau/repos",
      "events_url": "https://api.github.com/users/Carreau/events{/privacy}",
      "received_events_url": "https://api.github.com/users/Carreau/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2015-04-20T17:54:05Z",
    "updated_at": "2015-04-20T17:54:05Z",
    "author_association": "MEMBER",
    "body": "Yeah, trying to make a smaller example. \nI don't use getframe a lot so have to re-read the doc, but will probably do. \n"
  },
  {
    "url": "https://api.github.com/repos/ipython/ipython/issues/comments/94524534",
    "html_url": "https://github.com/ipython/ipython/issues/8293#issuecomment-94524534",
    "issue_url": "https://api.github.com/repos/ipython/ipython/issues/8293",
    "id": 94524534,
    "node_id": "MDEyOklzc3VlQ29tbWVudDk0NTI0NTM0",
    "user": {
      "login": "musically-ut",
      "id": 502876,
      "node_id": "MDQ6VXNlcjUwMjg3Ng==",
      "avatar_url": "https://avatars1.githubusercontent.com/u/502876?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/musically-ut",
      "html_url": "https://github.com/musically-ut",
      "followers_url": "https://api.github.com/users/musically-ut/followers",
      "following_url": "https://api.github.com/users/musically-ut/following{/other_user}",
      "gists_url": "https://api.github.com/users/musically-ut/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/musically-ut/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/musically-ut/subscriptions",
      "organizations_url": "https://api.github.com/users/musically-ut/orgs",
      "repos_url": "https://api.github.com/users/musically-ut/repos",
      "events_url": "https://api.github.com/users/musically-ut/events{/privacy}",
      "received_events_url": "https://api.github.com/users/musically-ut/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2015-04-20T17:57:20Z",
    "updated_at": "2015-04-20T17:57:20Z",
    "author_association": "CONTRIBUTOR",
    "body": "Thanks!\nAlso, please post the link to the Python bug here when you file it. :+1: \n"
  },
  {
    "url": "https://api.github.com/repos/ipython/ipython/issues/comments/94524606",
    "html_url": "https://github.com/ipython/ipython/issues/8293#issuecomment-94524606",
    "issue_url": "https://api.github.com/repos/ipython/ipython/issues/8293",
    "id": 94524606,
    "node_id": "MDEyOklzc3VlQ29tbWVudDk0NTI0NjA2",
    "user": {
      "login": "Carreau",
      "id": 335567,
      "node_id": "MDQ6VXNlcjMzNTU2Nw==",
      "avatar_url": "https://avatars3.githubusercontent.com/u/335567?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/Carreau",
      "html_url": "https://github.com/Carreau",
      "followers_url": "https://api.github.com/users/Carreau/followers",
      "following_url": "https://api.github.com/users/Carreau/following{/other_user}",
      "gists_url": "https://api.github.com/users/Carreau/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/Carreau/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/Carreau/subscriptions",
      "organizations_url": "https://api.github.com/users/Carreau/orgs",
      "repos_url": "https://api.github.com/users/Carreau/repos",
      "events_url": "https://api.github.com/users/Carreau/events{/privacy}",
      "received_events_url": "https://api.github.com/users/Carreau/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2015-04-20T17:57:44Z",
    "updated_at": "2015-04-20T17:57:44Z",
    "author_association": "MEMBER",
    "body": "Sure, that might not be today though. \n"
  },
  {
    "url": "https://api.github.com/repos/ipython/ipython/issues/comments/101033490",
    "html_url": "https://github.com/ipython/ipython/issues/8293#issuecomment-101033490",
    "issue_url": "https://api.github.com/repos/ipython/ipython/issues/8293",
    "id": 101033490,
    "node_id": "MDEyOklzc3VlQ29tbWVudDEwMTAzMzQ5MA==",
    "user": {
      "login": "keryil",
      "id": 1260145,
      "node_id": "MDQ6VXNlcjEyNjAxNDU=",
      "avatar_url": "https://avatars2.githubusercontent.com/u/1260145?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/keryil",
      "html_url": "https://github.com/keryil",
      "followers_url": "https://api.github.com/users/keryil/followers",
      "following_url": "https://api.github.com/users/keryil/following{/other_user}",
      "gists_url": "https://api.github.com/users/keryil/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/keryil/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/keryil/subscriptions",
      "organizations_url": "https://api.github.com/users/keryil/orgs",
      "repos_url": "https://api.github.com/users/keryil/repos",
      "events_url": "https://api.github.com/users/keryil/events{/privacy}",
      "received_events_url": "https://api.github.com/users/keryil/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2015-05-11T20:08:29Z",
    "updated_at": "2015-05-11T20:08:29Z",
    "author_association": "NONE",
    "body": "Any updates on this? \n"
  },
  {
    "url": "https://api.github.com/repos/ipython/ipython/issues/comments/101045951",
    "html_url": "https://github.com/ipython/ipython/issues/8293#issuecomment-101045951",
    "issue_url": "https://api.github.com/repos/ipython/ipython/issues/8293",
    "id": 101045951,
    "node_id": "MDEyOklzc3VlQ29tbWVudDEwMTA0NTk1MQ==",
    "user": {
      "login": "Carreau",
      "id": 335567,
      "node_id": "MDQ6VXNlcjMzNTU2Nw==",
      "avatar_url": "https://avatars3.githubusercontent.com/u/335567?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/Carreau",
      "html_url": "https://github.com/Carreau",
      "followers_url": "https://api.github.com/users/Carreau/followers",
      "following_url": "https://api.github.com/users/Carreau/following{/other_user}",
      "gists_url": "https://api.github.com/users/Carreau/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/Carreau/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/Carreau/subscriptions",
      "organizations_url": "https://api.github.com/users/Carreau/orgs",
      "repos_url": "https://api.github.com/users/Carreau/repos",
      "events_url": "https://api.github.com/users/Carreau/events{/privacy}",
      "received_events_url": "https://api.github.com/users/Carreau/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2015-05-11T21:03:41Z",
    "updated_at": "2015-05-11T21:03:41Z",
    "author_association": "MEMBER",
    "body": "No not particularly. \nI trying to up my installation to work on both 3.5 and 2.7 head of Python, but it's a rabbit hole.\n\n![](http://i.imgur.com/t0XHtgJ.gif)\n"
  },
  {
    "url": "https://api.github.com/repos/ipython/ipython/issues/comments/146368401",
    "html_url": "https://github.com/ipython/ipython/issues/8293#issuecomment-146368401",
    "issue_url": "https://api.github.com/repos/ipython/ipython/issues/8293",
    "id": 146368401,
    "node_id": "MDEyOklzc3VlQ29tbWVudDE0NjM2ODQwMQ==",
    "user": {
      "login": "ssanderson",
      "id": 1588357,
      "node_id": "MDQ6VXNlcjE1ODgzNTc=",
      "avatar_url": "https://avatars0.githubusercontent.com/u/1588357?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/ssanderson",
      "html_url": "https://github.com/ssanderson",
      "followers_url": "https://api.github.com/users/ssanderson/followers",
      "following_url": "https://api.github.com/users/ssanderson/following{/other_user}",
      "gists_url": "https://api.github.com/users/ssanderson/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/ssanderson/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/ssanderson/subscriptions",
      "organizations_url": "https://api.github.com/users/ssanderson/orgs",
      "repos_url": "https://api.github.com/users/ssanderson/repos",
      "events_url": "https://api.github.com/users/ssanderson/events{/privacy}",
      "received_events_url": "https://api.github.com/users/ssanderson/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2015-10-07T23:44:23Z",
    "updated_at": "2016-09-24T18:01:14Z",
    "author_association": "MEMBER",
    "body": "@Carreau the bug in `getargs` is caused by the fact the nested generator expression's bytecode has an anonymous inner argument named `.0`:\n\n```\nIn [5]: (0/0 for i in [1] if all(i for j in [])).gi_code.co_varnames\nOut[5]: ('.0',)\n```\n\nIn `inspect.getargs`, there's a big long section that's trying very hard to resolve names of functions with anonymous tuple arguments:\n\n```\n    # The following acrobatics are for anonymous (tuple) arguments.\n    for i in range(nargs):\n        if args[i][:1] in ('', '.'):\n            ... # Do a bunch of stuff to handle anonymous tuple args.\n```\n\nThis code is trying to handle functions that look like this:\n\n```\nIn [11]: def foo((x, y), z):\n   ....:     return x, y, z\n   ....:\n\nIn [12]: foo((1, 2), 3)\nOut[12]: (1, 2, 3)\n```\n\nTuple argument unpacking was removed in Python 3, which is why this issue only manifests in Python 2.\n\nThe bytecode for a function like `foo` generates extra instructions to unpack the first argument:\n\n```\nIn [13]: dis.dis(foo)\n  1           0 LOAD_FAST                0 (.0)\n              3 UNPACK_SEQUENCE          2\n              6 STORE_FAST               2 (x)\n              9 STORE_FAST               3 (y)\n\n  2          12 LOAD_FAST                2 (x)\n             15 LOAD_FAST                3 (y)\n             18 LOAD_FAST                1 (z)\n             21 BUILD_TUPLE              3\n             24 RETURN_VALUE\n```\n\nThe problem with all of this is that the bytecode for generator expressions uses the same machinery as tuple unpacking under the hood:\n\n```\nIn [3]: dis.dis((x for x in [0]).gi_code)\n  1           0 LOAD_FAST                0 (.0)\n        >>    3 FOR_ITER                11 (to 17)\n              6 STORE_FAST               1 (x)\n              9 LOAD_FAST                1 (x)\n             12 YIELD_VALUE\n             13 POP_TOP\n             14 JUMP_ABSOLUTE            3\n        >>   17 LOAD_CONST               0 (None)\n             20 RETURN_VALUE\n```\n\n`getargs` does the right thing for simple genexprs, but fails when the yielded values **are themselves generator expressions** that close over an outer name.  The simplest example of such a failure is something like this:\n\n```\nIn [8]: getargs(((x for _ in [0]) for x in [0]).gi_code)\n---------------------------------------------------------------------------\nIndexError                                Traceback (most recent call last)\n<ipython-input-8-eaf5530bb07a> in <module>()\n----> 1 getargs(((x for _ in [0]) for x in [0]).gi_code)\n\n/usr/lib/python2.7/inspect.pyc in getargs(co)\n    789                                 remain[-1] = remain[-1] - 1\n    790                             if not remain: break\n--> 791             args[i] = stack[0]\n    792\n    793     varargs = None\n\nIndexError: list index out of range\n```\n\nThe disassembly of the bad expression is:\n\n```\nIn [12]: dis.dis(((x for _ in [0]) for x in [0]).gi_code)\n  1           0 LOAD_FAST                0 (.0)\n        >>    3 FOR_ITER                30 (to 36)\n              6 STORE_DEREF              0 (x)\n              9 LOAD_CLOSURE             0 (x)\n             12 BUILD_TUPLE              1\n             15 LOAD_CONST               0 (<code object <genexpr> at 0x7f9ac7071eb0, file \"<ipython-input-12-272633ab0f4c>\", line 1>)\n             18 MAKE_CLOSURE             0\n             21 LOAD_CONST               1 (0)\n             24 BUILD_LIST               1\n             27 GET_ITER\n             28 CALL_FUNCTION            1\n             31 YIELD_VALUE\n             32 POP_TOP\n             33 JUMP_ABSOLUTE            3\n        >>   36 LOAD_CONST               2 (None)\n             39 RETURN_VALUE\n```\n\nThe issue here, ultimately, is the fact that the outer loop variable is passed to the inner function via a `STORE_DEREF` rather than as a `STORE_FAST`.  There's been an [open issue on bugs.python.org about this](http://bugs.python.org/issue14611) since 2012, which a patch supplied that fixes the issue (I just tried it locally).  I'm not sure why it hasn't been merged.\n"
  },
  {
    "url": "https://api.github.com/repos/ipython/ipython/issues/comments/155386617",
    "html_url": "https://github.com/ipython/ipython/issues/8293#issuecomment-155386617",
    "issue_url": "https://api.github.com/repos/ipython/ipython/issues/8293",
    "id": 155386617,
    "node_id": "MDEyOklzc3VlQ29tbWVudDE1NTM4NjYxNw==",
    "user": {
      "login": "taschini",
      "id": 7879276,
      "node_id": "MDQ6VXNlcjc4NzkyNzY=",
      "avatar_url": "https://avatars3.githubusercontent.com/u/7879276?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/taschini",
      "html_url": "https://github.com/taschini",
      "followers_url": "https://api.github.com/users/taschini/followers",
      "following_url": "https://api.github.com/users/taschini/following{/other_user}",
      "gists_url": "https://api.github.com/users/taschini/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/taschini/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/taschini/subscriptions",
      "organizations_url": "https://api.github.com/users/taschini/orgs",
      "repos_url": "https://api.github.com/users/taschini/repos",
      "events_url": "https://api.github.com/users/taschini/events{/privacy}",
      "received_events_url": "https://api.github.com/users/taschini/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2015-11-10T10:47:28Z",
    "updated_at": "2015-11-10T10:47:28Z",
    "author_association": "NONE",
    "body": "> I'm not sure why it hasn't been merged.\n\nI don't know either.  At least I'm happy that my patch could help you guys.\n"
  }
]
