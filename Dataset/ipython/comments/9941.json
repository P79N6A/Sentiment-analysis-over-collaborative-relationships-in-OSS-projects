[
  {
    "url": "https://api.github.com/repos/ipython/ipython/issues/comments/247878164",
    "html_url": "https://github.com/ipython/ipython/issues/9941#issuecomment-247878164",
    "issue_url": "https://api.github.com/repos/ipython/ipython/issues/9941",
    "id": 247878164,
    "node_id": "MDEyOklzc3VlQ29tbWVudDI0Nzg3ODE2NA==",
    "user": {
      "login": "mbyt",
      "id": 1878241,
      "node_id": "MDQ6VXNlcjE4NzgyNDE=",
      "avatar_url": "https://avatars0.githubusercontent.com/u/1878241?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/mbyt",
      "html_url": "https://github.com/mbyt",
      "followers_url": "https://api.github.com/users/mbyt/followers",
      "following_url": "https://api.github.com/users/mbyt/following{/other_user}",
      "gists_url": "https://api.github.com/users/mbyt/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/mbyt/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/mbyt/subscriptions",
      "organizations_url": "https://api.github.com/users/mbyt/orgs",
      "repos_url": "https://api.github.com/users/mbyt/repos",
      "events_url": "https://api.github.com/users/mbyt/events{/privacy}",
      "received_events_url": "https://api.github.com/users/mbyt/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2016-09-18T20:59:52Z",
    "updated_at": "2016-09-18T20:59:52Z",
    "author_association": "CONTRIBUTOR",
    "body": "Update: I looked into this again (and also slightly updated the description).\n\nThe problem is triggered by line 62 of /usr/lib/python3.4/unittest/main.py: `self.module = __import__(module)`, with module = `\"__main__\"`.\n\nNow running the example (of the issue description) with pdb set_trace() I get at the debugger prompt:\n\n```\n(Pdb) __import__(\"__main__\")\n<module '__main__' from '../snippets/test_ipython_debugger_in_unittest.py'>\n(Pdb) dir(__import__(\"__main__\"))\n['ATest', '__builtins__', '__cached__', '__doc__', '__file__', '__loader__', '__name__', '__package__', '__spec__', 'pdb', 'suite', 'unittest']\n```\n\nThis is actually what I would expect.\n\nDoing the same with the IPython set_trace, I get at the debugger prompt:\n\n```\nipdb> __import__(\"__main__\")\n<module '__main__'>\nipdb> dir(__import__(\"__main__\"))\n['In', 'Out', '_', '__', '___', '__builtin__', '__builtins__', '__doc__', '__loader__', '__name__', '__package__', '__spec__', '_dh', '_ih', '_oh', '_sh', 'exit', 'get_ipython', 'quit']\n```\n\nThat's interesting all imports the test class and suite is missing. That means `\"__main__\"` is something IPython specific. This is not rolled back, and so unittest will fail as described above.\n\nActually I can locally workaround / fix this issue by the following command from the command prompt.\n\n```\nipdb> import sys, os; sys.modules[\"__main__\"] = __import__(os.path.basename(__file__.replace(\".py\",\"\")))\n```\n\nThat is: For me it looks like, that the IPython `\"__main__\"` logic needs to be closed / rolled back / finished / teardowned as soon as the ipdb command prompt is hit.\n"
  },
  {
    "url": "https://api.github.com/repos/ipython/ipython/issues/comments/247949393",
    "html_url": "https://github.com/ipython/ipython/issues/9941#issuecomment-247949393",
    "issue_url": "https://api.github.com/repos/ipython/ipython/issues/9941",
    "id": 247949393,
    "node_id": "MDEyOklzc3VlQ29tbWVudDI0Nzk0OTM5Mw==",
    "user": {
      "login": "takluyver",
      "id": 327925,
      "node_id": "MDQ6VXNlcjMyNzkyNQ==",
      "avatar_url": "https://avatars3.githubusercontent.com/u/327925?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/takluyver",
      "html_url": "https://github.com/takluyver",
      "followers_url": "https://api.github.com/users/takluyver/followers",
      "following_url": "https://api.github.com/users/takluyver/following{/other_user}",
      "gists_url": "https://api.github.com/users/takluyver/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/takluyver/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/takluyver/subscriptions",
      "organizations_url": "https://api.github.com/users/takluyver/orgs",
      "repos_url": "https://api.github.com/users/takluyver/repos",
      "events_url": "https://api.github.com/users/takluyver/events{/privacy}",
      "received_events_url": "https://api.github.com/users/takluyver/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2016-09-19T09:37:41Z",
    "updated_at": "2016-09-19T09:37:41Z",
    "author_association": "MEMBER",
    "body": "Does it work if you restore `__main__` like this after starting the debugger?\n\n``` python\nsave_main = sys.modules['__main__']\nTerminalPdb().set_trace()\nsys.modules['__main__'] = save_main\n```\n"
  },
  {
    "url": "https://api.github.com/repos/ipython/ipython/issues/comments/248035219",
    "html_url": "https://github.com/ipython/ipython/issues/9941#issuecomment-248035219",
    "issue_url": "https://api.github.com/repos/ipython/ipython/issues/9941",
    "id": 248035219,
    "node_id": "MDEyOklzc3VlQ29tbWVudDI0ODAzNTIxOQ==",
    "user": {
      "login": "mbyt",
      "id": 1878241,
      "node_id": "MDQ6VXNlcjE4NzgyNDE=",
      "avatar_url": "https://avatars0.githubusercontent.com/u/1878241?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/mbyt",
      "html_url": "https://github.com/mbyt",
      "followers_url": "https://api.github.com/users/mbyt/followers",
      "following_url": "https://api.github.com/users/mbyt/following{/other_user}",
      "gists_url": "https://api.github.com/users/mbyt/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/mbyt/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/mbyt/subscriptions",
      "organizations_url": "https://api.github.com/users/mbyt/orgs",
      "repos_url": "https://api.github.com/users/mbyt/repos",
      "events_url": "https://api.github.com/users/mbyt/events{/privacy}",
      "received_events_url": "https://api.github.com/users/mbyt/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2016-09-19T15:58:58Z",
    "updated_at": "2016-09-19T16:01:53Z",
    "author_association": "CONTRIBUTOR",
    "body": "Thank you for taking your time and looking into this issue!\n\nI tried your solution and yes, this works also.\n\nI did the same experiment with `IPython.core.debugger.Pdb` and it shows exactly the same behaviour and it is also resolved by this solution.\n\nDoes it make sense to do save_main at the very beginning of the `IPython.core.debugger.Pdb` class and restore it just before `Pdb.set_trace`?\n"
  },
  {
    "url": "https://api.github.com/repos/ipython/ipython/issues/comments/248071079",
    "html_url": "https://github.com/ipython/ipython/issues/9941#issuecomment-248071079",
    "issue_url": "https://api.github.com/repos/ipython/ipython/issues/9941",
    "id": 248071079,
    "node_id": "MDEyOklzc3VlQ29tbWVudDI0ODA3MTA3OQ==",
    "user": {
      "login": "takluyver",
      "id": 327925,
      "node_id": "MDQ6VXNlcjMyNzkyNQ==",
      "avatar_url": "https://avatars3.githubusercontent.com/u/327925?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/takluyver",
      "html_url": "https://github.com/takluyver",
      "followers_url": "https://api.github.com/users/takluyver/followers",
      "following_url": "https://api.github.com/users/takluyver/following{/other_user}",
      "gists_url": "https://api.github.com/users/takluyver/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/takluyver/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/takluyver/subscriptions",
      "organizations_url": "https://api.github.com/users/takluyver/orgs",
      "repos_url": "https://api.github.com/users/takluyver/repos",
      "events_url": "https://api.github.com/users/takluyver/events{/privacy}",
      "received_events_url": "https://api.github.com/users/takluyver/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2016-09-19T18:01:23Z",
    "updated_at": "2016-09-19T18:01:23Z",
    "author_association": "MEMBER",
    "body": "Possibly [this branch](https://github.com/ipython/ipython/blob/3ad65eb369cd8aa05c17a85e761fe8ab54558295/IPython/core/debugger.py#L229), which it takes when IPython is not running, should save `__main__` and restore it just after creating the TerminalInteractiveShell instance.\n\nIt would be better if it could initialise as much of IPython as it needs without IPython modifying `sys.modules`, but I suspect that making that work cleanly would take a bit more time and effort.\n"
  },
  {
    "url": "https://api.github.com/repos/ipython/ipython/issues/comments/249006055",
    "html_url": "https://github.com/ipython/ipython/issues/9941#issuecomment-249006055",
    "issue_url": "https://api.github.com/repos/ipython/ipython/issues/9941",
    "id": 249006055,
    "node_id": "MDEyOklzc3VlQ29tbWVudDI0OTAwNjA1NQ==",
    "user": {
      "login": "mbyt",
      "id": 1878241,
      "node_id": "MDQ6VXNlcjE4NzgyNDE=",
      "avatar_url": "https://avatars0.githubusercontent.com/u/1878241?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/mbyt",
      "html_url": "https://github.com/mbyt",
      "followers_url": "https://api.github.com/users/mbyt/followers",
      "following_url": "https://api.github.com/users/mbyt/following{/other_user}",
      "gists_url": "https://api.github.com/users/mbyt/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/mbyt/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/mbyt/subscriptions",
      "organizations_url": "https://api.github.com/users/mbyt/orgs",
      "repos_url": "https://api.github.com/users/mbyt/repos",
      "events_url": "https://api.github.com/users/mbyt/events{/privacy}",
      "received_events_url": "https://api.github.com/users/mbyt/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2016-09-22T19:36:53Z",
    "updated_at": "2016-09-22T19:36:53Z",
    "author_association": "CONTRIBUTOR",
    "body": "Thank you! I tried your suggestion and _yes_ it works for both the core.debugger and the terminal.debugger. Therefore, I created the above pull request.\n"
  },
  {
    "url": "https://api.github.com/repos/ipython/ipython/issues/comments/249007851",
    "html_url": "https://github.com/ipython/ipython/issues/9941#issuecomment-249007851",
    "issue_url": "https://api.github.com/repos/ipython/ipython/issues/9941",
    "id": 249007851,
    "node_id": "MDEyOklzc3VlQ29tbWVudDI0OTAwNzg1MQ==",
    "user": {
      "login": "mbyt",
      "id": 1878241,
      "node_id": "MDQ6VXNlcjE4NzgyNDE=",
      "avatar_url": "https://avatars0.githubusercontent.com/u/1878241?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/mbyt",
      "html_url": "https://github.com/mbyt",
      "followers_url": "https://api.github.com/users/mbyt/followers",
      "following_url": "https://api.github.com/users/mbyt/following{/other_user}",
      "gists_url": "https://api.github.com/users/mbyt/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/mbyt/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/mbyt/subscriptions",
      "organizations_url": "https://api.github.com/users/mbyt/orgs",
      "repos_url": "https://api.github.com/users/mbyt/repos",
      "events_url": "https://api.github.com/users/mbyt/events{/privacy}",
      "received_events_url": "https://api.github.com/users/mbyt/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2016-09-22T19:44:39Z",
    "updated_at": "2016-09-22T19:44:39Z",
    "author_association": "CONTRIBUTOR",
    "body": "And, does it make sense to add a test? I looked for existing tests and found `core/tests/test_debugger.py`. Is the correct file to look at? If so, to my understanding these tests use doctest for verification. I did not do something with doctests since a long time. However, I might be able to add something there...\n"
  }
]
