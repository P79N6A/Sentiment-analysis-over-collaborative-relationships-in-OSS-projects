[
  {
    "url": "https://api.github.com/repos/ipython/ipython/issues/comments/420686696",
    "html_url": "https://github.com/ipython/ipython/issues/11306#issuecomment-420686696",
    "issue_url": "https://api.github.com/repos/ipython/ipython/issues/11306",
    "id": 420686696,
    "node_id": "MDEyOklzc3VlQ29tbWVudDQyMDY4NjY5Ng==",
    "user": {
      "login": "Carreau",
      "id": 335567,
      "node_id": "MDQ6VXNlcjMzNTU2Nw==",
      "avatar_url": "https://avatars3.githubusercontent.com/u/335567?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/Carreau",
      "html_url": "https://github.com/Carreau",
      "followers_url": "https://api.github.com/users/Carreau/followers",
      "following_url": "https://api.github.com/users/Carreau/following{/other_user}",
      "gists_url": "https://api.github.com/users/Carreau/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/Carreau/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/Carreau/subscriptions",
      "organizations_url": "https://api.github.com/users/Carreau/orgs",
      "repos_url": "https://api.github.com/users/Carreau/repos",
      "events_url": "https://api.github.com/users/Carreau/events{/privacy}",
      "received_events_url": "https://api.github.com/users/Carreau/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2018-09-12T15:15:19Z",
    "updated_at": "2018-09-12T15:15:19Z",
    "author_association": "MEMBER",
    "body": "Narrowed it down to \r\n\r\n```python\r\nfrom IPython.core.inputtransformer2 import EscapedCommand, make_tokens_by_line\r\n# \\n is added unconditionally so all cells ends with a \\n\r\ntoks = make_tokens_by_line(')\\n')\r\nEscapedCommand.find(toks)\r\n```"
  },
  {
    "url": "https://api.github.com/repos/ipython/ipython/issues/comments/420693959",
    "html_url": "https://github.com/ipython/ipython/issues/11306#issuecomment-420693959",
    "issue_url": "https://api.github.com/repos/ipython/ipython/issues/11306",
    "id": 420693959,
    "node_id": "MDEyOklzc3VlQ29tbWVudDQyMDY5Mzk1OQ==",
    "user": {
      "login": "Carreau",
      "id": 335567,
      "node_id": "MDQ6VXNlcjMzNTU2Nw==",
      "avatar_url": "https://avatars3.githubusercontent.com/u/335567?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/Carreau",
      "html_url": "https://github.com/Carreau",
      "followers_url": "https://api.github.com/users/Carreau/followers",
      "following_url": "https://api.github.com/users/Carreau/following{/other_user}",
      "gists_url": "https://api.github.com/users/Carreau/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/Carreau/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/Carreau/subscriptions",
      "organizations_url": "https://api.github.com/users/Carreau/orgs",
      "repos_url": "https://api.github.com/users/Carreau/repos",
      "events_url": "https://api.github.com/users/Carreau/events{/privacy}",
      "received_events_url": "https://api.github.com/users/Carreau/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2018-09-12T15:35:24Z",
    "updated_at": "2018-09-12T15:35:24Z",
    "author_association": "MEMBER",
    "body": "So in above case `make_tokens_by_line()`, last line is an empty list, that we never populate with anything. \r\n\r\nI believe that is not what was intended, so I thing in this special case we could just filter it out with a : \r\n\r\n```\r\n    if not tokens_by_line[-1]:\r\n        tokens_by_line.pop()\r\n```\r\n\r\nIt fails also on `\\x0c` as sole input (FORM-FEED, in string.printable), and we can get some fun with \r\n\r\n```\r\nimport string\r\nfrom IPython.core.inputtransformer2 import TransformerManager\r\ntm = TransformerManager()\r\nfail= []\r\nfor c in string.printable:\r\n    for k in string.printable:\r\n        try:\r\n            tm.check_complete(c+k)\r\n        except:\r\n            fail.append(c+k)\r\nfail\r\n```\r\n\r\nI'm tempted to catch any exception and return 'invalid' / SyntaxError to at least no crash user session.... and refine"
  },
  {
    "url": "https://api.github.com/repos/ipython/ipython/issues/comments/421278832",
    "html_url": "https://github.com/ipython/ipython/issues/11306#issuecomment-421278832",
    "issue_url": "https://api.github.com/repos/ipython/ipython/issues/11306",
    "id": 421278832,
    "node_id": "MDEyOklzc3VlQ29tbWVudDQyMTI3ODgzMg==",
    "user": {
      "login": "Carreau",
      "id": 335567,
      "node_id": "MDQ6VXNlcjMzNTU2Nw==",
      "avatar_url": "https://avatars3.githubusercontent.com/u/335567?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/Carreau",
      "html_url": "https://github.com/Carreau",
      "followers_url": "https://api.github.com/users/Carreau/followers",
      "following_url": "https://api.github.com/users/Carreau/following{/other_user}",
      "gists_url": "https://api.github.com/users/Carreau/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/Carreau/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/Carreau/subscriptions",
      "organizations_url": "https://api.github.com/users/Carreau/orgs",
      "repos_url": "https://api.github.com/users/Carreau/repos",
      "events_url": "https://api.github.com/users/Carreau/events{/privacy}",
      "received_events_url": "https://api.github.com/users/Carreau/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2018-09-14T08:50:58Z",
    "updated_at": "2018-09-14T08:50:58Z",
    "author_association": "MEMBER",
    "body": "cf PR #11307"
  }
]
