[
  {
    "url": "https://api.github.com/repos/ipython/ipython/issues/comments/2422477",
    "html_url": "https://github.com/ipython/ipython/issues/882#issuecomment-2422477",
    "issue_url": "https://api.github.com/repos/ipython/ipython/issues/882",
    "id": 2422477,
    "node_id": "MDEyOklzc3VlQ29tbWVudDI0MjI0Nzc=",
    "user": {
      "login": "abeld",
      "id": 96024,
      "node_id": "MDQ6VXNlcjk2MDI0",
      "avatar_url": "https://avatars1.githubusercontent.com/u/96024?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/abeld",
      "html_url": "https://github.com/abeld",
      "followers_url": "https://api.github.com/users/abeld/followers",
      "following_url": "https://api.github.com/users/abeld/following{/other_user}",
      "gists_url": "https://api.github.com/users/abeld/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/abeld/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/abeld/subscriptions",
      "organizations_url": "https://api.github.com/users/abeld/orgs",
      "repos_url": "https://api.github.com/users/abeld/repos",
      "events_url": "https://api.github.com/users/abeld/events{/privacy}",
      "received_events_url": "https://api.github.com/users/abeld/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2011-10-16T19:17:58Z",
    "updated_at": "2011-10-16T19:17:58Z",
    "author_association": "NONE",
    "body": "Most likely the problem is caused by not having pyzmq (or zeromq itself) installed. Since the ipython won't work without that, the real issue is not handling this situation more gracefully.\n"
  },
  {
    "url": "https://api.github.com/repos/ipython/ipython/issues/comments/2422687",
    "html_url": "https://github.com/ipython/ipython/issues/882#issuecomment-2422687",
    "issue_url": "https://api.github.com/repos/ipython/ipython/issues/882",
    "id": 2422687,
    "node_id": "MDEyOklzc3VlQ29tbWVudDI0MjI2ODc=",
    "user": {
      "login": "takluyver",
      "id": 327925,
      "node_id": "MDQ6VXNlcjMyNzkyNQ==",
      "avatar_url": "https://avatars3.githubusercontent.com/u/327925?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/takluyver",
      "html_url": "https://github.com/takluyver",
      "followers_url": "https://api.github.com/users/takluyver/followers",
      "following_url": "https://api.github.com/users/takluyver/following{/other_user}",
      "gists_url": "https://api.github.com/users/takluyver/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/takluyver/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/takluyver/subscriptions",
      "organizations_url": "https://api.github.com/users/takluyver/orgs",
      "repos_url": "https://api.github.com/users/takluyver/repos",
      "events_url": "https://api.github.com/users/takluyver/events{/privacy}",
      "received_events_url": "https://api.github.com/users/takluyver/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2011-10-16T19:51:52Z",
    "updated_at": "2011-10-16T19:51:52Z",
    "author_association": "MEMBER",
    "body": "Plain terminal IPython should work without ZMQ, and I think we already have an error message when we do need it. I have a feeling it's related to the profile directory being mounted over NFS, but I don't know exactly what the problem is.\n"
  },
  {
    "url": "https://api.github.com/repos/ipython/ipython/issues/comments/2462526",
    "html_url": "https://github.com/ipython/ipython/issues/882#issuecomment-2462526",
    "issue_url": "https://api.github.com/repos/ipython/ipython/issues/882",
    "id": 2462526,
    "node_id": "MDEyOklzc3VlQ29tbWVudDI0NjI1MjY=",
    "user": {
      "login": "takluyver",
      "id": 327925,
      "node_id": "MDQ6VXNlcjMyNzkyNQ==",
      "avatar_url": "https://avatars3.githubusercontent.com/u/327925?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/takluyver",
      "html_url": "https://github.com/takluyver",
      "followers_url": "https://api.github.com/users/takluyver/followers",
      "following_url": "https://api.github.com/users/takluyver/following{/other_user}",
      "gists_url": "https://api.github.com/users/takluyver/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/takluyver/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/takluyver/subscriptions",
      "organizations_url": "https://api.github.com/users/takluyver/orgs",
      "repos_url": "https://api.github.com/users/takluyver/repos",
      "events_url": "https://api.github.com/users/takluyver/events{/privacy}",
      "received_events_url": "https://api.github.com/users/takluyver/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2011-10-19T22:55:19Z",
    "updated_at": "2011-10-19T22:55:19Z",
    "author_association": "MEMBER",
    "body": "@fperez: Any ideas on this one? I seem to remember other people having a problem when IPYTHONDIR is mounted over the network, but I don't know what the problem is.\n"
  },
  {
    "url": "https://api.github.com/repos/ipython/ipython/issues/comments/2466784",
    "html_url": "https://github.com/ipython/ipython/issues/882#issuecomment-2466784",
    "issue_url": "https://api.github.com/repos/ipython/ipython/issues/882",
    "id": 2466784,
    "node_id": "MDEyOklzc3VlQ29tbWVudDI0NjY3ODQ=",
    "user": {
      "login": "abeld",
      "id": 96024,
      "node_id": "MDQ6VXNlcjk2MDI0",
      "avatar_url": "https://avatars1.githubusercontent.com/u/96024?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/abeld",
      "html_url": "https://github.com/abeld",
      "followers_url": "https://api.github.com/users/abeld/followers",
      "following_url": "https://api.github.com/users/abeld/following{/other_user}",
      "gists_url": "https://api.github.com/users/abeld/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/abeld/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/abeld/subscriptions",
      "organizations_url": "https://api.github.com/users/abeld/orgs",
      "repos_url": "https://api.github.com/users/abeld/repos",
      "events_url": "https://api.github.com/users/abeld/events{/privacy}",
      "received_events_url": "https://api.github.com/users/abeld/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2011-10-20T09:57:53Z",
    "updated_at": "2011-10-20T09:57:53Z",
    "author_association": "NONE",
    "body": "Running ipython under strace, the following is the part where it appears to freeze: (i.e. the last few lines strace prints out)\n\nopen(\"/loc/balin/d1/abeld/.ipython/profile_default/history.sqlite\", O_RDWR|O_CREAT, 0644) = 3\nfcntl(3, F_GETFD)                       = 0\nfcntl(3, F_SETFD, FD_CLOEXEC)           = 0\nfstat(3, {st_mode=S_IFREG|0600, st_size=0, ...}) = 0\ndup(3)                                  = 4\nfcntl(3, F_SETLK, {type=F_RDLCK, whence=SEEK_SET, start=0, len=1}\n\n(/loc/balin/d1/ is mounted via nfs, the history.sqlite file itself is empty.)\n"
  },
  {
    "url": "https://api.github.com/repos/ipython/ipython/issues/comments/2466859",
    "html_url": "https://github.com/ipython/ipython/issues/882#issuecomment-2466859",
    "issue_url": "https://api.github.com/repos/ipython/ipython/issues/882",
    "id": 2466859,
    "node_id": "MDEyOklzc3VlQ29tbWVudDI0NjY4NTk=",
    "user": {
      "login": "takluyver",
      "id": 327925,
      "node_id": "MDQ6VXNlcjMyNzkyNQ==",
      "avatar_url": "https://avatars3.githubusercontent.com/u/327925?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/takluyver",
      "html_url": "https://github.com/takluyver",
      "followers_url": "https://api.github.com/users/takluyver/followers",
      "following_url": "https://api.github.com/users/takluyver/following{/other_user}",
      "gists_url": "https://api.github.com/users/takluyver/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/takluyver/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/takluyver/subscriptions",
      "organizations_url": "https://api.github.com/users/takluyver/orgs",
      "repos_url": "https://api.github.com/users/takluyver/repos",
      "events_url": "https://api.github.com/users/takluyver/events{/privacy}",
      "received_events_url": "https://api.github.com/users/takluyver/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2011-10-20T10:07:42Z",
    "updated_at": "2011-10-20T10:07:42Z",
    "author_association": "MEMBER",
    "body": "OK, the SQLite FAQ says: \"...fcntl() file locking is broken on many NFS implementations. You should avoid putting SQLite database files on NFS if multiple processes might try to access the file at the same time.\" We do open two connections to the database (we use a separate thread for writing history, for performance reasons), so perhaps this is the problem.\n\nI don't know what we can do about this. If it raised an error, we could handle it, but if it just blocks, that doesn't work. Is there some reliable way to tell whether the IPYTHONDIR folder is on an NFS mount?\n"
  },
  {
    "url": "https://api.github.com/repos/ipython/ipython/issues/comments/2472749",
    "html_url": "https://github.com/ipython/ipython/issues/882#issuecomment-2472749",
    "issue_url": "https://api.github.com/repos/ipython/ipython/issues/882",
    "id": 2472749,
    "node_id": "MDEyOklzc3VlQ29tbWVudDI0NzI3NDk=",
    "user": {
      "login": "takluyver",
      "id": 327925,
      "node_id": "MDQ6VXNlcjMyNzkyNQ==",
      "avatar_url": "https://avatars3.githubusercontent.com/u/327925?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/takluyver",
      "html_url": "https://github.com/takluyver",
      "followers_url": "https://api.github.com/users/takluyver/followers",
      "following_url": "https://api.github.com/users/takluyver/following{/other_user}",
      "gists_url": "https://api.github.com/users/takluyver/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/takluyver/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/takluyver/subscriptions",
      "organizations_url": "https://api.github.com/users/takluyver/orgs",
      "repos_url": "https://api.github.com/users/takluyver/repos",
      "events_url": "https://api.github.com/users/takluyver/events{/privacy}",
      "received_events_url": "https://api.github.com/users/takluyver/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2011-10-20T18:54:31Z",
    "updated_at": "2011-10-20T18:54:31Z",
    "author_association": "MEMBER",
    "body": "On #909, @minrk says it works for him with IPYTHONDIR on an NFS mount. I don't know what the key difference is.\n"
  },
  {
    "url": "https://api.github.com/repos/ipython/ipython/issues/comments/2472909",
    "html_url": "https://github.com/ipython/ipython/issues/882#issuecomment-2472909",
    "issue_url": "https://api.github.com/repos/ipython/ipython/issues/882",
    "id": 2472909,
    "node_id": "MDEyOklzc3VlQ29tbWVudDI0NzI5MDk=",
    "user": {
      "login": "minrk",
      "id": 151929,
      "node_id": "MDQ6VXNlcjE1MTkyOQ==",
      "avatar_url": "https://avatars1.githubusercontent.com/u/151929?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/minrk",
      "html_url": "https://github.com/minrk",
      "followers_url": "https://api.github.com/users/minrk/followers",
      "following_url": "https://api.github.com/users/minrk/following{/other_user}",
      "gists_url": "https://api.github.com/users/minrk/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/minrk/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/minrk/subscriptions",
      "organizations_url": "https://api.github.com/users/minrk/orgs",
      "repos_url": "https://api.github.com/users/minrk/repos",
      "events_url": "https://api.github.com/users/minrk/events{/privacy}",
      "received_events_url": "https://api.github.com/users/minrk/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2011-10-20T19:03:54Z",
    "updated_at": "2011-10-20T19:03:54Z",
    "author_association": "MEMBER",
    "body": "Like the SQLite docs say, it affects 'many NFS implementations', not all. And I imagine that it can depend on configuration - my NFS environment was configured quite a bit from the defaults, which may matter.\n"
  },
  {
    "url": "https://api.github.com/repos/ipython/ipython/issues/comments/2482620",
    "html_url": "https://github.com/ipython/ipython/issues/882#issuecomment-2482620",
    "issue_url": "https://api.github.com/repos/ipython/ipython/issues/882",
    "id": 2482620,
    "node_id": "MDEyOklzc3VlQ29tbWVudDI0ODI2MjA=",
    "user": {
      "login": "fperez",
      "id": 57394,
      "node_id": "MDQ6VXNlcjU3Mzk0",
      "avatar_url": "https://avatars1.githubusercontent.com/u/57394?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/fperez",
      "html_url": "https://github.com/fperez",
      "followers_url": "https://api.github.com/users/fperez/followers",
      "following_url": "https://api.github.com/users/fperez/following{/other_user}",
      "gists_url": "https://api.github.com/users/fperez/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/fperez/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/fperez/subscriptions",
      "organizations_url": "https://api.github.com/users/fperez/orgs",
      "repos_url": "https://api.github.com/users/fperez/repos",
      "events_url": "https://api.github.com/users/fperez/events{/privacy}",
      "received_events_url": "https://api.github.com/users/fperez/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2011-10-21T15:31:29Z",
    "updated_at": "2011-10-21T15:31:29Z",
    "author_association": "MEMBER",
    "body": "This is nasty: I'm not quite sure how to detect whether a path is on nfs (I can think of several hacks, but I don't know how reliable/portable/robust they would be).  In the long run, I think the solution will have to be to allow the history db to be housed at runtime in a temp directory.  IPython would have to copy the db out to a temp directory on startup, use it from the temp directory, and copy it back to its normal place in atexit() operations.  Some care will be needed to ensure that with multiple concurrent sessions, only the first copies the database file out so later ones don't clobber it.  Handling the fact that sessions can die via segfaults without doing atexit cleanups will be very tricky.\n\n@abeld, in the meantime, your best bet will be to set the `IPYTHON_DIR` environment variable to point to a non-NFS mount. I realize this is not ideal, as I imagine you're in a shop where $HOME is on NFS. But we hadn't anticipated this clash between NFS and sqlite, and now it's not really easy to back out of our sqlite implementation into a flat file one anymore...\n"
  },
  {
    "url": "https://api.github.com/repos/ipython/ipython/issues/comments/2563499",
    "html_url": "https://github.com/ipython/ipython/issues/882#issuecomment-2563499",
    "issue_url": "https://api.github.com/repos/ipython/ipython/issues/882",
    "id": 2563499,
    "node_id": "MDEyOklzc3VlQ29tbWVudDI1NjM0OTk=",
    "user": {
      "login": "minrk",
      "id": 151929,
      "node_id": "MDQ6VXNlcjE1MTkyOQ==",
      "avatar_url": "https://avatars1.githubusercontent.com/u/151929?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/minrk",
      "html_url": "https://github.com/minrk",
      "followers_url": "https://api.github.com/users/minrk/followers",
      "following_url": "https://api.github.com/users/minrk/following{/other_user}",
      "gists_url": "https://api.github.com/users/minrk/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/minrk/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/minrk/subscriptions",
      "organizations_url": "https://api.github.com/users/minrk/orgs",
      "repos_url": "https://api.github.com/users/minrk/repos",
      "events_url": "https://api.github.com/users/minrk/events{/privacy}",
      "received_events_url": "https://api.github.com/users/minrk/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2011-10-29T04:45:04Z",
    "updated_at": "2011-10-29T04:45:04Z",
    "author_association": "MEMBER",
    "body": "I don't think it's feasible to detect NFS in particular, move the db to a temp location, and restore it after the session.  I think we just have to instruct users on NFS to put their history somewhere local (`ipython --HistoryManager.hist_file='/tmp/iphist.sqlite'` _should_ work, but there is something funky in `HistoryAccessor.__init__`, preventing config from having any effect.  I think it's using its own default mechanism, so it effectively ignores configuration.  I would imagine that a symlink to outside the NFS mount should also work.\n\nWhat would be helpful is if we can more directly detect a _hang_ in the right place, and then show a message, explaining how to put their history off of the NFS mount.\n\n@takluyver - Am I right in assuming that it is the init_db call that would be hanging?  Perhaps we can detect a hang there with SIGALRM (though it may be a locked up call that won't respond to the signal).\n"
  },
  {
    "url": "https://api.github.com/repos/ipython/ipython/issues/comments/2564440",
    "html_url": "https://github.com/ipython/ipython/issues/882#issuecomment-2564440",
    "issue_url": "https://api.github.com/repos/ipython/ipython/issues/882",
    "id": 2564440,
    "node_id": "MDEyOklzc3VlQ29tbWVudDI1NjQ0NDA=",
    "user": {
      "login": "takluyver",
      "id": 327925,
      "node_id": "MDQ6VXNlcjMyNzkyNQ==",
      "avatar_url": "https://avatars3.githubusercontent.com/u/327925?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/takluyver",
      "html_url": "https://github.com/takluyver",
      "followers_url": "https://api.github.com/users/takluyver/followers",
      "following_url": "https://api.github.com/users/takluyver/following{/other_user}",
      "gists_url": "https://api.github.com/users/takluyver/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/takluyver/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/takluyver/subscriptions",
      "organizations_url": "https://api.github.com/users/takluyver/orgs",
      "repos_url": "https://api.github.com/users/takluyver/repos",
      "events_url": "https://api.github.com/users/takluyver/events{/privacy}",
      "received_events_url": "https://api.github.com/users/takluyver/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2011-10-29T11:05:39Z",
    "updated_at": "2011-10-29T11:05:39Z",
    "author_association": "MEMBER",
    "body": "I think it's the sqlite3.connect call hanging, yes. The trace above shows an open() call at the C level.\n"
  },
  {
    "url": "https://api.github.com/repos/ipython/ipython/issues/comments/2955836",
    "html_url": "https://github.com/ipython/ipython/issues/882#issuecomment-2955836",
    "issue_url": "https://api.github.com/repos/ipython/ipython/issues/882",
    "id": 2955836,
    "node_id": "MDEyOklzc3VlQ29tbWVudDI5NTU4MzY=",
    "user": {
      "login": "fperez",
      "id": 57394,
      "node_id": "MDQ6VXNlcjU3Mzk0",
      "avatar_url": "https://avatars1.githubusercontent.com/u/57394?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/fperez",
      "html_url": "https://github.com/fperez",
      "followers_url": "https://api.github.com/users/fperez/followers",
      "following_url": "https://api.github.com/users/fperez/following{/other_user}",
      "gists_url": "https://api.github.com/users/fperez/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/fperez/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/fperez/subscriptions",
      "organizations_url": "https://api.github.com/users/fperez/orgs",
      "repos_url": "https://api.github.com/users/fperez/repos",
      "events_url": "https://api.github.com/users/fperez/events{/privacy}",
      "received_events_url": "https://api.github.com/users/fperez/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2011-11-30T06:53:06Z",
    "updated_at": "2011-11-30T06:53:06Z",
    "author_association": "MEMBER",
    "body": "Guys, in light of #909 and #940 having been merged, I'm closing this, as I don't think there's anything more we can do.  The nfs limitations of sqlite are beyond our power to fix, and now we have alternatives thanks to these two PRs, so there really isn't anything else we can do here.  Unfortunately, users whose `IPYTHON_DIR` is on an NFS mount that exhibits this problem, will need to manually config their hist files to reside elsewhere.\n"
  }
]
