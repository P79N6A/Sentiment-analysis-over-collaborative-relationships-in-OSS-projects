[
  {
    "url": "https://api.github.com/repos/OpenRA/OpenRA/issues/comments/282362116",
    "html_url": "https://github.com/OpenRA/OpenRA/issues/12843#issuecomment-282362116",
    "issue_url": "https://api.github.com/repos/OpenRA/OpenRA/issues/12843",
    "id": 282362116,
    "node_id": "MDEyOklzc3VlQ29tbWVudDI4MjM2MjExNg==",
    "user": {
      "login": "xp65",
      "id": 6690499,
      "node_id": "MDQ6VXNlcjY2OTA0OTk=",
      "avatar_url": "https://avatars2.githubusercontent.com/u/6690499?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/xp65",
      "html_url": "https://github.com/xp65",
      "followers_url": "https://api.github.com/users/xp65/followers",
      "following_url": "https://api.github.com/users/xp65/following{/other_user}",
      "gists_url": "https://api.github.com/users/xp65/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/xp65/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/xp65/subscriptions",
      "organizations_url": "https://api.github.com/users/xp65/orgs",
      "repos_url": "https://api.github.com/users/xp65/repos",
      "events_url": "https://api.github.com/users/xp65/events{/privacy}",
      "received_events_url": "https://api.github.com/users/xp65/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2017-02-24T18:10:05Z",
    "updated_at": "2017-02-24T18:38:34Z",
    "author_association": "NONE",
    "body": "Additionally, see Ore Truck issue for the player in the UK early in game (see screenshot).\r\n\r\nThe AI places an infantry in the position of the refinery and all ore trucks get stuck there.\r\n\r\n![openra-2017-02-24t180915063z](https://cloud.githubusercontent.com/assets/6690499/23315045/bec57d42-fac4-11e6-9a96-8b3b1675a07e.png)\r\n"
  },
  {
    "url": "https://api.github.com/repos/OpenRA/OpenRA/issues/comments/282400244",
    "html_url": "https://github.com/OpenRA/OpenRA/issues/12843#issuecomment-282400244",
    "issue_url": "https://api.github.com/repos/OpenRA/OpenRA/issues/12843",
    "id": 282400244,
    "node_id": "MDEyOklzc3VlQ29tbWVudDI4MjQwMDI0NA==",
    "user": {
      "login": "xp65",
      "id": 6690499,
      "node_id": "MDQ6VXNlcjY2OTA0OTk=",
      "avatar_url": "https://avatars2.githubusercontent.com/u/6690499?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/xp65",
      "html_url": "https://github.com/xp65",
      "followers_url": "https://api.github.com/users/xp65/followers",
      "following_url": "https://api.github.com/users/xp65/following{/other_user}",
      "gists_url": "https://api.github.com/users/xp65/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/xp65/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/xp65/subscriptions",
      "organizations_url": "https://api.github.com/users/xp65/orgs",
      "repos_url": "https://api.github.com/users/xp65/repos",
      "events_url": "https://api.github.com/users/xp65/events{/privacy}",
      "received_events_url": "https://api.github.com/users/xp65/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2017-02-24T20:47:07Z",
    "updated_at": "2017-02-24T20:54:01Z",
    "author_association": "NONE",
    "body": "Additional information about the performance in screenshots:\r\n\r\nStill slow, just before \"killing\" the second last player (other player is on the left bottom)\r\nThe AI player has only a few troops left (all on screen).\r\n![openra-2017-02-24t203527078z](https://cloud.githubusercontent.com/assets/6690499/23320234/2aefdcdc-fada-11e6-94ca-54b354833936.png)\r\n\r\nAfter the AI is defeated, it's fast, very fast. All the time I was thinking the slowdown was due to lots of boats and other units on the map... but it wasn't..\r\n![openra-2017-02-24t203532860z](https://cloud.githubusercontent.com/assets/6690499/23320312/78431e9a-fada-11e6-80a8-e202b519b5c9.png)\r\n\r\nAnd then there finally was a high frame rate to kill the last player (it never went too slow again, but at a stage in the end it had weird slow downs as well, but nothing that is too annoying).\r\n![openra-2017-02-24t203543057z](https://cloud.githubusercontent.com/assets/6690499/23320369/baffd32c-fada-11e6-9419-85ab357316ba.png)\r\n"
  },
  {
    "url": "https://api.github.com/repos/OpenRA/OpenRA/issues/comments/282406534",
    "html_url": "https://github.com/OpenRA/OpenRA/issues/12843#issuecomment-282406534",
    "issue_url": "https://api.github.com/repos/OpenRA/OpenRA/issues/12843",
    "id": 282406534,
    "node_id": "MDEyOklzc3VlQ29tbWVudDI4MjQwNjUzNA==",
    "user": {
      "login": "Mailaender",
      "id": 756669,
      "node_id": "MDQ6VXNlcjc1NjY2OQ==",
      "avatar_url": "https://avatars0.githubusercontent.com/u/756669?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/Mailaender",
      "html_url": "https://github.com/Mailaender",
      "followers_url": "https://api.github.com/users/Mailaender/followers",
      "following_url": "https://api.github.com/users/Mailaender/following{/other_user}",
      "gists_url": "https://api.github.com/users/Mailaender/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/Mailaender/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/Mailaender/subscriptions",
      "organizations_url": "https://api.github.com/users/Mailaender/orgs",
      "repos_url": "https://api.github.com/users/Mailaender/repos",
      "events_url": "https://api.github.com/users/Mailaender/events{/privacy}",
      "received_events_url": "https://api.github.com/users/Mailaender/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2017-02-24T21:16:11Z",
    "updated_at": "2017-02-24T21:16:11Z",
    "author_association": "MEMBER",
    "body": "> 2012 ms [93930] Trait: player->HackyAI\r\n\r\nSomething in the AI code is really costly here."
  },
  {
    "url": "https://api.github.com/repos/OpenRA/OpenRA/issues/comments/282482328",
    "html_url": "https://github.com/OpenRA/OpenRA/issues/12843#issuecomment-282482328",
    "issue_url": "https://api.github.com/repos/OpenRA/OpenRA/issues/12843",
    "id": 282482328,
    "node_id": "MDEyOklzc3VlQ29tbWVudDI4MjQ4MjMyOA==",
    "user": {
      "login": "RoosterDragon",
      "id": 3399086,
      "node_id": "MDQ6VXNlcjMzOTkwODY=",
      "avatar_url": "https://avatars0.githubusercontent.com/u/3399086?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/RoosterDragon",
      "html_url": "https://github.com/RoosterDragon",
      "followers_url": "https://api.github.com/users/RoosterDragon/followers",
      "following_url": "https://api.github.com/users/RoosterDragon/following{/other_user}",
      "gists_url": "https://api.github.com/users/RoosterDragon/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/RoosterDragon/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/RoosterDragon/subscriptions",
      "organizations_url": "https://api.github.com/users/RoosterDragon/orgs",
      "repos_url": "https://api.github.com/users/RoosterDragon/repos",
      "events_url": "https://api.github.com/users/RoosterDragon/events{/privacy}",
      "received_events_url": "https://api.github.com/users/RoosterDragon/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2017-02-25T12:56:48Z",
    "updated_at": "2017-02-25T12:56:48Z",
    "author_association": "MEMBER",
    "body": "The AI is spending its time [issuing new attack orders](https://github.com/OpenRA/OpenRA/blob/release-20161019/OpenRA.Mods.Common/AI/States/GroundStates.cs#L145).\r\n\r\n[Finding the closest enemy](https://github.com/OpenRA/OpenRA/blob/release-20161019/OpenRA.Mods.Common/AI/HackyAI.cs#L606-L609) is not a cheap operation. This is likely the reason for the large lag spike.\r\n\r\nI suspect it is choosing an invalid target, which means it has to try and find a new one again, which it tries to do roughly every second. The [filter](https://github.com/OpenRA/OpenRA/blob/release-20161019/OpenRA.Mods.Common/AI/HackyAI.cs#L312-L315) only specifies a targetable enemy non-husk unit and makes no further attempt to ensure the target is valid for the actors involved.\r\n\r\n- The main fix would be to ensure a valid target is chosen. There is a [`CanAttackTarget`](https://github.com/OpenRA/OpenRA/blob/release-20161019/OpenRA.Mods.Common/AI/States/StateBase.cs#L62-L77) method that sounds suited for the job.\r\n- `FindClosestEnemy` has to check every unit for suitability and then find the nearest. In a world with many units this is expensive. A quick fix for that is `Worlds.Actors.OrderBy(distance).Where(isEnemyUnit).FirstOrDefault()`, if sorting turns out to be cheaper than filtering all the units. A fancier fix would be to use the spatial partitions in the actor map to return actors in approximate distance order. This is more work but means if there is a nearby target we can bail out much sooner without having to check every actor."
  },
  {
    "url": "https://api.github.com/repos/OpenRA/OpenRA/issues/comments/282488171",
    "html_url": "https://github.com/OpenRA/OpenRA/issues/12843#issuecomment-282488171",
    "issue_url": "https://api.github.com/repos/OpenRA/OpenRA/issues/12843",
    "id": 282488171,
    "node_id": "MDEyOklzc3VlQ29tbWVudDI4MjQ4ODE3MQ==",
    "user": {
      "login": "xp65",
      "id": 6690499,
      "node_id": "MDQ6VXNlcjY2OTA0OTk=",
      "avatar_url": "https://avatars2.githubusercontent.com/u/6690499?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/xp65",
      "html_url": "https://github.com/xp65",
      "followers_url": "https://api.github.com/users/xp65/followers",
      "following_url": "https://api.github.com/users/xp65/following{/other_user}",
      "gists_url": "https://api.github.com/users/xp65/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/xp65/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/xp65/subscriptions",
      "organizations_url": "https://api.github.com/users/xp65/orgs",
      "repos_url": "https://api.github.com/users/xp65/repos",
      "events_url": "https://api.github.com/users/xp65/events{/privacy}",
      "received_events_url": "https://api.github.com/users/xp65/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2017-02-25T14:43:06Z",
    "updated_at": "2017-02-25T14:43:06Z",
    "author_association": "NONE",
    "body": "Thanks @Mailaender and @RoosterDragon  for looking into this. \r\n\r\nThe odd thing is, in the end my units are near his base, but the AI does not really use his army on the right to defend. If it rechecks every second for `FindClosestEnemy`, shoudn't it find my nearest units? and earlier in the game find the other AI just next to him? "
  }
]
