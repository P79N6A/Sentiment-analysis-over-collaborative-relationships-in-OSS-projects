[
  {
    "url": "https://api.github.com/repos/OpenRA/OpenRA/issues/comments/116316233",
    "html_url": "https://github.com/OpenRA/OpenRA/issues/8591#issuecomment-116316233",
    "issue_url": "https://api.github.com/repos/OpenRA/OpenRA/issues/8591",
    "id": 116316233,
    "node_id": "MDEyOklzc3VlQ29tbWVudDExNjMxNjIzMw==",
    "user": {
      "login": "Basti504",
      "id": 5729926,
      "node_id": "MDQ6VXNlcjU3Mjk5MjY=",
      "avatar_url": "https://avatars1.githubusercontent.com/u/5729926?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/Basti504",
      "html_url": "https://github.com/Basti504",
      "followers_url": "https://api.github.com/users/Basti504/followers",
      "following_url": "https://api.github.com/users/Basti504/following{/other_user}",
      "gists_url": "https://api.github.com/users/Basti504/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/Basti504/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/Basti504/subscriptions",
      "organizations_url": "https://api.github.com/users/Basti504/orgs",
      "repos_url": "https://api.github.com/users/Basti504/repos",
      "events_url": "https://api.github.com/users/Basti504/events{/privacy}",
      "received_events_url": "https://api.github.com/users/Basti504/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2015-06-28T19:09:08Z",
    "updated_at": "2015-06-28T19:09:08Z",
    "author_association": "NONE",
    "body": "And a link to the replay.\nhttps://www.dropbox.com/s/brie5jvpirm3jv0/OpenRA-2015-06-28T183538Z.orarep?dl=0\n"
  },
  {
    "url": "https://api.github.com/repos/OpenRA/OpenRA/issues/comments/116319695",
    "html_url": "https://github.com/OpenRA/OpenRA/issues/8591#issuecomment-116319695",
    "issue_url": "https://api.github.com/repos/OpenRA/OpenRA/issues/8591",
    "id": 116319695,
    "node_id": "MDEyOklzc3VlQ29tbWVudDExNjMxOTY5NQ==",
    "user": {
      "login": "penev92",
      "id": 7137365,
      "node_id": "MDQ6VXNlcjcxMzczNjU=",
      "avatar_url": "https://avatars2.githubusercontent.com/u/7137365?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/penev92",
      "html_url": "https://github.com/penev92",
      "followers_url": "https://api.github.com/users/penev92/followers",
      "following_url": "https://api.github.com/users/penev92/following{/other_user}",
      "gists_url": "https://api.github.com/users/penev92/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/penev92/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/penev92/subscriptions",
      "organizations_url": "https://api.github.com/users/penev92/orgs",
      "repos_url": "https://api.github.com/users/penev92/repos",
      "events_url": "https://api.github.com/users/penev92/events{/privacy}",
      "received_events_url": "https://api.github.com/users/penev92/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2015-06-28T19:34:20Z",
    "updated_at": "2015-06-28T19:34:20Z",
    "author_association": "MEMBER",
    "body": "Hint to potential volunteers:\nIt's most likely one of [these two lines](https://github.com/OpenRA/OpenRA/blob/bleed/OpenRA.Mods.Common/Orders/PlaceBuildingOrderGenerator.cs#L37-L38), but you'd still need to see which one exactly.\n"
  },
  {
    "url": "https://api.github.com/repos/OpenRA/OpenRA/issues/comments/120546473",
    "html_url": "https://github.com/OpenRA/OpenRA/issues/8591#issuecomment-120546473",
    "issue_url": "https://api.github.com/repos/OpenRA/OpenRA/issues/8591",
    "id": 120546473,
    "node_id": "MDEyOklzc3VlQ29tbWVudDEyMDU0NjQ3Mw==",
    "user": {
      "login": "obrakmann",
      "id": 4331210,
      "node_id": "MDQ6VXNlcjQzMzEyMTA=",
      "avatar_url": "https://avatars1.githubusercontent.com/u/4331210?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/obrakmann",
      "html_url": "https://github.com/obrakmann",
      "followers_url": "https://api.github.com/users/obrakmann/followers",
      "following_url": "https://api.github.com/users/obrakmann/following{/other_user}",
      "gists_url": "https://api.github.com/users/obrakmann/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/obrakmann/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/obrakmann/subscriptions",
      "organizations_url": "https://api.github.com/users/obrakmann/orgs",
      "repos_url": "https://api.github.com/users/obrakmann/repos",
      "events_url": "https://api.github.com/users/obrakmann/events{/privacy}",
      "received_events_url": "https://api.github.com/users/obrakmann/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2015-07-10T22:55:21Z",
    "updated_at": "2015-07-10T22:55:21Z",
    "author_association": "CONTRIBUTOR",
    "body": "The replay didn't record the crash unfortunately. I'm betting money on the bug being [here](https://github.com/OpenRA/OpenRA/blob/bleed/OpenRA.Mods.Common/Orders/PlaceBuildingOrderGenerator.cs#L52), though. If there are no more producers, `MostLikelyProducer` returns a `TraitPair` with both fields set to null, so dereferencing the trait field of the pair crashes.\n\nFix would be something like this:\n\n``` diff\ndiff --git a/OpenRA.Mods.Common/Orders/PlaceBuildingOrderGenerator.cs b/OpenRA.Mods.Common/Orders/PlaceBuildingOrderGenerator.cs\nindex 6c0da3f..f107a7e 100644\n--- a/OpenRA.Mods.Common/Orders/PlaceBuildingOrderGenerator.cs\n+++ b/OpenRA.Mods.Common/Orders/PlaceBuildingOrderGenerator.cs\n@@ -49,7 +49,8 @@ public PlaceBuildingOrderGenerator(ProductionQueue queue, string name)\n                        buildingInfo = info.Traits.Get<BuildingInfo>();\n\n                        var buildableInfo = info.Traits.Get<BuildableInfo>();\n-                       race = buildableInfo.ForceRace ?? queue.MostLikelyProducer().Trait.Race;\n+                       var mostLikelyProducer = queue.MostLikelyProducer();\n+                       race = buildableInfo.ForceRace ?? (mostLikelyProducer.Trait != null ? mostLikelyProducer.Trait.Race : producer.Owner.Country.Race);\n\n                        buildOk = map.SequenceProvider.GetSequence(\"overlay\", \"build-valid-{0}\".F(tileset)).GetSprite(0);\n                        buildBlocked = map.SequenceProvider.GetSequence(\"overlay\", \"build-invalid\").GetSprite(0);\n\n```\n\nComments?\n"
  }
]
